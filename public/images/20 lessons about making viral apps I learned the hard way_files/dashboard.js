/*! scripts/tumblr/utils/exceptions.js */
(function(y,D){var w=y.document;var a=y.encodeURIComponent;var d=y.navigator;var r=y.parseInt;var q=y.performance;var l=y.window;var e=y.Date;var C=y.Error;var m=y.Math;var u=y.XMLHttpRequest;var f=[];var n=[];function v(G,F,H,E){G.addEventListener?G.addEventListener(F,H,!!E):G.attachEvent&&G.attachEvent("on"+F,H,!!E)}function c(F,E){return(typeof F==="string")&&(F.length>E)?[F.slice(0,E/2),"...",F.length-E,"...",F.slice(-E/2)].join(""):F}function o(I,G){var J=[];for(var H in I){if(!I.hasOwnProperty(H)){continue}var F=G?(G+"["+H+"]"):H,E=I[H];J.push(typeof E==="object"?o(E,F):a(F)+"="+a(E))}return J.join("&")}var s=(function(E){return(E&&E.keys)||function(I){var F=[];var H=E.prototype.hasOwnProperty;for(var G in I){H.call(I,G)&&F.push(G)}return F}})(y.Object);var B=function(F,I,G){if(typeof I!=="function"){return}var E=(F&&F.length)>>>0;for(var H=0;H<E;H++){I.call(G,F[H],H,F)}};var x=(function(E){return(E&&E.stringify&&function(G){try{return E.stringify(G)}catch(F){A(F);return'"FAILED_JSON_STRINGIFY"'}})||function(){return'"NO_JSON_STRINGIFY"'}})(y.JSON);var h=(function(E){return(E&&E.Features)||(function(){A(new C("Missing Tumblr.Features in exceptions.js"));var F={enable_js_errors_log:true,enable_js_ephemeral_log:true};function G(H,I){return(typeof H==="function")?H.call(this,I):H}return function(I){var H=!!(F[I]);return function J(L,M){var K=G.call(this,(H?L:M),H);return(K!==void 0)?K:J}}})()})(y.Tumblr);function A(F,E){if(typeof E==="number"&&m.random()>E){return}if(F instanceof C){F.url||(F.url="//www.tumblr.com/");i(F.message,F.url,F.ln,F.col,F)}else{f.push(x(F))}}var t=/https?:\/\//;var k=/https?:\/\/[^/]*tumblr[^/]*/;function i(I,F,H,E,G){try{F=c(F,300)||"";if(t.test(F)&&!k.test(F)){return}G=x(c(G&&G.stack,1000)||"");if(t.test(G)&&!k.test(G)){return}n.push({path:(w.location||{}).pathname||"NO_LOCATION_OR_PATHNAME",msg:c(I,200)||"",url:F,ln:r(H,10)||-1,col:r(E,10)||-1,err:G})}catch(G){}}function b(){return((w.head||{}).innerHTML||"").indexOf("#missinge_button")!==-1}var g=A.debugDump=function(){var E=[];B(w.getElementsByTagName("script"),function(F){E.push(F.src)});return{timestamp:+new e(),path:(w.location||{}).href||"NO_HREF",lang:(d||{}).userLanguage||(d||{}).language||"NO_LANG",referrer:w.referrer||"NO_REFERRER",ua:(d||{}).userAgent||"NO_UA",timing:(q||{}).timing||"NO_TIMING",scripts:E,globals:s(y),cookie:w.cookie,ephemeral:f,errors:n,document:(w.documentElement||{}).innerHTML||"NO_DOCUMENT"}};function p(E){var F=g();F.name=E;return x(F)}function j(){try{var E;!b()&&h("enable_js_errors_log")(function(){n.length&&((E||(E={})).errors=n)});h("enable_js_ephemeral_log")(function(){f.length&&((E||(E={})).ephemeral=f)});h("js_debugger_1")(function(){(E||(E={})).ephemeral=[p("js_debugger_1")]});h("js_debugger_2")(function(){(E||(E={})).ephemeral=[p("js_debugger_2")]});if(!E){return}var G=new u();G.open("POST","/svc/log/capture/exceptions",false);G.setRequestHeader("Content-type","application/x-www-form-urlencoded");G.onreadystatechange=function(){if(G.readyState!==4){return}n.length=f.length=0};G.send(o({form_key:(w.getElementById("tumblr_form_key")||w.body).getAttribute("content"),log:E}))}catch(F){if(!y.jQuery){return}A(F);(E||(E={})).errors||(E.errors=n);y.jQuery.ajax({async:false,type:"POST",data:{form_key:y.jQuery("#tumblr_form_key").attr("content"),log:E},url:"/svc/log/capture/exceptions",with_form_key:true})}}(function z(){v(l,"beforeunload",j);l.onerror=i})();(D.Utils||(D.Utils={})).exceptions=A})(this,this.Tumblr||(this.Tumblr={}));
/*! scripts/application.js */
var video_thumbnail_hover=false;function load_typekit(){if(typeof Typekit!="undefined"){return}TypekitConfig={kitId:"dzi2tiv"};(function(){var a=document.createElement("script");a.src="//use.typekit.com/"+TypekitConfig.kitId+".js";a.type="text/javascript";a.async="true";a.onload=a.onreadystatechange=function(){var c=this.readyState;if(c&&c!="complete"&&c!="loaded"){return}try{Typekit.load(TypekitConfig)}catch(d){}};var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})()}function select_field(a){if(a.createTextRange){var b=a.createTextRange();b.moveStart("character",0);b.moveEnd("character",a.value.length);b.select()}else{if(a.setSelectionRange){a.setSelectionRange(0,a.value.length)}}}function get_cookie(d){var b=document.cookie;var g,f=b.split(";");var e,a=f.length;for(e=0;e<a;e+=1){if((g=f[e].replace(/^\s+|\s+$/g,"").split("="))[0]==d){return{name:g[0],value:g[1]}}}return false}function set_cookie(a,f,h,c){c=c||{};var b=new Date();var g=(typeof(c.path)!=="undefined")?c.path:"/";var e=(typeof(c.is_secure)!=="undefined")?true:false;var d=(typeof(c.domain)!=="undefined")?c.domain:"";b.setDate(b.getDate()+h);document.cookie=a+"="+escape(f)+((h==null)?"":";expires="+b.toGMTString())+";path="+g+((e===false)?"":";secure")+((d==="")?"":";domain="+d)}function unset_cookie(a){set_cookie(a,"",-1)}var trackable_follow=function(c,g,f,b,a,d,e){b=b||function(){};a=a||function(){};d=d||function(){};e=e||function(){};Tumblr.follow({tumblelog:f},{init:b,success:a,error:d,complete:e})};function toggle_video_embed(a){var b=jQuery;if(!b("#watch_video_"+a).is(":visible")){b("#video_embed_"+a).html(b("#video_code_"+a).val());b("#video_toggle_"+a).hide();b("#watch_video_"+a).show();if(typeof _gaq!=="undefined"&&_gaq){_gaq.push(["_trackEvent","dashboard_video","click","normal"])}}else{b("#video_embed_"+a).html("");b("#video_toggle_"+a).show();b("#watch_video_"+a).hide();if(typeof _gaq!=="undefined"&&_gaq){_gaq.push(["_trackEvent","dashboard_video","hide","normal"])}}}function cycle_video_thumbnails(b,c){var a=jQuery("#video_thumbnail_"+b);if(!a.attr("thumbnails")){return false}var d=a.attr("thumbnails").split("   |   ");if(!d.length){return false}if(c=="preload"){for(i=0;i<d.length;i++){add_to_image_queue(false,d[i])}}else{if(c=="start"){a.attr("original_src",a.src);a.attr("thumbnail_index",1);a.attr("src",d[1]);video_thumbnail_hover=window.setInterval(function(){index=parseInt(a.attr("thumbnail_index"),10)+1;if(index==d.length){index=0}a.attr("src",d[index]);a.attr("thumbnail_index",index)},500)}else{if(c=="stop"){window.clearInterval(video_thumbnail_hover);a.attr("src",a.attr("original_src"));a.removeAttr("thumbnail_index");a.removeAttr("original_src")}}}};
/*! scripts/tumblr/utils/prefixer.js */
Tumblr.Utils||(Tumblr.Utils={});(function(e){var d=(function(){var g=document.documentElement.style;var h=[];for(var i in g){if(typeof g[i]==="string"){h.push(i)}}return h.join(" ")})();var b=function(g){return new RegExp("\\b((webkit|moz|ms|o|)"+g.toLowerCase()+")\\b","i")};var a={};function f(h){if(a[h]===void 0){if(b(h).test(d)){var g=RegExp.$1;a[h]={js:g,css:(g[0]+g.slice(1).replace(/[A-Z]/g,"-$&")).toLowerCase()}}else{a[h]=false}}return a[h]}f.style=function c(j,i,l){var h,g;if(l){h={};h[i]=l}else{h=i}if(j.jquery){j=j[0]}for(var k in h){g=h[k];j.style[f(k).js]=g}return j};e.prefixer=f})(Tumblr.Utils);
/*! scripts/polyfills/function.bind.polyfill.js */
if(!Function.prototype.bind){Function.prototype.bind=function(a){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var e=Array.prototype.slice.call(arguments,1),d=this,b=function(){},c=function(){return d.apply(this instanceof b&&a?this:a,e.concat(Array.prototype.slice.call(arguments)))};b.prototype=this.prototype;c.prototype=new b();return c}};
/*! scripts/tumblelog/styler.js */
(function(a){function c(f,k,l){if(Array.prototype.indexOf){return f.indexOf(k,l)}for(var h=(l||0),g=f.length;h<g;h++){if(f[h]===k){return h}}return -1}function b(g,f){var i=[];if(!g){return i}for(var h in g){if(g.hasOwnProperty(h)){i.push(h)}}if(f&&f.length){return i.sort(function(k,j){return c(f,k)-c(f,j)})}return i}function e(){var f=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};return(f()+f()+"-"+f()+"-"+f()+"-"+f()+"-"+f()+f()+f())}var d=function(f){if(!(this instanceof d)){return new d(f)}if(!f){f={}}if(typeof f==="string"){f={id:f}}this.el=d.create_stylesheet(f.id||e());if(f.media_query){this.set_media_query(f.media_query)}this.selectors={};this.selectors_order=[];if(f.styles){this.import_styles(f.styles)}this.attach();d.register(this);return this};d.prototype={add_px:function(f){if(typeof f==="string"&&f.match(/\D/)){return f}return f+"px"},add_px_value:function(g,f){switch(g){case"top":case"right":case"bottom":case"left":case"width":case"height":return this.add_px(f);default:return f}},import_styles:function(g){for(var f in g){this.set(f,g[f])}},set_media_query:function(f){this.el.media=f||""},set:function(f,i,h,j){if(typeof this.selectors[f]==="undefined"){this.selectors[f]={properties:{},properties_order:[]};this.selectors_order.push(f)}f=this.selectors[f];if(typeof i==="object"){var g=i;j=h;for(i in g){if(typeof f.properties[i]==="undefined"){f.properties_order.push(i)}h=g[i];f.properties[i]=this.add_px_value(i,h)}}else{if(typeof f.properties[i]==="undefined"){f.properties_order.push(i)}f.properties[i]=this.add_px_value(i,h)}if(typeof j==="undefined"){j=true}if(j){this.update()}},get:function(f,g){f=this.selectors[f];if(typeof f==="undefined"){return false}if(!g){return f}g=f.properties[g];if(typeof g==="undefined"){return false}return g},has:function(f,g){f=this.selectors[f];if(typeof f==="undefined"){return false}if(!g){return true}g=f[g];if(typeof g==="undefined"){return false}return(typeof g!=="undefined")&&g!==""},set_selectors_order:function(f){this.selectors_order=b(this.selectors,f);this.update();return true},set_properties_order:function(f,g){if(!f){for(f in this.selectors){if(!this.selectors.hasOwnProperty(f)){continue}f=this.selectors[f];f.properties_order=b(f.properties,g||d.default_properties_order)}this.update();return true}f=this.get(f);if(!f){return false}f.properties_order=b(f.properties,g||d.default_properties_order);this.update();return true},attach:function(){var f=document.getElementsByTagName("head")[0];if(!f){return false}this.update();f.appendChild(this.el);return true},detach:function(){var f=document.getElementsByTagName("head")[0];if(!f){return false}if(this.el.parentNode!==f){return false}this.el.parentNode.removeChild(this.el);return true},update:function(){var f=this.selector_to_text(this.selectors,this.selectors_order).replace(/</g,"&lt;").replace(/>/g,"&gt;");if(this.el.styleSheet){this.el.styleSheet.cssText="\n"+f}else{while(this.el.hasChildNodes()){this.el.removeChild(this.el.lastChild)}this.el.appendChild(document.createTextNode("\n"+f))}},selector_to_text:function(j,g){g||(g=b(j));var f;var k="";for(var h=0;h<g.length;h++){f=g[h];if(!(j.hasOwnProperty(f)&&j[f])){continue}k+=f+" {\n";k+=this.properties_to_text(j[f].properties,j[f].properties_order);k+="}\n"}return k},properties_to_text:function(h,f){f||(f=b(h));var k="";var j;for(var g=0;g<f.length;g++){j=f[g];if(!(h.hasOwnProperty(j)&&h[j]!=="")){continue}k+=j+": "+h[j]+";\n"}return k},toString:function(){return this.selector_to_text(this.selectors,this.selectors_order).replace(/</g,"&lt;").replace(/>/g,"&gt;")}};d.instances=[];d.default_properties_order=["font","font-family","font-size","font-style","font-variant","font-weight","@font-face","font-size-adjust","font-stretch","padding","padding-top","padding-right","padding-bottom","padding-left","margin","margin-top","margin-right","margin-bottom","margin-left","border","border-top","border-top-color","border-top-style","border-top-width","border-right","border-right-color","border-right-style","border-right-width","border-bottom","border-bottom-color","border-bottom-style","border-bottom-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius","background","background-color","background-position","background-size","background-repeat","background-origin","background-clip","background-attachment","background-image","overflow","overflow-x","overflow-y","transition","transition-property","transition-duration","transition-timing-function","transition-delay","transform","transform-origin","transform-style"];d.create_stylesheet=function(g){var f=document.createElement("style");f.type="text/css";if(g){f.id=g}return f};d.register=function(f){this.instances.push(f)};a.Styler=d})(this.Tumblr||(this.Tumblr={}));
/*! scripts/tumblelog/follow_teaser.js */
("Tumblr" in window)||(window.Tumblr={});Tumblr.FollowTeaser=(function(){var h=false,o=false,n=false,a=false,l={},c=310,p=110,i=false,b=new Tumblr.Styler({id:"tumblr_teaser_follow_css",styles:{"#tumblr_teaser_follow":{display:"block",opacity:"1",visibility:"hidden",position:"fixed",bottom:"0",right:"0",width:"1px",height:"1px","z-index":"2147483647"},"#tumblr_teaser_follow.open":{visibility:"visible",width:c+"px",height:p+"px"}}});function q(w,t){var x=[];for(var u in w){var s=t?t+"["+u+"]":u,r=w[u];x.push(typeof r=="object"?q(r,s):encodeURIComponent(s)+"="+encodeURIComponent(r))}return x.join("&")}var g=0;var e=9000;var d=200;var f=false;function j(){if(f){return}var s=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop||0;if((s>e||(Tumblr.FollowTeaser.current_page>=2&&s>500))&&Tumblr.FollowTeaser.can_show()){Tumblr.FollowTeaser.scroll_listener(false);return}if(Tumblr.FollowTeaser.infer_infinite_scroll){var r=document.body.clientHeight;if(r>g+100){Tumblr.FollowTeaser.current_page++;g=r}}f=true;setTimeout(function(){f=false},d)}var m;function k(){if(f){return}clearTimeout(m);m=setTimeout(j,300);f=true;setTimeout(function(){f=false},d)}return{infer_infinite_scroll:false,current_page:1,can_show:function(){n=true;var r=this.open(c,p);if(h){h.contentWindow.postMessage("follow_teaser;show","*")}return r},create_from_tumblr_controls:function(r){if(!(o=document.getElementById("tumblr_controls"))){return false}if(!(url_matches=o.src.match(/([^\?#]+\/)([^\/\?\#]\.html)?(\?_v=[^\&#]+)?([^#]*)(.*)?/i))){return false}this.initialize({url:(r||(url_matches[1]+"follow.html"))+url_matches[4]+url_matches[5]})},create_iframe:function(r){var s=document.createElement("iframe");s.id="tumblr_teaser_follow";s.width=1;s.height=1;s.frameBorder=0;s.scrolling="no";s.src=r;document.body.appendChild(s);return s},scroll_listener:function(r){if(r){if(window.addEventListener){window.addEventListener("scroll",k)}else{if(window.attachEvent){window.attachEvent("onscroll",k)}}}else{if(window.removeEventListener){window.removeEventListener("scroll",k)}else{if(window.detachEvent){window.detachEvent("onscroll",k)}}}},initialize:function(t){if(!Tumblr.PostMessageListener){return false}if(!t){t={}}g=document.body.clientHeight;e=Math.min(e,3*Tumblr.windowDimensions().height);var r=this;Tumblr.PostMessageListener.initialize(function(x,w){r.post_message_event(x,w)});h=document.getElementById("tumblr_teaser_tagged");o=document.getElementById("tumblr_controls");if(!h){var u=t.query||{};var s=t.url||"http://www.tumblr.com/assets/html/follow.html";var v=(s.indexOf("#")<0?"#":"&")+q(u);h=this.create_iframe(s+v)}},post_message_event:function(s,r){if(!s||s.length<2||s[0]!=="follow_iframe"){return false}switch(s[1]){case"resize":if(s.length>3){c=s[2];p=s[3];b.set("#tumblr_teaser_follow.open",{width:c+"px",height:p+"px"})}a=true;this.open(c,p);break;case"dismiss":this.close();break}function t(u,v){if(!(typeof u==="string"&&u.match(/\d+%/))){u=parseInt(u,10)||0}if(!(typeof v==="string"&&v.match(/\d+%/))){v=parseInt(v,10)||0}if(u){tumblelog_iframe.width=u}if(v){tumblelog_iframe.height=v}}},open:function(s,r){if(!h){return false}if(!(n&&a)){return false}if(i){return false}i=true;Tumblr.addClass(h,"open");o.style.display="none";return true},close:function(){if(!h){return}if(!i){return}i=false;n=false;Tumblr.removeClass(h,"open");o.style.display="block"},toggle:function(){if(!h){return}if(i){return this.close()}else{this.open()}}}})();
/*! scripts/tumblelog/teaser.js */
("Tumblr" in window)||(window.Tumblr={});Tumblr.Teaser=(function(){var a=false,e=false,b=false,f={hide:false,sneeze:false},c=false,d=360;return{is_enabled:function(){return !!e},initialize:function(h){e=document.getElementById("teaser_iframe");if(!e){return false}a=e.parentNode;if(!h){h={}}if(h.slide_page){c=h.slide_page}if(h.width){d=h.width}this.prepare(false);var g=this;if("addEventListener" in a){a.addEventListener("mouseout",function(i){if(!(i.relatedTarget||i.toElement)){g.close()}})}},prepare:function(i){if(!e){return}var g=0.25;var j=0.3;a.style.display="block";a.style.opacity="0";a.style.visibility="hidden";a.style.position="fixed";a.style.top="0";a.style.right="0";a.style.bottom="0";a.style.width="1px";a.style.height="100%";a.style.zIndex="2147483646";a.style.overflow="hidden";try{a.style.backgroundColor="rgba(0,0,0, 0.6)"}catch(h){}a.style.webkitTransition="width "+g+"s ease-in-out";a.style.MozTransition="width "+g+"s ease-in-out";a.style.msTransition="width "+g+"s ease-in-out";a.style.OTransition="width "+g+"s ease-in-out";a.style.transition="width "+g+"s ease-in-out";e.style.display="block";e.style.opacity="1";e.style.visibility="visible";e.style.position="absolute";e.style.top="0";e.style.right="0";e.style.minWidth="100%";e.style.width=d+"px";e.style.height="100%";if(c&&document.body.parentNode){document.body.parentNode.style.position="relative";document.body.parentNode.style.webkitTransition="right "+g+"s ease-in-out";document.body.parentNode.style.MozTransition="right "+g+"s ease-in-out";document.body.parentNode.style.msTransition="right "+g+"s ease-in-out";document.body.parentNode.style.OTransition="right "+g+"s ease-in-out";document.body.parentNode.style.transition="right "+g+"s ease-in-out";document.body.parentNode.style.right="0"}},refresh:function(){if(!e){return}e.contentWindow.postMessage("teaser;refresh","*")},reset_timers:function(){clearTimeout(f.hide);f.hide=false;clearTimeout(f.sneeze);f.sneeze=false},reset:function(){if(!e){return}this.reset_timers();a.style.opacity="0";this.refresh()},open:function(){if(!e){return}if(b){return}b=true;a.style.opacity="1";a.style.visibility="visible";a.style.width=d+"px";if(c&&document.body.parentNode){document.body.parentNode.style.right=d+"px"}e.contentWindow.postMessage("teaser;show","*");this.reset_timers();clearTimeout(f.sneeze);f.sneeze=setTimeout(function(){f.sneeze=false},100)},close:function(){if(!e){return}if(!b||f.sneeze){return}b=false;a.style.opacity="1";a.style.visibility="visible";a.style.width="1px";if(c&&document.body.parentNode){document.body.parentNode.style.right="0"}e.contentWindow.postMessage("teaser;hide","*");this.reset_timers();var g=this;f.hide=setTimeout(function(){g.reset()},300)},toggle:function(){if(!e){return}if(b){return this.close()}else{this.open()}}}})();
/*! scripts/tumblelog/legacy_tumblelog_video.js */
("Tumblr" in window)||(window.Tumblr={});Tumblr.flashVersion=function(){if(navigator.plugins&&navigator.plugins.length>0){var a=navigator.mimeTypes;if(a&&a["application/x-shockwave-flash"]&&a["application/x-shockwave-flash"].enabledPlugin&&a["application/x-shockwave-flash"].enabledPlugin.description){return parseInt(a["application/x-shockwave-flash"].enabledPlugin.description.split(" ")[2].split(".")[0],10)}}else{if(navigator.appVersion.indexOf("Mac")==-1&&window.execScript){try{var c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");var b=c.GetVariable("$version");return b.split(",")[0].split(" ")[1]}catch(d){}return 0}}};Tumblr.replaceIfFlash=function(b,a,c){if(Tumblr.flashVersion()>=b){document.getElementById(a).innerHTML=c}};Tumblr.renderVideo=function(c,g,e,a,b){var d=navigator.userAgent.toLowerCase();var f=(d.indexOf("iphone")!=-1);if(f){document.getElementById(c).innerHTML='<object classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" width="'+e+'" height="'+a+'" codebase="http://www.apple.com/qtactivex/qtplugin.cab"><param name="src" value="'+g+'"><param name="qtsrc" value="'+g+'"><param name="autoplay" value="false"><embed src="'+g+'" qtsrc="'+g+'" width="'+e+'" height="'+a+'" pluginspage="http://www.apple.com/quicktime/"></embed></object>'}else{replaceIfFlash(10,c,'<embed type="application/x-shockwave-flash" src="http://assets.tumblr.com/swf/video_player.swf?22" bgcolor="#000000" quality="high" class="video_player" wmode="transparent" allowfullscreen="true" height="'+a+'" width="'+e+'" flashvars="file='+encodeURIComponent(g)+(b?"&amp;"+b:"")+'"></embed>')}};function flashVersion(){return Tumblr.flashVersion()}function renderVideo(c,e,d,a,b){Tumblr.renderVideo(c,e,d,a,b)}function replaceIfFlash(b,a,c){Tumblr.replaceIfFlash(b,a,c)};
/*! scripts/tumblelog/utilities.js */
("Tumblr" in window)||(window.Tumblr={});Tumblr.hasClass=function(b,a){return new RegExp("(\\s|^)"+a+"(\\s|$)").test(b.className)};Tumblr.addClass=function(b,a){if(!Tumblr.hasClass(b,a)){b.className+=" "+a}};Tumblr.removeClass=function(c,a){if(Tumblr.hasClass(c,a)){var b=new RegExp("(\\s|^)"+a+"(\\s|$)");c.className=c.className.replace(b," ")}};Tumblr.toggleClass=function(b,a){if(Tumblr.hasClass(b,a)){Tumblr.removeClass(b,a)}else{Tumblr.addClass(b,a)}};
/*! scripts/tumblelog/lightbox.js */
("Tumblr" in window)||(window.Tumblr={});Tumblr.windowDimensions=function(){if(window.innerWidth!==undefined){return{width:window.innerWidth,height:window.innerHeight}}else{if(document.documentElement){return{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}}else{return{width:document.body.clientWidth,height:document.body.clientHeight}}}};Tumblr.Lightbox=(function(){var f=false;var h=false;var n=false;var d=[];var i=false;var g=false;var o=false;var e=false;var c={left:false,center:false,right:false};function m(r,u){if(document.getElementById("tumblr_lightbox")){return}if(!u){u=1}d=r;if(navigator&&navigator.userAgent.indexOf("Firefox")!=-1){var y=document.createElement("input");y.setAttribute("id","Tumblr_Lightbox_focus_input");y.setAttribute("type","text");y.style.position="fixed";y.style.top=0;y.style.left=0;document.body.appendChild(y);y.focus();document.body.removeChild(y)}else{window.focus()}if(!f){if(window.onkeydown){h=window.onkeydown}window.onkeydown=function(B){if(document.getElementById("tumblr_lightbox")){if(!B){B=window.event}var A=B.charCode?B.charCode:B.keyCode;if(!B.shiftKey&&!B.ctrlKey&&!B.altKey&&!B.metaKey){if(A==37){if(g>1){k(g-1)}}else{if(A==39){if(g<d.length){k(g+1)}}else{if(A==27||A==32||A==74||A==75){l()}}}}else{if((B.ctrlKey||B.metaKey)&&A==87){l();return false}}}if(h){h()}};if(window.onresize){n=window.onresize}window.onresize=function(){if(document.getElementById("vignette")){document.getElementById("vignette").style.display="none";if(e){clearTimeout(e)}e=setTimeout(function(){document.getElementById("vignette").style.display="inline-block"},100)}j();if(n){n()}};if(navigator&&navigator.userAgent.search("iPad")!=-1){document.addEventListener("touchmove",function(){l()},false)}f=true}document.body.style.overflow="hidden";var p=document.createElement("div");p.setAttribute("id","tumblr_lightbox");if(navigator&&navigator.userAgent.search("iPad")!=-1){p.style.position="absolute";p.style.top=document.body.scrollTop+"px";p.style.height=window.innerHeight+"px"}else{p.style.position="fixed";p.style.top="0px";p.style.bottom="0px"}p.style.left="0px";p.style.right="0px";p.style.zIndex=4294967294;p.style.overflow="hidden";p.style.backgroundColor=(navigator&&navigator.userAgent.indexOf("MSIE")!=-1)?"#222":"rgba(17,17,17,0.92)";p.onclick=function(){if(i){i=false}else{l()}};if(!(navigator&&navigator.userAgent.search("iPad")!=-1)&&!(navigator&&navigator.userAgent.search("MSIE")!=-1)){var x=document.createElement("img");x.setAttribute("id","vignette");x.setAttribute("src","http://assets.tumblr.com/images/full_page_vignette.png");x.style.position="absolute";x.style.width="100%";x.style.height="100%";x.style.left="0px";x.style.top="0px";p.appendChild(x);var w=document.createElement("div");w.style.position="absolute";w.style.width="100%";w.style.height="100%";w.style.left="0px";w.style.top="0px";p.appendChild(w)}var s=document.createElement("div");s.style.position="absolute";s.style.left="50%";s.style.top="50%";if(!document.getElementById("tumblr_form_key")){s.style.width="100%"}p.appendChild(s);var q=["left","center","right"];while(stage_name=q.pop()){var v=document.createElement("a");v.setAttribute("id","tumblr_lightbox_"+stage_name+"_link");v.setAttribute("href","#");if(d.length<2){v.style.cursor="default"}s.appendChild(v);var t=document.createElement("img");t.setAttribute("id","tumblr_lightbox_"+stage_name+"_image");t.setAttribute("src","http://assets.tumblr.com/images/x.gif");t.style.mozBorderRadius="3px";t.style.webkitBorderRadius="3px";t.style.borderRadius="3px";if(navigator&&navigator.userAgent.indexOf("Chrome")!=-1){t.style.moxBoxShadow="0 4px 30px rgba(0,0,0,1)";t.style.webkitBoxShadow="0 4px 30px rgba(0,0,0,1)";t.style.boxShadow="0 4px 30px rgba(0,0,0,1)"}t.style.borderWidth="0px";t.style.position="absolute";if(stage_name=="center"){t.style.zIndex=4294967295}v.appendChild(t)}var z=document.createElement("div");z.setAttribute("id","tumblr_lightbox_caption");z.style.position="absolute";z.style.textAlign="center";z.style.font="bold 17px 'HelveticaNeue','Helvetica','Arial',sans-serif";z.style.color="#fff";z.style.paddingTop="20px";z.style.textShadow="0 4px 30px rgba(0,0,0,1)";z.style.display="inline-block";z.style.textRendering="optimizeLegibility";s.appendChild(z);document.body.appendChild(p);k(u);j()}function l(){document.body.style.overflow="";document.getElementById("tumblr_lightbox").style.display="none";document.body.removeChild(document.getElementById("tumblr_lightbox"))}function k(q){g=q;o=Math.round(Math.random()*1000000000000);document.getElementById("tumblr_lightbox_left_link").onclick=function(){i=true;k(q-1);return false};if(d.length==1){document.getElementById("tumblr_lightbox_center_link").onclick=function(){return false}}else{if(q<d.length){document.getElementById("tumblr_lightbox_center_link").onclick=function(){i=true;k(q+1);return false}}else{document.getElementById("tumblr_lightbox_center_link").onclick=function(){i=true;k(1);return false}}}document.getElementById("tumblr_lightbox_right_link").onclick=document.getElementById("tumblr_lightbox_center_link").onclick;c.left=false;c.center=false;c.right=false;b("center",q-1);if(q>1){b("left",q-2)}if(q<d.length){b("right",q)}if(q+1<d.length){var p=new Image();p.src=d[q+1].low_res}}function b(q,s){var p=new Image();var r=false;p.className=o;p.onload=function(){if(this.className==o){this.className="high-res";c[q]=this;j()}};p.src=d[s].high_res;if(!p.complete){r=new Image();r.className=o;r.onload=function(){if(this.className==o&&(!c[q]||c[q].className=="placeholder")){this.className="low-res";c[q]=this;j()}};r.src=d[s].low_res;if(d[s].width&&d[s].height){if(r){r.style.maxWidth=d[s].width+"px";r.style.maxHeight=d[s].height+"px"}p.style.maxWidth=d[s].width+"px";p.style.maxHeight=d[s].height+"px"}if(!r.complete&&(d[s].width&&d[s].height)){c[q]=new Image(d[s].width,d[s].height);c[q].style.maxWidth=d[s].width+"px";c[q].style.maxHeight=d[s].height+"px";c[q].src="http://assets.tumblr.com/images/x.gif";c[q].className="placeholder"}}}function j(){var u=["right","left","center"];while(stage_name=u.pop()){var r=document.getElementById("tumblr_lightbox_"+stage_name+"_image");if(!r){continue}var s=c[stage_name];if(!s){r.style.display="none";continue}else{r.style.display="inline-block"}var q=s.style.maxWidth?parseInt(s.style.maxWidth,10):s.width;var p=s.style.maxHeight?parseInt(s.style.maxHeight,10):s.height;if(Tumblr.windowDimensions().width/Tumblr.windowDimensions().height<q/p){var t=(d.length==1)?0.85:0.75;if(Tumblr.windowDimensions().width*t>q&&(s.className=="high-res"||s.style.maxWidth)){r.style.width=q+"px";r.style.height=p+"px"}else{r.style.height=(p*((Tumblr.windowDimensions().width*t)/q))+"px";r.style.width=(Tumblr.windowDimensions().width*t)+"px"}}else{if(Tumblr.windowDimensions().height*0.85>p&&(s.className=="high-res"||s.style.maxHeight)){r.style.width=q+"px";r.style.height=p+"px"}else{r.style.width=(q*((Tumblr.windowDimensions().height*0.85)/p))+"px";r.style.height=(Tumblr.windowDimensions().height*0.85)+"px"}}if(stage_name=="center"){r.style.left=(0-parseInt(r.style.width,10)/2)+"px";r.style.top=(0-parseInt(r.style.height,10)/2)+"px"}else{r.style[stage_name]=(0-(parseInt(r.style.width,10)+Tumblr.windowDimensions().width*0.42))+"px";r.style.top=(0-parseInt(r.style.height,10)/2)+"px"}r.src=s.src;r.style.backgroundColor=(s.className=="placeholder")?((navigator&&navigator.userAgent.indexOf("MSIE")!=-1)?"#444":"rgba(255,255,255,0.05)"):"transparent";if(stage_name=="center"&&d[g-1].caption){document.getElementById("tumblr_lightbox_caption").innerHTML=d[g-1].caption;document.getElementById("tumblr_lightbox_caption").style.width=(Tumblr.windowDimensions().width*0.7)+"px";document.getElementById("tumblr_lightbox_caption").style.top=(parseInt(r.style.height,10)*0.5)+"px";document.getElementById("tumblr_lightbox_caption").style.left=(0-Tumblr.windowDimensions().width*0.35)+"px";document.getElementById("tumblr_lightbox_caption").style.display="block"}else{if(stage_name=="center"){document.getElementById("tumblr_lightbox_caption").style.display="none"}}}}function a(){return !!document.getElementById("tumblr_lightbox")}return{init:m,isOpen:a}})();
/*! scripts/tumblelog/iframe_preloader.js */
Tumblr.IframePreloader=function(a){for(var b in a){if(typeof b=="object"){for(var c in b){this.options[b][c]=b[c]}}else{this.options[b]=a[b]}}this.__create()};Tumblr.IframePreloader.prototype={options:{iframe_src:"",iframe_before_onload:function(){},iframe_after_onload:function(){},iframe_class:"",iframe_styles:{zIndex:8675309,position:"fixed",top:"0px",left:"0px",right:"0px",bottom:"0px",width:"100%",height:"100%",background:"transparent",border:"0px",overflow:"hidden"},preloader_class:"",preloader_innerHTML:'<div style="position:absolute; top:0; left:0; right:0; bottom:0; background:transparent center no-repeat url(\'/images/loading_big_fff_on_2e3133.gif?709\')"><img style="position:absolute; left:0; top:0; width:100%; height:100%; opacity:0.3;" src="http://assets.tumblr.com/images/full_page_vignette.png?709"/></div>',preloader_styles:{zIndex:8675310,position:"fixed",top:"0px",left:"0px",right:"0px",bottom:"0px",width:"100%",height:"100%",overflow:"hidden",background:"rgba(17,17,17,0.92)"},close_class:"",close_innerHTML:"&times;",close_styles:{zIndex:8675311,position:"fixed",top:"10px",right:"15px",cursor:"pointer",font:"bold 20px Helvetica, sans-serif"}},iframe_loaded:false,__create:function(){this.id=Math.random().toString().split(".")[1];this.$container=document.createElement("div");this.$preloader=document.createElement("div");this.$preloader.id="iframe_preloader-preloader-"+this.id;this.$preloader.className=this.options.preloader_class;for(var d in this.options.preloader_styles){this.$preloader.style[d]=this.options.preloader_styles[d]}this.$preloader.innerHTML=this.options.preloader_innerHTML;this.$iframe=document.createElement("iframe");this.$iframe.id="iframe_preloader-iframe-"+this.id;this.$iframe.className=this.options.iframe_class;for(var c in this.options.iframe_styles){this.$iframe.style[c]=this.options.iframe_styles[c]}this.$iframe.src=this.options.iframe_src;this.$iframe.scrolling="no";this.$iframe.frameborder="0";this.$close=document.createElement("div");this.$close.id="iframe_preloader-close-"+this.id;this.$close.className=this.options.close_class;for(var b in this.options.close_styles){this.$close.style[b]=this.options.close_styles[b]}this.$close.innerHTML=this.options.close_innerHTML;var a=this;this.$close.onclick=function(){if(typeof pano_iframe_preloader!="undefined"&&pano_iframe_preloader){pano_iframe_preloader.remove()}};this.$iframe.onload=function(){a.options.iframe_before_onload();a.iframe_loaded=true;a.show();a.$close.style.display="none";a.options.iframe_after_onload()};this.hide_iframe();this.lock_body();this.$container.appendChild(this.$preloader);this.$container.appendChild(this.$iframe);this.$container.appendChild(this.$close);document.body.appendChild(this.$container)},hide:function(){this.hide_iframe();this.hide_preloader();this.unlock_body()},show:function(){if(this.iframe_loaded){this.show_iframe();this.hide_preloader()}else{this.hide_iframe();this.show_preloader()}this.lock_body()},remove:function(){this.hide();document.body.removeChild(this.$container);delete this.$container;delete this.$preloader;delete this.$iframe},lock_body:function(){document.body.style.overflow="hidden"},unlock_body:function(){document.body.style.overflow=""},show_preloader:function(){this.window.focus();this.$preloader.style.display="block"},hide_preloader:function(){this.$preloader.style.display="none"},show_iframe:function(){this.$iframe.contentWindow.focus();this.$iframe.style.opacity=1},hide_iframe:function(){this.$iframe.style.opacity=0}};var pano_iframe_preloader=false;Tumblr.PanoLightboxInit=function(b,a){if((!b&&window.event&&(window.event.metaKey||window.event.altKey))||(b&&(b.metaKey||b.altKey))){return true}pano_iframe_preloader=new Tumblr.IframePreloader({iframe_src:a});return false};
/*! scripts/tumblelog/iframe_content.js */
("Tumblr" in window)||(window.Tumblr={});Tumblr.IframeContent=function(){var e,g,h,b;function i(){e=document.createElement("iframe");e.width=b.width;e.height=b.height;e.src="about:blank";for(var j in b.attr){e.setAttribute(j,b.attr[j])}e.setAttribute("frameborder","0");e.setAttribute("scrolling","no");e.setAttribute("webkitAllowFullScreen","");e.setAttribute("mozallowfullscreen","");e.setAttribute("allowFullScreen","");e.setAttribute("seamless","");e.setAttribute("style","display:block;background-color:transparent;overflow:hidden;");g.appendChild(e)}function d(){h="<!DOCTYPE html><html><head><title>Tumblr Video</title></head>";h+='<body class="'+b.body_class+'">';h+=b.content;h+="</body></html>"}function a(){e.onload=f;e.contentWindow.document.open("text/html","replace");e.contentWindow.document.write(h);e.contentWindow.document.close()}function c(){var j=e.contentWindow.document.body.offsetHeight;if(!j){return}e.height=j}function f(){c();if(typeof(b.onload)==="function"){b.onload()}}return{initialize:function(j){b=j;b.width=b.width||500;b.height=b.height||Math.floor(b.width*0.75);g=document.getElementById(b.container);if(!g){return false}i();d();a()}}};
/*! scripts/tumblelog/like_button.js */
("Tumblr" in window)||(window.Tumblr={});Tumblr.LikeButtonUpdate=(function(){return{post_message_event:function(c,a){if(c[0]==="tumblelog_like"){if(c[1]&&document.getElementById("like_button_"+c[1])){var b=document.getElementById("like_button_"+c[1]);if(c[2]==="liked"){Tumblr.addClass(b,"liked")}else{Tumblr.removeClass(b,"liked")}}}}}})();Tumblr.LikeButton={loaded_iframes:{},like_statuses:{},get_status_by_page:function(c){var a=document.getElementById("tumblr_controls");if(a){var b="get_like_states;"+JSON.stringify({page:c});a.contentWindow.postMessage(b,"*")}},get_status_by_post_ids:function(b){var a=document.getElementById("tumblr_controls");if(a){var c="get_like_states;"+JSON.stringify({ids:b});a.contentWindow.postMessage(c,"*")}},post_message_event:function(d,b){if(d[0]==="like_state_update"){var e=JSON.parse(d[1]);if(e.length){for(var c=0,a=e.length;c<a;c++){Tumblr.LikeButton.queue_like_status(e[c]);Tumblr.LikeButton.update_like_state(e[c])}}else{Tumblr.LikeButton.queue_like_status(e);Tumblr.LikeButton.update_like_state(e)}}},logged_in_iframe_loaded:function(m,h){if(m[0]==="logged_in_iframe_loaded"){var g="";var k="";var l=window.location.pathname;if(l.indexOf("page")!==-1||l.indexOf("post")!==-1){var e=l.split("/");for(var c=0;c<e.length;c++){if(e[c]==="page"&&e[c++]){g=e[c++];break}if(e[c]==="post"&&e[c++]){k=e[c++];break}}}if(k){Tumblr.LikeButton.get_status_by_post_ids([k])}else{if(g){Tumblr.LikeButton.get_status_by_page(g)}else{var f=[];var b=document.querySelectorAll(".like_button");for(var a=0;a<b.length;a++){var d=b[a];if(d.attributes["data-post-id"]){f.push(d.attributes["data-post-id"].value)}}if(f.length>0){Tumblr.LikeButton.get_status_by_post_ids(f)}}}}},like_iframe_loaded:function(b,a){if(b[0]==="like_iframe_load"){var c=JSON.parse(b[1]);if(c.post_id){Tumblr.LikeButton.loaded_iframes[c.post_id]=1;Tumblr.LikeButton.check_like_status(c.post_id,true)}}},check_like_status:function(b,a){var d=Tumblr.LikeButton.like_statuses[b];if(d){var c={post_id:b,state:(d==="liked")?true:false};Tumblr.LikeButton.update_like_state(c)}},queue_like_status:function(a){if(a.post_id){Tumblr.LikeButton.like_statuses[a.post_id]=(a.state)?"liked":"unliked"}},update_like_state:function(b){if(b.post_id){var a=document.getElementById("like_iframe_"+b.post_id);if(a){a.contentWindow.postMessage("state_update;"+JSON.stringify(b),"http://assets.tumblr.com")}}}};
/*! scripts/tumblelog/post_message_form_resize.js */
("Tumblr" in window)||(window.Tumblr={});Tumblr.TumblelogFormResize=(function(){return{post_message_event:function(d,b){if(d[0]==="resize_tumblelog_form_iframe"){var e=d[1];var c=document.getElementById(e);var a=parseInt(d[2],10);if(e){c.height=a}}}}})();
/*! scripts/tumblelog/post_message_photoset_resize.js */
Tumblr.PhotosetResize=(function(){return{post_message_event:function(c,b){if(c[0]==="resize_photoset_iframe"){var d=c[1],a=parseInt(c[2],10);document.getElementById("photoset_iframe_"+d).height=a}}}})();
/*! scripts/tumblelog/feature_analytics.js */
("Tumblr" in window)||(window.Tumblr={});Tumblr.AnalyticsFeatureSupport=(function(){return{post_message_event:function(c,a){if(c[0]==="openInMobileAppSuccess"){if(typeof(open_in_mobile_app)==="function"){if(c[1]&&c[1].length){var b=parseInt(c[1],10);open_in_mobile_app(b)}}}}}})();
/*! scripts/tumblelog/feature_iframe.js */
Tumblr.IframeFeatureSupport=(function(){var g,d,a,b=new Tumblr.Styler({id:"tumblr_iframe_css",styles:{"#tumblr_controls":{display:"block",opacity:"1",visibility:"hidden",position:"absolute",top:"0",right:"0",width:"1px",height:"1px","z-index":"2147483647"},"#tumblr_controls.visible":{visibility:"visible"},".tumblr_mobile_banner":{position:"relative"},"html.tumblr_mobile_banner body iframe#tumblr_controls.visible.tumblr_sticky_iframe":{position:"absolute !important",visibility:"visible !important",top:"0 !important",opacity:"1 !important"},".tumblr_mobile_banner #tumblr_controls":{position:"absolute !important",visibility:"visible !important",top:"0 !important","-webkit-transform":"translateY(-100%)","-moz-transform":"translateY(-100%)","-ms-transform":"translateY(-100%)","-o-transform":"translateY(-100%)",transform:"translateY(-100%)","-webkit-transition":"-webkit-transform 0.2s ease-out","-moz-transition":"-moz-transform 0.2s ease-out","-ms-transition":"-ms-transform 0.2s ease-out","-o-transition":"-o-transform 0.2s ease-out",transition:"transform 0.2s ease-out"},".tumblr_mobile_banner #tumblr_controls.visible":{"-webkit-transform":"none","-moz-transform":"none","-ms-transform":"none","-o-transform":"none",transform:"none"}}});function e(){var i,j,h=document.querySelector('meta[name="color:Tumblr Controls"]');if(h){i=h.getAttribute("content")}if(!i){i="default"}g.contentWindow.postMessage("color_match;"+i,d)}function f(h,i){if(!(typeof h==="string"&&h.match(/\d+%/))){h=parseInt(h,10)||0}if(!(typeof i==="string"&&i.match(/\d+%/))){i=parseInt(i,10)||0}Tumblr.addClass(g,"visible");if(h){g.width=h;b.set("#tumblr_controls","width",h+"px")}if(i){g.height=i;b.set("#tumblr_controls","height",i+"px")}}function c(l,k){if(!l){l=200}var i=false;var j=k?document.getElementById(k):g;if(!j){return}var h=d;window.addEventListener("scroll",function(){if(i){return}var m=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop||0;var q=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft||0;var p=Tumblr.windowDimensions();var o=document.body.offsetWidth-(q+p.width);var n=document.body.offsetHeight-(m+p.height);j.contentWindow.postMessage("parent_scroll;"+m+";"+q+";"+o+";"+n,h);i=true;setTimeout(function(){i=false},l)})}return{post_message_event:function(q,o){a=document.getElementById("mobile_iframe");g=document.getElementById("tumblr_controls");d=q[q.length-1];if(a){if(q[0]==="show_mobile_banner"){if(q[1]==="1"){Tumblr.MobileBanner.showBanner();Tumblr.MobileBanner.mobile_origin=d}else{Tumblr.MobileBanner.showHeaderBanner()}}}else{if(g&&d){if(q[0]==="color_match"){e()}if(q[0]==="location_change"){if(!document.getElementById("iframe_flash_fix")){var i=document.createElement("div");i.id="iframe_flash_fix";i.innerHTML="&shy;<style> #tumblr_controls { visibility: hidden; } </style>";document.body.appendChild(i);document.getElementById("tumblr_controls").onload=function(){document.body.removeChild(i)}}}if(q[0]==="request_keywords"){if(typeof tumblr_meta_keyboards!="undefined"){g.contentWindow.postMessage("keywords;"+tumblr_meta_keyboards,d)}}if(q[0]==="teaser_iframe"){if(q.length<2||!Tumblr.Teaser){return false}switch(q[1]){case"initialize":g.contentWindow.postMessage("teaser;enable",d);return Tumblr.Teaser.initialize({slide_page:(q.length>2&&q[2]==="slide")});case"load":return Tumblr.Teaser.load_once();case"open":return Tumblr.Teaser.open();case"close":return Tumblr.Teaser.close();case"toggle":return Tumblr.Teaser.toggle();default:break}}if(q[0]==="tagged_teaser_iframe"){if(q.length<2||!Tumblr.TaggedTeaser){return false}switch(q[1]){case"show":Tumblr.TaggedTeaser.initialize({once:true,open:true});return;case"open":return Tumblr.TaggedTeaser.open(q.length>2?q[2]:false);case"close":return Tumblr.TaggedTeaser.close();case"toggle":return Tumblr.TaggedTeaser.toggle();default:break}}if(q[0]==="resize_iframe"){f(q[1],q[2]);if(q.length>2){switch(q[3]){case"body_class":if(q.length>3&&q[4]){Tumblr.addClass(document.body,q[4])}break;default:break}}}if(q[0]==="mobile_resize_iframe"){f(q[1],q[2]);var j=g.width;var p=g.height;var n=0;var h=false;var k=3;while(k<q.length){switch(q[k]){case"corner_buttons":h=true;k++;break;case"add_iframe_class":if(k+1<q.length){Tumblr.addClass(g,q[++k])}break;case"remove_iframe_class":if(k+1<q.length){Tumblr.removeClass(g,q[++k])}break;case"margin_bottom":if(k+1<q.length){n=parseInt(q[++k],10);if(!n){n=0}}break;default:break}k++}if(!h){Tumblr.addClass(document.body.parentNode,"tumblr_mobile_banner");b.set(".tumblr_mobile_banner",{top:(p-n)+"px !important"});b.set(".tumblr_mobile_banner #tumblr_controls",{top:(n-p)+"px !important"})}else{Tumblr.removeClass(document.body.parentNode,"tumblr_mobile_banner");b.set(".tumblr_mobile_banner",{position:"fixed !important",top:""});b.set(".tumblr_mobile_banner #tumblr_controls",{position:"fixed !important",top:""})}}if(q[0]==="scroll_listen"){var l=(q.length>2)?q[1]:false;var m=(q.length>3)?q[2]:false;c(l,m)}}}}}})();
/*! scripts/tumblelog/feature_video.js */
Tumblr.VideoFeatureSupport=(function(){var b={setup_controls:{}};function f(){if(document.getElementById("tumblr_video_iframe_fullscreen")){return true}var j=document.createElement("style");j.id="tumblr_video_iframe_fullscreen";j.innerHTML=".tumblr_video_iframe.fullwindow { top: 0; bottom: 0; right: 0; left: 0; position: fixed; z-index: 8675309; height: 100%; width: 100%; }";document.body.appendChild(j)}function e(j){f();if(j){b.iframe.className="tumblr_video_iframe fullwindow"}else{b.iframe.className="tumblr_video_iframe"}}function i(j){var k=document.getElementById("tumblr_controls");if(!j){if(b.parent_post){b.parent_post.className=b.parent_post.className.replace(/\s+is_lightbox/g,"")}document.body.className=document.body.className.replace(/\s+is_lightbox/g,"");document.body.style.overflow="visible";b.iframe.style.position="static";b.iframe.style.height="100%";b.iframe.style.width="100%";b.iframe.style.zIndex=0;if(k){k.style.display="block"}return}a();if(b.parent_post){b.parent_post.className+=" is_lightbox"}document.body.className+=" is_lightbox";document.body.style.overflow="hidden";b.iframe.style.position="fixed";b.iframe.style.height="100%";b.iframe.style.width="100%";b.iframe.style.top=0;b.iframe.style.right=0;b.iframe.style.left=0;b.iframe.style.bottom=0;b.iframe.style.zIndex=90210;if(k){k.style.display="none"}}function g(j){if(!j){if(b.parent_post){b.parent_post.className=b.parent_post.className.replace(/\s+is_fullscreen/g,"")}document.body.className=document.body.className.replace(/\s+is_fullscreen/g,"");return}if(b.parent_post){b.parent_post.className+=" is_fullscreen"}document.body.className+=" is_fullscreen"}function a(){if(b.setup_controls[b.id]){return}var k=document.querySelector("#post_"+b.id+" .tumblr_lightbox_controls .close_button");if(k){k.addEventListener("click",function(l){b.iframe.contentWindow.postMessage("exit_lightbox",b.origin_url);return false})}var j=document.querySelector("#post_"+b.id+" .tumblr_lightbox_controls .like_button");if(j){j.addEventListener("click",function(m){var l=this;var n={id:l.getAttribute("data-post-id"),key:l.getAttribute("data-reblog-key")};if(Tumblr.hasClass(l,"already_like")){Tumblr.unlike(n,{success:function(){Tumblr.removeClass(l,"already_like")}})}else{Tumblr.like(n,{success:function(){Tumblr.addClass(l,"already_like")}})}return false})}b.setup_controls[b.id]=true}function h(){if(typeof(get_cookie)==="function"){var j=get_cookie("supress_lightbox"),k=parseInt(j.value,10)||0;if(j&&k>3){return"supress_lightbox"}if(!j){return"enable_lightbox"}}return false}function d(k){if(typeof(set_cookie)==="function"){var j=get_cookie("supress_lightbox"),l=parseInt(j.value,10)||0;if(k>0&&k<5){}if(k===-1){if(l>1){}else{}}c(h())}}function c(l){if(!l){return}var k=document.querySelectorAll(".tumblr_video_iframe.has_lightbox");for(var j=0;j<k.length;j++){k[j].contentWindow.postMessage(l,k[j].getAttribute("data-origin"))}}return{post_message_event:function(l,j){var k=l[2];b.iframe=document.getElementById("tumblr_video_iframe_"+k);if(!b.iframe){return}b.id=k;b.origin_url=b.iframe.getAttribute("data-origin");b.parent_post=document.getElementById("post_"+k);if(l[0]==="lightbox"){i((l[1]==="true")?true:false)}if(l[0]==="full_window"){e((l[1]==="true")?true:false)}if(l[0]==="full_screen"){g((l[1]==="true")?true:false)}}}})();
/*! scripts/tumblelog/feature_audio.js */
Tumblr.AudioFeatureSupport=(function(){return{post_message_event:function(d,a){var c,b;if(d[0]==="audioPlayerReady"){c=document.getElementsByClassName("tumblr_audio_player");for(b=0;b<c.length;b++){if(c[b].className.indexOf(" tumblr_audio_player_"+d[1])>=0){try{if(!c[b].style.webkitTransform){c[b].style.webkitTransform="translate3d(0px, 0px, 0px)"}}catch(f){}}}}else{if(d[0]==="audioPlayerPlaying"){c=document.getElementsByClassName("tumblr_audio_player");for(b=0;b<c.length;b++){if(c[b].className.indexOf(" tumblr_audio_player_"+d[1])<0){c[b].contentWindow.postMessage("pause","*")}}c=document.getElementsByClassName("tumblr_video_iframe");for(b=0;b<c.length;b++){c[b].contentWindow.postMessage("pause","*")}}}}}})();
/*! scripts/tumblelog/mobile_fullscreen_iframe.js */
("Tumblr" in window)||(window.Tumblr={});Tumblr.mobileFullscreenIframe={og_store:function(){this.og_body_position=document.body.style.position;this.og_body_overflow=document.body.style.overflow;this.og_html_bg=this.html_el.style.backgroundColor;this.win_height=window.innerHeight+"px"},set_frame_height:function(){this.win_height=window.innerHeight+"px";this.win_width=window.innerWidth+"px";this.frame.style.height=this.win_height;this.frame.style.minWidth=this.win_width},enable:function(a){this.frame=document.getElementById(a);if(!this.frame){return}this.html_el=document.getElementsByTagName("html")[0];this.og_store();this.orientation_height_change=this.set_frame_height.bind(this);window.addEventListener("orientationchange",this.orientation_height_change,false);window.addEventListener("resize",this.orientation_height_change,false);this.frame.className+=" is_lightbox";document.body.className+=" is_lightbox";document.body.style.position="relative";document.body.style.left="-99999px";document.body.style.overflow="hidden";this.html_el.style.backgroundColor="#000000";this.frame.style.cssText="position:fixed; overflow:hidden; width: 100%; top:0; left:0; right:0; bottom:0; z-index: 90210;";this.frame.style.height=this.win_height;if(document.getElementById("tumblr_controls")){document.getElementById("tumblr_controls").style.display="none"}},disable:function(a){this.frame=this.frame||document.getElementById(a);if(!this.frame){return}this.frame.className=this.frame.className.replace(/\s+is_lightbox/,"");document.body.className=document.body.className.replace(/\s+is_lightbox/,"");document.body.style.overflow=this.og_body_overflow;document.body.style.position=this.og_body_position;this.html_el.style.backgroundColor=this.og_html_bg;this.frame.style.cssText="";if(document.getElementById("tumblr_controls")){document.getElementById("tumblr_controls").style.display="block"}window.removeEventListener("orientationchange",this.orientation_height_change,false);window.removeEventListener("resize",this.orientation_height_change,false)}};
/*! scripts/tumblelog/sticky_iframe.js */
(function(){function a(){var g=document.getElementById("tumblr_controls");if(!g){return}var l=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight;var i=g.offsetTop;var e=l-(g.offsetTop+g.offsetHeight);if(i===0||e===0){g.style.position="fixed";return}if(!g.classList){return}var k=g.clientHeight;var h="        html body iframe#tumblr_controls {            -webkit-transition-property: opacity;               -moz-transition-property: opacity;                -ms-transition-property: opacity;                 -o-transition-property: opacity;                    transition-property: opacity;            -webkit-transition-duration: .3s;               -moz-transition-duration: .3s;                -ms-transition-duration: .3s;                 -o-transition-duration: .3s;                    transition-duration: .3s;            -webkit-transition-timing-function: ease;               -moz-transition-timing-function: ease;                -ms-transition-timing-function: ease;                 -o-transition-timing-function: ease;                    transition-timing-function: ease;        }        html body iframe#tumblr_controls.tumblr_sticky_iframe {            position: fixed !important;            top: 0 !important;        }        ";var b;var d="tumblr_sticky_iframe_style";var j=document;if(j.createStyleSheet){b=j.createStyleSheet();b.cssText=h;if(d){b.owningElement.id=d}}else{b=j.createElementNS?j.createElementNS("http://www.w3.org/1999/xhtml","style"):j.createElement("style");b.appendChild(j.createTextNode(h));if(d){b.id=d}j.getElementsByTagName("head")[0].appendChild(b)}function f(){g.style.visibility="visible";g.style.opacity=1}function c(){var m=window.pageYOffset||(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;if(m>=(i+k)){if(g.classList.contains("tumblr_sticky_iframe")){return}g.style.visibility="hidden";g.style.opacity=0;g.classList.add("tumblr_sticky_iframe");setTimeout(f,400)}else{g.classList.remove("tumblr_sticky_iframe")}}window.setInterval(c,500)}if(window.addEventListener){window.addEventListener("DOMContentLoaded",a,false)}else{window.attachEvent("onload",a)}})();
/*! scripts/tumblelog/post_message_listener.js */
("Tumblr" in window)||(window.Tumblr={});Tumblr.PostMessageListener=(function(){return{initialize:function(d){d=d||function(){};var c=window.addEventListener?"addEventListener":"attachEvent";var b=window[c];var a=c=="attachEvent"?"onmessage":"message";b(a,function(g){if(typeof g.data!=="string"){return}var f=g.data.split(";");d(f,g.origin)},false)}}})();Tumblr.PostMessageListener.initialize(function(b,a){Tumblr.VideoFeatureSupport.post_message_event(b,a);Tumblr.AudioFeatureSupport.post_message_event(b,a);Tumblr.IframeFeatureSupport.post_message_event(b,a);Tumblr.AnalyticsFeatureSupport.post_message_event(b,a);Tumblr.TumblelogFormResize.post_message_event(b,a);Tumblr.PhotosetResize.post_message_event(b,a);Tumblr.LikeButtonUpdate.post_message_event(b,a);Tumblr.LikeButton.logged_in_iframe_loaded(b,a);Tumblr.LikeButton.post_message_event(b,a);Tumblr.LikeButton.like_iframe_loaded(b,a)});
/*! scripts/tumblelog.js */

/*! scripts/spin.js */
(function(i,k,a){var e=["webkit","Moz","ms","O"];var p={};var o;function g(q,t){var r=k.createElement(q||"div");var s;for(s in t){r[s]=t[s]}return r}function h(r){for(var q=1,s=arguments.length;q<s;q++){r.appendChild(arguments[q])}return r}var j=function(){var q=g("style");h(k.getElementsByTagName("head")[0],q);return q.sheet||q.styleSheet}();function c(u,q,v,y){var r=["opacity",q,~~(u*100),v,y].join("-");var s=0.01+v/y*100;var x=Math.max(1-(1-u)/q*(100-s),u);var w=o.substring(0,o.indexOf("Animation")).toLowerCase();var t=w&&"-"+w+"-"||"";if(!p[r]){j.insertRule("@"+t+"keyframes "+r+"{0%{opacity:"+x+"}"+s+"%{opacity:"+u+"}"+(s+0.01)+"%{opacity:1}"+(s+q)%100+"%{opacity:"+u+"}100%{opacity:"+x+"}}",0);p[r]=1}return r}function n(u,v){var t=u.style;var q;var r;if(t[v]!==a){return v}v=v.charAt(0).toUpperCase()+v.slice(1);for(r=0;r<e.length;r++){q=e[r]+v;if(t[q]!==a){return q}}}function f(q,s){for(var r in s){q.style[n(q,r)||r]=s[r]}return q}function m(s){for(var q=1;q<arguments.length;q++){var r=arguments[q];for(var t in r){if(s[t]===a){s[t]=r[t]}}}return s}function l(q){var r={x:q.offsetLeft,y:q.offsetTop};while((q=q.offsetParent)){r.x+=q.offsetLeft;r.y+=q.offsetTop}return r}var d={lines:12,length:7,width:5,radius:10,color:"#000",speed:1,trail:100,opacity:1/4,fps:20,zIndex:2000000000,className:"spinner",top:"auto",left:"auto"};var b=function b(q){if(!this.spin){return new b(q)}this.opts=m(q||{},b.defaults,d)};b.defaults={};b.prototype={spin:function(x){this.stop();var B=this;var q=B.opts;var r=B.el=f(g(0,{className:q.className}),{position:"relative",zIndex:q.zIndex});var A=q.radius+q.length+q.width;var C;var z;if(x){x.insertBefore(r,x.firstChild||null);z=l(x);C=l(r);f(r,{left:(q.left=="auto"?z.x-C.x+(x.offsetWidth>>1):q.left+A)+"px",top:(q.top=="auto"?z.y-C.y+(x.offsetHeight>>1):q.top+A)+"px"})}r.setAttribute("aria-role","progressbar");B.lines(r,B.opts);if(!o){var u=0;var s=q.fps;var w=s/q.speed;var v=(1-q.opacity)/(w*q.trail/100);var y=w/q.lines;!function t(){u++;for(var D=q.lines;D;D--){var E=Math.max(1-(u+D*y)%w*v,q.opacity);B.opacity(r,q.lines-D,E,q)}B.timeout=B.el&&setTimeout(t,~~(1000/s))}()}return B},stop:function(){var q=this.el;if(q){clearTimeout(this.timeout);if(q.parentNode){q.parentNode.removeChild(q)}this.el=a}return this},lines:function(s,u){var r=0;var q;function t(v,w){return f(g(),{position:"absolute",width:(u.length+u.width)+"px",height:u.width+"px",background:v,boxShadow:w,transformOrigin:"left",transform:"rotate("+~~(360/u.lines*r)+"deg) translate("+u.radius+"px,0)",borderRadius:(u.width>>1)+"px"})}for(;r<u.lines;r++){q=f(g(),{position:"absolute",top:1+~(u.width/2)+"px",transform:u.hwaccel?"translate3d(0,0,0)":"",opacity:u.opacity,animation:o&&c(u.opacity,u.trail,r,u.lines)+" "+1/u.speed+"s linear infinite"});if(u.shadow){h(q,f(t("#000","0 0 4px #000"),{top:2+"px"}))}h(s,h(q,t(u.color,"0 0 1px rgba(0,0,0,.1)")))}return s},opacity:function(r,q,s){if(q<r.childNodes.length){r.childNodes[q].style.opacity=s}}};!function(){var r=f(g("group"),{behavior:"url(#default#VML)"});var q;if(!n(r,"transform")&&r.adj){for(q=4;q--;){j.addRule(["group","roundrect","fill","stroke"][q],"behavior:url(#default#VML)")}b.prototype.lines=function(v,u){var t=u.length+u.width;var B=2*t;function A(){return f(g("group",{coordsize:B+" "+B,coordorigin:-t+" "+-t}),{width:B,height:B})}var w=-(u.width+u.length)*2+"px";var z=f(A(),{position:"absolute",top:w,left:w});var y;function x(C,s,D){h(z,h(f(A(),{rotation:360/u.lines*C+"deg",left:~~s}),h(f(g("roundrect",{arcsize:1}),{width:t,height:u.width,left:u.radius,top:-u.width>>1,filter:D}),g("fill",{color:u.color,opacity:u.opacity}),g("stroke",{opacity:0}))))}if(u.shadow){for(y=1;y<=u.lines;y++){x(y,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)")}}for(y=1;y<=u.lines;y++){x(y)}return h(v,z)};b.prototype.opacity=function(t,s,v,u){var w=t.firstChild;u=u.shadow&&u.lines||0;if(w&&s+u<w.childNodes.length){w=w.childNodes[s+u];w=w&&w.firstChild;w=w&&w.firstChild;if(w){w.opacity=v}}}}else{o=n(r,"animation")}}();i.Spinner=b})(window,document);
/*! scripts/popover_scroll.js */
(function(b,a){var c=function(d,e){this.$container=b(d);this.container=this.$container[0];this.options=b.extend({on_infinite_scroll:function(){},on_scroll:function(){}},e||{});this.$wrapper=b('<div class="popover_scrollbar"></div>');this.$track=b('<div class="popover_scrollbar_track"></div>');this.$thumb=b('<div class="popover_scrollbar_thumb"></div>');this.is_scrollable=false;this.is_scrolling=false;this.$track.on("mousedown",b.proxy(this.on_scrollbar_mousedown,this));this.$container.on("scroll.popover_scrollbar",b.proxy(this.on_scroll,this));this.init()};c.prototype={init:function(){this.$container.wrap(this.$wrapper);this.update()},update:function(){if(!this.is_scrollable&&this.container.scrollHeight>this.$container.height()){this.is_scrollable=true;this.$container.after(this.$track);this.$track.append(this.$thumb);if(!("ontouchstart" in document.documentElement)){this.$container.on("mousewheel DOMMouseScroll",b.proxy(this.steal_scroll,this))}}if(this.is_scrollable){var d=this.$container.height()/this.container.scrollHeight;this.$thumb.height(this.$track.height()*d)}this.on_scroll()},steal_scroll:function(f){var d=f.currentTarget,g=f.originalEvent.wheelDelta||-f.originalEvent.detail;if(g>0&&d.scrollTop<=0){f.preventDefault()}if(g<0&&d.scrollTop>=d.scrollHeight-b(d).height()){f.preventDefault()}},on_scrollbar_mousedown:function(d){d.preventDefault();this.$track.addClass("is_scrolling");b(window).on("mousemove.popover_scrollbar",b.proxy(this.on_scrollbar_mousemove,this));b(window).on("mouseup.popover_scrollbar",b.proxy(this.on_scrollbar_mouseup,this));this.on_scrollbar_mousemove(d)},on_scrollbar_mousemove:function(h){var f=h.pageY-this.$track.offset().top,g=f/this.$track.height(),d=this.container.scrollHeight-this.$container.height();if(g>=0&&g<=1){this.$container.scrollTop(d*g)}},on_scrollbar_mouseup:function(d){this.$track.removeClass("is_scrolling");b(window).off(".popover_scrollbar")},on_scroll:function(g){var f=this.container.scrollTop/(this.container.scrollHeight-this.$container.height()),d=this.$track.height()-this.$thumb.height();this.$thumb.css("top",d*f);this.options.on_scroll(this.container.scrollTop,f);if(f>0.9){this.options.on_infinite_scroll()}},destroy:function(){if(this.is_scrollable){this.$track.off().remove();this.$thumb.remove();this.$container.off(".popover_scrollbar")}this.$container.unwrap();this.is_scrollable=false;this.is_scrolling=false}};a.PopoverScroll=c})(jQuery,Tumblr);
/*! scripts/polyfills/placeholders.js */
(function(b,a){var c={init:function(l){var h=b(document);var d="placeholder" in document.createElement("input");var j="placeholder" in document.createElement("textarea");l=b.extend({},l);var k=(l.els)?b(l.els):b("input, textarea");var i=l.clear_on_submit;var e=l.force;function m(p){var n=b(p.target);var o=n.get(0).nodeName.toLowerCase();if(!d||!j||e){if(n.hasClass("placeholder")){n.val("").removeClass("placeholder")}if(n.attr("data-type")=="password"){try{n.get(0).type="password"}catch(q){}}}}function f(n){if(!d||!j||e){g(n.target)}}function g(n){$input=b(n);var o=$input.attr("placeholder");if(o&&$input.val()===""){$input.addClass("placeholder").val(o)}if($input.attr("type")=="password"&&($input.val()===""||$input.val()===o)){try{$input.get(0).type="text"}catch(p){}$input.attr("data-type","password")}}if(!d||!j||e){h.on("focus",k.selector,m);h.on("blur",k.selector,f);_.each(k,function(o){g(o);if(i){var n=b(o);n.parents("form").on("submit",function(){if(n.val()===n.attr("placeholder")){n.val("")}})}})}}};a.PlaceHolders=c})(jQuery,this.Tumblr||(this.Tumblr={}));
/*! scripts/events.js */
(function(b,a,c){if(c==null||c.Events==null){throw"Tumblr.Events depends on Backbone.Events"}a.Events=_.extend({},c.Events)})(jQuery,Tumblr,Backbone);
/*! scripts/domeventor.js */
(function(o,g,n,f,j,k){var e=g(k);var a=g(j);var m={};var i={};m.documentHeight=i.documentHeight=null;m.windowHeight=i.windowHeight=null;m.windowWidth=i.windowHeight=null;m.windowScrollTop=i.windowScrollTop=null;m.windowScrollY=i.windowScrollY=null;var l=(!Object.hasOwnProperty.call(j,"requestAnimationFrame")&&j.requestAnimationFrame)||(!Object.hasOwnProperty.call(j,"webkitRequestAnimationFrame")&&j.webkitRequestAnimationFrame)||(!Object.hasOwnProperty.call(j,"mozRequestAnimationFrame")&&j.mozRequestAnimationFrame)||(!Object.hasOwnProperty.call(j,"oRequestAnimationFrame")&&j.oRequestAnimationFrame)||(function(r){j.setTimeout(function(){r()},1000/20)});function b(){var s;function r(t){q();f.Events.trigger("DOMEventor:flatresize",m);s=false}a.on("resize.DOMEventor-nextResizeLoop",function(){if(!s){l(r);s=true}})}function d(){var s;var r=0;function t(u){if(!(r--)){i.documentHeight=m.documentHeight;m.documentHeight=e.height();r=1}i.windowScrollTop=i.windowScrollY=m.windowScrollTop;m.windowScrollTop=m.windowScrollY=a.scrollTop();f.Events.trigger("DOMEventor:flatscroll",m);s=false}a.on("scroll.DOMEventor-nextScrollLoop",function(){if(!s){l(t);s=true}})}function q(){i.documentHeight=m.documentHeight;m.documentHeight=e.height();i.windowHeight=m.windowHeight;m.windowHeight=a.height();i.windowWidth=m.windowWidth;m.windowWidth=a.width();i.windowScrollTop=i.windowScrollY=m.windowScrollTop;m.windowScrollTop=m.windowScrollY=a.scrollTop()}function h(){var r={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"leftmeta",92:"rightmeta",93:"rightmeta",96:"num0",97:"num1",98:"num2",99:"num3",100:"num4",101:"num5",102:"num6",103:"num7",104:"num8",105:"num9",106:"multiply",107:"add",109:"subtract",110:"decimal",111:"devide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"forwardslash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebracket",222:"singlequote"};e.on("keydown.DOMEventor keyup.DOMEventor",function(v){var w=v.target.nodeName.toUpperCase();if(w==="INPUT"||w==="TEXTAREA"||w==="SELECT"){return}var s=v.type;if(!(s==="keyup"||s==="keydown")){return}var u=v.which;var t=s+":"+(v.altKey&&u!==18?"alt+":"")+(v.ctrlKey&&u!==17?"ctrl+":"")+(v.metaKey&&(u!==91&&u!==92&&u!==93)?"meta+":"")+(v.shiftKey&&u!==16?"shift+":"")+(r[u]||"");f.Events.trigger("DOMEventor:"+t,v,t)});f.Events.off("DOMEventor:startKeyboardObserver");f.Events.on("DOMEventor:stopKeyboardObserver",c)}function c(){e.off("keydown.DOMEventor keyup.DOMEventor");f.Events.on("DOMEventor:startKeyboardObserver",h);f.Events.off("DOMEventor:stopKeyboardObserver")}var p={init:function(){if(!(f.Events instanceof Object)||f.Events.on!==n.Events.on||f.Events.off!==n.Events.off||f.Events.trigger!==n.Events.trigger){throw"DOMEventor depends on Tumblr.Events being a mixin of Backbone.Events"}q();d();b();h();f.Events.on("DOMEventor:updateRect",q)},rect:function(){return m},lastRect:function(){return i}};f.DOMEventor=p})(_,jQuery,Backbone,Tumblr,window,document);
/*! scripts/tumblr/tooltip.js */
(function(d,c,b){var a={class_name:"tumblr_tooltip",init:function(e){this.options=e||{};this.options.selector=d.trim((e.selector||"")+" ");this.options.class_name=e.class_name||"";this.options.offset=e.offset||"50%";this.tooltips=d(this.options.selector+"[data-tooltip]");this.tooltips.on("mouseenter.tooltip",c.bind(this.show,this));this.tooltips.on("mouseleave.tooltip",c.bind(this.hide,this));return this},show:function(h){var f=d(h.currentTarget);var g=d(this.tooltip_markup(f.data("tooltip")));f.append(g)},hide:function(h){var f=d(h.currentTarget);var g=f.find("."+this.class_name);g.remove()},tooltip_markup:function(e){return'<div class="'+this.class_name+" "+this.options.class_name+'" style="left:'+this.options.offset+'">'+e+"</div>"}};b.ToolTip=a})(jQuery,_,Tumblr);
/*! scripts/application/glass.js */
(function(c,a){var b=new (Backbone.View.extend({id:"glass_overlay",events:{click:"click"},locked:false,initialize:function(){},render:function(){c(document.body).prepend(this.$el);this.rendered=true;Tumblr.Events.on("DOMEventor:escape",_.bind(this.keydown,this))},click:function(){if(this.locked){return}this.hide()},keydown:function(d){if(this.locked){return}if(this.visible){this.hide()}},show:function(e,d){if(Tumblr.KeyCommands&&!Tumblr.KeyCommands.suspended){Tumblr.KeyCommands.suspend();this.glass_suspended_keys=true}if(!this.rendered){this.render()}d=d||"";this.on_close=e||function(){};this.visible=true;Tumblr.Events.trigger("Glass:show",this);this.$el.addClass("show");setTimeout(_.bind(function(){this.$el.addClass(d)},this),0)},hide:function(){this.visible=false;Tumblr.Events.trigger("Glass:hide",this);this.$el.removeClass("show");this.on_close();if(this.glass_suspended_keys){Tumblr.KeyCommands.resume();this.glass_suspended_keys=false}},lock:function(){this.locked=true},unlock:function(){this.locked=false}}))();a.Glass=b})(jQuery,Tumblr);
/*! scripts/application/cookie.js */
(function(c,b){var a={get:function(d){return new RegExp(d+"=([^;]+)").test(unescape(document.cookie))?RegExp.$1:null},set:function(d,j,i,f){f=f||{};var e=new Date();var k=f.path?f.path:"/";var h=f.is_secure?true:false;var g=f.domain?f.domain:"";e.setTime(e.getTime()+(i*1000));document.cookie=d+"="+escape(j)+((i==null)?"":";expires="+e.toGMTString())+";path="+k+((h===false)?"":";secure")+((g==="")?"":";domain="+g)},unset:function(d){a.set(d,"",-1)}};b.Cookie=a})(jQuery,Tumblr);
/*! scripts/application/popover.js */
(function(d,b){var a=Backbone.View.extend({events:{click:"click"},initialize:function(e){this.button=d(e.el||this.$el);this.popover=e.popover||this.$el.find(".popover");this.on_hide=e.on_hide||function(){};this.on_show=e.on_show||function(){};this.auto_show=e.auto_show||false;if(this.auto_show){this.show()}a.register(this)},click:function(){this.toggle()},is_showing:false,show:function(){var e=this;Tumblr.Glass.show(function(){this.hide();this.on_hide()}.bind(this));this.popover.show();this.on_show();this.is_showing=true},hide:function(){if(!this.is_showing){return}var e=this;Tumblr.Glass.on_close=function(){if(e.is_showing){e.popover.hide();e.on_hide()}};Tumblr.Glass.hide();this.is_showing=false},toggle:function(){return this.is_showing?this.hide():this.show()},});a.instances=[];a.register=function(e){this.instances.push(e)};a.hide_all=function(){for(var e=0;e<this.instances.length;e++){this.instances[e].hide()}};a.hide_all_after=function(e){e=(e)?e:100;setTimeout(function(){for(var f=0;f<this.instances.length;f++){this.instances[f].hide()}}.bind(this),e)};var c=a.extend({initialize:function(e){Tumblr.BasePopover.prototype.initialize.apply(this,arguments);this.skip_glass=e.skip_glass||false;this.skip_offset=e.skip_offset||false;this.direction=e.direction||"down";this.align=e.align||"left";this.options=e||{};this.options.left=e.left||0;this.options.right=e.right||0;this.options.top=e.top||0;this.options.bottom=e.bottom||0},click:function(){if(!this.options.disable_auto_show){this.show()}return},show:function(){if(this.options.directional){this.position()}var e=this;if(!this.skip_glass){Tumblr.Glass.show(function(){e.hide();e.on_hide()})}if(!this.$el.is(this.popover.parent())){var g={top:0,left:0};var f={};if(!this.skip_offset){g=this.button.position()}if(this.direction!=="up"){f.top=(this.options.top+g.top)+"px"}else{f.bottom=(this.options.bottom-g.top-this.button.height())+"px"}if(this.align!=="right"){f.left=(this.options.left+g.left)+"px"}else{f.right=(this.options.right-g.left-this.button.width())+"px"}this.popover.css(f)}this.popover.show();this.on_show();this.is_showing=true},hide:function(){var e=this;if(!this.skip_glass){Tumblr.Glass.on_close=function(){if(e.is_showing){e.popover.hide()}};Tumblr.Glass.hide()}this.is_showing=false},position:function(){this.popover.show();var i=d(window);var e={top:i.scrollTop(),left:i.scrollLeft()};this.popover.removeClass("up nipple_on_bottom");e.right=e.left+i.width();e.bottom=e.top+i.height();var h=this.popover.offset();var g=this.popover.outerHeight();var f=i.height();h.right=h.left+this.popover.outerWidth();h.bottom=h.top+g;if(f>g&&e.bottom<h.bottom){this.popover.addClass("up nipple_on_bottom")}}});b.BasePopover=a;b.Popover=c})(jQuery,Tumblr);
/*! scripts/application/popover_with_form.js */
(function(c,b){var a=Tumblr.Popover.extend({initialize:function(d){this.options=d||{};this.form=this.$("form");this.form.submit(_.bind(this.submit_form,this));Tumblr.Popover.prototype.initialize.apply(this,arguments)},show:function(){Tumblr.Popover.prototype.show.call(this);if(!this.options.no_autofocus){this.$("form :input").first().focus()}},submit_form:function(){var d=this.form.serializeArray();d.push({name:"form_key",value:c("#tumblr_form_key").attr("content")});c.ajax({url:this.form.attr("action"),type:this.form.attr("method")||"post",data:d,success:_.bind(this.on_success,this)||function(){},error:_.bind(function(){if(_.isFunction(this.on_error)){this.on_error()}Tumblr.Dialog.alert(l10n_str.ajax_error)},this),complete:_.bind(function(){if(!this.options.wait){this.hide()}if(_.isFunction(this.on_complete)){this.on_complete()}},this)});this.on_submit&&this.on_submit();return false}});b.PopoverWithForm=a})(jQuery,Tumblr);
/*! scripts/application/ajax_request.js */
(function(c,a){var b=function(d){return function(g,f){if(!d){return}g=g||{};f=f||{};if(f.init){f.init()}var e=c.ajax({url:d,type:"POST",data:{form_key:c("#tumblr_form_key").attr("content"),data:g},with_form_key:true});e.success(function(){if(f.success){f.success()}});e.error(function(){if(f.error){f.error()}else{Tumblr.Dialog.alert(l10n_str.ajax_error)}});e.complete(function(){if(f.complete){f.complete()}});return e}};a.follow=b("/svc/follow");a.unfollow=b("/svc/unfollow");a.like=b("/svc/like");a.unlike=b("/svc/unlike");a.ignore=b("/svc/ignore/add");a.unignore=b("/svc/ignore/remove");a.report=b("/svc/report");a.reply=b("/svc/reply")})(jQuery,Tumblr||{});
/*! scripts/application/tabs.js */
(function(c,d,b){var a=Backbone.View.extend({el:"#user_tools",events:{"click #logout_button":"logout",},initialize:function(){this.create_settings_popover()},logout:function(i){i.preventDefault();var h=d(i.currentTarget);var g=h.data("confirm-message");var f=h.attr("href");if(c.isObject(Tumblr.Dialog)){this.settings_popover.hide();Tumblr.Dialog.confirm(g,c.bind(function(){window.location.href=f}));return false}},create_settings_popover:function(){this.settings_popover=new Tumblr.Popover({el:this.$("#preferences_button"),popover:this.$("#tab_settings_popover")})}});b.Tabs=a})(_,jQuery,Tumblr);
/*! scripts/application/tumblr_logo.js */
(function(b,c,a){a.tumblrLogo=c.View.extend({el:"#logo",events:{"mouseenter .logo_dot":"mouseenter_logo_dot","click .logo_dot":"click_logo_dot"},initialize:function(){this.$dot=this.$el.find(".logo_dot");this.tooltip_selector="#logo .logo_dot";if(this.$dot.length&&this.$dot.data("tooltip")){this.init_tooltip()}},init_tooltip:function(){Tumblr.ToolTip.init({selector:this.tooltip_selector,class_name:"tumblr_tooltip down",offset:this.$dot.data("tooltip-offset")});Tumblr.Events.trigger("Capture:push","tumblr_dot_usage","impression")},mouseenter_logo_dot:function(){if(!this.hovered){this.hovered=1;Tumblr.Events.trigger("Capture:push","tumblr_dot_usage","hover")}},click_logo_dot:function(){Tumblr.Events.trigger("Capture:push","tumblr_dot_usage","click")}})})(jQuery,Backbone,Tumblr);
/*! scripts/jquery.application.js */
(function(c,b){var a=Tumblr.Popover.extend({is_scroll_disabled:false,initialize:function(d){this.options=d||{};Tumblr.Popover.prototype.initialize.apply(this,arguments);this.$container=this.$el.find(".popover_inner");this.$scroll=this.$el.find(".popover_scroll");this.options.disable_infinite_scroll=d.disable_infinite_scroll||false;this.on_load_more=d.on_load_more||function(){};this.scrollbar=null;this.auto_center=_.isBoolean(this.options.auto_center)?this.options.auto_center:true;if(!this.$scroll.length){this.is_scroll_disabled=true}},show:function(){Tumblr.Popover.prototype.show.apply(this,arguments);if(this.auto_center){this.position_vertical()}if(Tumblr.PopoverScroll){this.scrollbar=new Tumblr.PopoverScroll(this.$scroll,{on_infinite_scroll:c.proxy(this.load_more,this)})}this.$scroll.attr("tabindex","-1").focus()},hide:function(){if(this.$container){this.$container.css({top:"",height:""})}if(this.$scroll){this.$scroll.css("height","")}if(this.scrollbar){this.scrollbar.destroy();this.scrollbar=null}Tumblr.Popover.prototype.hide.apply(this,arguments)},update:function(){if(this.scrollbar){this.scrollbar.update()}this.position_vertical()},load_more:function(){if(this.is_scroll_disabled||this.options.disable_infinite_scroll){return}this.on_load_more()},position_vertical:function(){if(!this.$container||!this.$scroll){return}var e=50-(this.$container.outerHeight(true)*0.5),f=c(window).height(),h,g,d;this.$container.css("top",e);if(this.$scroll.height()>f-80){this.$scroll.css("height",f-80)}d=this.$container.outerHeight(true);h=this.$container.offset().top-c(window).scrollTop();g=parseInt(this.$container.css("top"),10);if(h<30){g=g-(h-30);this.$container.css("top",(g<23)?g:23)}else{if(h+d>f-30){g=g-((h+d)-f+50);this.$container.css("top",(g>-(d-80))?g:-(d-68))}}if(this.scrollbar){this.scrollbar.update()}}});b.PopoverWithScroll=a})(jQuery,Tumblr);(function(c,a){var b=Tumblr.Popover.extend({events:{click:"click"},initialize:function(d){this.$popover=this.$el;this.popover=this.el},click:function(e){var d=e.target;if(d.id=="modal_alert_accept_button"){this.on_accept()}if(d.id=="modal_alert_cancel_button"){this.on_cancel()}},show:function(){Tumblr.Glass.show(null,"dark");this.$popover.removeClass("belowscreen").removeClass("abovescreen").addClass("up").addClass("modal_is_visible");c(document.body).addClass("popover_alert_active");this.on_show()},hide:function(){Tumblr.Glass.hide();this.$popover.addClass("abovescreen").removeClass("up").removeClass("belowscreen").removeClass("modal_is_visible");c(document.body).removeClass("popover_alert_active");this.on_hide()},cancel:function(){this.on_cancel()},on_accept:function(){this.hide()},on_show:function(){},on_hide:function(){},on_cancel:function(){}});a.Alert=b})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({initialize:function(){if(!this.$el.length){return}this.popover=new Tumblr.Popover({el:this.$el,on_show:_.bind(function(){this.$el.addClass("show");this.$el.closest("#sidebar_footer_nav").addClass("show_popover");this.close_on_scroll()},this),on_hide:_.bind(function(){this.$el.removeClass("show");this.$el.closest("#sidebar_footer_nav").removeClass("show_popover")},this)});this.popover_button=this.$el.find(".popover_legal_link");this.popover_button.on("click",_.bind(function(d){this.popover.show();return false},this));this.update_position()},update_position:function(){var d=Math.floor(this.popover.popover.outerWidth()/2);this.popover.popover.css({marginLeft:-d+"px"})},close_on_scroll:function(){c(window).on("scroll.legalpopover",_.bind(function(){this.popover.hide();c(window).off("scroll.legalpopover")},this))}});Tumblr.LegalPopover=b})(jQuery,Tumblr);(function(c,b){var a=Backbone.View.extend({el:"#user_tools",events:{"focus #search_query":"focus_search_query","click #popover_tracked_tags .popover_menu_item":"click_popover","submit #search_form":"submit","mouseenter #popover_tracked_tags":"mouseenter"},initialize:function(d){this.options=d||{};this.popover_selector=this.options.popover_selector||"#popover_tracked_tags";this.$search_field=this.$("#search_field");this.$search_form=this.$("#search_form");this.$search_query=this.$("#search_query");this.$popover=this.$(this.popover_selector);this.$tracked_tags=this.$(this.popover_selector+" .tracked_tags");this.$autocomplete_results=this.$(this.popover_selector+" .autocomplete_results");this.popover=new Tumblr.Popover({el:this.$search_query,popover:this.$popover,disable_auto_show:true,on_show:_.bind(function(){this.bind_key_nav()},this),on_hide:_.bind(function(){c("#unread_tag_notice").show();c("#search_query").addClass("with_unread");this.$search_field.removeClass("active");this.unbind_key_nav()},this)});this.setup_autocomplete();this.keyevents={bind_key_down:_.bind(this.keydown,this),bind_key_up:_.bind(this.keyup,this)}},setup_autocomplete:function(){this.auto_complete=new Tumblr.AutoCompleteTags({el:this.$search_query,store:"/svc/tags/featured",popover:this.popover,include:Tumblr.EXISTING_TAGS})},focus_search_query:function(){this.$search_field.addClass("active");this.currentIndex=-1;if(!this.has_children(this.$tracked_tags)&&!this.has_children(this.$autocomplete_results)){return}this.popover.show();this.$("#unread_tag_notice").hide();this.$search_query.removeClass("with_unread")},mouseenter:function(d){if(this.in_popover(this.in_focus())){this.in_focus().blur()}},has_children:function(d){return(d.children().length>0)?true:false},click_popover:function(g){var f=this.$(g.currentTarget);var d=f.find("a").attr("href");if(g.metaKey||g.altKey){window.open(d)}else{window.location=d}this.popover.hide();g.stopPropagation();g.preventDefault()},bind_key_nav:function(){c(document).off("keydown",this.keyevents.bind_key_down);c(document).off("keyup",this.keyevents.bind_key_up);c(document).on("keydown",this.keyevents.bind_key_down);c(document).on("keyup",this.keyevents.bind_key_up)},unbind_key_nav:function(){c(document).off("keyup",this.keyevents.bind_key_up);c(document).off("keydown",this.keyevents.bind_key_down)},next:function(){this.$search_query.blur();this.currentIndex++;this.set_active("next")},previous:function(){this.$search_query.blur();this.currentIndex--;this.set_active("previous")},set_active:function(f){var d=c(this.popover_selector+" .popover_menu_item a").filter(":visible");var e=d.filter(":focus");if(e.length){this.currentIndex=(f==="previous")?d.index(e)-1:d.index(e)+1}if(this.currentIndex>=0&&this.currentIndex<d.length){d.get(this.currentIndex).focus()}else{if(this.currentIndex==-2&&f==="previous"){d.get(d.length-1).focus();this.currentIndex=d.length-1}else{this.currentIndex=-1;this.$search_query.focus()}}},in_focus:function(){return c(document.activeElement)},contains:function(d){return(this.in_popover(d)||this.$search_query.is(d))?true:false},in_popover:function(d){return this.$popover.has(d).length},keyup:function(d){if(d.keyCode===9){if(!this.contains(this.in_focus())){this.popover.hide();this.unbind_key_nav();this.in_focus().blur()}}},keydown:function(d){switch(d.keyCode){case 27:this.$search_query.blur();return;case 38:d.preventDefault();this.previous();break;case 40:d.preventDefault();this.next();break;default:break}},submit:function(d){if(c.trim(this.$search_query.val())===""){return false}return true}});b.TagPopover=a})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({events:{keyup:"keyup"},initialize:function(d){this.options=d||{};this.init=true;this.init_value=this.$el.val();this.related_base_url=this.options.related_url||"/related_tags/";this.threshold=this.options.threshold||1;this.store=this.options.store||[];this.include=this.options.include||[];if(typeof this.store==="string"){this.ajax_store=true}this.popover=this.options.popover;this.$auto_results=b("#popover_tracked_tags .autocomplete_results");this.$tracked=b("#popover_tracked_tags .tracked_tags");this.$related=b("#popover_tracked_tags .related_tags");this.tags_template=b("#autocomplete_tags_template").html();this.related_template=b("#related_tags_template").html()},keyup:_.throttle(function(d){this.lookup()},100),get_store:function(d){if(this.store_cache){if(typeof d==="function"){d.call(this)}return}if(this.store_xhr){this.store_xhr.abort()}this.store_xhr=b.ajax({url:this.store,dataType:"json"});this.store_xhr.done(_.bind(function(e){this.store_cache=this.include_unique(e,this.include,"tag_id","tag");if(typeof d==="function"){d.call(this)}},this))},include_unique:function(j,d,h,e){if(!d.length){return j}if(h){var f=[];_.each(d,function(k){f.push(k[h])});var g=[];_.each(j,function(k){if(_.indexOf(f,k[h])===-1){g.push(k)}});j=b.merge(g,d);j.sort(function(n,l){var m=n[e].toLowerCase();var k=l[e].toLowerCase();if(m<k){return -1}if(m>k){return 1}return 0})}else{j=b.merge(d,j)}return j},lookup:function(){var e=b.trim(this.$el.val());var f=e.length;var d;if(f>=this.threshold&&!this.init&&e!==this.init_value){if(this.ajax_store){this.get_store(_.bind(function(){d=this.filter(this.store_cache,e);this.update(d)},this))}else{d=this.filter(this.store,e);this.update(d)}}else{this.update([])}this.init=false;this.init_value=""},escapeRegex:function(d){return d.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(f,e){var d=new RegExp(this.escapeRegex(e),"i");return b.grep(f,function(g){return d.test(g.tag||g)})},update:function(e){if(e.length){this.popover.show();var d={items:e};var f=_.template(this.tags_template);this.$auto_results.html(f(d));this.$tracked.hide();if(e.length===1){this.get_related(e[0]["tag"])}else{this.$related.empty()}}else{if(this.$tracked.children().length>0){this.$tracked.show()}else{this.popover.hide()}this.$auto_results.empty();this.$related.empty()}},get_related:function(d){var e=encodeURIComponent(d.toLowerCase());if(this.cache[e]){this.update_related(this.cache[e]);return}if(this.xhr){this.xhr.abort()}this.xhr=b.ajax({url:this.related_base_url+e,dataType:"json"});this.xhr.done(_.bind(function(f){this.cache[e]=f;this.update_related(f)},this))},update_related:function(d){if(d.length){var e=_.template(this.related_template);this.$related.html(e({items:d}))}},cache:{}});a.AutoCompleteTags=c})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({el:"#dashboard_controls_open_blog",events:{"click #popover_button_blogs":"click_popover_button","click #popover_blogs .popover_menu_item":"click_popover_blogs"},initialize:function(){if(c("#popover_blogs").length){this.popover=new Tumblr.Popover({el:this.$("#popover_button_blogs"),popover:this.$("#popover_blogs"),disable_auto_show:true,on_hide:function(){c("#all_channel_count_notice").show()}});this.sortable=new Tumblr.SortableView({el:this.$("#popover_blogs"),items:".item",callback:_.bind(this.save,this),scrollable:true})}},click_popover_button:function(d){if(d.target.id=="open_blog_link"){return}d.stopPropagation();d.preventDefault();this.popover.show();c("#all_channel_count_notice").hide()},click_popover_blogs:function(f){var e=this.$(f.currentTarget);var d=e.find("a").attr("href");if(f.metaKey||f.altKey){window.open(d)}else{window.location=d}this.popover.hide();f.stopPropagation();f.preventDefault()},save:function(e){var d=_.map(e.sequence(),function(f){return f.replace("menuitem-","")});c.ajax({type:"POST",url:"/order",data:"channel_names="+JSON.stringify(d)})}});a.BlogMenu=b})(jQuery,Tumblr);(function(c,b){var a=Tumblr.Popover.extend({events:{click:"toggle","click .popover_menu_item a":"select_language"},initialize:function(){if(!this.$el.length){return}Tumblr.Popover.prototype.initialize.apply(this,arguments);this.update_timezone();this.update_position();this.language_form=this.$el.find("#set_language");this.language_form_type=this.language_form.attr("method");this.language_form_url=this.language_form.attr("action")},show:function(){Tumblr.Popover.prototype.show.call(this);this.$el.closest("#sidebar_footer_nav").addClass("show_popover");this.update_position()},hide:function(){Tumblr.Popover.prototype.hide.call(this);this.$el.closest("#sidebar_footer_nav").removeClass("show_popover")},select_language:function(d){var e=c(d.target);d.preventDefault();c("#language_selected").val(e.attr("data-lang"));c("#language_switcher .current").removeClass("current");if(this.spinner){this.spinner.stop()}else{this.spinner=new Spinner({top:"auto",left:"100%",width:2,radius:3,length:2,color:"#444",className:"language_switcher_spinner"})}this.spinner.spin(e[0]);this.set_language()},set_language:function(){var d=_(this.language_form.serializeArray()).map(function(e){return[e.name,e.value]}).zipObject().value();c.ajax({type:this.language_form_type,url:this.language_form_url,data:d,complete:function(){if(d.redirect_to){window.location=d.redirect_to}else{window.location.reload()}}})},update_position:function(){var d=Math.floor(this.popover.outerWidth()/2);this.popover.css({marginLeft:-d+"px"})},update_timezone:function(){var e=new Date();var g=new Date(e.getFullYear(),0,1,0,0,0,0);var f=new Date(g.toGMTString().replace(/(.*)(\s\S+)/,"$1"));var d=Math.round((g-f)/(1000*60*60));this.$el.removeClass("americas europe_africa asia_pacific");switch(d){case -12:case -11:case -10:case -9:case -8:case -7:case -6:case -4:case -3:case -2:case -1:this.$el.addClass("americas");break;case 0:case 1:case 2:case 3:case 4:case 5:this.$el.addClass("europe_africa");break;case 6:case 7:case 8:case 9:case 10:case 11:case 12:this.$el.addClass("asia_pacific");break;default:this.$el.addClass("americas");break}return d}});b.LanguageMenu=a})(jQuery,Tumblr);(function(b,a){var c={init:function(){b("#posts").on("click",".panorama",function(e){if(e.shiftKey||e.ctrlKey||e.altKey||e.metaKey){return}var d=b(e.target).closest(".panorama");if(d.hasClass("with_clickthru")&&e.target.className!="zoomer"){return}e.stopImmediatePropagation();e.preventDefault();d.panorama({lightbox:true})})}};a.Panos=c})(jQuery,Tumblr);(function(b,a){a.DashboardLinkPops=Backbone.View.extend({initialize:function(){},el:"#posts",events:{"click a":"run_click"},run_click:function(f){var c=f.currentTarget.href;var d=b(f.currentTarget);if(d.is(".no_pop, .photoset_photo, .photo_exif_flipper, .fan_mail_read_more, .follow")){return}if(self!==top&&d.is(".post_control.reblog, .post_control.edit")){c=c.replace(/\?.*/,"")}else{if(d.closest(".no_pop, .post_controls, #new_post, .controls, .user_menu_list, form, .flash_notification, .more_notes_link").length>0){return}if(!c||c=="#"){return}}f.preventDefault();f.stopPropagation();window.open(c)}})})(jQuery,Tumblr);(function(b,a){a.Elevator=Backbone.View.extend({id:"return_to_top",tagName:"a",className:"return_to_top",attributes:{href:"#"},initialize:function(){this.$body=b("body");this.render();this.return_to_top_visible=false;this.$sidebar_footer_nav=this.$body.find(".pinned_sidebar_footer");this.listenTo(Tumblr.Events,"DOMEventor:flatscroll",this.toggle_elevator)},events:{click:"scroll_to_top"},scroll_to_top:function(c){c.preventDefault();b("html, body").animate({scrollTop:0},"slow")},toggle_elevator:function(d){var c=d.windowScrollY;if(c>=1500){if(!this.return_to_top_visible){this.return_to_top_visible=true;this.fade_in()}}else{if(this.return_to_top_visible){this.return_to_top_visible=false;this.fade_out()}}},fade_in:function(){this.$el.addClass("show");this.$sidebar_footer_nav.addClass("fade_footer");window.setTimeout(_.bind(function(){this.$sidebar_footer_nav.addClass("hide_footer")},this),500)},fade_out:function(){this.$el.removeClass("show");this.$sidebar_footer_nav.removeClass("fade_footer");window.setTimeout(_.bind(function(){this.$sidebar_footer_nav.removeClass("hide_footer")},this),0)},render:function(){this.$body.append(this.$el);this.$el.append(b("<div>",{"class":"return_to_top_icon"}));return this}})})(jQuery,Tumblr);(function(c,b){var a={white:{lines:16,length:11,width:4,radius:17,color:"#ffffff",speed:0.9,trail:34,shadow:false,hwaccel:false,className:"tumblr_default_spinner spinner",zIndex:2000000000,top:"50",left:"auto"}};b.spinners=a})(jQuery,Tumblr);(function(d,b){var c=Tumblr.PopoverWithForm.extend({initialize:function(e){this.submit_button=this.$("button");this.textarea=this.$("form textarea");this.check_form_state();this.textarea.on("input",_.bind(this.check_form_state,this));this.textarea.on("keyup",_.bind(this.check_form_state,this));_.extend(this.options,{on_hide:this.on_hide});Tumblr.PopoverWithForm.prototype.initialize.apply(this,arguments)},check_form_state:function(){this.submit_button.attr("disabled",this.textarea[0].value.length===0)},on_hide:function(){this.$el.removeClass("active")},on_submit:function(){this.submit_button.attr("disabled",true);this.submit_button.html(this.submit_button.data("label-loading"))},on_success:function(){this.$el.addClass("already_reply");this.$el.find("button").attr("disabled",false);this.$el.find("textarea").val("");this.submit_button.html(this.submit_button.data("label"));var e=this.$el.parents(".post");if(e.hasClass("promotion_pinned")&&!e.hasClass("is_mine")){d.ajax({url:"/unpin",type:"post",data:{post_id:e.attr("id").replace("post_",""),form_key:d("#tumblr_form_key").attr("content")}})}}});var a={init:function(){var e={};d("#posts").on("click",".reply_button",function(f){if(f.target!=f.currentTarget){return}f.stopPropagation();f.preventDefault();var g=f.currentTarget.id;if(!e[g]){e[g]=new c({el:d(f.target)})}d(f.currentTarget).addClass("active");e[g].show()})}};b.ReplyPopover=c;b.ReplyButtons=a})(jQuery,Tumblr);(function(c,a){var d=Backbone.View.extend({initialize:function(){this.$post=this.$el.closest(".post")},clicked:function(){if(this.$el.closest(".logged_out").length||this.$el.data("reblogged")){return}this.reblog();this.$el.addClass("animated").addClass("collapse_reblog_button");window.setTimeout(_.bind(function(){this.$el.addClass("final_state")},this),1000)},reblog:function(){this.$el.data("reblogged",1);c.ajax({url:"/fast_reblog",type:"post",data:{reblog_key:this.$el.attr("data-reblog-key"),reblog_post_id:this.$el.attr("data-reblog-id"),form_key:this.$el.attr("data-user-form-key")},success:_.bind(function(){this.$el.addClass("reblogged");if(this.$post.hasClass("promotion_pinned")&&!this.$post.hasClass("is_mine")){this.unpin()}},this),error:function(){Tumblr.Dialog.alert(l10n_str.ajax_error)},complete:function(){}})},unpin:function(){c.ajax("/unpin",{type:"post",data:{post_id:this.$post.id().replace("post_",""),form_key:c("#tumblr_form_key").attr("content")}})}});var b={init:function(){var e={};c("#posts").on("click",".reblog_button",function(f){if(!f.altKey||f.target!=f.currentTarget){return}f.stopPropagation();f.preventDefault();new d({el:c(f.target)}).clicked()})}};a.ReblogButtons=b})(jQuery,Tumblr);(function(d,a){var c=Tumblr.Popover.extend({events:function(){return _.defaults({"click .share_email":"__email_click","click .share_facebook":"__share_facebook_click","click .share_twitter":"__share_twitter_click","click .share_permalink":"__share_permalink_click","input .email_address":"__email_input","keyup .email_address":"__email_input","click .cancel":"__cancel_click","input .twitter .share_message":"__twitter_input","keyup .twitter .share_message":"__twitter_input","click .reply_to_input":"__reply_to_input",},Tumblr.Popover.prototype.events)},__email_click:function(f){f.preventDefault();this.toggle_email_form()},__email_input:function(f){if(this.validate_email(this.$email_address.val())){this.$submit_button.attr("disabled",false)}else{this.$submit_button.attr("disabled",true)}},__twitter_input:function(f){f.preventDefault();if(this.validate_twitter(this.$share_message.val())){this.$submit_button.attr("disabled",false)}else{this.$submit_button.attr("disabled",true)}},__cancel_click:function(f){f.preventDefault();this.cancel_or_close()},__share_facebook_click:function(f){f.preventDefault();if(this.$share_to_facebook){this.toggle_facebook_form()}else{this.facebook_fallback()}},__share_twitter_click:function(f){f.preventDefault();if(this.$twitter_username){this.toggle_twitter_form()}else{window.open("https://twitter.com/intent/tweet?url="+encodeURIComponent(this.$tiny_url),"twitter-share-dialog","width=626,height=258");this.popover.hide();this.on_hide()}},__share_permalink_click:function(f){this.popover.hide();this.on_hide()},__reply_to_input:function(g){var f=d(g.currentTarget).is(":checked");Tumblr.Cookie.set("share_popover_reply_to",f,365*24*60*60)},_placeholder_support:function(){var e=document.createElement("input");return("placeholder" in e)},initialize:function(e){this.options=e||{};_.extend(this.options,{on_hide:this.on_hide});Tumblr.Popover.prototype.initialize.apply(this,arguments);this.$share_form=this.$(".share_form");this.$share_label=this.$(".share_label");this.$reply_to=this.$(".reply_to");this.$share_form.off("submit.share_form").on("submit.share_form",_.bind(this.submit_share_form,this));this.$share_form.off("keydown.share_form").on("keydown.share_form",_.bind(function(f){if(f.keyCode==13&&(f.ctrlKey||f.metaKey||f.altKey)){f.preventDefault();f.stopPropagation();this.submit_share_form()}},this));this.$share_options=this.$(".share_options");this.$submit_button=this.$("button");this.$email_address=this.$(".email_address");this.$share_message=this.$(".share_message");this.$character_count=this.$(".character_count");this.$service_cancel=this.$(".cancel.service");this.$status=this.$(".status");this.$error_status=this.$(".error_status");this.$status_message=this.$(".status_message");this.$reply_to_input=this.$(".reply_to_input");this.$sent_text=this.$status.data("sent");this.$error_text=this.$status.data("error");if(d(".share_twitter")){this.$twitter_username=d(".share_twitter").data("twitter-username")}if(d(".share_facebook")){this.$share_to_facebook=d(".share_facebook").data("has-facebook")}this.$post_url=this.$share_options.data("post-url");this.$tiny_url=this.$share_options.data("post-tiny-url");this.placeholder_supported=this._placeholder_support();if(Tumblr.Cookie.get("share_popover_reply_to")==="true"){this.$reply_to_input.prop("checked",true)}},submit_share_form:function(){var e="/svc/email_post";switch(this.$share_form.data("type")){case"facebook":e="/svc/share_to_facebook";break;case"twitter":e="svc/share_to_twitter";break}var f=this.$share_form.serializeArray();f.push({name:"form_key",value:d("#tumblr_form_key").attr("content")});d.ajax({url:e,type:"post",data:f,success:_.bind(function(){this.on_success(this.$share_form)},this)||function(){},error:_.bind(function(g){this.on_error(g)},this)});this.on_submit(this.$submit_button);return false},on_hide:function(){this.reset_and_hide()},on_submit:function(){this.$submit_button.attr("disabled",true);this.$submit_button.html(this.$submit_button.data("label-sending"))},on_success:function(){this.$status.show();this.flyaway_popup()},on_error:function(f){this.$error_status.html(this.$error_text);this.$submit_button.html(this.$submit_button.data("label"));this.$submit_button.attr("disabled",false);this.$error_status.addClass("active")},flyaway_popup:function(){this.popover.addClass("flyaway");setTimeout(d.proxy(function(){this.popover.removeClass("flyaway").hide();this.hide()},this),1000)},fadeout_popup:function(e,f){setTimeout(_.bind(function(){this.popover.fadeOut(150,_.bind(function(){this.on_hide()},this))},this),1250)},toggle_email_form:function(){this.$submit_button.html(this.$submit_button.data("label"));this.$share_form.data("type","email");this.$share_options.toggleClass("active");this.$share_form.toggleClass("active");this.$reply_to.addClass("active");if(this.$share_form.hasClass("active")&&this.placeholder_supported){this.$email_address.focus()}},toggle_facebook_form:function(){d.ajax({url:"/svc/facebook_status",type:"post",data:{form_key:d("#tumblr_form_key").attr("content")},success:_.bind(this.facebook_success,this),error:_.bind(this.facebook_fallback,this)})},facebook_success:function(e){if(e){this.$service_cancel.show();this.$submit_button.html(this.$submit_button.data("label"));this.$share_form.data("type","facebook");this.$share_label.text(e);this.$submit_button.attr("disabled",false);this.$share_form.addClass("facebook");this.$share_options.toggleClass("active");this.$share_form.toggleClass("active");if(this.$share_form.hasClass("active")&&this.placeholder_supported){this.$share_message.focus()}}else{this.facebook_fallback()}},facebook_fallback:function(){window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(this.$post_url),"facebook-share-dialog","width=626,height=436");this.popover.hide();this.on_hide()},toggle_twitter_form:function(e){this.$service_cancel.show();this.$submit_button.html("Tweet");this.$share_form.data("type","twitter");this.$share_label.text("@"+this.$twitter_username);this.$share_message.val(" [URL]");this.$share_form.addClass("active");this.$share_options.removeClass("active");this.$share_message.get(0).setSelectionRange(0,0);this.validate_twitter(this.$share_message.val());this.$share_message.attr("placeholder","");this.$submit_button.attr("disabled",false);this.$share_form.addClass("twitter");if(this.$share_form.hasClass("active")&&this.placeholder_supported){this.$share_message.focus();this.$share_message.get(0).setSelectionRange(0,0)}},resets:function(){this.$service_cancel.hide();this.$submit_button.html(this.$submit_button.data("label"));this.$submit_button.attr("disabled",true);this.$email_address.val("");this.$share_message.val("");this.$share_message.attr("placeholder",this.$share_message.attr("title"));this.$share_options.addClass("active");this.$share_form.removeClass("active");this.$share_form.removeClass("facebook");this.$share_form.removeClass("twitter");this.$status.hide();this.$status_message.html(this.$sent_text);this.$reply_to.removeClass("active");this.$error_status.removeClass("active")},reset_and_hide:function(){this.resets();this.$el.removeClass("active")},cancel_or_close:function(){if(this.$share_form.data("type")==="email"&&this.$email_address.val().length){this.$email_address.val("");this.$submit_button.attr("disabled",true)}else{this.resets()}},validate_email:function(f){var e=/\S+@\S+\.\S+/;return e.test(f)},validate_twitter:function(h){var g=h.match(/\[URL\]/ig);var e=(g)?(g.length*24):0;var f=140-h.length-e;this.$character_count.html(f);if(f<10){this.$character_count.css("color","#d95e40")}else{if(f<20){this.$character_count.css("color","#444444")}else{this.$character_count.css("color","#bbbbbb")}}if(f<0||f==140){return false}return true}});var b={init:function(){var e={};d("#posts").on("click",".share_social_button",function(g){if(g.currentTarget!=g.target){return}var f=d(g.currentTarget);var h=d(g.currentTarget).attr("id");if(!e[h]){e[h]=new c({el:f,wait:true,directional:true,no_autofocus:true,disable_auto_show:true})}f.addClass("active");e[h].show()})}};a.ShareButtons=b})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({events:{"click .retro_video_preview":"show_video","click .hide_inline_video":"hide_video"},show_video:function(h){var g=c(h.currentTarget);var f=g.data("id");if(g.data("render-context")=="blank"){var d=c("#permalink_"+f).attr("href");window.open(d,"_blank");return false}if(c("#video_preview_"+f).is(":visible")){c("#video_embed_"+f).html(c("#video_code_"+f).val());c("#video_preview_"+f).hide();c("#watch_video_"+f).show()}this.track_view(true);return false},hide_video:function(g){var d=c(g.currentTarget);var f=d.data("id");if(!c("#video_preview_"+f).is(":visible")){c("#video_embed_"+f).html("");c("#video_preview_"+f).show();c("#watch_video_"+f).hide()}return false},track_view:function(d){if(typeof _gaq!=="undefined"&&_gaq){_gaq.push(["_trackEvent","dashboard_video","click",d?"static":"normal"])}}});a.VideoThumbnails=b})(jQuery,Tumblr);(function(c,b){var a=function(e,d){if(!(this instanceof a)){return new a(e,d)}this.el=(typeof e==="string")?c(e).get(0):e;this.$el=c(e);this.options=d;if(this.$el.data("resizeAnchor")){return this.$el.data("resizeAnchor")}this.$el.data("resizeAnchor",this);this.metadata=this.$el.data("plugin-options");this.config=c.extend({},a.defaults,this.options,this.metadata);this.config.resize=this.$el.css("resize")||"both";if(this.config.create_container){this.$container=c("<div/>").addClass(this.config.container_class).insertBefore(this.$el);this.$container.append(this.$el);this.$clearfix=c("<div/>").addClass(this.config.clearfix_class).insertAfter(this.$container)}this.$anchor=c("<span/>").attr({onclick:"return false;",tabindex:-1}).addClass(this.config.anchor_class).insertAfter(this.$el);this.anchor_visibility();this.resize_start=c.proxy(this._resize_start,this);this.resize_move=c.proxy(this._resize_move,this);this.resize_end=c.proxy(this._resize_end,this);this.$anchor.on("mousedown",this.resize_start);this.$parent=c(window);a.register(this);return this};a.prototype={__event_position:function(f){var d,g;d=f.pageX;g=f.pageY;return{x:d,y:g}},_resize_start:function(d){this.start_width=this.$el.outerWidth();this.start_height=this.$el.outerHeight();this.start_position=this.__event_position(d);this.$parent.on("mousemove",this.resize_move);this.$parent.on("mouseup",this.resize_end);d.preventDefault()},_resize_move:function(d){this.current_position=this.__event_position(d);switch(this.config.resize){case"vertical":this.set_height(this.current_position.y-this.start_position.y+this.start_height);break;case"horizontal":this.set_width(this.current_position.x-this.start_position.x+this.start_width);break;case"both":this.set_size(this.current_position.x-this.start_position.x+this.start_width,this.current_position.y-this.start_position.y+this.start_height);break;case"none":break}},_resize_end:function(d){this.$parent.off("mousemove",this.resize_move);this.$parent.off("mouseup",this.resize_end)},anchor_visibility:function(){if(this.config.resize==="none"){this.$anchor.hide()}else{this.$anchor.show()}},set_width:function(d){this.$el.css("width",Math.max(0,d))},set_height:function(d){this.$el.css("height",Math.max(0,d))},set_size:function(e,d){this.$el.css({width:Math.max(0,e),height:Math.max(0,d)})},destroy:function(){this.$anchor.remove();if(this.config.create_container){this.$el.insertBefore($container);this.$container.remove();this.$clearfix.remove()}}};a.instances=[];a.defaults={container_class:"resize_textarea_container",clearfix_class:"resize_textarea_clearfix",anchor_class:"resize_textarea_anchor",create_container:true};a.register=function(d){this.instances.push(d)};a.destroy_all=function(d){for(var e=0;e<this.instances.length;e++){this.instances[e].destroy()}};c.fn.resizeanchor=function(d){return this.each(function(){new a(this,d)})};b.ResizeAnchor=a})(jQuery,Tumblr);(function(c,a){var b=function(f,d){if(!(this instanceof b)){return new b(f,d)}this.el=(typeof f==="string")?c(f).get(0):f;this.$el=c(f);this.options=d;this.metadata=this.$el.data("plugin-options");this.config=c.extend({},b.defaults,this.options,this.metadata);var e=parseInt(this.$el.css("lineHeight"),10);this.minHeight=this.oldHeight=(this.config.minHeight)?this.config.minHeight:this.$el.height();this.maxHeight=(this.config.maxHeight)?this.config.maxHeight:false;this.padder=e;this.$el.css("min-height",this.minHeight);this.$el.each(c.proxy(function(g){this.create_shadow(g)},this));this.events={__input:c.proxy(this.__input,this),__mouseup:c.proxy(this.__mouseup,this)};this.$el.on("input",this.events.__input);this.$el.on("mouseup",this.events.__mouseup);this.update(this.$el);b.register(this);return this};b.prototype={__input:function(f){var d=c(f.currentTarget);this.update(d)},__mouseup:function(f){var d=c(f.currentTarget);this.oldHeight=d.outerHeight();if(this.oldHeight>=this.maxHeight){this.maxHeight=this.oldHeight}},create_shadow:function(d){this.$shadow=(c("."+this.config.shadowClass).length)?c("."+this.config.shadowClass):c("<div/>",{"class":this.config.shadowClass});this.$shadow.css({position:"absolute",top:-10000,left:-10000,width:this.$el.width(),fontSize:this.$el.css("fontSize"),fontFamily:this.$el.css("fontFamily"),fontWeight:this.$el.css("fontWeight"),lineHeight:this.$el.css("lineHeight")}).appendTo(document.body)},replace_value:function(d){return d.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>")},update:function(d){var f=this.replace_value(d.val());this.$shadow.css("width",this.$el.width());this.$shadow.html(f);var e=Math.max(this.$shadow.height()+this.padder,this.oldHeight);if((this.maxHeight&&(e<this.maxHeight))||!this.maxHeight){this.$el.css("height",e)}else{this.$el.css("height",this.maxHeight)}},destroy:function(){this.$shadow.remove();this.$el.off("input",this.events.__input);this.$el.off("mouseup",this.events.__mouseup)}};b.instances=[];b.defaults={shadowClass:"autoexpand_shadow",minHeight:false,maxHeight:400};b.register=function(d){this.instances.push(d)};b.destroy_all=function(d){for(var e=0;e<this.instances.length;e++){this.instances[e].destroy()}};c.fn.autoexpand=function(d){return this.each(function(){new b(this,d)})};a.AutoExpand=b})(jQuery,Tumblr);(function(b,a){var c=function(e,d){if(!(this instanceof c)){return new c(e,d)}this.el=(typeof e==="string")?b(e).get(0):e;this.$el=b(e);this.options=d;this.metadata=this.$el.data("plugin-options");this.config=b.extend({},c.defaults,this.options,this.metadata);if(this.config.event){this.config.events=this.config.event}if(this.config.selector){this.config.child_selector=this.config.selector}this.$relay_targets=b(this.$el.find(this.config.child_selector)).add(b(this.config.global_selector));this.$el.addClass(this.config.relay_class);this.$relay_targets.addClass(this.config.target_class);this.relay=b.proxy(this.__relay,this);this.events={};b.each(this.config.events.split(","),b.proxy(function(f,g){this.add_event(g)},this));this.$el.data("eventRelayObject",this);c.register(this);return this};c.prototype={__relay:function(d){if(this.__is_relay_element(d)){d.stopPropagation();this.$relay_targets.not(d.target).trigger(d)}},__is_relay_element:function(d){return this.$el.is(d.currentTarget)},add_event:function(d){this.events[d]=true;this.$el.on(d,this.relay)},remove_event:function(d){this.events[d]=false;this.$el.off(d,this.relay)},destroy:function(d){b.each(this.events,b.proxy(function(f){this.remove_event(f)},this));if(!d){c.unregister(this)}}};c.defaults={events:"click",child_selector:false,global_selector:false,relay_class:"click_relay",target_class:"click_relay_target"};c.instances=[];c.register=function(d){this.instances.push(d)};c.unregister=function(d){this.instances.splice(this.instances.indexOf(d),1)};c.destroy_all=function(d){for(var e=0;e<this.instances.length;e++){this.instances[e].destroy(true)}this.instances=[]};b.fn.eventrelay=function(d){return this.each(function(){new c(this,d)})};a.EventRelay=c})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({defaults:{password:"#signup_password",email:"#signup_email",tumblelog:"#signup_username"},initialize:function(d){this.options=d||{};this.options=_.extend(this.defaults,this.options);this.$password_meter=c("#password_strength_meter");this.$password=c(this.options.password);this.$email=c(this.options.email);this.$tumblelog=c(this.options.tumblelog);if(!this.$password.length){return}this.class_name="password_strength_meter";this.password_meter_markup='<div class="password_strength_meter inactive" id="password_strength_meter"><strong class="l5"></strong><strong class="l4 l5"></strong><strong class="l3 l4 l5"></strong><strong class="l2 l3 l4 l5"></strong><strong class="l1 l2 l3 l4 l5"></strong></div>';this.render();this.test_password();this.$password.on("keydown keyup focus blur",_.throttle(_.bind(function(e){if(this.last_checked!==this.get_password()){this.test_password(e)}},this),250))},render:function(){if(!this.$password_meter.length){this.$password.after(this.password_meter_markup);this.$password_meter=c("#password_strength_meter")}},set_inactive:function(){this.$password_meter.addClass("inactive")},set_active:function(){this.$password_meter.removeClass("inactive")},set_level:function(d){this.set_active();switch(d){case 1:this.$password_meter[0].className=this.class_name+" level_1";break;case 2:this.$password_meter[0].className=this.class_name+" level_2";break;case 3:this.$password_meter[0].className=this.class_name+" level_3";break;case 4:this.$password_meter[0].className=this.class_name+" level_4";break;case 5:this.$password_meter[0].className=this.class_name+" level_5";break;default:this.$password_meter[0].className=this.class_name;break}},test_password:function(d){this.last_checked=this.$password.val();if(!d||!this.$password.val().length){this.set_inactive();return}this.get_password_strength()},update:function(){this.test_password()},get_email:function(){return this.$email.val()},get_password:function(){return this.$password.val()},get_username:function(){return this.$tumblelog.val()},get_form_data:function(){var d={};d.username=this.get_username();d.email=this.get_email();d.password=this.get_password();return d},get_password_strength:function(){if(this.pw_xhr){this.pw_xhr.abort()}this.pw_xhr=c.ajax({url:"/svc/account/validation",dataType:"json",type:"POST",data:this.get_form_data()});this.pw_xhr.done(_.bind(function(d){var e=d.score||0;this.set_level(e);this.block_registration_step=(d.reject_reason)?d.reject_reason:false;delete this.pw_xhr},this))}});Tumblr.PasswordStrengthMeter=b})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({initialize:function(d){this.options=d||{};if(typeof this.$el=="undefined"||this.$el.length===0||this.$el.find("leviathan").length!==0){this.remove();return false}this.uid=Math.floor(Math.random()*10000);this.$el.append(this.html());this.$loader=c(".leviathan.loader_"+this.uid);this.center();this.$u1=c("i.unum",this.$loader);this.$u2=c("i.duo",this.$loader);this.$u3=c("i.tres",this.$loader);this.ti=null;this.t1=null;this.t2=null;this.t3=null},start:function(){clearInterval(this.ti);var d=_.bind(function(){this.t1=this.rise(this.$u1,300,0);this.t2=this.rise(this.$u2,300,100);this.t3=this.rise(this.$u3,300,200)},this);d();this.ti=setInterval(_.bind(function(){clearTimeout(this.t1);clearTimeout(this.t2);clearTimeout(this.t3);d()},this,d),600);this.$loader.show()},stop:function(){this.$loader.hide();clearInterval(this.ti);clearTimeout(this.t1);clearTimeout(this.t2);clearTimeout(this.t3)},destroy:function(){this.stop();this.unbind();this.$loader.remove();this.remove()},center:function(){var e=this.$el.width();var d=this.$el.height();var g=this.$loader.width();var f=this.$loader.height();var j=(e/2)-(g/2);var h=(d/2)-(f/2);this.$loader.css({left:j,top:h})},rise:function(e,f,d){if(typeof e=="undefined"||e.length===0){return}return setTimeout(function(){e.stop(true,true).animate({height:"28px",opacity:1,marginTop:"0px"},f).animate({height:"20px",opacity:0.5,marginTop:"4px"},f)},d)},html:function(){return'<div class="loader_'+this.uid+' leviathan"><i class="unum"></i><i class="duo"></i><i class="tres"></i></div>'}});a.PillLoader=b})(jQuery,Tumblr);(function(b,a){a.ReportTumblelogView=Backbone.View.extend({el:"#report_tumblelog_bar",events:{"click .spam":"report_spam","click .harassment":"report_harassment","click .dismiss":"dismiss",mouseenter:"delay_dismiss",mouseleave:"timeout_dismiss"},initialize:function(c){a.Events.on("block_tumblelog",_.bind(this.block_tumblelog,this))},block_tumblelog:function(c){if(c.can_report){this.tumblelog=c.tumblelog;this.animate_in();this.timeout_dismiss()}},animate_in:function(){this.$el.find("#report_tumblelog_with_name").show();this.$el.find("#report_tumblelog_name").html(this.tumblelog);this.$el.fadeIn(300)},report_spam:function(c){var d=this.tumblelog;a.report({tumblelog:d,reason:"1"}).done(function(){a.Events.trigger("report_tumblelog",{tumblelog:d,reason:"spam"})}).always(_.bind(function(){this.dismiss()},this))},report_harassment:function(c){var d=this.tumblelog;a.report({tumblelog:d,reason:"2"}).done(function(){a.Events.trigger("report_tumblelog",{tumblelog:d,reason:"harassment"})}).always(_.bind(function(){this.dismiss()},this))},dismiss:function(c){this.$el.fadeOut(300,_.bind(function(){this.$el.find("#report_tumblelog_name").html("");this.$el.find("#report_tumblelog_with_name").hide()},this))},timeout_dismiss:function(c){c=c||3000;clearTimeout(this.dismissTimeout);this.dismissTimeout=setTimeout(_.bind(function(){this.dismiss()},this),3000)},delay_dismiss:function(c){clearTimeout(this.dismissTimeout)}})})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({initialize:function(){this.$no_posts_found=b(".no_posts_found");this.$left_column=b("#left_column");this.$right_column=b("#right_column");if(this.$no_posts_found.length&&this.$left_column.length&&this.$right_column.length){if(this.$right_column.css("min-height")!="0px"){return}var e=this.$left_column.height(),d=this.$right_column.height(),g=0,f="+";if(e<d){f="+";g=d-e}else{if(e>d){f="-";g=e-d;if(g>=50){g=0}}}this.center_padding(g,f)}},center_padding:function(d,f){if(d>0&&(f=="+"||f=="-")){var e=d/2;this.$no_posts_found.css("padding-top",f+"="+e).css("padding-bottom",f+"="+e)}}});a.FullHeightNoPostsFound=c})(jQuery,Tumblr);(function(g,f){var l={init:function(){_.each(j,function(m,n){l.add(false,m)});c()},add:h};var b=[],d=[],a=false,k=("https:"==document.location.protocol?"https://secure.assets.tumblr.com":"http://assets.tumblr.com"),j=[k+"/images/inline_photo_loading.gif",k+"/images/black_75.png",k+"/images/white_80.png",k+"/images/loading_reblog.gif"];function h(o,m,n){if(typeof n=="undefined"){n=false}d.push([o,m,n])}function e(){for(i=d.length-1;i>=0;i--){var p=d[i][0];var m=d[i][1];var o=d[i][2];if(p===false){img_obj=new Image();img_obj.src=m;b.push(img_obj)}else{var n=document.getElementById(p);if(!n){continue}if(o=="bg"){n.style.backgroundImage="url("+m+")"}else{if(o=="src"){n.src=m}}}d.splice(i,1)}}function c(){if(a){return true}a=window.setInterval(function(){if(typeof(d)!="undefined"&&d.length){e()}},500)}f.ImagePreloader=l;window.add_to_image_queue=h;window.process_image_queue=e;window.start_processing_image_queue=c})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({el:"#right_column",events:{"mousedown li":"on_mousedown"},on_mousedown:function(e){var d=this.$(e.currentTarget);if(d.length&&!d.hasClass("item")&&!d.hasClass("no_push")){this.$(".selected").removeClass("selected");d.addClass("selected")}}});a.PushButtons=b})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({events:{"click .post_content img":"toggle"},toggle:function(k){var g=this.$(k.currentTarget).parents(".post_content");var f=g.find(".toggle_inline_image");f.toggleClass("inline_image");var h=g.find(".inline_external_image");_.each(h,_.bind(this.toggle_external,this));var j=g.find(".image_thumbnail");if(j.length){this.toggle_thumbnail(j)}var d=g.find(".photo_info");if(d.length){d.toggleClass("hidden")}},toggle_thumbnail:function(d){if(d.hasClass("enlarged")){d.removeClass("enlarged");d.attr("width",d.data("thumbnail-width"));d.attr("height",d.data("thumbnail-height"))}else{d.addClass("enlarged");d.attr("width",d.data("width"));d.attr("height",d.data("height"))}},toggle_external:function(f){var g=this.$(f);var d=g.attr("external_src");if(g.hasClass("enlarged")){g.attr("src",g.attr("original_src"));g.removeClass("enlarged")}else{g.attr("original_src",g.attr("src"));g.addClass("enlarged");if(g.attr("loader")){g.attr("src",g.attr("loader"))}var e=new Image();e.onload=function(){g.attr("src",d)};e.src=d}}});a.PhotoThumbnails=c})(jQuery,Tumblr);(function(d,a){var c=Backbone.View.extend({ignore:function(g){g.preventDefault();d("body").addClass("dialog_open");var j=this.tumblelog;var h=a.TumblelogActions.confirm_ignore({tumblelog:j,avatar_url:d(g.delegateTarget).find(".avatar").attr("src")});h.done(function(){a.ignore({tumblelog:j,source:"IGNORE_SOURCE_NOTIFICATION"});a.Events.trigger("block_tumblelog",{tumblelog:j,can_report:true})});return false}});var e=c.extend({events:{"click .block":"ignore","mousedown .notification_inner":"before_notification_click","mouseup .notification_inner":"after_notification_click","click .notification_inner":"notification_click","click .notification_follow_button":"notification_follow","click .photo_reply_image":"notification_photo_reply_image","mouseenter .notification .block":"notification_block_hover","mouseleave .notification .block":"notification_block_hover","mouseenter .control":"control_hover_in","mouseleave .control":"control_hover_out"},initialize:function(){this.tumblelog=this.$el.find("a.block").attr("data-tumblelog");a.Events.on("block_tumblelog",_.bind(this.tumblelog_block,this));if(this.$el.find("a.block").length){this.$el.addClass("can_ignore")}},tumblelog_block:function(g){if(this.tumblelog==g.tumblelog){this.$el.addClass("ignored").addClass("no_active").addClass("no_hover").removeClass("can_ignore");this.$el.find(".block").remove();this.$el.unbind()}},update:function(){this.$el.find(".notification .notification_text").each(function(h,j){var g=d(j);if(g.find("a").length>1){g.addClass("underline_links")}});this.$el.find(".notification a.block").each(function(h,j){var g=d(j);g.closest(".notification").addClass("can_ignore")})},before_notification_click:function(h){var g=d(h.target);if(g.is(".photo_reply_image")||g.is(".photo_reply_image_container")){this.$el.addClass("no_active")}},after_notification_click:function(h){var g=d(h.target);if(g.is(".photo_reply_image")||g.is(".photo_reply_image_container")){this.$el.removeClass("no_active")}},notification_click:function(j){var g=d(j.target);if(!g.is("a")&&!g.is(".photo_reply_image_container")){j.stopPropagation();j.preventDefault();var h=this.$el.find(".notification_target").attr("href");if(!h&&this.$el.find("a").length===1){h=this.$el.find("a").attr("href")}if(h){window.open(h)}}},notification_follow:function(h){h.stopPropagation();h.preventDefault();var g=d(h.target);var j=d(h.currentTarget);j.addClass("animated").addClass("poof");window.setTimeout(_.bind(function(){j.parent().remove();this.$el.removeClass("has_follow");j.addClass("final_state")},this),1000);a.follow({tumblelog:j.attr("data-tumblelog-name"),source:"FOLLOW_SOURCE_DASHBOARD_NOTIFICATION"},{success:function(){var k=d('[href="'+j.attr("data-tumblelog-name")+'"]');k.hide()},error:function(){a.Dialog.alert(l10n_str.ajax_error)}})},notification_photo_reply_image:function(h){var g=d(h.target);h.stopPropagation();h.preventDefault();a.Lightbox.init([{high_res:g.attr("src"),low_res:g.attr("src"),width:500}])},notification_block_hover:function(h){var g=this.$el.find(".notification_inner")},control_hover_in:function(g){this.$el.addClass("control_hover")},control_hover_out:function(g){this.$el.removeClass("control_hover")}});a.Notifications=Backbone.View.extend({el:"#posts",events:{"click .notification_dismiss":"notification_dismiss"},initialize:function(){AfterAutoPaginationQueue.push(_.bind(this.updateViews,this));this.updateViews();this.$el.find(".notification .notification_text").each(function(h,j){var g=d(j);if(g.find("a").length>1){g.addClass("underline_links")}})},updateViews:function(){this.$el.find(".notification:not([data-view-exists])").each(function(j,k){var h=d(k);if(!h.attr("data-view-exists")){var g=new e({el:k});h.attr("data-view-exists",true)}})},notification_dismiss:function(k){k.stopPropagation();k.preventDefault();var h=d(k.target);var n=h.parents(".notification");var m=n.data("cookie");if(m){m=m.split("|");var j=m[0]||"";var l=m[1]||"";var o=parseInt(m[2],10)||null;if(j){set_cookie(j,l,o)}}var g=n.data("ajax");if(g){d.get(g)}n.css("display","none")}});var b=c.extend({events:{"click a.block":"ignore"},initialize:function(){this.tumblelog=this.$el.attr("data-tumblelog");a.Events.on("block_tumblelog",_.bind(this.tumblelog_block,this))},tumblelog_block:function(g){if(this.tumblelog==g.tumblelog){this.$el.addClass("ignored").addClass("no_active").addClass("no_hover").removeClass("can_ignore");this.$el.find(".block").remove();this.$el.unbind()}}});a.NoteView=b;var f=b.extend({events:function(){return _.extend({},b.prototype.events,{click:"note_click",mouseenter:"note_hover",mouseleave:"note_out","mouseenter .avatar_frame":"note_img_hover","mouseleave .avatar_frame":"note_img_out","mouseleave .block":"note_img_out",mousedown:"note_down",mouseup:"note_up"})},note_down:function(h){var g=d(h.target);if(!g.is("a")&&!g.is("img")){this.$el.addClass("active")}},note_up:function(g){this.$el.removeClass("active")},note_hover:function(g){this.$el.addClass("hover")},note_out:function(g){this.$el.removeClass("hover").removeClass("active")},note_img_hover:function(g){this.$el.removeClass("hover")},note_img_out:function(g){this.$el.addClass("hover")},note_click:function(k){var h=d(k.target);var g=d(k.currentTarget);if(!h.is("a")&&!h.is("img")){k.stopPropagation();k.preventDefault();var j=g.find(".action").attr("data-post-url");window.open(j)}}});a.ReblogNoteView=f;a.Notes=Backbone.View.extend({initialize:function(){},el:"#posts",loading_notes:false,events:{"click .post_control.reblog_count":"toggle_notes","click .more_notes_link_container":"more_notes"},create_note_views:function(g){g.find(".note:not([data-view-exists])").each(function(j,l){if(d(l).hasClass("reblog")){var k=new f({el:l})}else{var h=new b({el:l})}d(l).attr("data-view-exists",true)})},toggle_notes:function(g){g.preventDefault();if(this.loading_notes){return}this.loading_notes=true;$link=d(g.currentTarget);$post=$link.closest(".post");$note_outer_container=$post.find(".notes_outer_container");$note_container=$post.find(".notes_container");$notes=$post.find(".notes");$note_outer_container.show();$note_container.show();if($notes.is(":visible")){this.loading_notes=true;$notes.slideUp(300,_.bind(function(){this.loading_notes=false},this));return}if($link.attr("data-notes-loaded")){this.animate_in($notes);return}this.load_notes($post.attr("data-post-id"),$post.attr("data-tumblelog-key"),{},_.bind(function(h){$link.attr("data-notes-loaded",true);$notes.append(d(h).html());this.animate_in($notes);$note_outer_container.find(".notes_control").hide();this.create_note_views($notes)},this))},animate_in:function(g){this.loading_notes=true;g.slideDown(300,_.bind(function(){this.loading_notes=false},this))},more_notes:function(g){g.preventDefault();$more_container=d(g.currentTarget);$link=$more_container.find(".more_notes_link");$post=$more_container.closest(".post");$notes=$post.find(".notes");$loading=$post.find(".notes_loading").show();$link.hide();this.load_notes($post.attr("data-post-id"),$post.attr("data-tumblelog-key"),{from_id:$link.attr("data-next")},_.bind(function(h){$more_container.remove();$notes.find(".last_note").removeClass("last_note");$notes.append(d(h).html());this.create_note_views($notes)},this))},load_notes:function(g,l,j,k){var h="/dashboard/notes/"+g+"/"+l;if(j.from_id){h+="?from_c="+j.from_id}d.ajax(h).done(k)}})})(jQuery,Tumblr);(function(b,a){Tumblr.PostControls=Backbone.View.extend({initialize:function(){},el:"#posts",events:{"click .post_control.block_link":"ignore","click .post_control.publish_post":"publish"},ignore:function(h){var g=b(h.currentTarget);var f=g.data("message");var d=g.data("tumblelog-name");var c=g.data("tumblelog-hash");Tumblr.Dialog.confirm(f,_.bind(function(){Tumblr.ignore({tumblelog:d,source:"IGNORE_SOURCE_POST"});Tumblr.remove_tumblelog_posts(c)},this));return false},publish:function(g){var f=b(g.currentTarget);var d=f.data("message");var c=f.data("post-id");Tumblr.Dialog.confirm(d,_.bind(function(){b("#publish_post_"+c).submit()}));return false}})})(jQuery,Tumblr);(function(c,a){var b={validate_tumblelog_name:function(d){return !(/^-|-$|[^\-a-z0-9]|tumblr/i).test(d)},has_starting_hyphen:function(d){return(/^-/).test(d)},has_ending_hyphen:function(d){return(/-$/).test(d)},clean_tumblelog_name:function(d){return d.toLowerCase().replace(/[^\-a-z0-9]/g,"-").replace(/^-+|-+$/g,"").replace(/tumblr/gi,"")}};a.BlogNameHelper=b})(jQuery,Tumblr);(function(c,a){var b={show:function(g){this.hide();var e="/send?lightbox=true";if(g&&g.href){e=g.href;e+=(e.indexOf("?")!==-1?"&":"?")+"lightbox=true"}var d=c('<div id="send_fan_mail_lightbox_loader"></div>');d.css({zIndex:4294967294,position:"fixed",top:"0px",left:"0px",right:"0px",bottom:"0px",width:"100%",height:"100%",background:"transparent url('/images/fan_mail/grid_bg_lightbox.png?709') center"});d.html('<div style="position:absolute; top:0; left:0; right:0; bottom:0; background:transparent center no-repeat url(\'/images/loading_big_fff_on_2e3133.gif?709\')"><img style="position:absolute; left:0; top:0; width:100%; height:100%; opacity:0.3;" src="/images/full_page_vignette.png?709"/></div>');c("body").append(d);var f=c('<iframe id="send_fan_mail_lightbox" scrolling="no" border="0" frameBorder="0"/>');f.attr("src",e);f.css({zIndex:4294967294,display:"none",position:"fixed",top:"0px",left:"0px",right:"0px",bottom:"0px",width:"100%",height:"100%",background:"transparent",overflow:"hidden"});f.load(function(){c("#send_fan_mail_lightbox_loader").hide();c("#send_fan_mail_lightbox").show()});c("body").append(f)},hide:function(){c("#send_fan_mail_lightbox").hide().remove();c("#send_fan_mail_lightbox_loader").hide().remove()},sending:function(){c("#send_fan_mail_lightbox").hide().load(function(d){c("#send_fan_mail_lightbox_loader").hide();c("#send_fan_mail_lightbox").show()});c("#send_fan_mail_lightbox_loader").show()},make_url_from_tumblelog:function(d){return"/send/"+d}};a.FanMail=b})(jQuery,Tumblr);(function(c,b){var a=Backbone.View.extend({el:"#posts",events:{"mouseover .post_footer_links .tags":"mouseover","mousedown .post_footer_links .tags.draggable":"mousedown",mousemove:"mousemove"},initialize:function(){c("body").on("mouseup",_.bind(this.mouseup,this))},mouseover:function(h){var j=this.$(h.currentTarget);var g=j.parents(".post_footer_links");var f=g.width();var d=g.find(".source_url").width();this.max_width=f;if(d){this.max_width=f-d+8}if(j.width()>this.max_width){j.addClass("draggable")}h.preventDefault();h.stopPropagation()},mousedown:function(d){this.$dragging=this.$(d.currentTarget).addClass("dragging");this.mouse_down_left=d.offsetX||d.clientX-this.$(d.currentTarget).offset().left;d.preventDefault();d.stopPropagation()},mousemove:function(d){if(this.$dragging){this.$dragging.offset({left:d.pageX-this.mouse_down_left});d.preventDefault();d.stopPropagation()}},mouseup:function(g){if(this.$dragging==null){return}this.$dragging.removeClass("dragging");var f=parseInt(this.$dragging.css("left"),10);var d=this.$dragging.width();if(f>0||f<this.max_width-d){this.$dragging.animate({left:"0"})}this.$dragging=null;g.preventDefault();g.stopPropagation()}});b.DraggableTags=a})(jQuery,Tumblr);(function(e,c){function d(j,k,m){var g=(m==null)?e("#like_form_"+j):e("#"+m),h;if(!g.length){return}h=g.attr("action");if(typeof k=="undefined"){f(j)}else{k()}var l=e.ajax({url:h,data:g.serialize(),type:"post"});l.fail(function(){Tumblr.Dialog.alert(l10n_str.ajax_error)})}function f(k){var l=e("#like_button_"+k);var h=e("#like_form_"+k);var g=l.hasClass("already_like");var j=h.attr("action");e("#post_"+k).addClass("force_redraw");e("#post_"+k)[0].offsetHeight;e("#post_"+k).removeClass("force_redraw");var m=l.attr("data-root-post-id")||false;if(g){l.removeClass("already_like");h.attr("action",j.replace("/unlike","/like"));a(k);if(m){e(".like_root_"+m).removeClass("already_like")}}else{l.addClass("already_like");h.attr("action",j.replace("/like","/unlike"));b(k);if(m){e(".like_root_"+m).addClass("already_like")}}}function b(g){if(!(e("#notes_outer_container_"+g)[0]&&e("#show_notes_link_"+g)[0]&&e("#note_link_more_"+g)[0]&&e("#note_link_less_"+g)[0]&&e("#note_link_current_"+g)[0])){return false}e("#show_notes_link_"+g).show();if(e("#note_link_less_"+g).is(":visible")){e("#note_link_less_"+g).hide();e("#note_link_current_"+g).show();e("#note_link_more_"+g).hide()}else{e("#note_link_less_"+g).hide();e("#note_link_current_"+g).hide();e("#note_link_more_"+g).show()}}function a(g){if(!(e("#show_notes_link_"+g)[0]&&e("#note_link_more_"+g)[0]&&e("#note_link_less_"+g)[0]&&e("#note_link_current_"+g)[0])){return false}e("#show_notes_link_"+g).show();if(e("#note_link_more_"+g).is(":visible")){e("#note_link_less_"+g).hide();e("#note_link_current_"+g).show();e("#note_link_more_"+g).hide()}else{e("#note_link_less_"+g).hide();e("#note_link_current_"+g).hide();e("#note_link_less_"+g).show()}}c.like_post=d;window.increment_note_count=b;window.decrement_note_count=a})(jQuery,Tumblr);(function(c,a){function b(e){c("#answer_form_"+e+" [name=redirect_to]").remove();var g="#answer_container_"+e,f=c(g)[0],m=f.children[0].className,l=c("#answer_text_"+e)[0],k=f.querySelector(".answer_avatar").outerHTML,j=c("#answer_form_"+e).serialize();if(!l.value){return}increment_note_count(e);c(f).addClass("updating");l.disabled=true;var h=c.ajax({url:"/answer",data:j,type:"post"});h.fail(function(){Tumblr.Dialog.alert(l10n_str.ajax_error)});h.done(function(n){setTimeout(function(){f.innerHTML='<div class="'+m+'">'+k+' <span class="answer_body">'+l.value.replace("<","&lt;")+"</span></div>";c(f).addClass("updated")},500)})}var d=Backbone.View.extend({el:"#posts",events:{"keyup .answer_form .answer_input":"keyup","submit .answer_form":"submit"},keyup:function(f){this.answer_input=c(f.currentTarget);this.answer_form=this.answer_input.closest(".answer_form");this.answer_length_label=this.answer_form.find(".answer_length");this.answer_input_value=this.answer_input.val();if(this.answer_input_value.length){this.answer_length_label.html(141-this.answer_input_value.length)}else{this.answer_length_label.html()}},submit:function(g){g.preventDefault();g.stopPropagation();var f=c(g.currentTarget).attr("data-post-id");if(f){b(f)}}});a.AnswerPost=d})(jQuery,Tumblr);(function(c,a){function b(e){var d=c(".post_tumblelog_"+e);d.fadeOut(500,function(){d.remove()})}a.remove_tumblelog_posts=b})(jQuery,Tumblr);(function(c,b){var a=Backbone.View.extend({el:"#posts",events:{"click .photo_exif_flipper":"flip"},flip:function(d){d.preventDefault();d.stopPropagation();$el=c(d.currentTarget).parents(".flipcard");$el.addClass("initialized");_.defer(function(){$el.toggleClass("reveal_back")})}});b.ExifFlipcards=a})(jQuery,Tumblr);(function(c,b){var a=Backbone.View.extend({el:"#posts",events:{"click .share_private":"toggle"},toggle:function(g){g.preventDefault();var d=c(g.currentTarget).parents("li").attr("data-post-id");var f=c("#share_"+d);f.toggle()}});b.SharePrivatePost=a})(jQuery,Tumblr);(function(b,a){a.documentWidth=function(c){if(!c){c=b(document).width()}Tumblr.Cookie.set("documentWidth",c,24*60*60)}})(jQuery,Tumblr);(function(b,a){a.devicePixelRatio=function(){Tumblr.Cookie.set("devicePixelRatio",window.devicePixelRatio,24*60*60)}})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({el:"#dashboard_controls_open_blog .activity .count",initialize:function(g){if(this.$el.length){var d=this.$el.data("sparkline");if(typeof(this.$el.sparkline)=="function"){try{if(typeof(d)!=="object"){throw"sparkline is not an object"}if(_.max(d)===0){throw"sparkline has no interesting data"}this.$el.sparkline(d,{type:"line",lineColor:"#748696",fillColor:false,lineWidth:4,chartRangeMin:0,spotColor:false,minSpotColor:false,maxSpotColor:false,disableInteraction:true,width:"72px",height:"30px"});this.$el.find("canvas").css({height:"15px",width:"36px"});return}catch(f){}}}}});a.ActivitySparkline=c})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({el:"body",defaults:{username_input:"#signup_username"},events:{"click #suggested_usernames .popover_menu_item":"handle_click"},initialize:function(d){this.options=d||{};this.options=_.extend(this.defaults,this.options)},handle_click:function(d){b(this.options.username_input).val(d.target.innerHTML).focus();b("#used_suggestion").val(1);b("#suggested_usernames_container").addClass("hidden")}});a.UsernameSuggester=c})(jQuery,Tumblr);(function(c,b){var a={confirm:function(f){var e=c.Deferred();f=f||{};if(!f.tumblelog){return e.reject()}var d=f.avatar_url||"/images/anonymous_avatar_96.png";if(d&&!d.match(/96\.png/)){d=d.replace(/_(\d\d.?)\.png/,"_96.png")}var h=function(){e.resolve();c("body").removeClass("dialog_open")};var g=function(){e.reject();c("body").removeClass("dialog_open")};Tumblr.Dialog.confirm({text:f.confirm_text||"",text_ok:f.text_ok||Tumblr.Dialog.__("Ok"),text_cancel:Tumblr.Dialog.__("Nevermind"),callback_ok:h,callback_cancel:g,templates:{content:'<div class="avatar_image" style="background-image: url('+d+');"><div class="avatar_frame"></div></div><span class="text"><%= text %></span>'}});return e.promise()},confirm_ignore:function(g){if(!g.tumblelog){var f=c.Deferred();return f.reject()}var d="";var e=g.tumblelog.match(/post\_id\:/)||g.tumblelog.match(/ip\:/);if(e){d=l10n_str.confirm_block_this_person}else{d=l10n_str.confirm_block.replace("%1$s","<strong>"+g.tumblelog+"</strong>")}g.confirm_text=d;g.text_ok=Tumblr.Dialog.__("Ignore");return this.confirm(g)},confirm_unfollow:function(e){if(!e.tumblelog){var d=c.Deferred();return d.reject()}e.confirm_text=Tumblr.Dialog.__("Confirm_Unfollow").replace("%1$s","<strong>"+e.tumblelog+"</strong>");e.text_ok=Tumblr.Dialog.__("Unfollow");return this.confirm(e)}};b.TumblelogActions=a})(jQuery,Tumblr);jQuery(document).ready(function(a){Tumblr.LinkButton.init();Tumblr.PhotoReply.init();Tumblr.Panos.init();Tumblr.ReplyButtons.init();Tumblr.ReblogButtons.init();Tumblr.ShareButtons.init();Tumblr.ImagePreloader.init();Tumblr.PlaceHolders.init();Tumblr.DOMEventor.init();Tumblr.Lib.AJAXWithFormKey();new Tumblr.Tabs();new Tumblr.VideoThumbnails({el:a("#posts")});new Tumblr.PhotoThumbnails({el:a("#posts")});new Tumblr.BlogMenu();new Tumblr.DashboardLinkPops();new Tumblr.LanguageMenu({el:"#language_switcher"});new Tumblr.LegalPopover({el:"#popover_legal"});new Tumblr.ReportTumblelogView();new Tumblr.FullHeightNoPostsFound();new Tumblr.PushButtons();new Tumblr.Notifications();new Tumblr.DraggableTags();new Tumblr.ExifFlipcards();new Tumblr.AnswerPost();new Tumblr.SharePrivatePost();new Tumblr.Notes();new Tumblr.PostControls();new Tumblr.ActivitySparkline();new Tumblr.devicePixelRatio();new Tumblr.documentWidth();new Tumblr.tumblrLogo()});
/*! scripts/tumblr/auto_paginator.js */
(function(g,f){var h,p=document.location.href,n=Tumblr.Features("dash_set_pagination_url")(true,false);function k(r){window.history.replaceState({},"",r)}if(window.history.replaceState&&n){h=k}else{h=_.noop}var l={start:function(){m=3;Tumblr.Events.on("DOMEventor:flatscroll",i)},stop:function(){window.loading_next_page=false;Tumblr.Events.off("DOMEventor:flatscroll",i)}};_.extend(l,Backbone.Events);var m=3;window.loading_next_page=false;function i(r){if(r&&r.windowScrollTop===0){h(p)}if(!next_page){if(g("#auto_pagination_loader").is(":visible")){g("#auto_pagination_loader").hide()}l.stop();return}if(loading_next_page){return}if((r.documentHeight-r.windowScrollY)<r.windowHeight*3){loading_next_page=true;a();l.trigger("before",next_page);g("#auto_pagination_loader_loading").show();g("#auto_pagination_loader_failure").hide();d()}}function d(){m--;var r=g.ajax({url:next_page,type:"get"});r.done(function(t){h(next_page);c(t);var s=r.getResponseHeader("X-next-page");if(s){next_page=s}else{next_page=t.match('id="next_page_link" href="')?t.split('id="next_page_link" href="')[1].split('"')[0]:false;if(!next_page){l.stop()}}g("#auto_pagination_loader_loading").hide()});r.fail(function(){if(m){d()}else{j()}})}function c(t){if(t.indexOf('<script type="text/javascript" language="javascript" src="http://assets.tumblr.com/languages/errors.js')!==-1){l.stop();return false}var s;if(t.indexOf("<!-- START POSTS -->")===-1){s=t}else{s=t.split("<!-- START POSTS -->")[1].split("<!-- END POSTS -->")[0]}var r=g(g.trim(s)).not(":empty");g("#posts").append(r);Tumblr.Events.trigger("DOMEventor:updateRect");b();loading_next_page=false;setTimeout(function(){if(typeof window.after_auto_paginate=="function"){after_auto_paginate()}e();l.trigger("after",next_page)},0)}function j(){l.stop();g("#auto_pagination_loader_loading").hide();g("#auto_pagination_loader_failure").show()}function b(){next_page=next_page.replace(/https?:\/\/.*?\//,"/");var s=next_page;if(next_page.indexOf("/dashboard")===0){next_page=next_page.substring(0,next_page.lastIndexOf("/"))}if(window._gaq!==undefined){try{var r=s;var t="unknown_autopagination_route";if(r.match(/^\/dashboard\/[0-9]+\/[0-9]+/)){t="/dashboard/:page/:offset"}else{if(r.match(/^\/dashboard/)){t="/dashboard/:page"}else{if(r.match(/^\/tagged\/[^\/]*\/everything/)){t="/tagged/:tag/everything"}else{if(r.match(/^\/tagged/)){t="/tagged/:tag"}else{if(r.match(/^\/search/)){t="/search/:q"}else{if(r.match(/^\/likes\/page/)){t="/likes/page/:page"}else{if(r.match(/^\/liked\/by/)){t="/liked/by/:tumblelog/page/:page"}else{if(r.match(/^\/blog\/[^\/]*\/queue/)){t="/blog/:channel_id/queue"}else{if(r.match(/^\/blog\/[^\/]*\/drafts\/after\/[0-9]+/)){t="/blog/:channel_id/drafts/after/:before_id"}else{if(r.match(/^\/blog\/[^\/]*\/[0-9]+/)){t="/blog/:channel_id/:page"}}}}}}}}}}if(r.indexOf("?")===-1){r+="?route="+t}else{r+="&route="+t}_gaq.push(["_setCustomVar",2,"User_Logged_In","Yes",3]);ga("set","dimension2","Yes");_gaq.push(["_trackPageview",r]);ga("send","pageview",r)}catch(u){Tumblr.Utils.exceptions(u)}}try{if(window._qevents&&window.__qc){__qc.qpixelsent=[];_qevents.push({qacct:"p-19UtqE8ngoZbM"})}}catch(u){Tumblr.Utils.exceptions(u)}if(typeof(COMSCORE)!=="undefined"){try{COMSCORE.beacon({c1:"2",c2:"15742520"})}catch(u){Tumblr.Utils.exceptions(u)}}}var o=[];function a(){for(var r=o.length-1;r>=0;r--){if(typeof(o[r])==="function"){o[r]()}}}var q=[];function e(){for(var r=q.length-1;r>=0;r--){if(typeof(q[r])==="function"){q[r]()}}}f.AutoPaginator=l;window.BeforeAutoPaginationQueue=o;window.AfterAutoPaginationQueue=q})(jQuery,Tumblr);
/*! scripts/plexi.js */
(function(c,a){var b=function(d){if(!(this instanceof b)){return new b(d)}this.token=d.token||"";if(d.instance){this.instance=d.instance;this.$instance=c(d.instance)}this.hide_timeout=null;this.transition_class=null;this.$hide_timeout=null;b.register(this)};b.prototype={create:function(e,f){f=f||{};var d=c(e);this.$instance=c("<div/>",{"data-token":this.token,"class":"plexi"});this.instance=this.$instance.get(0);if(f.cssClass){this.$instance.addClass(f.cssClass)}d.append(this.$instance)},show:function(d){d=d||{};this.transition_class=d.transition_class||false;if(!this.$instance.hasClass("instant")){this.$instance.addClass("active")}setTimeout(c.proxy(function(){clearTimeout(this.$hide_timeout);if(this.transition_class){this.$instance.addClass(this.transition_class)}this.$instance.addClass("show");if(!this.$instance.hasClass("instant")){this.$instance.addClass("active")}},this),1)},hide:function(){this.$instance.removeClass("show");this.$hide_timeout=setTimeout(c.proxy(function(){this.$instance.removeClass("show instant active fast");if(this.transition_class){this.$instance.removeClass(this.transition_class)}},this),50)},destroy:function(){b.instances.splice(_.indexOf(this),1);return this}};b.instances=[];b.register=function(d){this.instances.push(d)};b.findByToken=function(f){var d;for(var e=0;e<this.instances.length;e++){if(this.instances[e].token==f){d=this.instances[e]}}if(!d){var h=c('.plexi[data-token="'+f+'"]');if(h.length){var g=new Tumblr.Plexi({instance:h,token:f});this.instances.push(g);return g}}return d};a.Plexi=b})(jQuery,Tumblr);
/*! scripts/sortable.js */
(function(c,b){var a=Backbone.View.extend({initialize:function(d){this.options=d||{};d.items||(d.items=".item");this.callback=d.callback||function(){};this.before=d.before||function(){};this.placeholder=null;this.on_dragenter=_.throttle(this.on_dragenter,500);this.reloadItems()},events:function(){var d=this.options.items;var e=_(["dragstart","dragenter","dragover","drop","dragend"]).reduce(function(f,g){f[g+" "+d]="on_"+g;return f},{});return _.extend(e,{})},on_dragstart:function(f){f.originalEvent.dataTransfer.effectAllowed="move";try{f.originalEvent.dataTransfer.setData("text/html","foo")}catch(d){}this.dragged=f.currentTarget;this.placeholder=c(this.dragged).clone().addClass("sortable-placeholder");if(!this.options.no_opacity){this.placeholder.css("opacity","0").find("*").css("opacity","0")}this.placeholder=this.placeholder.get(0);this.$(this.dragged).addClass("sortable-dragging");this.before.call(this);this.trigger("dragstart",this);if(this.options.scrollable){this.$el.on("dragover."+this.cid,_.throttle(function(k){var i=0.2;var h=window.innerHeight;var g=k.originalEvent.clientY/h;var j=this.getBoundingClientRect();if(g<i&&j.top<0){window.scrollBy(0,-((i-g)*200))}else{if(g>(1-i)){window.scrollBy(0,((i+g-1)*200))}}k.preventDefault()},50));this.$(this.dragged).one("dragend",_.bind(function(){this.$el.off(["dragenter."+this.cid,"dragover."+this.cid].join(" "))},this))}},on_dragenter:function(h){if(!this.dragged){return}h.preventDefault();var g=h.currentTarget;if(g==this.placeholder){return}this.$(this.dragged).hide();var d=this.$(g).index(this.options.items);var f=this.$(this.placeholder).index(this.options.items);if(f<d){this.$(g).after(this.placeholder)}else{this.$(g).before(this.placeholder)}this.last_droppable=g},on_dragover:function(d){if(!this.dragged){return}d.preventDefault()},on_drop:function(d){if(!this.dragged){return}d.stopPropagation();this.$(this.dragged).insertAfter(this.placeholder);return false},on_dragend:function(d){this.$(this.dragged).removeClass("sortable-dragging").show();this.$(this.placeholder).detach();d.stopPropagation();this.callback(this);this.trigger("dragend",this);this.dragged=null;this.last_droppable=null},sequence:function(){var d=this.$(this.options.items).toArray();return _.uniq(_.pluck(d,"id"))},reloadItems:function(){this.items=this.$(this.options.items);this.items.attr("draggable",true);this.items.find("a").attr("draggable",false);this.items.find("img").attr("draggable",false);return this},teardown:function(){this.undelegateEvents();if(this.options.scrollable){this.$el.off(["dragenter."+this.cid,"dragover."+this.cid].join(" "))}this.items.add("a, img",this.items).removeAttr("draggable");this.options.items=this.items=null;this.options.callback=this.callback=null;this.options.before=this.before=null;this.on_dragenter=null;return this}});b.SortableView=a})(jQuery,Tumblr);
/*! scripts/toaster.js */
(function(c,b){var a=Backbone.View.extend({el:"#toaster",debug_mode:false,defaults:{max_toast:5,toast_padding:623,away_speed:350,close_buttons:false,queue_heartbeat:1000,pause_on_hover:true,only_when_footer_hidden:true,token:null},default_toast:{id:null,type:"text",on_create:false,on_destory:false,animation:true,message:" ",img1:{url:null,badge:" ",is_link:false,href:"#"},img2:{url:null,badge:" ",is_link:false,href:"#"},icon:{type:"regular",href:"#"},notification:{object:null,title:"",body:"",icon:false},is_link:false,href:"#",position_class:"toast_only",close:false,expires:7023,in_queue:false},toast_count:0,toasts:{},desk_notify_support:false,page_visible:true,transition_support:true,is_ipad:false,toast_ids:[],queue_ids:[],paused:false,t_paused:null,unpause_expires:2000,t_queue_heartbeat:null,toast_padding_mult:0,push_lock:false,time_until_lock:50,t_push_lock:null,footer_overlaps:false,templates:{text:'<li id="toast_<%- id %>" class="toast toast_text <%- position_class %>"><span class="toast_border"><span class="toast_outer"><span class="toast_inner"><% if (is_link === true) { %><a class="anchor" href="<%- href %>" target="blank"></a><% } %><span class="txt"><%= message %></span></span></span><% if (close === true) { %><span class="close"></span><% } %></span></li>',image_text:'<li id="toast_<%- id %>" class="toast toast_image_text <%- position_class %>"><span class="toast_border"><span class="toast_outer"><span class="toast_inner"><% if (is_link === true) { %><a class="anchor" href="<%- href %>" target="blank"></a><% } %><span class="frame box_left <%- img1.badge %>"><% if (img1.is_link === true) { %><a href="<%- img1.href %>" target="_blank"><% } %><img src="<%- img1.url %>" width="28" height="28" /><% if (img1.is_link === true) { %></a><% } %></span><span class="txt"><%= message %></span></span></span><% if (close === true) { %><span class="close"></span><% } %></span></li>',image_text_image:'<li id="toast_<%- id %>" class="toast toast_image_text_image <%- position_class %>"><span class="toast_border"><span class="toast_outer"><span class="toast_inner"><% if (is_link === true) { %><a class="anchor" href="<%- href %>" target="blank"></a><% } %><span class="frame box_left <%- img1.badge %>"><% if (img1.is_link === true) { %><a href="<%- img1.href %>" target="_blank"><% } %><img src="<%- img1.url %>" width="28" height="28" /><% if (img1.is_link === true) { %></a><% } %></span><span class="txt"><%= message %></span><span class="frame box_right <%- img2.badge %>"><% if (img2.is_link === true) { %><a href="<%- img2.href %>" target="_blank"><% } %><img src="<%- img2.url %>" width="28" height="28" /><% if (img2.is_link === true) { %></a><% } %></span></span></span><% if (close === true) { %><span class="close"></span><% } %></span></li>',image_text_icon:'<li id="toast_<%- id %>" class="toast toast_image_text_icon <%- position_class %>"><span class="toast_border"><span class="toast_outer"><span class="toast_inner"><% if (is_link === true) { %><a class="anchor" href="<%- href %>" target="blank"></a><% } %><span class="frame box_left <%- img1.badge %>"><% if (img1.is_link === true) { %><a href="<%- img1.href %>" target="_blank"><% } %><img src="<%- img1.url %>" width="28" height="28" /><% if (img1.is_link === true) { %></a><% } %></span><span class="txt"><%= message %></span><a class="frame box_right icon <%= icon.type %>" href="<%- icon.href %>"><span class="inside icon <%= icon.type %>"></span></a></span></span><% if (close === true) { %><span class="close"></span><% } %></span></li>'},events:{mouseover:"hover_in",mouseout:"hover_out"},initialize:function(d){this.options=d||{};this.options=_.extend(this.defaults,this.options);this.debug_order=0;if(this.options.only_when_footer_hidden){this._sidebar_hide_helpers()}if(window.webkitNotifications||window.Notification){this.desk_notify_support=true}c('<style type="text/css"> #toaster .toast .toast_border { background-color: '+c("body").css("background-color")+" !important; } </style>").appendTo("head");var e=document.createElement("div").style;this.transition_support="transition" in e||"WebkitTransition" in e||"MozTransition" in e||"msTransition" in e||"OTransition" in e;this.is_ipad=(navigator.userAgent.match(/iPad/i)===null)?false:true;this._queue_heartbeat();this._add_visibility_helper();return this},debug:function(d){this.debug_mode=d;console.log("Debug mode is now "+(d?"on":"off")+".")},tumblrbot:function(e){var d={type:"image_text",message:"<strong>"+e+"</strong>",is_link:false,href:"#",img1:{url:"/images/toast_tumblrbot.png",is_link:true,href:"http://tumblrbot.tumblr.com/"}};this.add_toast(d)},can_display_toasts:function(){var d=c(window);if(d.innerHeight()<400||d.innerWidth()<960){return false}return this.page_visible},footer_will_overlap:function(){if(this.options.only_when_footer_hidden){return this.footer_overlaps}return false},is_screen_full:function(){return(this.toast_ids.length>=this.options.max_toast)},is_screen_empty:function(){return(this.toast_ids.length===0)},is_queue_empty:function(){return(this.queue_ids.length===0)},_queue_heartbeat:function(){clearTimeout(this.t_queue_heartbeat);var d=function(){if(this.is_queue_empty()||!this.is_screen_empty()){this._queue_heartbeat()}else{this.push_lock=true;var g=this.queue_ids.length;this.toast_padding_mult=0;for(var e=0;e<=g;e++){if((e<this.options.max_toast)&&(e<g)){var f=this.queue_ids[0];this.queue_ids.splice(0,1);this.toast_ids.push(f);this._delayed_add_toast_to_dom(f,(this.toast_padding_mult*this.options.toast_padding));this.toast_padding_mult++}else{break}}this._queue_heartbeat()}};this.t_queue_heartbeat=setTimeout(_.bind(d,this),this.options.queue_heartbeat)},_delayed_add_toast_to_dom:function(f,d){var e=setTimeout(_.bind(function(){this._add_toast_to_dom(f)},this),d)},_add_next_queue_item:function(){if(!this.is_queue_empty()){var d=this.queue_ids[0];this.queue_ids.splice(0,1);this.toast_ids.push(d);this._add_toast_to_dom(d);this._queue_heartbeat()}},add_toast:function(d){var e={};jQuery.extend(e,this.default_toast,d);this._toast(e)},_toast:function(e){var f=this.toast_count++;var d=(this.push_lock||!this.is_queue_empty()||this.is_screen_full());if(d){this.queue_ids.push(f)}else{if(this.toast_ids.length===0){this.toast_padding_mult=0}this.toast_ids.push(f)}e=jQuery.extend(e,{id:f});var g=this._get_toast_template(e.type);$toast=c(g(e));this.toasts[f]={id:f,$el:$toast,options:e,in_queue:d,t:null};if(!d){setTimeout(_.bind(function(){this._add_toast_to_dom(f)},this),(this.toast_padding_mult*this.options.toast_padding));this.toast_padding_mult++;clearTimeout(this.t_push_lock);this.t_push_lock=setTimeout(_.bind(function(){this.push_lock=true;this.toast_padding_mult=0},this),this.time_until_lock)}return f},_add_toast_to_dom:function(d){if(this.footer_will_overlap()||!this.can_display_toasts()||typeof this.toasts[d]==="undefined"){this._nuke_toast(d);return}this.toasts[d].t=this._set_toast_timeout(d);this.$el.append(this.toasts[d].$el);if(this.transition_support){setTimeout(_.bind(function(){this._update_position_helpers()},this),200)}else{this._update_position_helpers()}c("#toast_"+d).addClass("animation");setTimeout(function(){c("#toast_"+d).addClass("slide_open")},50);this._measure_helpers(d);this._click_helpers(d)},_sidebar_hide_helpers:function(){var e=c("#right_column");if(e.length!==1){return}var f=e.outerWidth();var d=e.outerHeight();setInterval(_.bind(function(){var p=c(window).innerHeight();var n=window.pageYOffset;var m=n+p;var o=e.offset();var k=o.top;var h=o.top+d;if((n+(p/2.5))<h){this.footer_overlaps=true;for(var l=this.toast_ids.length-1;l>=0;l--){this.pop_toast(this.toast_ids[l])}for(var g=this.queue_ids.length-1;g>=0;g--){this._nuke_toast(this.queue_ids[g])}this._queue_heartbeat()}else{this.footer_overlaps=false}},this),800)},_measure_helpers:function(d){$txt=c("#toast_"+d+" .txt");if($txt.length>0){var e=$txt.height();if(e>0&&e<=20){$txt.addClass("nowrap")}}},_click_helpers:function(d){$anchor=c("#toast_"+d+" .anchor");if($anchor.length>0){$anchor.on("mousedown",function(){c("#toast_"+d).addClass("toast_active")});$anchor.on("click, mouseup, mouseleave",function(){c("#toast_"+d).removeClass("toast_active")})}},reset_all_timeouts:function(){c.each(this_toast_ids,_.bind(function(e,d){this._set_toast_timeout(d)},this))},set_all_timeouts:function(d){c.each(this.toast_ids,_.bind(function(f,e){this.toasts[e].t=this._set_custom_toast_timeout(e,d)},this))},hover_in:function(){if(this.is_ipad){return}clearTimeout(this.t_paused);if(!this.paused){this._clear_all_timeouts()}this.paused=true;this.$el.addClass("hover")},hover_out:function(){if(this.is_ipad){return}this.t_paused=setTimeout(_.bind(function(){this.paused=false;this.$el.removeClass("hover");c.each(this.toast_ids,_.bind(function(f,e){var d=this.unpause_expires+(f*this.options.toast_padding);this.toasts[e].t=this._set_custom_toast_timeout(e,d)},this))},this),150)},pop_toast:function(e){if(this.debug_mode||typeof this.toasts[e]==="undefined"){return}clearTimeout(this.toasts[e].t);var d=jQuery.inArray(e,this.toast_ids);this.toast_ids.splice(d,1);delete this.toasts[e];this._freeze_toast(e);this._animate_away(e);this._update_position_helpers();if(this.can_display_toasts()&&!this.footer_will_overlap()&&(this.toast_ids.length==(this.options.max_toast-1))){this._add_next_queue_item()}else{this._queue_heartbeat()}clearTimeout(this.t_push_lock);if(this.is_screen_empty()){this.push_lock=false}},_nuke_all_toast:function(){c.each(this.toasts,_.bind(function(e,d){this._nuke_toast(d.id)},this));this._queue_heartbeat()},_nuke_toast:function(e){var d=jQuery.inArray(e,this.toast_ids);if(d!==-1){this.toast_ids.splice(d,1)}var f=jQuery.inArray(e,this.queue_ids);if(f!==-1){this.queue_ids.splice(f,1)}if(d!==-1||f!==-1){clearTimeout(this.toasts[e].t);delete this.toasts[e];var g=c("#toast_"+e);if(g.length>0){g.remove()}}this._update_position_helpers();return},_clear_all_timeouts:function(){c.each(this.toast_ids,_.bind(function(e,d){clearTimeout(this.toasts[d].t)},this))},_animate_away:function(e){var d=c("#toast_"+e);if(d.length===0){return}c("#toast_"+e).addClass("fade_out");setTimeout(function(){c("#toast_"+e).remove()},(this.options.away_speed+15))},_freeze_toast:function(d){var l=c("#toast_"+d);if(l.length===0){return}var e=l.position();var j=c("#toaster").height();var h=l.outerHeight();var i=l.width();var k=l.height();var g=e.top;var f=e.left;l.css({position:"absolute",bottom:(j-h)+"px",left:f+"px",width:i,height:k})},_get_toast_template:function(d){return _.template(this.templates[d])},_toast_expire:function(d){this.pop_toast(d)},_add_visibility_helper:function(){var g,h,f={hidden:"visibilitychange",mozHidden:"mozvisibilitychange",webkitHidden:"webkitvisibilitychange",msHidden:"msvisibilitychange",oHidden:"ovisibilitychange"};for(g in f){if(f.hasOwnProperty(g)&&g in document){h=f[g];break}}if(h){document.addEventListener(h,e)}else{if(c.browser.msie&&(parseInt(c.browser.version,10)<=9)){document.onfocusin=document.onfocusout=e}else{window.onfocus=window.onblur=e}}var d=this;function e(j){var i=document.body;j=j||window.event;if(j.type=="focus"||j.type=="focusin"){d.page_visible=true}else{if(j.type=="blur"||j.type=="focusout"){d.page_visible=false}else{d.page_visible=this[g]?false:true}}}},_set_toast_timeout:function(d){if(typeof this.toasts[d]!="object"){return null}return this._set_custom_toast_timeout(d,this.toasts[d].options.expires)},_set_custom_toast_timeout:function(f,d){if(typeof this.toasts[f]!="object"){return null}clearTimeout(this.toasts[f].t);var e=function(){this._toast_expire(f)};return setTimeout(_.bind(e,this),d)},_update_position_helpers:function(){var f=0;var d=0;for(var e=this.toast_ids.length-1;e>=0;e--){if(c("#toast_"+this.toast_ids[e]).is(":visible")){d++}}c.each(this.toast_ids,function(h,g){$this_toast=c("#toast_"+g);if($this_toast.length>0){$this_toast.removeClass("toast_only toast_top toast_bottom toast_middle");if(d==1){$this_toast.addClass("toast_only")}else{if(f===0){$this_toast.addClass("toast_top")}else{if(f===(d-1)){$this_toast.addClass("toast_bottom")}else{$this_toast.addClass("toast_middle")}}}f++}})}});b.Toaster=a})(jQuery,Tumblr);(function(c,a){var b=Backbone.Model.extend({translations:{},add_translations:function(d){jQuery.extend(this.translations,d)},unset_translations:function(){this.translations={}},__:function(d){return this.translations[d]||d},_helper_icon_target_type:function(d){return d.target_post_type},_helper_media_url:function(d){return d.media_url},_helper_from_tumblelog_link:function(d){var e=d.from_tumblelog_name;if(d.from_tumblelog_name.length>14){e=d.from_tumblelog_name.substr(0,14)+"..."}return'<a href="'+d.from_tumblelog_url+'" target="_blank">'+e+"</a>"},_helper_other_user_badge:function(d){var e=d.type;if(e==="answer"){e="reply"}if(e==="photo_reply"){e="reply"}return e},_helper_blockquote:function(d){return"<blockquote>"+_.escape(d)+"</blockquote>"},_helper_is_empty:function(d){return(d==="")},_helper_has_reply:function(d){if((typeof d.quote_summary=="string")&&!this._helper_is_empty(d.quote_summary)){return true}else{return false}},_helper_summary_txt:function(d){if((typeof d.summary=="string")&&!this._helper_is_empty(d.summary)){return": <em>"+_.escape(d.summary)+"</em>"}else{return""}},_helper_post_noun:function(d){return d.noun_type=="question"?"post":d.noun_type},_base_other_user_action:function(d){var g={img1:{url:d.from_tumblelog_avatar,badge:this._helper_other_user_badge(d),is_link:true,href:d.from_tumblelog_url}};var f={};if(d.type=="follower"||d.type=="user_mention"){f={type:"image_text"}}else{if(d.type=="photo_reply"){f={type:"image_text_image",img2:{url:d.photo_reply_url,is_link:true,href:d.target_post_url}}}else{if(d.target_post_type=="photo"){f={type:"image_text_image",img2:{url:this._helper_media_url(d),is_link:true,href:d.target_post_url}}}else{f={type:"image_text_icon",icon:{type:this._helper_icon_target_type(d),href:d.target_post_url}}}}}var e={};jQuery.extend(e,g,f);return e},notification_center_convert:function(f,d){var e={type:"image_text",message:"<strong>"+f+"</strong>",is_link:true,href:d.url,img1:{url:d.tumblelog.avatar,is_link:true,href:d.tumblelog.url}};return e},like:function(d){var e=this._base_other_user_action(d);var g="%1$s liked your "+this._helper_post_noun(d);g=this.__(g).replace("%1$s",this._helper_from_tumblelog_link(d));var f={message:g,is_link:true,href:d.target_post_url};jQuery.extend(f,e);return f},reblog:function(d){var e=this._base_other_user_action(d);var g="%1$s reblogged your "+this._helper_post_noun(d);g+=this._helper_has_reply(d)?" and added:":"";g=this.__(g).replace("%1$s",this._helper_from_tumblelog_link(d));if(this._helper_has_reply(d)){g+=this._helper_blockquote(d.quote_summary)}var f={message:g,is_link:true,href:d.new_post_url};jQuery.extend(f,e);return f},answer:function(d){var e=this._base_other_user_action(d);var g="%1$s answered your question";g=this.__(g).replace("%1$s",this._helper_from_tumblelog_link(d));g+=this._helper_summary_txt(d)+this._helper_blockquote(d.answer_text);var f={message:g,is_link:true,href:d.target_post_url};jQuery.extend(f,e);return f},reply:function(d){var e=this._base_other_user_action(d);var g="%1$s replied to your "+this._helper_post_noun(d);g=this.__(g).replace("%1$s",this._helper_from_tumblelog_link(d));g+=this._helper_summary_txt(d)+this._helper_blockquote(d.reply_text);var f={message:g,is_link:true,href:d.target_post_url};jQuery.extend(f,e);return f},photo_reply:function(d){var e=this._base_other_user_action(d);var g="%1$s replied to your "+this._helper_post_noun(d);g=this.__(g).replace("%1$s",this._helper_from_tumblelog_link(d));g+=this._helper_summary_txt(d);var f={message:g,is_link:true,href:d.target_post_url};jQuery.extend(f,e);return f},follower:function(d){var e=this._base_other_user_action(d);var g="%1$s started following %2$s";if(this.has("primary_tumblelog")){if(this.get("primary_tumblelog")==d.target_tumblelog_name){g="%1$s started following you"}}g=this.__(g);g=g.replace("%1$s",this._helper_from_tumblelog_link(d));g=g.replace("%2$s",d.target_tumblelog_name);var f={message:g,is_link:true,href:d.from_tumblelog_url};jQuery.extend(f,e);return f},user_mention:function(d){var f=this._base_other_user_action(d);var i=this._helper_post_noun(d);var e=i=="audio"?"an":"a";var h="%1$s mentioned %2$s in "+e+" "+i;h=this.__(h);h=h.replace("%1$s",this._helper_from_tumblelog_link(d));h=h.replace("%2$s",d.target_tumblelog_name);var g={message:h,is_link:true,href:d.new_post_url};jQuery.extend(g,f);return g}});a.ToastKit=new b()})(jQuery,Tumblr);(function(c,a){var b=Backbone.Model.extend({enabled:true,debug_mode:false,poll_route:"/svc/poll",is_sleeping:false,total_sleep_heartbeats:0,total_empty_heatbeats:0,hash_history:{},use_hash_history:true,visibility_check:2000,i_visibility_check:null,is_window_visible:true,defaults:{toast_mode:0,primary_tumblelog:false,start_timestamp:false,check_posts:false,check_inbox:false,current_speed:1,initial_delay:0,poll_speeds:{0:10000,1:20000,2:30000,3:50000,4:60000,5:80000},sleep_speed:300000,sleep_max:18,slowdown_beats:10,poll_padding:30000},use_timestamps:true,last_timestamp:false,t_heartbeat:null,is_first_heartbeat:true,poll_lock:false,initialize:function(d){this.options=this.attributes;Tumblr.ToastKit.set("primary_tumblelog",d.primary_tumblelog);if(typeof Tumblr.Cookie==="object"){var e=Tumblr.Cookie.get("last_toast");if(e){e=parseInt(e,10);if(e!==0&&e>this.options.start_timestamp){this.options.start_timestamp=e}}}if(this.options.start_timestamp){this.update_timestamp(this.options.start_timestamp)}if(this.options.toast_mode===0){this.options.current_speed=3}this._set_heartbeat();this.i_visibility_check=setInterval(_.bind(this._check_visibility,this),this.visibility_check)},kill_switch:function(){this.enabled=false;this.poll_lock=true;clearTimeout(this.t_heartbeat)},debug_endless:function(){this.use_timestamps=false;this.use_hash_history=false;this.options.current_speed=0;this.heartbeat();return true},heartbeat:function(){clearTimeout(this.t_heartbeat);if(!this.enabled){return false}if(this.total_empty_heatbeats>=this.options.slowdown_beats){this.total_empty_heatbeats=0;this.poll_slower()}if(this.is_sleeping){this.total_sleep_heartbeats++;if(this.total_sleep_heartbeats<=this.options.sleep_max){this.poll()}else{}}else{this.poll()}this._set_heartbeat();return},get_next_heartbeat:function(){return this.is_sleeping?this.options.sleep_speed:this.options.poll_speeds[this.options.current_speed]},_check_visibility:function(){var d=Tumblr.Toaster.can_display_toasts();if(this.is_window_visible&&!d){this.sleep()}if(!this.is_window_visible&&d){this.wakeup()}this.is_window_visible=d},_set_heartbeat:function(){var d=this.is_sleeping?this.options.sleep_speed:this.options.poll_speeds[this.options.current_speed];if(this.is_first_heartbeat){this.is_first_heartbeat=false;d=this.is_sleeping?this.options.sleep_speed:this.options.poll_speeds[this.options.initial_delay]}this.t_heartbeat=setTimeout(_.bind(function(){this.heartbeat()},this),d)},poll_faster:function(){var d=this.options.current_speed;if((d-1)>=0){this.options.current_speed--}},poll_slower:function(){var d=this.options.current_speed;var e=_.size(this.options.poll_speeds);if((d+1)<e){this.options.current_speed++}},sleep:function(){this.is_sleeping=true;this.total_sleep_heartbeats=0},wakeup:function(){this.is_sleeping=false;this.total_sleep_heartbeats=0;this._set_heartbeat()},poll:function(){if(this.poll_lock){return}this.poll_lock=true;var g={notifications_next:(this.get_next_heartbeat()+this.options.poll_padding),magick:Math.floor(Math.random()*100001)};if(this.options.token!==null){g.token=this.options.token}if(this.options.toast_mode!==0){var d={notifications:true};jQuery.extend(g,d)}if(this.use_timestamps&&this.last_timestamp&&!this.debug_mode){jQuery.extend(g,{from:this.last_timestamp})}if(this.options.check_posts){var h={unread:true};jQuery.extend(g,h)}if(this.options.check_inbox){var e={inbox:true};jQuery.extend(g,e)}var f=c.ajax({url:this.poll_route,type:"GET",data:g});f.done(_.bind(function(i){this.poll_lock=false;if(this.options.toast_mode!==0){this.parse_notifications(i)}if(this.options.check_posts){this.parse_unread(i)}if(this.options.check_inbox){this.parse_inbox(i)}if(typeof i.next_from!=="undefined"){this.update_timestamp(i.next_from)}},this));f.fail(_.bind(function(){this.kill_switch()},this))},update_timestamp:function(d){d=parseInt(d,10);if(this.last_timestamp===false||d>this.last_timestamp){this.last_timestamp=d;if(typeof Tumblr.Cookie==="object"){Tumblr.Cookie.set("last_toast",d,365*24*60*60)}}},parse_unread:function(f){if(typeof f.unread!=="number"){return}var e=f.unread;if(e){var d=e;if(e>=100){this.options.check_posts=false;d="100+"}if(e>0){document.title="("+d+") "+(document.title.indexOf(")")!=-1?document.title.split(")")[1]:document.title);c(".new_post_notice_container").each(_.bind(function(h,g){var j=c(g);j.find(".tab_notice_value").text(d);j.show()},this))}}},parse_inbox:function(f){if(typeof f.inbox!=="number"){return}var e=f.inbox;if(e){var d=e;if(e>0){c(".inbox_notice_container").each(_.bind(function(h,g){var j=c(g);j.find(".tab_notice_value").text(d);j.show()},this))}else{c(".inbox_notice_container").hide()}}},parse_notifications:function(e){if(typeof e.notifications!=="object"){return}var d=e.notifications;if(d.length>0){c(d).each(_.bind(function(h,f){var j=false;if(this.use_hash_history){var k=f.hash;if(k in this.hash_history){this.hash_history[k]++;j=true}else{this.hash_history[k]=1}}if(!j&&this.options.toast_mode!==0){var g=false;switch(f.type){case"like":g=Tumblr.ToastKit.like(f);break;case"reblog":g=Tumblr.ToastKit.reblog(f);break;case"answer":g=Tumblr.ToastKit.answer(f);break;case"reply":g=Tumblr.ToastKit.reply(f);break;case"photo_reply":g=Tumblr.ToastKit.photo_reply(f);break;case"follower":g=Tumblr.ToastKit.follower(f);break;case"user_mention":g=Tumblr.ToastKit.user_mention(f);break}if(g){Tumblr.Toaster.add_toast(g)}}},this));this.poll_faster();this.total_empty_heatbeats=0}else{this.total_empty_heatbeats++}}});a.Thoth=b})(jQuery,Tumblr);
/*! scripts/dialog.js */
/*!
 * Tumblr.Dialog
 * A highly customizable queuing dialog system with easy replacements for alert() and prompt()
 * Features:
 *   - Add custom templates
 *   - Tab between buttons + enter/escape support
 *   - Default buttons tied to keys
 *   - Multiple dialogs queue for user
 *   - Multiple button styles
 *   - Callbacks everywhere
 */
(function(c,b){var a=Backbone.View.extend({el:".ui_dialog",translations:{},defaults:{},default_templates:{dialog:'<div class="ui_dialog <%= type %>"><%= content_html %><div class="buttons"><%= buttons_html %></div></div>',content:'<span class="text"><%= text %></span>',button:'<button class="ui_button btn_<%= btn_id %> chrome <%= btn_class %>" data-btn-id="<%= btn_id %>"><span><%= text %></span></button>'},events:{"click .ui_button":"button_click"},default_dialog:{text:"",type:"default",has_form:"auto",visible_glass:true,confirm_by_enter:true,close_by_space:true,key_tab:true,key_close:true,scroll_lock:false,animate:true,animate_in:{dialog_el:".ui_dialog",dialog_class:"add_animation fadeIn"},on_close:function(){},on_open:function(){}},initialize:function(d){this.options=_.extend(this.defaults,this.options);this.templates=this.default_templates;this.is_visible=false;this.dialog_queue_order=[];this.dialog_queue={};this.queue_counter=0;this.current_dialog=false;this.current_dialog_id=0;this.uid=0;this._init_click_lock();this._setup_keys()},add_translations:function(d){jQuery.extend(this.translations,d)},unset_translations:function(){this.translations={}},__:function(d){return this.translations[d]||d},dialog:function(d){if(!_.isObject(d)){return false}return this._dialog(d)},confirm:function(e,i,j,g,d){if(_.isString(e)){e={text:e}}var h={callback_ok:i,callback_cancel:j,text_ok:g,text_cancel:d};e=_.extend({},h,e);var f={text:e.text,type:"confirm",visible_glass:true,templates:e.templates||null,escape_button:0,buttons:{0:{text:e.text_cancel||this.__("Cancel"),close:true,callback:((_.isFunction(e.callback_cancel))?e.callback_cancel:function(){})},1:{text:e.text_ok||this.__("OK"),selected:true,btn_class:"blue",close:true,callback:((_.isFunction(e.callback_ok))?e.callback_ok:function(){})}}};return this._dialog(f)},alert:function(d,h,f){if(_.isString(d)){d={text:d}}var g={callback_ok:h,text_ok:f};d=_.extend({},g,d);var e={text:d.text,type:"alert",visible_glass:true,templates:d.templates||null,escape_button:0,buttons:{0:{text:d.text_ok||this.__("OK"),selected:true,btn_class:"blue",close:true,callback:((_.isFunction(d.callback_ok))?d.callback_ok:function(){})}}};return this._dialog(e)},button_click:function(i){var h=c(i.currentTarget);var g=h.data("btn-id");if(_.isUndefined(this.current_dialog.buttons[g])||h.hasClass("disabled")){return false}var f=this.current_dialog.buttons[g];var d=null;if(_.isFunction(f.callback)){d=f.callback(this)}if(d!==false&&((!_.isUndefined(f.close)&&f.close)||_.isUndefined(f.close))){this.close()}},is_active:function(d){if((this.current_dialog===false)||(this.current_dialog.uid!=d)){return false}return true},close:function(f){if(this.current_dialog===false){return false}if(_.isUndefined(f)){f=false}if(f!==false&&this.current_dialog.uid!=f){return false}this.$dialog_lock.hide();c(".ui_dialog_pos").remove();this.is_visible=false;if(_.isObject(Tumblr.KeyCommands)){Tumblr.KeyCommands.resume()}if(_.isFunction(this.current_dialog.on_close)){this.current_dialog.on_close()}this.current_dialog=false;c("html").removeClass("dialog_lock");if(this.dialog_queue_order.length>0){var d=this.dialog_queue_order.shift();var e=this.dialog_queue[d];delete this.dialog_queue[d];this._dialog(e)}},_tab:function(h){var g=this.$el.find(".buttons .tab_frame");var k=g.filter(".focus");var j=g.index(k);var f=g.length;var d=false;if((j+1)<f){d=j+1}else{d=0}k.removeClass("focus init_focus");var i=g.eq(d);if(i.length>0){i.addClass("focus");i.find("button").focus()}},_form_is_tab_to_button:function(j,h){var k=this.$el.find(":focus");if(k.length===0){return true}var i=this.$el.find(".buttons .tab_frame");var g=this.$el.find(":input:visible");var f=g.index(k);if(h&&(f===(g.length-1))){this.$el.find(":input:visible:first").focus();j.preventDefault();i.removeClass("focus init_focus");return false}if(f>=0){var d=this.$el.find(":input:visible:eq("+(f+1)+")");if((d.length>0)&&d.hasClass("ui_button")){return true}}i.removeClass("focus init_focus");return false},_select:function(g){var f=this.$el.find(".buttons .tab_frame.focus");var d=f;if(d.length===1){d.find(".ui_button").click()}},_form_is_focus_on_button:function(d){var f=this.$el.find(":focus");if(f.length===0){return false}return f.hasClass("ui_button")},_escape:function(d){if(_.isUndefined(this.current_dialog.escape_button)){return}var f=this.$el.find(".btn_"+this.current_dialog.escape_button);if(f.length){f.click()}},_dialog:function(g){if(_.isUndefined(g.uid)){g.uid=this._get_uid()}if(this.current_dialog!==false){this.dialog_queue_order.push(this.queue_counter);this.dialog_queue[this.queue_counter]=g;this.queue_counter++;return g.uid}_.defaults(g,this.default_dialog);var h=this._build_buttons(g.buttons);_.extend(g,{buttons_html:h});var e=this.templates;if(_.isObject(g.templates)){e=_.extend({},this.templates,g.templates)}var d=_.template(e.dialog);var f=_.template(e.content);g.content_html=f(g);var i=d(g);this.$dialog_lock.show();if(!_.isUndefined(g.visible_glass)){if(g.visible_glass){this.$dialog_lock.addClass("opaque")}}else{this.$dialog_lock.removeClass("opaque")}if(!_.isUndefined(g.scroll_lock)&&g.scroll_lock){c("html").addClass("dialog_lock")}this.current_dialog_id=g.uid;this.current_dialog=g;c("body").append('<div id="dialog_'+this.current_dialog_id+'" class="ui_dialog_pos">'+i+"</div>");this.$el=c("#dialog_"+this.current_dialog_id);this.is_visible=true;if(g.animate&&_.isObject(g.animate_in)&&this.$el.find(g.animate_in.dialog_el).length){this.$el.find(g.animate_in.dialog_el).addClass(g.animate_in.dialog_class)}this._focus();if(_.isObject(Tumblr.KeyCommands)){Tumblr.KeyCommands.suspend()}if(_.isUndefined(g.has_form)){g.has_form="auto"}if(g.has_form==="auto"){g.has_form=(this.$el.find("form, input").length>0)}if(_.isFunction(g.on_open)){g.on_open()}this.el=this.$el[0];this.delegateEvents();return g.uid},_button:function(h,f,i,g){var e=_.template(this.templates.button);if(_.isObject(this.current_dialog.templates)){e=this.current_dialog.templates.button}if(g){f+=" default-pulse"}var d=e({btn_class:f,text:h,btn_id:((!_.isUndefined(i))?i:"")});d='<div class="tab_frame">'+d+"</div>";return d},_focus:function(){if(!this.current_dialog){return false}for(var e in this.current_dialog.buttons){var d=this.current_dialog.buttons[e];if(!_.isUndefined(d.selected)&&d.selected){$button=this.$el.find(".btn_"+e);if($button.length>0){$button.parent().addClass("focus init_focus")}}}},_setup_keys:function(){c(document).on("keydown",_.bind(function(g){var f=(g.ctrlKey||g.shiftKey||g.metaKey);if(!this.is_visible||f){return}var d=g.keyCode||g.which;if((d===9)&&this.current_dialog.key_tab){if(this.current_dialog.has_form){if(!this._form_is_tab_to_button(g,true)){return}}g.preventDefault();this._tab(g)}if(((d===13)&&this.current_dialog.confirm_by_enter)||((d===32)&&this.current_dialog.close_by_space)){if(this.current_dialog.has_form&&(d===32)){if(!this._form_is_focus_on_button(g)){return}}g.preventDefault();this._select(g)}if((d===27)&&this.current_dialog.key_close){g.preventDefault();this._escape(g)}},this))},_build_buttons:function(k){if(!_.isObject(k)){return""}var h=0;for(var g in k){if(k.hasOwnProperty(g)){h++}}var f="";for(var e=0;e<h;e++){if(_.isUndefined(k[e])){continue}var l=(!_.isUndefined(k[e].text))?k[e].text:"";var d=(!_.isUndefined(k[e].btn_class))?k[e].btn_class:"";var j=(!_.isUndefined(k[e].selected))?k[e].selected:false;f+=this._button(l,d,e,j)}return f},_init_click_lock:function(){this.$dialog_lock=false;c(_.bind(function(){c("body").prepend('<div class="ui_dialog_lock"></div>');this.$dialog_lock=c("body > .ui_dialog_lock")},this))},_get_uid:function(){return this.uid++}});b.Dialog=new a()})(jQuery,Tumblr);
/*! scripts/photo_reply.js */
(function(a){Tumblr.PhotoReply=Backbone.View.extend({options:{post_id:undefined,mb_limit:10,status:"inactive",progress:0,image:undefined},initialize:function(b){this.options=b||{};this.post_id=this.options.post_id||this.$el.data("postId");this.status=this.options.status||"inactive";this.progress=this.options.progress||0;this.disabled=true;this.$post=this.$el.closest(".post");this.$container=this.$post.find(".photo_reply_container");this.$icon=this.$(".photo_reply_icon");this.$progress=this.$(".photo_reply_icon_progress");this.$image=this.$(".photo_reply_image");this.$icon.addClass("show_progress_bar");this.__proxy_functions();if(this.status!=="has_image"){this.enable_dropzone()}this.$el.data("tumblr_photoreply",this);this.constructor.register(this)},__proxy_functions:function(){this._show_image=a.proxy(this.show_image,this);this._hide_image=a.proxy(this.hide_image,this);this._upload_file_add=a.proxy(this.upload_file_add,this);this._upload_submit=a.proxy(this.upload_submit,this);this._upload_progress=a.proxy(this.upload_progress,this);this._upload_end=a.proxy(this.upload_end,this);this._upload_cancel=a.proxy(this.upload_cancel,this);this._upload_stop=a.proxy(this.upload_stop,this);this._dragenter=a.proxy(this.dragenter,this);this._dragleave=a.proxy(this.dragleave,this);this._drop=a.proxy(this.drop,this)},attach_image:function(c){var b={width:"",height:"",src:""};if(typeof c==="string"){b.src=c}else{if(c.url){b.src=c.url}if(c.height){b.height=c.height}if(c.width){b.width=c.width}}this.$container.addClass("fileupload");if(!(this.$image&&this.$image.length)){this.$image=a('<img src="" alt="" class="photo_reply_image"/>');this.$image.appendTo(this.$container).on("load",this._show_image)}this.$image.attr(b)},show_image:function(){if(!(this.$image&&this.$image.length)){return false}this.$container.css("max-height",this.$image.get(0).naturalHeight).addClass("has_photo_reply")},hide_image:function(){this.$container.removeClass("has_photo_reply").css("max-height","")},enable_dropzone:function(){this.disabled=false;this.$post.on({dragenter:this._dragenter,dragleave:this._dragleave,drop:this._drop});this.$post.find("*").on("dragenter dragover",this.cancel_event);this.$el.find('input[type="file"]').on("click",this._upload_cancel).attr("disabled",false);this.create_uploader({form:this.$el,dropzone:this.$post})},disable_dropzone:function(){this.disabled=true;this.$post.off({dragenter:this.dragenter,dragleave:this.dragleave,drop:this.drop});this.$post.removeClass("photo_reply_hover");this.$post.find("*").off("dragenter dragover",this.cancel_event);this.$el.find('input[type="file"]').off("click",this._upload_cancel).attr("disabled",true)},create_uploader:function(b){this.destroy_uploader();this.$uploader=a(b.form).fileupload({dataType:"json",maxNumberOfFiles:1,dropZone:b.dropzone,pasteZone:null,add:this._upload_file_add,submit:this._upload_submit,send:this._upload_start,progress:this._upload_progress,always:this._upload_end,stop:this._upload_stop})},destroy_uploader:function(){if(this.$uploader&&this.$uploader.data("fileupload")){a(this.$uploader).fileupload("destroy")}},dragenter:function(b){this.$post.addClass("photo_reply_hover")},dragleave:function(b){if(this.event_in_bounds(b)){return false}this.$post.removeClass("photo_reply_hover")},drop:function(b){this.$post.removeClass("photo_reply_hover")},show_coddled_progress:function(b){return this.show_progress(b,20)},show_progress:function(b,c){if(c){b=Math.max(c,Math.min(b,100-c))}this.$progress.css("width",b+"%");return b},upload_submit:function(f,d){if(this.disabled){return false}if(this.status!=="inactive"){return false}var b=!!d.files.length;a.each(d.files,a.proxy(function(e,g){if(g.size&&g.size>this.options.mb_limit*1048576){b=false}},this));if(!b){var c=l10n_str.ajax_error;if(l10n_str.over_max_file_size_mb){c=l10n_str.over_max_file_size_mb.replace("%1$s",this.options.mb_limit)}alert(c);return false}},upload_file_add:function(c,b){this.jqXHR=b.submit()},upload_start:function(c,b){this.status="uploading";this.progress=0;this.show_progress(this.progress)},upload_progress:function(c,b){this.progress=parseInt(b.loaded/b.total*100,10);this.show_coddled_progress(this.progress)},upload_end:function(d,c){var b;if(c.textStatus==="success"){b=c.result}else{b=a.parseJSON(c.jqXHR.responseText)}if(b&&b.meta&&b.meta.status&&b.meta.status===200){if(b&&b.response&&b.response[0].url){this.image=b.response[0];this.progress=100;this.status="has_image";this.disable_dropzone();this.attach_image(this.image)}}else{if(c&&c.errorThrown==="abort"){this.progress=0;this.status="inactive"}else{this.progress=0;this.status="error";alert(b&&b.response?b.response:l10n_str.ajax_error)}}this.show_progress(this.progress)},upload_cancel:function(){try{this.jqXHR.abort()}catch(b){}this.progress=0;this.show_progress(this.progress);this.enable_dropzone()},upload_stop:function(){this.destroy_uploader()},cancel_event:function(b){b.preventDefault();b.stopPropagation();return false},event_in_bounds:function(f){var d=f.currentTarget.getBoundingClientRect();var c=f.originalEvent;var b,g;if(typeof c.clientX==="undefined"){b=c.pageX;g=c.pageY}else{b=c.clientX;g=c.clientY}return !(b>d.left+d.width-1||b<d.left||g>d.top+d.height-1||g<d.top)}},{instances:[],register:function(b){this.instances.push(b)},unregister:function(b){this.instances.splice(_.indexOf(this.instances,b),1)},clean_up:function(d){if(!document.body){return}var c,b;for(c=0;c<this.instances.length;c++){b=this.instances[c];if(!(b.$el.data("tumblr_photoreply")&&b.$el.closest(document.body).length)){b.remove();c--}}},init:function(){if(!this._scan){this._scan=a.proxy(this.scan,this)}if(_.indexOf(AfterAutoPaginationQueue,this._scan)<0){AfterAutoPaginationQueue.push(this._scan)}this.scan()},scan:function(b){b=a.extend({},b);a(b.el||".photo_reply_form").each(a.proxy(function(c,d){if(!a(d).data("tumblr_photoreply")){new Tumblr.PhotoReply({el:d})}},this));return this}})})(jQuery);
/*! scripts/link_button.js */
(function(a){Tumblr.LinkButton=Backbone.View.extend({events:{click:"follow_link"},initialize:function(b){this.$el.addClass("clickable");this.determine_size();this.$el.data("tumblr_linkbutton",this);this.constructor.register(this)},determine_size:function(){this.$el.removeClass("small");if(this.$(".link_title").text().length>100||this.$(".link_text").height()>110){this.$el.addClass("small")}},follow_link:function(b){if(a(b.target).is(".link_title")){return true}b.preventDefault();b.stopPropagation();this.$(".link_title").click();return false}},{instances:[],register:function(b){this.instances.push(b)},unregister:function(b){this.instances.splice(_.indexOf(this.instances,b),1)},init:function(){if(!this._scan){this._scan=a.proxy(this.scan,this)}if(_.indexOf(AfterAutoPaginationQueue,this._scan)<0){AfterAutoPaginationQueue.push(this._scan)}this.scan()},scan:function(b){b=a.extend({},b);a(b.el||".link_button").each(a.proxy(function(c,d){if(!a(d).data("tumblr_linkbutton")){new Tumblr.LinkButton({el:d})}},this));return this}})})(jQuery);
/*! scripts/jquery.pano.js */
(function(c,b){var a=function(d,e){if(!(this instanceof a)){return new a(d)}this.options=d;this.config=c.extend({},a.defaults,this.options);this._=c.extend({},a.init,this.init);this.evt=c.extend({},a.events);c.each(this.evt,c.proxy(function(f){if(typeof this.config[f]==="function"){this.evt[f]=this.config[f]}},this));this.clock=false;this.still=true;this.motion=false;this.paused=false;a.register(this);return this};a.prototype={start_clock:function(){if(this.clock){return false}this.clock=true;clearInterval(this.ticker);this.ticker=setInterval(c.proxy(this.tick,this),this.config.dt)},stop_clock:function(){this.clock=false;clearInterval(this.ticker)},tick:function(d){if(!d){d=this.config.dt}return this.paused?false:this.__tick(d)},__tick:function(f,e){if(this.evt.pre_tick&&!this.evt.pre_tick.apply(this,[this])){return this}if(!f){f=this.config.dt}if(!e){this.set_properties({px0:this._.px,vx0:this._.vx,ax0:this._.ax,py0:this._.py,vy0:this._.vy,ay0:this._.ay,pz0:this._.pz,vz0:this._.vz,az0:this._.az,dt:f})}if(!f){return this}this.still=true;this.motion=false;var d=f*f;if(this.config.x&&(this._.vx||this._.ax)){this._.px=this._.px+this._.vx*f+0.5*this._.ax*d;this._.vx=this.__almost_zero(this._.vx+this._.ax*f);if(this._.drag<1){this._.vx*=this._.drag}if(this._.vx){this.still=false}if(this._.vx||this._.ax){this.motion=true}}if(this.config.y&&(this._.vy||this._.ay)){this._.py=this._.py+this._.vy*f+0.5*this._.ay*d;this._.vy=this.__almost_zero(this._.vy+this._.ay*f);if(this._.drag<1){this._.vy*=this._.drag}if(this._.vy){this.still=false}if(this._.vy||this._.ay){this.motion=true}}if(this.config.z&&(this._.vz||this._.az)){this._.pz=this._.pz+this._.vz*f+0.5*this._.az*d;this._.vz=this.__almost_zero(this._.vz+this._.az*f);if(this._.drag<1){this._.vz*=this._.drag}if(this._.vz){this.still=false}if(this._.vz||this._.az){this.motion=true}}if(this.evt.post_tick){this.evt.post_tick.apply(this,[this])}if(this.still&&this.evt.when_still){this.evt.when_still.apply(this,[this])}if(!this.motion&&this.evt.no_motion){this.evt.no_motion.apply(this,[this])}return this},__split_tick:function(g,f,h){if(typeof h!=="function"){return this.__tick(g,true)}var d=f*g;var e=g-d;if(e){this.__tick(e)}h.apply(this,[this]);if(d){this.__tick(d)}return this},__almost_zero:function(d){return Math.abs(d)<this.config.threshold?0:d},set_properties:function(d,e){if(c.isPlainObject(d)){c.extend(this._,d)}else{this._[d]=e}return this},calculate_velocity:function(g,h,n){if(g.length<2){return false}if(this.evt.slide_start){this.evt.slide_start.apply(this,[this])}var l=0,j=g.length-1;var e=(new Date()).getTime()-h;for(var f=0;f<g.length;f++){if(g[f][0]<e){l=f+1}}if(l>=j){return false}var m=g[l],k=g[j],d=k[0]-m[0];this.set_properties({vx0:this._.vx,vy0:this._.vy,vx:(m[1]-k[1])/d,vy:(m[2]-k[2])/d});if(n){this.autostart_xy()}return this},autostart_xy:function(){var d=(this.config.x&&this._.vx)||(this.config.y&&this._.vy);if(d){this.start_clock()}return d},autostop_xy:function(){var d=!(this._.vx&&this.config.x)&&!(this._.vy&&this.config.y);if(d){this.stop_clock()}return d}};a.instances=[];a.register=function(d){this.instances.push(d)};a.unregister=function(d){this.instances.splice(this.instances.indexOf(d),1)};a.dt=15;a.tick=function(e){if(typeof e!=="number"){e=this.dt}for(var d=0;d<this.instances.length;d++){this.instances[d].tick(e)}};a.init={px:0,vx:0,ax:0,py:0,vy:0,ay:0,pz:0,vz:0,az:0,px0:0,vx0:0,ax0:0,py0:0,vy0:0,ay0:0,pz0:0,vz0:0,az0:0,drag0:0.9,drag:0.9,dt:null};a.events={pre_tick:false,post_tick:false,slide_start:false,when_still:false,no_motion:false};a.defaults={x:true,y:false,z:false,threshold:0.005,dt:a.dt};b.Physics=a})(jQuery,this.Tumblr||(this.Tumblr={}));(function(c,b){var a=function(e,d){if(!(this instanceof a)){return new a(e,d)}this.el=(typeof e==="string")?c(e).get(0):e;this.$el=c(e);this.options=d;this.metadata=this.$el.data("plugin-options");this.config=c.extend({},a.defaults,this.options,this.metadata);this.$parent=c(this.config.parent);this.start=c.proxy(this.__start,this);this.end=c.proxy(this.__end,this);this.move=c.proxy(this.__move,this);this.click=c.proxy(this.__click,this);this.scroll=c.proxy(this.__scroll,this);this.__init();a.register(this);return this};a.prototype={__init:function(){this.__reset_positions();if(this.autostart){this.enable()}this.touch=("ontouchstart" in window||"onmsgesturechange" in window)&&navigator.msMaxTouchPoints>1;if(this.touch){c.extend(this.config,{start:"touchstart",end:"touchend",move:"touchmove"})}this.physics=this.config.physics?new Tumblr.Physics(this.config.physics):false},enable:function(){this.enable_dragging();if(this.config.can_scroll){this.enable_scrolling()}},enable_dragging:function(){this.dragging=false;this.$el.on(this.config.start,this.start);this.$el.on(this.config.click,this.click)},enable_scrolling:function(){this.scrolling=false;this.$el.on(this.config.scroll,this.scroll);clearTimeout(this.enable_scrolling_delay)},disable:function(){this.disable_dragging();this.disable_scrolling()},disable_dragging:function(){this.dragging=false;this.$el.off(this.config.start,this.start);this.$el.off(this.config.click,this.click);this.$parent.off(this.config.blur,this.end);this.$parent.off(this.config.end,this.end);this.$parent.off(this.config.move,this.move)},disable_scrolling:function(){this.scrolling=false;this.$el.off(this.config.scroll,this.scroll);clearTimeout(this.enable_scrolling_delay)},__start:function(d){this.dragging=true;this.$parent.on(this.config.blur,this.end);this.$parent.on(this.config.end,this.end);this.$parent.on(this.config.move,this.move);this.__reset_positions();this.__event_position(d);this.start_position=this.end_position=this.positions[0];if(this.config.start_position){this.config.start_position(this.start_position[1],this.start_position[2])}if(this.physics){this.physics.set_properties({vx0:this.physics._.vx,vy0:this.physics._.vy,vx:0,vy:0}).stop_clock()}d.stopPropagation();return false},__end:function(d){this.dragging=false;this.$parent.off(this.config.blur,this.end);this.$parent.off(this.config.end,this.end);this.$parent.off(this.config.move,this.move);if(this.config.end_position){this.config.end_position(this.end_position[1],this.end_position[2])}if(this.physics){this.physics.calculate_velocity(this.positions,this.config.pos_time,true)}},__click:function(d){if(this.__any_movement()){d.stopPropagation();return false}return true},__move:function(f){var d=this.__event_position(f);this.end_position=this.positions[this.positions.length-1];if(this.config.update_position){this.config.update_position(d.x-this.start_position[1],d.y-this.start_position[2],false)}},__scroll:function(d){if(this.physics&&this.physics.clock){d.preventDefault();this.physics.set_properties({vx0:this.physics._.vx,vy0:this.physics._.vy,vz0:0,vx:0,vy:0,vz:0}).stop_clock();this.physics.motion=false;if(this.physics.evt.no_motion){this.physics.evt.no_motion.apply(this.physics,[this.physics])}return false}if(this.config.update_position){this.config.update_position(this.$el.scrollLeft(),this.$el.scrollTop(),true)}},__event_position:function(f,h){var d,g;if(this.touch){if(!f.originalEvent.targetTouches.length){return false}d=f.originalEvent.targetTouches[0].pageX;g=f.originalEvent.targetTouches[0].pageY}else{d=f.pageX;g=f.pageY}if(h){return{x:d,y:g}}else{return this.__record_position(d,g)}},__any_movement:function(){if(this.positions<2){return false}var e=this.positions[0],d=this.positions[this.positions.length-1];return d[0]!==e[0]||d[1]!==e[1]},__reset_positions:function(){delete this.start_position;delete this.end_position;this.positions=[];this.scroll_x=this.$el.scrollLeft();this.scroll_y=this.$el.scrollTop()},__record_position:function(d,f){if(c.isPlainObject(d)){f=d.y;d=d.x}var e=(new Date()).getTime();this.positions.push([e,d,f]);if(this.positions.length-1===this.config.pos_limit){this.positions.shift()}else{if(this.positions.length>this.config.pos_limit){this.positions.splice(-this.config.pos_limit,this.positions.length)}}this.positions.push([e,d,f]);return{x:d,y:f}},sync_scroll:function(e){if(!this.config.can_scroll){return}this.disable_scrolling();var d=c(e);this.$el.scrollLeft(d.scrollLeft());this.$el.scrollTop(d.scrollTop());this.scroll_x=this.$el.scrollLeft();this.scroll_y=this.$el.scrollTop();if(this.physics){this.physics.set_properties({px:this.scroll_x,py:this.scroll_Y})}clearTimeout(this.enable_scrolling_delay);this.enable_scrolling_delay=setTimeout(c.proxy(this.enable_scrolling,this),200)}};a.instances=[];a.register=function(d){this.instances.push(d)};a.unregister=function(d){this.instances.splice(this.instances.indexOf(d),1)};a.defaults={pos_limit:5,pos_time:200,start:"mousedown",end:"mouseup",move:"mousemove",click:"click",scroll:"scroll",blur:"blur",parent:window,can_scroll:true,physics:false,start_position:false,end_position:false,update_position:false,autostart:true};b.DragRelay=a})(jQuery,Tumblr);(function(c,a){var d=function(e){this.options=e;this.__init(this.config);return this};d.prototype={__init:function(){Tumblr.Glass.show(function(){this.__destroy()}.bind(this));this.click=c.proxy(this.__click,this);this.resize=c.proxy(this.__resize,this);this.keydown=c.proxy(this.__keydown,this);this.keyup=c.proxy(this.__keyup,this);this.keycancel=c.proxy(this.__keycancel,this);this.__create();if(this.options.pano){this.__clone_pano(this.options.pano)}this.__open()},__bind_events:function(){this.$lightbox.on("click",this.click);c(window).on("resize",this.resize);c(window).on("keydown",this.keydown)},__unbind_events:function(){this.$lightbox.off("click",this.click);c(window).off("resize",this.resize);c(window).off("keydown",this.keydown);c(window).off("keyup",this.keyup);c(window).off("blur",this.keycancel)},__create:function(){this.$lightbox=c("<div/>").attr("class","pano_lightbox").appendTo(c("body"));this.$lightbox.css({position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:4294967294,overflow:"hidden",backgroundColor:"rgba(15,15,15,0.95)"});c("<img/>").attr("id","vignette").attr("src","http://assets.tumblr.com/images/full_page_vignette.png").css({position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%"}).appendTo(this.$lightbox);c("<div/>").css({position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%"}).appendTo(this.$lightbox)},__destroy:function(){this.__unbind_events();this.$lightbox.css("display","none").remove();this.pano.$parent.css("overflow","");delete this.$lightbox;if(window.top!=window.self){if(typeof window.top.pano_iframe_preloader!="undefined"&&window.top.pano_iframe_preloader){window.top.pano_iframe_preloader.remove()}}b.unregister(this)},__clone_pano:function(e){this.$pano=c(e).clone(false).appendTo(this.$lightbox);this.pano=new b(this.$pano,{side_margins:100});this.pano.lightbox=this},__open:function(){this.__bind_events();this.pano.__center_vertically(c(window).height());this.pano.$parent.css("overflow","hidden")},__close:function(){Tumblr.Glass.hide()},__click:function(f){if(c(f.target).closest(".pano_dragger").length||c(f.target).closest(".pano_thumb").length){return}this.__close()},__resize:function(f){this.pano.__enforce_max_height();this.pano.__center_vertically(c(window).height());this.pano.__draw_shades();c("#vignette").css("display","none")},__keydown:function(g){if(!g){return false}var f=g.charCode?g.charCode:g.keyCode;if((g.ctrlKey||g.metaKey)&&f===87){this.__close();return false}if(!g.shiftKey&&!g.ctrlKey&&g.altKey&&!g.metaKey){return true}switch(f){case 37:if(this.arrowed){return false}this.arrowed=true;this.pano.physics.set_properties({drag0:this.pano.physics._.drag,drag:1,vx0:this.pano.physics._.vx,vx:-0.9}).autostart_xy();c(window).on("blur",this.keycancel);c(window).on("keyup",this.keyup);return false;case 39:if(this.arrowed){return false}this.arrowed=true;this.pano.physics.set_properties({drag0:this.pano.physics._.drag,drag:1,vx0:this.pano.physics._.vx,vx:0.9}).autostart_xy();c(window).on("blur",this.keycancel);c(window).on("keyup",this.keyup);return false;case 27:case 32:case 74:case 75:this.__close();return false}},__keyup:function(g){if(!g){return false}var f=g.charCode?g.charCode:g.keyCode;if(!g.shiftKey&&!g.ctrlKey&&g.altKey&&!g.metaKey){return true}switch(f){case 37:this.arrowed=false;this.pano.physics.set_properties({drag:this.pano.physics._.drag0}).autostop_xy();c(window).off("blur",this.keycancel);c(window).off("keyup",this.keyup);return false;case 39:this.arrowed=false;this.pano.physics.set_properties({drag:this.pano.physics._.drag0}).autostop_xy();c(window).off("blur",this.keycancel);c(window).off("keyup",this.keyup);return false}},__keycancel:function(f){if(this.arrowed){this.arrowed=false;this.pano.physics.set_properties({drag:this.pano.physics._.drag0,vx0:this.pano.physics._.vx,vx:0}).autostop_xy()}c(window).off("blur",this.keycancel);c(window).off("keyup",this.keyup)}};var b=function(f,e){if(!(this instanceof b)){return new b(f,e)}this.el=(typeof f==="string")?c(f).get(0):f;this.$el=c(f);if(this.$el.data("panoObject")){return this.$el.data("panoObject")}this.options=e;this.metadata=this.$el.data("plugin-options");this.config=c.extend({physics:{post_tick:c.proxy(function(g){this.viewport_size();if(g._.px<=0){g.set_properties({px:0,vx:0.1*Math.abs(g._.vx)});if(this.lightbox){this.lightbox.keycancel()}}else{if(g._.px>=(this.display_width+(this.display_side_margins*2))-this.viewport_width){g.set_properties({px:(this.display_width+(this.display_side_margins*2))-this.viewport_width,vx:-0.1*Math.abs(g._.vx)});if(this.lightbox){this.lightbox.keycancel()}}}this.set_position(g._.px,g._.py,true)},this),slide_start:c.proxy(function(g){this.relay.disable_scrolling();this.scrubber_relay.disable_scrolling()},this),no_motion:c.proxy(function(g){g.stop_clock();this.relay.enable_scrolling();this.scrubber_relay.enable_scrolling();this.relay.sync_scroll(this.$viewport)},this)},autostart:true},this.options,this.metadata);this.__init(this.config);return this};b.prototype={__init:function(e){this.img_loaded=c.proxy(this.__img_loaded,this);this.img_ready=c.proxy(this.__img_ready,this);this.__create();c.extend(this.config,{start_position:c.proxy(this.set_start_position,this),end_position:c.proxy(this.set_end_position,this),update_position:c.proxy(this.set_position,this)});this.relay=new Tumblr.DragRelay(this.$dragger,this.config);this.physics=this.relay.physics;this.scrubber_relay=new Tumblr.DragRelay(this.$scrubber,c.extend({},this.config,{can_scroll:false,physics:false,start_position:c.proxy(this.set_inverted_start_position,this),update_position:c.proxy(this.set_inverted_position,this)}));this.__load_pano_image();b.register(this)},__create:function(){if(this.$el.is("a")){this.$orig_a=this.$el;this.$orig_img=this.$el.children("img")}else{this.$orig_img=this.$el}this.src=this.$orig_img.data("panoSrc");this.href=this.$orig_img.data("panoHref");this.width=this.$orig_img.data("panoWidth");this.height=this.$orig_img.data("panoHeight");this.position_height=Math.min(80,this.$orig_img.data("thumbHeight"));this.position_width=this.$orig_img.data("thumbWidth")*(this.position_height/this.$orig_img.data("thumbHeight"));this.position_width=Math.min(500,this.position_width);this.$parent=c("body");this.$container=c("<div/>").attr("class","pano_container loading");this.$view_container=c("<div/>").attr("class","pano_view_container").appendTo(this.$container);this.$viewport=c("<div/>").attr("class","pano_viewport").appendTo(this.$view_container);this.$img_container=c("<div/>").attr("class","pano_img_container").css({width:this.width,height:this.height,padding:"0 "+this.options.side_margins+"px"}).appendTo(this.$viewport);this.$img=c("<img/>").attr({src:"http://assets.tumblr.com/images/x.gif","class":"pano_img"}).css({width:this.width,height:this.height}).appendTo(this.$img_container);this.$loader_img=c("<img/>").attr({"class":"pano_loader_img",src:this.$orig_img.attr("src")}).css({width:this.width,height:this.height}).appendTo(this.$img_container);this.$position=c("<div/>").attr("class","pano_position").css({width:this.position_width,height:this.position_height}).appendTo(this.$container);this.$thumb=c("<img/>").attr("class","pano_thumb").attr("src",this.$orig_img.attr("src")).appendTo(this.$position);this.$shade_left=c("<div/>").attr("class","pano_shade left").appendTo(this.$position);this.$shade_right=c("<div/>").attr("class","pano_shade right").appendTo(this.$position);this.$scrubber=c("<div/>").attr("class","pano_scrubber grab").appendTo(this.$position);this.$dragger=c("<div/>").attr("class","pano_dragger grab").css({height:this.height}).appendTo(this.$container);this.$scroller=c("<div/>").attr("class","pano_scroller").css({width:this.width,height:this.height,borderLeft:this.options.side_margins+"px solid transparent",borderRight:this.options.side_margins+"px solid transparent"}).appendTo(this.$dragger);this.$el.css("display","none").data("panoObject",this).after(this.$container);this.__set_img_dimensions(this.width,this.height,this.options.side_margins);this.__enforce_max_height();return this},__destroy:function(){this.$img.off("load",this.img_ready);this.$container.remove();delete this.$container;delete this.$view_container;delete this.$viewport;delete this.$img;delete this.$loader_img;delete this.$position;delete this.$thumb;delete this.$pos_frame;delete this.$dragger;this.$el.css("display","").data("panoObject","")},__load_pano_image:function(e){if(!e){e=this.src}this.img_poll=setInterval(this.img_ready,1000);this.$img.on("load",this.img_loaded).attr("src",e);this.__img_init()},__img_init:function(){this.relay.enable();this.scrubber_relay.enable();this.__scrubber_sizing();this.set_position(0,0)},__img_ready:function(e){if(!e){e=this.$img[0]}if(e&&e.src&&e.complete){this.__img_loaded()}},__img_loaded:function(f){this.__scrubber_sizing();this.$container.removeClass("loading");clearInterval(this.img_poll)},__scrubber_sizing:function(){this.viewport_size();var e=100*this.viewport_width/(this.$img.width()+(this.options.side_margins*2));this.$scrubber.width(Math.min(e,100)+"%");if(Math.min(e,100)==100){this.$position.css("opacity","0")}else{this.$position.css("opacity","1")}},__draw_shades:function(){if(this.relay.touch){return}this.$shade_left.css("width",Math.max(0,this.scrubber_x));this.$shade_right.css("width",Math.max(0,this.position_width-this.scrubber_x-this.$scrubber.width()))},__set_img_dimensions:function(g,e,f){this.$img_container.css({width:g,height:e});this.$img.css({width:g,height:e});this.$loader_img.css({width:g,height:e});this.$dragger.css({height:e});this.$scroller.css({width:g,height:e});this.display_width=g;this.display_height=e;if(typeof f==="number"){this.$img_container.css({padding:"0 "+f+"px"});this.$scroller.css({borderLeft:f+"px solid transparent",borderRight:f+"px solid transparent"});this.display_side_margins=f}},__enforce_max_height:function(f){f=f||200;var g=c(window).height()-this.$position.outerHeight(true);g-=30;var e=Math.max(f,Math.min(this.height,g));var h=this.width*(e/this.height);this.__set_img_dimensions(h,e);this.$img_container.css("min-width",c(window).width()-2*this.display_side_margins);this.__scrubber_sizing()},__center_vertically:function(e){this.$container.css("top",(e/2)-(this.$container.height()/2))},set_start_position:function(e,f){this.$parent.addClass("grabbing");this.start_x=this.$viewport.scrollLeft();this.start_y=this.$viewport.scrollTop()},set_inverted_start_position:function(e,f){this.$parent.addClass("grabbing");this.start_x=this.$scrubber.position().left;this.start_y=this.$scrubber.position().top},set_end_position:function(e,f){this.$parent.removeClass("grabbing");this.relay.sync_scroll(this.$viewport)},viewport_size:function(){this.viewport_width=this.$viewport.width();this.viewport_height=this.$viewport.height()},set_position:function(f,g,e){this.viewport_size();if(e){this.position_x=f;this.position_y=g}else{this.position_x=this.start_x-f;this.position_y=this.start_y-g}this.$viewport.scrollLeft(this.position_x);this.position_x=this.$viewport.scrollLeft();this.scrubber_x=this.$scrubber.width()*this.position_x/this.viewport_width;this.$scrubber.css("left",parseInt(this.scrubber_x,10)+"px");this.__draw_shades()},set_inverted_position:function(f,g,e){this.viewport_size();if(e){this.scrubber_x=f}else{this.scrubber_x=this.start_x+f}this.scrubber_x=Math.max(0,Math.min(this.scrubber_x,(this.$position.width()-this.$scrubber.width())));this.position_x=this.$viewport.width()*this.scrubber_x/this.$scrubber.width();this.$scrubber.css("left",parseInt(this.scrubber_x,10)+"px");this.__draw_shades();this.$viewport.scrollLeft(this.position_x)}};b.instances=[];b.register=function(e){this.instances.push(e)};b.unregister=function(e){this.instances.splice(this.instances.indexOf(e),1)};c.fn.panorama=function(e){e=e||{};var f=e.lightbox||false;return this.each(function(){if(f){new d(c.extend({},e,{pano:this}))}else{new b(this,e)}})};a.Panorama=b})(jQuery,this.Tumblr||(this.Tumblr={}));
/*! scripts/search/views/search_input_controls.js */
(function(c,a){var b=Backbone.View.extend({className:"search_query_input_controls",events:{"click .search_query_btn":"_on_click"},_on_click:function(g){g.preventDefault();var d=c(g.currentTarget);var f=d.data("search-query-mode");if(this.$el.hasClass("is_disabled")){return false}if(f==="top"){f=false}this.query=this.get_query();if(f&&this.query.length){window.location="/search/"+this.query+"/"+f}else{window.location="/search/"+this.query;return}},get_query:function(){return encodeURIComponent(this.$search_query.val())},initialize:function(){if(!this.$el.length){return}this.$ui_search=this.$el.closest(".ui_search");this.$ui_search.addClass("show_search_input_controls");this.$search_query=this.$ui_search.find("#search_query");this.query=this.get_query();if(this.query.length){this.enable()}this.set_search_query_width()},set_search_query_width:function(){var d=this.$el.width()+3;var f=this.$ui_search.find(".search_form_field");var e=(f.width()-d);if(e<75){return}this.$search_query.width(e)},disable:function(){this.$el.addClass("is_disabled").removeClass("is_enabled")},enable:function(){this.$el.addClass("is_enabled").removeClass("is_disabled")}});a.SearchInputControlsView=b})(jQuery,Tumblr);
/*! scripts/search/search_popover.js */
(function(c,b){var a=Tumblr.TagPopover.extend({events:{"focus #search_query":"focus_search_query","blur #search_query":"blur_search_query","keyup #search_query":"keyup_search_query","keydown #search_query":"keydown_search_query","click #popover_search .popover_menu_item":"click_popover","submit #search_form":"submit","mouseenter #popover_search":"mouseenter","mouseenter .popover_menu_item a":"mouseenter_search_type","mouseleave #popover_search":"mouseleave_search_type"},initialize:function(d){this.options=d||{};this.options.popover_selector="#popover_search";this.log_session=Tumblr.Features("log_search_box")(true);this.show_input_controls=Tumblr.Features("search_web_input")(true,false);this.onboarding_search=this.options.onboarding||false;this.onboarding_search_endpoint=this.options.onboarding_search_endpoint||false;this.search_results_redesign=Tumblr.Features("search_results_redesign")(true,false);Tumblr.TagPopover.prototype.initialize.apply(this,arguments);this.search_term=this.$search_query.val();if(this.options.promo){this.should_show_promo()}this.capturing=(Tumblr.Capture)?new Tumblr.Capture.SearchPopover():null;this.pressed_keys=[];this.is_new_search=Tumblr.Features("search_results_redesign")(true,false);this.listenTo(Tumblr.Events,"search:change:query",this.change_query,this);this.listenTo(Tumblr.Events,"search:submit",this.force_submit,this);if(this.show_input_controls){this.create_input_controls()}},should_show_promo:function(){if(Tumblr.Cookie.get("search_promo")!=1){this.show_promo()}},show_promo:function(){if(!this.promo_popover){this.promo_popover=new Tumblr.Popover({el:c("#popover_search_promo").parent(),popover:c("#popover_search_promo"),disable_auto_show:true,on_show:function(){c("#glass_overlay").addClass("blue");c("#search_field").addClass("showing_search_promo over_glass")},on_hide:_.bind(this.hide_promo,this)})}this.promo_popover.show();this.promo_popover.popover.find(".search_promo_button").on("click",_.bind(this.hide_promo,this));this.$search_query.on("focus.search_promo",_.bind(this.hide_promo,this))},hide_promo:function(){this.promo_popover.hide();this.promo_popover.popover.remove();this.$search_query.off("focus.search_promo");c("#glass_overlay").removeClass("blue");c("#search_field").removeClass("showing_search_promo over_glass");Tumblr.Cookie.set("search_promo",1);this.popover.show();this.$search_query.focus()},click_popover:function(h){var g=this.$(h.currentTarget);var f=g.find("a");var d=f.attr("href");if(h.metaKey||h.altKey){window.open(d);h.stopPropagation();h.preventDefault()}this.popover.hide();if(this.search_results_redesign){this.change_query(f.data("tag-result"));if(f.hasClass("search_typeahead")){h.preventDefault();h.stopPropagation();this.force_submit();this.clicked_typeahead(f.data("tag-result"),f)}}},clicked_typeahead:function(g,h){var d=h.closest(".popover_menu_item");var f=d.parent().children().index(d);var e=h.find(".result_title u").text();this.log_search_box("typeahead_click",{position:f,query:g,characters:e})},log_search_box:function(d,e){if(this.log_session){Tumblr.Events.trigger("Capture:push","search_box_usage",d,e)}},setup_autocomplete:function(){if(this.onboarding_search){this.auto_complete=new Tumblr.OnboardingAutoCompleteSearch({el:this.$search_query,endpoint:this.onboarding_search_endpoint,popover:this.popover})}else{this.auto_complete=new Tumblr.AutoCompleteSearch({el:this.$search_query,store:"/svc/search_popover",popover:this.popover,include:Tumblr.EXISTING_TAGS,base_blog_search_url:this.options.base_blog_search_url||null,blog_search_label:this.options.blog_search_label||'More results for "%1$s"'})}},focus_search_query:function(){this.$search_field.addClass("active");this.currentIndex=-1;this.set_search_type(this.search_type);if(this.$search_query.val()==this.$search_query.attr("placeholder")){this.$search_query.val("")}if(this.$search_query.val().length){this.auto_complete.lookup()}else{if(!this.has_children(this.$tracked_tags)&&!this.has_children(this.$autocomplete_results)){return}this.popover.show();this.$("#unread_tag_notice").hide();this.$search_query.removeClass("with_unread")}Tumblr.Events.trigger("SearchPopover:focus");this.log_search_box("focus")},blur_search_query:function(){var d=this.$search_query.val();if(d==this.auto_complete.init_value){this.set_search_type(this.search_type)}if(d===""){this.set_search_type("tag")}if(d){this.log_search_box("blur_with_typed")}Tumblr.Events.trigger("SearchPopover:blur")},keyup_search_query:function(e){this.pressed_keys[e.keyCode]=0;var d=this.$search_query.val();if(d!==this.auto_complete.init_value){this.set_search_type("tag")}else{this.set_search_type(this.search_type)}if(this.show_input_controls){if(d.length){this.searchInputControlsView.enable()}else{this.searchInputControlsView.disable()}}if(!this.pressed_keys[16]){this.set_search_type(this.search_type)}},create_input_controls:function(){this.searchInputControlsView=new Tumblr.SearchInputControlsView({el:this.$(".search_query_input_controls")})},keydown_search_query:function(d){this.pressed_keys[d.keyCode]=1;if(this.pressed_keys[18]){this.set_search_type("blog")}if(this.show_input_controls&&(d.keyCode===13)){if(this.$search_query.val().length){return}d.stopPropagation();d.preventDefault()}if(this.pressed_keys[18]&&d.keyCode===13){d.stopPropagation();d.preventDefault();this.do_blog_search()}},set_active:function(g){var d=c(this.popover_selector+" .popover_menu_item a").filter(":visible");var f=d.filter(":focus");if(f.length){this.currentIndex=(g==="previous")?d.index(f)-1:d.index(f)+1}if(this.currentIndex>=0&&this.currentIndex<d.length){d.eq(this.currentIndex).focus()}else{if(this.currentIndex==-2&&g==="previous"){d.eq(d.length-1).focus();this.currentIndex=d.length-1}else{this.currentIndex=-1;this.$search_query.focus()}}var e=(this.currentIndex>=0)?d.eq(this.currentIndex):false;if(e.length){if(e.closest(".search_results_section").hasClass("blog")){this.set_search_type("blog")}if(e.closest(".search_results_section").hasClass("tag")){this.set_search_type("tag")}}},set_search_type:function(d){if(this.is_new_search){return}this.search_type=d;if(d=="blog"){this.$search_form.removeClass("is_tag_search").addClass("is_blog_search")}if(d=="tag"){this.$search_form.addClass("is_tag_search").removeClass("is_blog_search")}},do_blog_search:function(){var d=c.trim(this.$search_query.val());document.location="/search/blogs?q="+d},mouseenter_search_type:function(e){var d=c(e.currentTarget);if(d.length&&d.closest(".search_results_section").hasClass("blog")){this.set_search_type("blog")}else{this.set_search_type("tag")}},mouseleave_search_type:function(){this.set_search_type("tag")},change_query:function(d){this.$search_query.val(d);return this},force_submit:function(){this.$("#search_form").trigger("submit")},submit:function(){if(c.trim(this.$search_query.val())===""){window.location="/search";return false}if(_.isFunction(this.auto_complete.abort)){this.auto_complete.abort()}this.popover.hide();this.$search_query.blur();this.$search_field.removeClass("active");this.log_search_box("form_submit");Tumblr.Events.trigger("Capture:push","search_page_usage","submit")}});b.SearchPopover=a})(jQuery,Tumblr);
/*! scripts/search/search_autocomplete.js */
(function(c,a){var b=Backbone.View.extend({events:{keyup:"keyup"},initialize:function(d){this.options=d||{};this.endpoint=this.options.endpoint||"/svc/search_popover/";this.threshold=this.options.threshold||1;this.cache_size=this.options.cache_size||15;this.init_value=this.$el.val();this.base_blog_search_url=this.options.base_blog_search_url||"/search/blogs?q=";this.blog_search_label=this.options.blog_search_label||'More blogs with "%1$s"';this.form_key=c("#tumblr_form_key").attr("content");this.search_results_redesign=Tumblr.Features("search_results_redesign")(true,false);this.cache={};this.queries=[];this.popover=this.options.popover;this.search_loading_template=c("#search_loading_template").html();this.search_results_template=c("#search_results_template").html();this.search_results_item_blogs_template=c("#search_results_item_blogs").html();this.search_results_item_tags_template=c("#search_results_item_tags").html();this.$search_query=c("#search_query");this.$search_results_container=c("#search_results_container");this.$tracked_tags=c(".tracked_tags.search_results_section");this.tracked_tags_markup=c("<div>").append(this.$tracked_tags.clone()).html()},keyup:_.throttle(function(d){this.lookup()},100),prepare_search_data:function(){this.queries.push(this.search_query);return{q:this.search_query_raw,form_key:this.form_key}},get_results:function(d){d=d||function(){};if(this.cache[this.search_query]){this.results=this.cache[this.search_query];d.call(this);return}this.search_in_progress=true;this.results={tags:[],blogs:[]};this.store_xhr=c.ajax({url:this.endpoint,data:this.prepare_search_data(),dataType:"json",type:"GET"});this.store_xhr.done(_.bind(function(e){this.results=e;this.add_to_cache(this.search_query,e)},this));this.store_xhr.fail(_.bind(function(f,e){if(e==="abort"){this.force_hide=true}},this));this.store_xhr.always(_.bind(function(e){this.search_in_progress=false;d.call(this)},this))},lookup:function(){var e=c.trim(this.$el.val());if(e[0]=="#"){e=e.substr(1)}var f=e.length;var d;if(f>=this.threshold&&e.length){this.search_query=_.escape(e);this.search_query_raw=e;this.force_hide=false;this.get_results(_.bind(function(){this.update()},this))}else{this.reset_popover()}this.init=false;this.init_value=""},show_tracked_tags:function(){if(this.$tracked_tags.children().length>0){this.$tracked_tags.show()}else{this.popover.hide()}},hide_tracked_tags:function(){this.$tracked_tags.hide()},reset_popover:function(){if(this.tracked_tags_markup.length){this.$search_results_container.html(this.tracked_tags_markup)}else{this.popover.hide()}},add_to_cache:function(d,e){this.cache[d]=e;if(_.size(this.cache)>this.cache_size){delete this.cache[this.queries[0]];this.queries.shift()}},should_add_query_to_tags:function(d){var e=_.find(d,function(g){var i=g.tag.toLowerCase(),j=this.search_query.toLowerCase(),h=this.search_query_raw.toLowerCase();return(i==j||i==h)},this);if(!e){var f={tag:this.search_query,url:"/tagged/"+this.search_query,is_query:true};d.unshift(f)}return d},inject_search_substring:function(d,f){if(!this.search_query){return}var e=new RegExp(this._escapeRegExp(this.search_query),"gi"),g=this.decorate_search_substring;if(!e){return}_.each(d,function(j,h){if(f=="tag"&&!j.is_query){d[h].escaped_tag=d[h].escaped_tag||_.escape(j.tag);d[h].hilite_tag=d[h].hilite_tag||j.escaped_tag.replace(e,g)}if(f=="blog"){d[h].hilite_name=d[h].hilite_name||j.name.replace(e,g);d[h].hilite_title=d[h].hilite_title||j.title.replace(e,g);d[h].hilite_url=d[h].hilite_url||j.url.replace(e,g)}});return d},decorate_search_substring:function(d){return"<u>"+d+"</u>"},_escapeRegExp:function(d){return d.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|\~\`\!\@\#]/g,"\\$&")},update:function(){if(!_.isObject(this.results)){return}var f=_.isArray(this.results.tags)?this.results.tags:[],j=_.isArray(this.results.blogs)?this.results.blogs:[],h="",e=false,d=false,g=_.template(this.search_results_template),i;f=this.should_add_query_to_tags(f);f=this.inject_search_substring(f,"tag");j=this.inject_search_substring(j,"blog");if(_.size(f)){if(f.length>5){f=f.slice(0,5)}i={results:{type:"tag",items:f,query:this.search_query,item_template:this.search_results_item_tags_template,blog_search_url:this.base_blog_search_url,blog_search_label:this.blog_search_label}};h+=g(i)}if(_.size(j)||!this.search_results_redesign){g=_.template(this.search_results_template);i={results:{type:"blog",items:j,query:this.search_query,item_template:this.search_results_item_blogs_template,blog_search_url:this.base_blog_search_url,blog_search_label:this.blog_search_label}};h+=g(i)}if(h.length&&!this.force_hide){this.$search_results_container.empty().prop("innerHTML",h);this.popover.show()}else{this.reset_popover()}},abort:function(){if(this.store_xhr){this.store_xhr.abort()}}});a.AutoCompleteSearch=b})(jQuery,Tumblr);
/*! scripts/capture.js */
(function(c,b){var a={};a.Base=Backbone.View.extend({el:"body",svc_url:"/svc/log/capture",initialize:function(){this.form_key=c("#tumblr_form_key").attr("content");this.$start_time=new Date().getTime();this.tracking_data={};c(window).on("beforeunload.capture",_.bind(this.send_data,this))},_get_delta:function(){var d=new Date().getTime();return d-this.$start_time},enable_listeners:function(){this.listenTo(Tumblr.Events,"Capture:set",this._set,this);this.listenTo(Tumblr.Events,"Capture:push",this._push,this)},_set:function(e,d,f){if(!(e in this.tracking_data)){this.tracking_data[e]={}}this.tracking_data[e][d]=f},_push:function(e,d,f){f=f||{};if(_.isObject(f)){f.time=this._get_delta()}if(!(e in this.tracking_data)){this.tracking_data[e]={}}if(!(d in this.tracking_data[e])||!_.isArray(this.tracking_data[e][d])){this.tracking_data[e][d]=[]}this.tracking_data[e][d].push(f)},send_data:function(){if(typeof Tumblr.enable_capture_js==="undefined"||Tumblr.enable_capture_js===false){return}if(this.sending_data){return}if(_.size(this.tracking_data)<1){return}this.track_context();var d=c.ajax({url:this.svc_url,type:"POST",data:{log:this.tracking_data},with_form_key:true,async:false});this.tracking_data={}},unique_cookie:function(){var d=Tumblr.Cookie.get("capture")||this.form_key;if(d==this.form_key){Tumblr.Cookie.set("capture",this.form_key)}return d},track_context:function(){this.tracking_data.context=this.tracking_data.context||{};this.tracking_data.context.id=this.unique_cookie();this.tracking_data.context.language=(window.navigator.userLanguage||window.navigator.language).toLowerCase();this.tracking_data.context.path=document.location.pathname}});a.Generic=a.Base.extend({initialize:function(){a.Base.prototype.initialize.call(this);this.enable_listeners()},_set_generic_data:function(){this.tracking_data._init=this.$start_time;this.tracking_data._elapsed=this._get_delta()},send_data:function(){if(_.size(this.tracking_data)<1){return}this._set_generic_data();a.Base.prototype.send_data.call(this)}});a.UserActions=a.Base.extend({el:"body",initialize:function(){a.Base.prototype.initialize.call(this);this.tracking_data.context={}},send_moneyball_beacon:function(e){if(e.$el.data("mb-click-url")){var d=document.createElement("img");d.src=e.$el.data("mb-click-url")}},get_post_id:function(f,g){g=g||".post";var e=0,d=f.closest(g);if(d.length){e=d.data("post-id")}return e},track_signup_buttons:function(e){var f=c(e.target),d=f.attr("id").replace("signup_button_","");this.tracking_data.signup_button[d]=1;Tumblr.Eventbug.track({type:"click",target:"signup_buttons",args:[d,this.source_page]})},track_search:function(f){var d=c(f.target);var e=d.serialize();this.tracking_data.search=e;Tumblr.Eventbug.track({type:"submit",target:"search",args:[e,this.source_page]})},track_explore_tag:function(e){var d=c(e.target);this.tracking_data.explore=d.text();Tumblr.Eventbug.track({type:"click",target:"explore_tag",args:[d.text(),this.source_page]})},track_spotlight_blog:function(f){var d=c(f.target),e=d.find(".tumblelog_name").text();this.tracking_data.spotlight=e;Tumblr.Eventbug.track({type:"click",target:"spotlight_blog",args:[e,this.source_page]})},track_small_links:function(f){var e=c(f.target),d=e.attr("href");if(d=="/explore"){this.tracking_data.explore_link=1}if(d=="/spotlight"){this.tracking_data.spotlight_link=1}Tumblr.Eventbug.track({type:"click",target:"small_sidebar_links",args:[d.replace("/",""),this.source_page]})},track_post_tags:function(g){var e=c(g.target),f=this.get_post_id(e),d={post_id:e.text()};this.tracking_data.post_tags.push(d);Tumblr.Eventbug.track({type:"click",target:"post_tags",args:[d,f,this.source_page]})},track_post_info:function(f){var g=c(f.target),d=this.get_post_id(g),e=g.text();this.tracking_data.post_info={post_id:e};Tumblr.Eventbug.track({type:"click",target:"post_info",args:[e,d,this.source_page]})},track_post_controls:function(g){var f=c(g.target),d=this.get_post_id(f),e;if(f.hasClass("reblog_button")){e="reblog"}if(f.hasClass("like_button")){e="like"}if(f.hasClass("reblog_count")||f.closest(".reblog_count").length){e="notes"}this.tracking_data.post_controls[d]=this.tracking_data.post_controls[d]||[];this.tracking_data.post_controls[d][e]=1;Tumblr.Eventbug.track({type:"click",target:"post_controls",args:[e,d,this.source_page]})},track_post_content:function(h){var f=c(h.target),d=f.closest(".post"),g=this.get_post_id(f),i=d.attr("data-type")||"unknown",e=f[0].outerHTML.replace(/[\n\r]/g," ").replace(/\>\s+\/</g,"");this.tracking_data.post_content[g]=this.tracking_data.post_content[g]||{};this.tracking_data.post_content[g].post_type=i;this.tracking_data.post_content[g].clicks=this.tracking_data.post_content[g].clicks||[];this.tracking_data.post_content[g].clicks.push(e);Tumblr.Eventbug.track({type:"click",target:"post_content",args:[g,i,e,this.source_page]})},track_j_k_keys:function(e){var d=e.keyCode;if((d==74||d==75)&&!c("body").hasClass("show_form")){this.tracking_data.keycommands=1;Tumblr.Eventbug.track({type:"scroll",target:"j_k_next_prev",args:[d,this.source_page]})}},track_auto_pager:function(d){this.page_number=this.page_number||1;this.tracking_data.auto_pager=this.page_number;Tumblr.Eventbug.track({type:"scroll",target:"auto_pager",args:[this.page_number,this.source_page]});this.page_number++},track_recommendations:function(h){var f=c(h.target);var e=f.closest(".ht_post").data("id"),g=(f.hasClass("hello_tag"))?"tag":"thumbnail",d=f.attr("href");this.tracking_data.recommendations.push({post_id:e,type:g,url:d});Tumblr.Eventbug.track({type:"click",target:"recommendation",args:[e,g,d,this.source_page]})},track_related_tag:function(e){var d=c(e.target),f=false;if(!d.hasClass(".tag")){d=d.closest(".tag")}f=c.trim(d.text());if(f&&f.length){this.tracking_data.related_tags.push(f);Tumblr.Eventbug.track({type:"click",target:"related_tag",args:[f,this.source_page]})}},track_related_blog:function(f){var d=c(f.target),e=false;if(!d.hasClass(".blog")){d=d.closest(".blog")}e=d.data("tumblelog");if(e&&e.length){this.tracking_data.related_blogs.push(e);Tumblr.Eventbug.track({type:"click",target:"related_blog",args:[e,this.source_page]})}},track_tag_source:function(){if(c("body").hasClass("sassafras")){this.tracking_data.tag_source="sassafras"}else{this.tracking_data.tag_source="default"}}});a.OnboardingDash=a.UserActions.extend({events:{"submit #search_form":"track_search","click .signup_buttons .chrome":"track_signup_buttons","click .tracked_tag .tag":"track_explore_tag","click #tag_editors .blog":"track_spotlight_blog","click .post .tag":"track_post_tags","click .post_info a":"track_post_info","click .post_controls a":"track_post_controls","click .post_content > *":"track_post_content","click #right_column .small_links a":"track_small_links",keydown:"track_j_k_keys"},initialize:function(){a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture/logged_out_dashboard";this.tracking_data.signup_button={};this.tracking_data.search="";this.tracking_data.explore="";this.tracking_data.explore_link=0;this.tracking_data.spotlight="";this.tracking_data.spotlight_link=0;this.tracking_data.post_tags=[];this.tracking_data.post_info={};this.tracking_data.post_controls={};this.tracking_data.post_content={};this.tracking_data.keycommands=0;this.tracking_data.auto_pager=0;this.track_auto_pager();if(window.AfterAutoPaginationQueue){window.AfterAutoPaginationQueue.push(this.track_auto_pager.bind(this))}this.source_page="onboarding_dash"}});a.OnboardingTags=a.OnboardingDash.extend({events:_.extend({"click #related_tags .tag":"track_related_tag"},a.OnboardingDash.prototype.events),initialize:function(){a.OnboardingDash.prototype.initialize.call(this);this.svc_url="/svc/log/capture/logged_out_tags";this.tracking_data.related_tags=[];this.track_tag_source();this.source_page="onboarding_tags"}});a.HelloDash=a.UserActions.extend({el:"body",events:{"submit #search_form":"track_search","click .signup_buttons .chrome":"track_signup_buttons","click .ht_post .hello_tag":"track_post_tags","click .ht_post .go":"track_go_lightbox",keydown:"track_j_k_keys"},track_post_tags:function(g){var e=c(g.target),f=this.get_post_id(e,".ht_post"),d={};d[f]=e.text();this.tracking_data.post_tags.push(d);Tumblr.Eventbug.track({type:"click",target:"post_tags",args:[d,f,this.source_page]})},track_go_lightbox:function(f){var e=c(f.target);var d=this.get_post_id(e,".ht_post");this.tracking_data.go_lightbox.push(d);Tumblr.Eventbug.track({type:"click",target:"lightbox_open",args:[d,this.has_zoom_effect(),this.source_page]})},has_zoom_effect:function(){return(c('.ht_post[data-effect="grow"]').length||c(".ht_post").data("grow"))},track_post_zoom_effect:function(){if(this.has_zoom_effect){this.tracking_data.has_zoom=1}},initialize:function(){a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture/hello_dash";this.tracking_data.signup_button={};this.tracking_data.search="";this.tracking_data.post_tags=[];this.tracking_data.go_lightbox=[];this.tracking_data.has_zoom=0;this.track_post_zoom_effect();this.source_page="hello_dash"}});a.HelloLightbox=a.UserActions.extend({events:{"click .post .tag":"track_post_tags","click .post_info a":"track_post_info","click .post_controls a":"track_post_controls","click .post_content > *":"track_post_content","click .recommendations a":"track_recommendations",keydown:"track_j_k_keys"},initialize:function(){a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture/hello_lightbox";this.tracking_data.post_tags=[];this.tracking_data.post_info={};this.tracking_data.post_controls={};this.tracking_data.post_content={};this.tracking_data.keycommands=0;this.tracking_data.auto_pager=0;this.tracking_data.recommendations=[];this.track_auto_pager();if(window.AfterAutoPaginationQueue){window.AfterAutoPaginationQueue.push(this.track_auto_pager.bind(this))}this.source_page="hello_lightbox"}});a.Radar=a.UserActions.extend({el:"#tumblr_radar",events:{"click .radar_content a":"track_radar_content","click .radar_controls a":"track_radar_controls","click .radar_footer a":"track_radar_footer"},initialize:function(){a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture_radar";this.tracking_data.radar_id={};this.tracking_data.radar_content=[];this.tracking_data.radar_controls={};this.tracking_data.radar_footer=0},send_data:function(){if(!this.tracking_data.radar_id.post_id){return}a.UserActions.prototype.send_data.call(this)},track_radar_id:function(){if(this.tracking_data.radar_id.post_id){return}this.tracking_data.radar_id={tumblelog:this.$el.data("tumblelog-name"),post_id:this.$el.data("post-id")}},track_follow:function(d){var f=d.hasClass("followed");var e=f?"follow":"unfollow";this.tracking_data.radar_controls[e]=1+(this.tracking_data.radar_controls[e]||0);if(f){a.UserActions.prototype.send_moneyball_beacon(this)}},track_like:function(e){var d=e.hasClass("liked");var f=d?"like":"unlike";this.tracking_data.radar_controls[f]=1+(this.tracking_data.radar_controls[f]||0);if(d){a.UserActions.prototype.send_moneyball_beacon(this)}},track_reblog:function(f,e){var d=(e.altKey)?2:1;this.tracking_data.radar_controls.reblog=d;a.UserActions.prototype.send_moneyball_beacon(this)},track_note_count:function(e,d){var f="note_count";this.tracking_data.radar_controls[f]=1+(this.tracking_data.radar_controls[f]||0);a.UserActions.prototype.send_moneyball_beacon(this)},track_radar_content:function(f){var e=c(f.target);e=(e.is("a"))?e:e.closest("a");var d=e.attr("href");this.tracking_data.radar_content.push({clicked:d});this.track_radar_id();a.UserActions.prototype.send_moneyball_beacon(this)},track_radar_controls:function(g){var f=c(g.target);f=(f.is("a"))?f:f.closest("a");var h=false;if(f.hasClass("reblog")&&!g.altKey){h="reblog"}else{if(f.hasClass("like")){h="like"}else{if(f.hasClass("note_link_current")){h="note_count"}}}if(h===false){return}if(h=="reblog"){var d=this;var e=function(i){d.track_reblog(c(i.target),i);d.track_radar_id();c("body").off("click.capturejs")};c("body").on("click.capturejs","#create_post > button",e)}else{this["track_"+h](f,g);this.track_radar_id()}},track_radar_footer:function(d){if(c(d.target).hasClass("follow")){this["track_follow"](c(d.target),d);this.track_radar_id()}else{this.tracking_data.radar_footer=1;this.track_radar_id();a.UserActions.prototype.send_moneyball_beacon(this)}}});a.WebInStream=a.UserActions.extend({el:".sponsored_post",events:{"click .post_controls .post_control":"track_sponsored_controls","click .post_permalink":"track_sponsored_controls","click .post_avatar a":"track_sponsored_controls","click .post_info .post_info_fence":"track_sponsored_controls","click .post_info .reblog_follow_button":"track_sponsored_controls","click .sponsored_badge a":"track_sponsored_controls","click .post_tags a.post_tag":"track_sponsored_controls","click .post_content a":"track_sponsored_content","click .post_media":"track_sponsored_controls"},initialize:function(){if(this.initialized){return}a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture_web_instream";this.tracking_data.sponsored_id={};this.tracking_data.sponsored_controls={};this.tracking_data.sponsored_content=[];this.tracking_data.sponsored_tags=[];this.tracking_data.is_moneyball=(this.$el.data("mb-click-url"))?1:0;this.control_names={post_avatar_image:"avatar",post_tag:"tag",post_permalink:"permalink",reblog:"reblog",reblog_count:"notes",share:"share",share_email:"share_email",share_facebook:"share_facebook",share_twitter:"share_twitter",share_permalink:"share_permalink",sponsored_badge_icon:"sponsored_badge",post_media:"media"};this.initialized=true},send_data:function(){if(!this.tracking_data.sponsored_id.post_id){return}a.UserActions.prototype.send_data.call(this)},track_sponsored_id:function(){if(this.tracking_data.sponsored_id.post_id){return}this.tracking_data.sponsored_id={tumblelog:this.$el.data("tumblelog-name"),post_id:this.$el.data("post-id"),placement_id:this.$el.data("placement-id")}},track_follow:function(e){var d=e?"follow":"unfollow";this.tracking_data.sponsored_controls[d]=1+(this.tracking_data.sponsored_controls[d]||0);this.track_sponsored_id();if(e){a.UserActions.prototype.send_moneyball_beacon(this)}},track_like:function(d){var e=d?"like":"unlike";this.tracking_data.sponsored_controls[e]=1+(this.tracking_data.sponsored_controls[e]||0);this.track_sponsored_id();if(d){a.UserActions.prototype.send_moneyball_beacon(this)}},track_reblog:function(e,d){this.tracking_data.sponsored_controls.reblog=1;this.track_sponsored_id();a.UserActions.prototype.send_moneyball_beacon(this)},track_fast_reblog:function(){this.track_sponsored_id();this.tracking_data.sponsored_controls.reblog=2;a.UserActions.prototype.send_moneyball_beacon(this)},track_sponsored_content:function(e){var d=c(e.target);d=(d.is("a"))?d:d.closest("a");this.tracking_data.sponsored_content.push({clicked:d.attr("href")});this.track_sponsored_id();a.UserActions.prototype.send_moneyball_beacon(this)},track_sponsored_controls:function(g){var f=(c(g.target).className)?c(g.target):c(g.currentTarget);if(f.hasClass("share_social_button")){if(g.target!=g.currentTarget){f=c(g.target).parent()}}var i=null;switch(true){case f.parent().hasClass("source_url"):i="source_url";break;case f.parent().hasClass("post_info"):if(!f.hasClass("reblog_follow_button")){i="header"}break;default:for(var h in this.control_names){if(f.hasClass(h)){i=this.control_names[h];break}}break}if(!i){return}if(i=="reblog"){var d=this;var e=function(j){d.track_reblog(c(j.target),j);d.track_sponsored_id();d.send_data();c("body").off("click.capturejs")};c("body").on("click.capturejs","#create_post > button",e)}else{if(this["track_"+i]&&this["track_"+i].call){this["track_"+i](f,g);this.track_sponsored_id()}else{this.tracking_data.sponsored_controls[i]=1+(this.tracking_data.sponsored_controls[i]||0);this.track_sponsored_id();a.UserActions.prototype.send_moneyball_beacon(this)}}},force_track_sponsored_controls:function(d){this.tracking_data.sponsored_controls[d]=1+(this.tracking_data.sponsored_controls[d]||0);this.track_sponsored_id();a.UserActions.prototype.send_moneyball_beacon(this)}});a.PremiumRadar=a.Radar.extend({el:"#tumblr_radar.premium",events:function(){return _.extend({},a.Radar.prototype.events,{"click .sponsored_badge":"track_radar_badge","mouseenter .radar_content a":"track_radar_hover","mouseleave .radar_content a":"track_radar_hover"})},initialize:function(){a.Radar.prototype.initialize.call(this);this.svc_url="/svc/log/capture_premium_radar";this.tracking_data.is_moneyball=(this.$el.data("mb-click-url"))?1:0;_.bindAll(this,"track_radar_loaded");c(window).load(this.track_radar_loaded);this.track_radar_visibility();_.bindAll(this,"track_radar_visibility");c(window).scroll(this.track_radar_visibility)},track_radar_id:function(){if(this.tracking_data.radar_id.post_id){return}this.tracking_data.radar_id={tumblelog:this.$el.data("tumblelog-name"),post_id:this.$el.data("post-id"),placement_id:this.$el.data("placement-id")}},get_radar_args:function(d){var f=[this.$el.data("tumblelog-name"),this.$el.data("post-id")];for(var e=0;e<arguments.length;e++){f.push(arguments[e])}return f},track_follow:function(d){a.Radar.prototype.track_follow.call(this,d);var e=(d.hasClass("followed"))?1:0;Tumblr.Eventbug.track({type:"click",target:"premium_radar_follow",args:this.get_radar_args(e)})},track_like:function(e){a.Radar.prototype.track_like.call(this,e);var d=(e.hasClass("liked"))?1:0;Tumblr.Eventbug.track({type:"click",target:"premium_radar_like",args:this.get_radar_args(d)})},track_reblog:function(f,e){a.Radar.prototype.track_reblog.call(this,f,e);var d=(e.altKey)?2:1;Tumblr.Eventbug.track({type:"click",target:"premium_radar_reblog",args:this.get_radar_args(d)})},track_radar_content:function(f){a.Radar.prototype.track_radar_content.call(this,f);var e=c(f.target);e=(e.is("a"))?e:e.closest("a");var d=e.attr("href");Tumblr.Eventbug.track({type:"click",target:"premium_radar_content",args:this.get_radar_args(d)})},track_radar_hover:function(e){var d=(e.type=="mouseenter")?1:0;Tumblr.Eventbug.track({type:"hover",target:"premium_radar_content",args:this.get_radar_args(d)})},track_radar_loaded:function(e){var d=this;this.$el.find(".radar_content a img").each(function(g,f){if(f.complete&&!f.hidden){Tumblr.Eventbug.track({type:"view",target:"premium_radar",args:d.get_radar_args()})}})},track_radar_visibility:function(e){if(this.$el.length>0){var d=this.elInView(this.$el[0])?1:0;var f=this.is_radar_visible!=d;this.is_radar_visible=d;if(f){Tumblr.Eventbug.track({type:"scroll",target:"premium_radar",args:this.get_radar_args(d)})}}},elInView:function(f){var h=f.offsetTop;var g=f.offsetLeft;var e=f.offsetWidth;var d=f.offsetHeight;while(f.offsetParent){f=f.offsetParent;h+=f.offsetTop;g+=f.offsetLeft}return(h<(window.pageYOffset+window.innerHeight)&&g<(window.pageXOffset+window.innerWidth)&&(h+d)>window.pageYOffset&&(g+e)>window.pageXOffset)},track_radar_footer:function(d){a.Radar.prototype.track_radar_footer.call(this,d);Tumblr.Eventbug.track({type:"click",target:"premium_radar_footer",args:this.get_radar_args()})},track_radar_badge:function(d){this.tracking_data.radar_badge=1;this.track_radar_id();Tumblr.Eventbug.track({type:"click",target:"premium_radar_badge",args:this.get_radar_args()})},force_track_radar_controls:function(d){this.tracking_data.radar_controls[d]=1+(this.tracking_data.radar_controls[d]||0);this.track_radar_id();a.UserActions.prototype.send_moneyball_beacon(this)}});a.SearchPopover=a.UserActions.extend({el:"#header",events:{"mousedown .tracked_tags .result_link":"track_tracked_tag_click","mousedown .tag .result_title":"track_tag_click","mousedown .blog .result_link":"track_blog_click","mousedown .blog .more_results_link":"track_blog_click","keydown #popover_search":"keyup"},initialize:function(){a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture_search";this.$search_field=this.$el.find("#search_query");this.$search_popover=this.$el.find("#popover_search");this.tracking_data.query=0;this.tracking_data.tag=0;this.tracking_data.blog=0;this.tracking_data.search_tag=0;this.tracking_data.search_blog=0;this.tracking_data.tracked_tag=0},send_data:function(){if(this.tracking_data.tracked_tag===0&&this.tracking_data.query===0){return}a.UserActions.prototype.send_data.call(this)},get_query_name:function(){return c.trim(this.$search_field.val())},get_tag_name:function(d){return c.trim(d.text()).replace("#","")},get_tumblelog_name:function(d){return(d)?d.attr("data-tumblelog-name"):""},track_query:function(d){this.tracking_data.query=((this.get_query_name().length)?1:0)},track_tag:function(d){if(d.closest(".result.is_query").length){this.tracking_data.search_tag++;Tumblr.Eventbug.track({type:"click",target:"search_popover_search_tag",args:[this.get_query_name()]})}else{this.tracking_data.tag++;Tumblr.Eventbug.track({type:"click",target:"search_popover_popular_tag",args:[this.get_query_name(),this.get_tag_name(d)]})}this.track_query()},track_blog:function(d){if(d.hasClass("more_results_link")){this.tracking_data.search_blog++;Tumblr.Eventbug.track({type:"click",target:"search_popover_search_blog",args:[this.get_query_name()]})}else{this.tracking_data.blog++;Tumblr.Eventbug.track({type:"click",target:"search_popover_popular_blog",args:[this.get_query_name(),this.get_tumblelog_name(d)]})}this.track_query()},track_tag_click:function(e){var d=c(e.currentTarget);this.track_tag(d)},track_tracked_tag_click:function(e){var d=c(e.currentTarget);this.track_tracked_tag(d)},track_tracked_tag:function(d){this.tracking_data.tracked_tag++;this.track_query();Tumblr.Eventbug.track({type:"click",target:"search_popover_tracked_tag",args:[this.get_query_name(),this.get_tag_name(d)]})},track_blog_click:function(e){var d=c(e.currentTarget);this.track_blog(d)},track_submit:function(d){this.track_query();Tumblr.Eventbug.track({type:"click",target:"search_popover_submit",args:[this.get_query_name()]})},keyup:function(e){if(e.keyCode==13){var d=c(document.activeElement);if(d.closest(".tag").length){this.track_tag(d)}if(d.closest(".tracked_tags").length){this.track_tracked_tag(d)}if(d.closest(".blog").length){this.track_blog(d)}}}});a.CrushClick=a.UserActions.extend({el:"#crushes",events:{"mousedown .crush":"track_crush_click"},initialize:function(){a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture_crush";this.tracking_data.crush_clicks=[]},track_crush_click:function(e){var d=c(e.currentTarget);this.tracking_data.crush_clicks.push({click_time:Math.round(Date.now()/1000),tumblelog_name:d.data("tumblelog-name"),position:d.attr("id").split("_")[1],love:d.data("love")})}});a.TumblelogClick=a.UserActions.extend({el:'[href^="http"][href*=".tumblr"]:not([href*="://tumblr"]):not([href*="://www.tumblr"]):not([href*=".media.tumblr"])',events:{mousedown:"track_click"},initialize:function(){a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture_tumblelog_click";this.tracking_data.page=c(location).attr("href");this.tracking_data.tumblelog_clickthrough={}},track_click:function(f){var d=c(f.currentTarget),e=c.trim(d.closest("[class]").prop("className"));this.tracking_data.tumblelog_clickthrough[e]=1+(this.tracking_data.tumblelog_clickthrough[e]||0)}});b.Capture=a;c(function(d){Tumblr.CaptureGeneric=new Tumblr.Capture.Generic();Tumblr.Features("tumblelog_clickthrough")(function(){Tumblr.CaptureTumblelogClick=new Tumblr.Capture.TumblelogClick()},false)})})(jQuery,Tumblr);
/*! scripts/sponsored_posts.js */
(function(c,a){var b=Backbone.View.extend({initialize:function(d){this.div=document.createElement("div");this.isScrollEnabled=false;this.transform=(this.check_support("transform")||this.check_support("webkitTransform")||this.check_support("MozTransform")||this.check_support("msTransform")||this.check_support("OTransform"));this.div=null;if(!this.transform){return}this.rings=c();Tumblr.AutoPaginator.on("after",c.proxy(this.on_autopaginator_after,this));this.check_for_rings()},check_support:function(d){if(d in this.div.style){return d}return false},check_for_rings:function(){this.rings=this.rings.add(".sponsored_badge_icon .ring");if(!this.isScrollEnabled&&this.rings.length>0){this.isScrollEnabled=true;Tumblr.Events.on("DOMEventor:flatscroll",this.on_window_scroll,this)}},on_autopaginator_after:function(){this.check_for_rings()},on_window_scroll:function(g){var d=g.windowScrollTop;for(var f=0,e=this.rings.length;f<e;f++){this.rings[f].style[this.transform]="rotate("+d+"deg)"}}});c(function(){a.SponsoredPosts=new b()})})(jQuery,Tumblr);
/*! scripts/vendor/gif-js/gif.js */
(function(f){function e(a,i){if({}.hasOwnProperty.call(e.cache,a)){return e.cache[a]}var h=e.resolve(a);if(!h){throw new Error("Failed to resolve module "+a)}var j={id:a,require:e,filename:a,exports:{},loaded:!1,parent:i,children:[]};i&&i.children.push(j);var g=a.slice(0,a.lastIndexOf("/")+1);return e.cache[a]=j.exports,h.call(j.exports,j,j.exports,g,a),j.loaded=!0,e.cache[a]=j.exports}e.modules={},e.cache={},e.resolve=function(a){return{}.hasOwnProperty.call(e.modules,a)?e.modules[a]:void 0},e.define=function(a,g){e.modules[a]=g};var d=function(b){return b="/",{title:"browser",version:"v0.10.5",browser:!0,env:{},argv:[],nextTick:f.setImmediate||function(c){setTimeout(c,0)},cwd:function(){return b},chdir:function(a){b=a}}}();e.define("/gif.coffee",function(t,a,l,m){function s(g,c){return{}.hasOwnProperty.call(g,c)}function o(i,g){for(var h=0,j=g.length;h<j;++h){if(h in g&&g[h]===i){return !0}}return !1}function n(g,c){function h(){this.constructor=g}for(var i in c){s(c,i)&&(g[i]=c[i])}return h.prototype=c.prototype,g.prototype=new h,g.__super__=c.prototype,g}var q,r,p;r=e("events",t).EventEmitter,q=e("/browser.coffee",t),p=function(h,c,i){function g(j){var b,k;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(j);for(b in c){k=c[b],null!=this.options[b]?this.options[b]:this.options[b]=k}}return n(g,h),c={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null},i={delay:500,copy:!1},g.prototype.setOption=function(k,j){return this.options[k]=j,null!=this._canvas&&(k==="width"||k==="height")?this._canvas[k]=j:void 0},g.prototype.setOptions=function(b){return function(u){var j,k;for(j in b){if(!s(b,j)){continue}k=b[j],u.push(this.setOption(j,k))}return u}.call(this,[])},g.prototype.addFrame=function(j,v){var k,u;null==v&&(v={}),k={};for(u in i){k[u]=v[u]||i[u]}if("undefined"!==typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&j instanceof CanvasRenderingContext2D||"undefined"!==typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&j instanceof WebGLRenderingContext){v.copy?k.data=this.getContextData(j):k.context=j}else{if(null!=j.childNodes){null!=this.options.width||this.setOption("width",j.width),null!=this.options.height||this.setOption("height",j.height),v.copy?k.data=this.getImageData(j):k.image=j}else{throw new Error("Invalid image")}}return this.frames.push(k),null!=k.width&&this.setOption("width",k.width),null!=k.height?this.setOption("height",k.height):void 0},g.prototype.render=function(){var u,k;if(this.running){throw new Error("Already running")}this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(w){var y;for(var x=0,z=function(){var A,A;A=[];for(var B=0;0<=this.frames.length?B<this.frames.length:B>this.frames.length;0<=this.frames.length?++B:--B){A.push(B)}return A}.apply(this,arguments).length;x<z;++x){y=function(){var A,A;A=[];for(var B=0;0<=this.frames.length?B<this.frames.length:B>this.frames.length;0<=this.frames.length?++B:--B){A.push(B)}return A}.apply(this,arguments)[x],w.push(null)}return w}.call(this,[]),k=this.spawnWorkers();for(var j=0,v=function(){var x,x;x=[];for(var w=0;0<=k?w<k:w>k;0<=k?++w:--w){x.push(w)}return x}.apply(this,arguments).length;j<v;++j){u=function(){var x,x;x=[];for(var w=0;0<=k?w<k:w>k;0<=k?++w:--w){x.push(w)}return x}.apply(this,arguments)[j],this.renderNextFrame()}return this.emit("start"),this.emit("progress",0)},g.prototype.abort=function(){var b;while(!0){if(b=this.activeWorkers.shift(),!(null!=b)){break}console.log("killing active worker"),b.terminate()}return this.running=!1,this.emit("abort")},g.prototype.spawnWorkers=function(){var u,k,j;k=Math.min(this.options.workers,this.frames.length);for(var w=0,v=function(){var y,y;y=[];for(var x=this.freeWorkers.length;this.freeWorkers.length<=k?x<k:x>k;this.freeWorkers.length<=k?++x:--x){y.push(x)}return y}.apply(this,arguments).length;w<v;++w){u=function(){var y,y;y=[];for(var x=this.freeWorkers.length;this.freeWorkers.length<=k?x<k:x>k;this.freeWorkers.length<=k?++x:--x){y.push(x)}return y}.apply(this,arguments)[w],(j=this,function(x){var b,y;return console.log("spawning worker "+x),y=new Worker(j.options.workerScript),b=j,y.onmessage=function(z){return b.activeWorkers.splice(b.activeWorkers.indexOf(y),1),b.freeWorkers.push(y),b.frameFinished(z.data)},j.freeWorkers.push(y)})()}return k},g.prototype.frameFinished=function(b){return console.log("frame "+b.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[b.index]=b,o(null,this.imageParts)?this.renderNextFrame():this.finishRendering()},g.prototype.finishRendering=function(){var C,G,w,u,F,D,z;F=0;for(var B=0,x=this.imageParts.length;B<x;++B){G=this.imageParts[B],F+=(G.data.length-1)*G.pageSize+G.cursor}F+=G.pageSize-G.cursor,console.log("rendering finished - filesize "+Math.round(F/1000)+"kb"),C=new Uint8Array(F),D=0;for(var A=0,v=this.imageParts.length;A<v;++A){G=this.imageParts[A];for(var E=0,y=G.data.length;E<y;++E){z=G.data[E],w=E,C.set(z,D),w===G.data.length-1?D+=G.cursor:D+=G.pageSize}}return u=new Blob([C],{type:"image/gif"}),this.emit("finished",u,C)},g.prototype.renderNextFrame=function(){var u,k,j;if(this.freeWorkers.length===0){throw new Error("No free workers")}return this.nextFrame>=this.frames.length?void 0:(u=this.frames[this.nextFrame++],j=this.freeWorkers.shift(),k=this.getTask(u),console.log("starting frame "+(k.index+1)+" of "+this.frames.length),this.activeWorkers.push(j),j.postMessage(k))},g.prototype.getContextData=function(b){return b.getImageData(0,0,this.options.width,this.options.height).data},g.prototype.getImageData=function(j){var k;return null!=this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),k=this._canvas.getContext("2d"),k.setFill=this.options.background,k.fillRect(0,0,this.options.width,this.options.height),k.drawImage(j,0,0),this.getContextData(k)},g.prototype.getTask=function(k){var u,j;if(u=this.frames.indexOf(k),j={index:u,last:u===this.frames.length-1,delay:k.delay,width:this.options.width,height:this.options.height,quality:this.options.quality,repeat:this.options.repeat,canTransfer:q.name==="chrome"},null!=k.data){j.data=k.data}else{if(null!=k.context){j.data=this.getContextData(k.context)}else{if(null!=k.image){j.data=this.getImageData(k.image)}else{throw new Error("Invalid frame")}}}return j},g}(r),t.exports=p}),e.define("/browser.coffee",function(m,l,k,j){var r,o,n,p,q;p=navigator.userAgent.toLowerCase(),n=navigator.platform.toLowerCase(),q=p.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],o=q[1]==="ie"&&document.documentMode,r={name:q[1]==="version"?q[3]:q[1],version:o||parseFloat(q[1]==="opera"&&q[4]?q[4]:q[2]),platform:{name:p.match(/ip(?:ad|od|hone)/)?"ios":(p.match(/(?:webos|android)/)||n.match(/mac|win|linux/)||["other"])[0]}},r[r.name]=!0,r[r.name+parseInt(r.version,10)]=!0,r.platform[r.platform.name]=!0,m.exports=r}),e.define("events",function(k,l,j,i){d.EventEmitter||(d.EventEmitter=function(){});var b=l.EventEmitter=d.EventEmitter,n=typeof Array.isArray==="function"?Array.isArray:function(c){return Object.prototype.toString.call(c)==="[object Array]"},m=10;b.prototype.setMaxListeners=function(c){this._events||(this._events={}),this._events.maxListeners=c},b.prototype.emit=function(p){if(p==="error"&&(!(this._events&&this._events.error)||n(this._events.error)&&!this._events.error.length)){throw arguments[1] instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.")}if(!this._events){return !1}var h=this._events[p];if(!h){return !1}if(!(typeof h=="function")){if(n(h)){var c=Array.prototype.slice.call(arguments,1),q=h.slice();for(var r=0,o=q.length;r<o;r++){q[r].apply(this,c)}return !0}else{return !1}}switch(arguments.length){case 1:h.call(this);break;case 2:h.call(this,arguments[1]);break;case 3:h.call(this,arguments[1],arguments[2]);break;default:var c=Array.prototype.slice.call(arguments,1);h.apply(this,c)}return !0},b.prototype.addListener=function(g,c){if("function"!==typeof c){throw new Error("addListener only takes instances of Function")}if(this._events||(this._events={}),this.emit("newListener",g,c),!this._events[g]){this._events[g]=c}else{if(n(this._events[g])){if(!this._events[g].warned){var h;this._events.maxListeners!==undefined?h=this._events.maxListeners:h=m,h&&h>0&&this._events[g].length>h&&(this._events[g].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[g].length),console.trace())}this._events[g].push(c)}else{this._events[g]=[this._events[g],c]}}return this},b.prototype.on=b.prototype.addListener,b.prototype.once=function(g,p){var h=this;return h.on(g,function o(){h.removeListener(g,o),p.apply(this,arguments)}),this},b.prototype.removeListener=function(g,o){if("function"!==typeof o){throw new Error("removeListener only takes instances of Function")}if(!(this._events&&this._events[g])){return this}var c=this._events[g];if(n(c)){var h=c.indexOf(o);if(h<0){return this}c.splice(h,1),c.length==0&&delete this._events[g]}else{this._events[g]===o&&delete this._events[g]}return this},b.prototype.removeAllListeners=function(c){return c&&this._events&&this._events[c]&&(this._events[c]=null),this},b.prototype.listeners=function(c){return this._events||(this._events={}),this._events[c]||(this._events[c]=[]),n(this._events[c])||(this._events[c]=[this._events[c]]),this._events[c]}}),f.GIF=e("/gif.coffee")}.call(this,this));
/*! scripts/eventbug.js */
(function(c,a){var b=function(){var g=(function(){var j={click:["explore_tag","lightbox_open","post_content","post_controls","post_info","post_tags","premium_radar_badge","premium_radar_content","premium_radar_follow","premium_radar_footer","premium_radar_like","premium_radar_reblog","recommendation","related_blog","related_tag","search_popover_popular_blog","search_popover_popular_tag","search_popover_search_blog","search_popover_search_tag","search_popover_submit","search_popover_tracked_tag","signup_buttons","small_sidebar_links","spotlight_blog"],hover:["premium_radar_content"],keyboard:[],navigate:[],scroll:["auto_pager","j_k_next_prev","premium_radar"],submit:["search"],view:["premium_radar"],error:["window_onerror","exception"]};function i(k){var o={};for(var l in k){o[l]={};for(var m=0;m<k[l].length;m++){var n=k[l][m];if(typeof ENVIRONMENT!=="undefined"&&ENVIRONMENT=="development"){if(typeof o[l][n]!=="undefined"){console.error("Event "+l+"."+n+" is duplicated!")}}o[l][n]=true}}return o}return i(j)})();var h="www.tumblr.com/evixu";var d=[];var e=0;function f(){for(var k=0;k<d.length;k++){var l=c.param(d[k]);var j=new Image(1,1);j.src=document.location.protocol+"//"+h+"?"+l}d.length=0}setInterval(f,5000);c(window).on("beforeunload",f);return{track:function(i){setTimeout(function(){if(typeof Tumblr.enable_eventbug==="undefined"||Tumblr.enable_eventbug===false){return}if(typeof g[i.type]==="undefined"||typeof g[i.type][i.target]==="undefined"){throw"Event "+i.type+"."+i.target+" is not a valid event type!"}var k={ev:i.type,tg:i.target,v:i.version||"default",seq:e+=1,ts:Math.floor(new Date().getTime()/1000),url:encodeURIComponent(document.location.href)};if(i.args instanceof Array){for(var j=0;j<i.args.length;j++){k["a"+j]=i.args[j]}}d.push(k);f()},0)}}};a.Eventbug=a.Eventbug||b()})(jQuery,Tumblr);
/*! scripts/vendor/jquery_plugins/jquery.hoverIntent.js */
/*!
 * hoverIntent r7 // 2013.03.11 // jQuery 1.9.1+
 * http://cherne.net/brian/resources/jquery.hoverIntent.html
 *
 * You may use hoverIntent under the terms of the MIT license. Basically that
 * means you are free to use hoverIntent as long as this header is left intact.
 * Copyright 2007, 2013 Brian Cherne
 */
(function(a){a.fn.hoverIntent=function(m,d,h){var j={interval:100,sensitivity:7,timeout:0};if(typeof m==="object"){j=a.extend(j,m)}else{if(a.isFunction(d)){j=a.extend(j,{over:m,out:d,selector:h})}else{j=a.extend(j,{over:m,out:m,selector:d})}}var l,k,g,f;var e=function(n){l=n.pageX;k=n.pageY};var c=function(o,n){n.hoverIntent_t=clearTimeout(n.hoverIntent_t);if((Math.abs(g-l)+Math.abs(f-k))<j.sensitivity){a(n).off("mousemove.hoverIntent",e);n.hoverIntent_s=1;return j.over.apply(n,[o])}else{g=l;f=k;n.hoverIntent_t=setTimeout(function(){c(o,n)},j.interval)}};var i=function(o,n){n.hoverIntent_t=clearTimeout(n.hoverIntent_t);n.hoverIntent_s=0;return j.out.apply(n,[o])};var b=function(p){var o=jQuery.extend({},p);var n=this;if(n.hoverIntent_t){n.hoverIntent_t=clearTimeout(n.hoverIntent_t)}if(p.type=="mouseenter"){g=o.pageX;f=o.pageY;a(n).on("mousemove.hoverIntent",e);if(n.hoverIntent_s!=1){n.hoverIntent_t=setTimeout(function(){c(o,n)},j.interval)}}else{a(n).off("mousemove.hoverIntent",e);if(n.hoverIntent_s==1){n.hoverIntent_t=setTimeout(function(){i(o,n)},j.timeout)}}};return this.on({"mouseenter.hoverIntent":b,"mouseleave.hoverIntent":b},j.selector)}})(jQuery);
/*! scripts/tumblr/models/tumblelog.js */
(function(m,f,l,d){var e="name";var g=new l.Collection();var i=/^[a-z0-9-_]+$/i;var j=d.Features("is_admin");function h(v,s,w){var u=f.Deferred();var p={data:{tumblelog:v.get("name")}};if(w.placement_id){p.data.placement_id=w.placement_id}if(w.source){p.data.source=w.source}var r=function(){if(!w.wait){v.set({following:s.following},w)}};var q=function(x,y){if(!w.wait){v.set({following:!s.following},w)}u.reject(y)};var t=function(){if(w.wait){v.set({following:s.following},w)}u.resolve()};var o=(s.following?"/svc/follow":"/svc/unfollow");f.ajax({beforeSend:r,cache:!w.force,data:p,error:q,type:"POST",success:t,url:o,with_form_key:true});return u.promise()}function c(v,r){var p=f.Deferred();var t={is_tumblelog_popover:r.is_tumblelog_popover};var q=function(w,x){p.reject(x)};var u=function(w){v.set({highlighted_posts:w});p.resolve()};var o=Tumblr.Features("enable_new_highlighted_posts")(true,false);var s=(o?"/svc/"+v.get("name")+"/posts/highlighted":"/svc/highlighted_posts/"+v.get("name"));f.ajax({cache:!r.force,data:t,error:q,type:"GET",success:u,url:s,with_form_key:true});return p.promise()}var b=l.Model.extend({save_following:function(p,o){o||(o={});p||(p={});p.following=!!p.following;var q=this;if(!o.force&&q.get("following")===p.following){return f.when(q.get("following"))}else{return h(q,p,o).then(m.bindKey(q,"save_following",p))}},fetch_highlighted_posts:function(o){o||(o={});o.is_tumblelog_popover=!!o.is_tumblelog_popover||false;var p=this;if(!o.force&&p.has("highlighted_posts")){return f.when(p.get("highlighted_posts"))}else{return c(p,o).then(m.bindKey(p,"fetch_highlighted_posts",undefined))}},save_spam:j(function a(){return function(p,o){}},function n(){return function(){return f.Deferred().reject()}}),save_nsfw:j(function k(){return function(){}},function n(){return function(){return f.Deferred().reject()}}),defaults:{},idAttribute:e,constructor:function(o,r){var s=o&&o[e];if(!(typeof s==="number"||typeof s==="string")||!(s=s+"")||!(i.test(s))){throw'Invalid Tumblelog "'+e+'": "'+s+'".'}var q=g.get(s);if(r&&r.collection){r=m.omit(r,["collection","add","merge","previousModels","remove"])}if(q){if(m.keys(o).length>1){q.set(o,r)}return q}else{var p=[o,r].concat(m.rest(arguments,2));this.constructor.__super__.constructor.apply(this,p);g.add(this)}},initialize:function(){},parse:function(o){return o},validate:function(){return false},destroy:function(){return this},fetch:function(){return this},save:function(){return this},url:function(){},urlRoot:function(){}},m.extend({instances:function(){return g.slice()},collection:g},l.Events));(d.Models||(d.Models={})).Tumblelog=b})(_,jQuery,Backbone,this.Tumblr||(this.Tumblr={}));
/*! scripts/tumblr/collections/topcontentblogs.js */
(function(b,d,e,a){if(!a.Models||!a.Models.Tumblelog){throw"Tumblr.Models.Tumblelog is missing."}var c=e.Collection.extend({url:"/svc/top/blogs",model:a.Models.Tumblelog,initialize:function(){},parse:function(f){return(f&&b.isArray(f.blogs))?f.blogs:[]}});(a.Collections||(a.Collections={})).TopContentBlogs=c})(_,jQuery,Backbone,this.Tumblr||(this.Tumblr={}));
/*! scripts/tumblr/utils/ajaxwithformkey.js */
(function(g,u){var c;var h;var a;var n=[];var d;var p;var k=29*1000*60;var f=[{uid:Math.round(new Date()/Math.random())},{event:"start",time:+new Date()}];var r=Tumblr.Flags("is_dev")(function(){return g.proxy(window.console.log,window.console)},function(){return g.noop});var s=Tumblr.Flags("secure_form_key_fully_on")(true,false);var b=Tumblr.Flags("is_long_form_key_renew")(function(){var w;function v(){g.ajax({type:"POST",url:"/svc/secure_form_key/exchange"}).done(function(){f.push({event:"keyRenewalDone",time:+new Date(),data:{}});r(f)}).fail(function(x){f.push({event:"keyRenewalFail",time:+new Date(),data:{status:x.status}})})}return function(){if(w){clearTimeout(w)}w=setTimeout(v,k)}},function(){return g.noop});function e(){g.ajax({type:"POST",url:"/svc/secure_form_key",withoutFormKeyTransport:true,with_form_key:true,beforeSend:function(){c=true},complete:function(v){c=false;a=v.getResponseHeader("X-tumblr-secure-form-key");if(!a){i(v)}j()}})}function i(v){d=v.status;p=v.statusText}function t(){g.each(n,function(v,w){w.complete(d,p,{},"")});f.push({event:"abortExistingQueue",time:+new Date(),data:{status:d,length:n.length}});n.length=0}function j(){if(c===true||!n.length){return}if(c===void 0){return e()}if(s&&!a){return t()}q()}function q(){var v=n[0];var w=v.originalOptions;w.beforeSend&&(w.beforeSend=null);w.complete&&(w.complete=null);w.error&&(w.error=null);w.success&&(w.success=null);w.headers||(w.headers={});w.headers["X-tumblr-puppies"]=a;w.withoutFormKeyTransport=true;w.with_form_key=true;c=true;v.ajax=g.ajax(w).always(function(x){x.getResponseHeader||(x=arguments[2]);if(x.readyState===0||x.readyState===1){}else{a=x.getResponseHeader("X-tumblr-kittens")}a||i(x);var y={};x.responseJSON&&(y.json=x.responseJSON);x.responseText&&(y.text=x.responseText);x.responseXML&&(y.xml=x.responseXML);v.complete(x.status,x.statusText,y,x.getAllResponseHeaders());f.push({event:"nextInQueue",time:+new Date(),data:{status:x.status}});n.splice(g.inArray(v,n),1);c=false;j();b()})}function m(){var v=/^(\/svc\/(post\/update|upload|settings\/.*))|(\/settings\/(save|tfa)\/?.*)|(\/svc\/secure_form_key\/exchange)\/?$/;g.ajaxTransport("+*",function(w,A,z){if(w.type!=="POST"||!v.test(w.url)){return}if(w.withoutFormKeyTransport){return}var x;var y={options:w,originalOptions:A,jqXHR:z,ajax:null,complete:null};n.push(y);return{send:function(C,B){y.complete=B;if(A.beforeSend){x=setTimeout(j,0)}else{j()}},abort:function(){x&&clearTimeout(x);y.ajax&&y.ajax.abort()}}})}function l(){h||(h=g("#tumblr_form_key").attr("content"));g.ajaxPrefilter(function(v,w){if(!w.with_form_key){return}v.headers||(v.headers={});v.headers["X-tumblr-form-key"]=h})}var o=(function(){var v;return Tumblr.Features("secure_form_key")(function x(){return function(){v||(v=true,l(),m())}},function w(){return function(){v||(v=true,l())}})})();(u.Lib||(u.Lib={})).AJAXWithFormKey=o})(jQuery,this.Tumblr||(this.Tumblr={}));
/*! scripts/tumblr/binary_switch.js */
(function(c,b){var a=Backbone.View.extend({el:".binary_switcher",className:"binary_switch",defaults:{additionalClassNames:""},initialize:function(d){this.options=d||{};this.options=_.extend(this.defaults,this.options||{})},render:function(){_.each(this.$el.not("[data-binary-switch-init]"),_.bind(function(e){var d=c(e);d.attr("data-binary-switch-init",true);d.wrap(c("<label>").addClass(this.className).addClass(this.options.additionalClassNames));d.after(c("<span>",{"class":this.className+"_button"}));d.after(c("<span>",{"class":this.className+"_track"}))},this));return this}});b.BinarySwitch=a})(jQuery,Tumblr);
/*! scripts/tumblelog_popover.js */
(function(e,b,a,h){var d={};var c=function(j){var i=e(j),k={left:0,right:0,top:0,bottom:0};if(i.length){k=i.offset();k.right=k.left+i.width();k.bottom=k.top+i.height()}return k};var g=h.View.extend({events:{"click .follow":"on_follow_click","click .unfollow":"on_follow_click","click .tumblelog_menu_btn":"on_menu_click","click .ask":"on_ask_click","click .fan_mail":"on_fan_mail_click","click .ignore":"on_ignore_click","click .toggle_spam":"on_spam_click","click .toggle_nsfw":"on_nsfw_click","click .recent_posts a":"on_post_click","click .tumblelog_info a.avatar":"on_avatar_click","click .tumblelog_info .name a":"on_blog_name_click","mousedown .recent_posts a":"capture_tumblelog_click","mousedown .tumblelog_info a.avatar":"capture_tumblelog_click","mousedown .tumblelog_info .name a":"capture_tumblelog_click"},capture_tumblelog_click:function(i){if(a.CaptureTumblelogClick){a.CaptureTumblelogClick.track_click(i)}},initialize:function(i){this.options=i||{};this.template=b.template(this.options.template||e("#tumblelog_popover_info").html());this.on_close=this.options.on_close||e.noop;this.on_menu_toggle=this.options.on_menu_toggle||e.noop;this.min_load_time=this.options.min_load_time||500;this.current_data=this.options.current_data||{};this.hide_posts_on_unfollow=(this.options.hide_posts_on_unfollow!==false)?true:false;this.is_user_mention=this.options.is_user_mention||false;this.post=a.Posts.get(this.options.post)||null;this.is_mobile=!!("ontouchstart" in document.documentElement);this.is_disabled=false;this.is_menu_open=false;this.xhr=null;this.$recent_posts=this.$el.find(".recent_posts");this.$menu=this.$el.find(".tumblelog_menu");this.model=new a.Models.Tumblelog({name:this.options.tumblelog});this.listenTo(this.model,"add",this.render);this.listenTo(this.model,"change",this.render);this.listenTo(this.model,"change:highlighted_posts",this.on_posts_change);if(this.current_data&&!b.isEmpty(this.current_data)){var j,k=this.model.toJSON();for(j in k){if(k[j]){this.current_data[j]=k[j]}}this.model.set(this.current_data,{silent:true});this.render();if(this.current_data.highlighted_posts&&b.isArray(this.current_data.highlighted_posts)){this.render_posts(true)}else{this.model.fetch_highlighted_posts({is_tumblelog_popover:true})}}else{this.fetch_popover_data()}},render:function(){var i=this.model.toJSON();if(b.isUndefined(i.url)){this.close()}this.$el.find(".tumblelog_info").html(this.template(i));this.update_cache();return this},render_posts:function(r){var m=this.model.toJSON();if(!b.isArray(m.highlighted_posts)){return}var s=m.highlighted_posts,q=s.join(""),p=e(q).find("img"),o=0;if(s.length<2){setTimeout(b.bind(function(){this.$el.addClass("is_empty");this.$recent_posts.html("")},this),this.min_load_time);return}this.$recent_posts.addClass("has_"+s.length+"_posts");if(r){this.$recent_posts.addClass("is_cached").html(q);return}if(p.length<1){setTimeout(b.bind(function(){this.$recent_posts.addClass("is_loaded").html(q)},this),this.min_load_time);return}for(var n=0,j=p.length;n<j;n++){var k=new Image();e(k).load(b.bind(function(){o++;if(o===p.length){setTimeout(b.bind(function(){this.$recent_posts.addClass("is_loaded").html(q)},this),this.min_load_time);e(k).unbind()}},this));k.src=p[n].src}},close:function(i){i=i||true;if(i){this.on_close()}if(this.xhr){this.xhr.abort();this.xhr=null}e(document).off(".tumblelog_popover_menu");this.remove()},fetch_popover_data:function(){var l=this.model;var i=e.Deferred();var j=function(m,n){i.reject(n)};var k=function(m){l.set(m);i.resolve()};e.ajax({cache:true,data:{is_user_mention:this.is_user_mention},error:j,type:"GET",success:k,url:"/svc/tumblelog_popover/"+l.get("name"),with_form_key:true})},update_cache:function(){var i=this.model.toJSON(),j=this.model.get("name");d[j]={timestamp:new Date().getTime(),data:JSON.stringify(i)}},open_dialog:function(i,j){j=j||e.noop;this.is_disabled=true;i.fail(b.bind(function(){this.is_disabled=this.is_menu_open},this));i.done(b.bind(function(){this.is_disabled=this.is_menu_open;j()},this))},hide_posts:function(){a.Posts.whereBy({tumblelog:this.model.get("name"),sponsored:false}).invoke("dismiss");this.close()},show_menu:function(){this.is_menu_open=true;this.is_disabled=true;this.$el.addClass("admin_menu_open")},hide_menu:function(){this.is_menu_open=false;this.is_disabled=false;this.$el.removeClass("admin_menu_open")},on_posts_change:function(){this.update_cache();this.render_posts()},on_follow_click:function(i){i.preventDefault();i.stopPropagation();if(e(i.currentTarget).hasClass("unfollow")){var j=a.TumblelogActions.confirm_unfollow({tumblelog:this.model.get("name"),avatar_url:this.model.get("avatar_url")||""});this.open_dialog(j,b.bind(function(){this.model.save_following({following:false},{source:"UNFOLLOW_SOURCE_TUMBLELOG_POPOVER",from_popover:true,placement_id:(this.post instanceof a.Post&&this.post.get("placement_id"))||""});if(this.hide_posts_on_unfollow){this.hide_posts()}this._track_premium_engagement("popover_unfollow")},this))}else{this.model.save_following({following:true},{source:"FOLLOW_SOURCE_TUMBLELOG_POPOVER",from_popover:true,placement_id:(this.post instanceof a.Post&&this.post.get("placement_id"))||""});this._track_premium_engagement("popover_follow")}},on_menu_click:function(i){i.preventDefault();if(!this.is_menu_open){this.show_menu();e(document).on("mouseup.tumblelog_popover_menu",b.bind(this.on_menu_mouseup,this))}this._track_premium_engagement("popover_menu")},on_menu_mouseup:function(k){var i=c(this.$el.find(".tumblelog_menu_popover"));var l=!(i.left<=k.pageX&&k.pageX<=i.right),j=!(i.top<=k.pageY&&k.pageY<=i.bottom);if(l||j){e(document).off(".tumblelog_popover_menu");this.hide_menu()}},on_ask_click:function(){this.close()},on_fan_mail_click:function(j){if(b.isObject(a.FanMail)){var i={href:a.FanMail.make_url_from_tumblelog(this.model.get("name"))};j.preventDefault();a.FanMail.show(i);this.close()}},on_ignore_click:function(i){i.preventDefault();var j=a.TumblelogActions.confirm_ignore({tumblelog:this.model.get("name"),avatar_url:this.model.get("avatar_url")||""});this.open_dialog(j,b.bind(function(){a.ignore({tumblelog:this.model.get("name")},{success:b.bind(function(){this.model.set("ignoring",true);this.hide_posts()},this)})},this))},on_spam_click:function(i){i.preventDefault();e.ajax({url:"/spam/toggle",type:"POST",data:{tumblelog:this.model.get("name")},with_form_key:true,success:b.bind(function(j){this.model.set("spam",(j.spammer)?true:false)},this)})},on_nsfw_click:function(i){i.preventDefault();e.ajax({url:"/nsfw/toggle",type:"POST",data:{tumblelog:this.model.get("name")},with_form_key:true,success:b.bind(function(j){this.model.set("nsfw",j.nsfw)},this)})},on_post_click:function(){this._track_premium_engagement("popover_post")},on_avatar_click:function(){this._track_premium_engagement("popover_avatar")},on_blog_name_click:function(){this._track_premium_engagement("popover_blog")},_track_premium_engagement:function(j){if(this.post instanceof a.Post){if(a.CapturePremiumRadar&&this.post===a.radar.postModel&&this.post.get("placement_id")){a.CapturePremiumRadar.force_track_radar_controls(j)}else{if(this.post.get("sponsored")){var i=b.find(a.postsView.postViews,{model:this.post});if(!i){return}i.capture_web_instream.force_track_sponsored_controls(j)}}}}});var f=h.View.extend({el:"body",initialize:function(l){this.options=l||{};this.popover_template=e.trim(this.options.template||e("#tumblelog_popover_template").html());this.cache_timeout=this.options.cache_timeout||3600000;this.mention_hostname=this.options.mention_hostname||"tmblr.co";this.hide_posts_on_unfollow=(this.options.hide_posts_on_unfollow!==false)?true:false;this.$popover=null;this.popover=null;this.popover_info=null;this.current_target=null;this.current_data={};this.current_tumblelog="";this.current_post="";this.current_mouse_x=0;this.hide_timeout=null;this.queued_event=null;this.hover_bounds={};this.is_open=false;this.is_user_mention=false;this.is_mobile=!!("ontouchstart" in document.documentElement);var i=e(this.options.selector||this.el);if(this.is_mobile){var n=i.find("a[data-tumblelog-popover]");n.addClass("no_pop");n.on("touchend",b.bind(this.on_touch_open,this))}else{var j=String(window.location.host).replace(/^(https?:\/\/)?(www\.)?/,""),k='a[data-tumblelog-popover], a[href^="http://www."], a[href^="https://www."], .popover a, .link_text a, .photo_info a, .notification_target, .no_popover';i.hoverIntent({selector:'a[data-tumblelog-popover], a[href*=".'+j+'"]:not('+k+'), a[href*="'+this.mention_hostname+'"]',over:b.bind(this.on_mouseover,this),out:e.noop})}if(window.sessionStorage){try{this.sync_storage()}catch(m){}}},sync_storage:function(){var k,i,j,l=sessionStorage.getItem("tumblelog_popover");if(l){k=e.parseJSON(l);i=new Date().getTime();for(j in k){if(i-k[j].timestamp>this.cache_timeout||!b.has(k[j],"data")){delete k[j]}}d=k}e(window).on("beforeunload",b.bind(function(){var q,n,p=b.size(d),m=50;if(p>m){q=0;for(n in d){if(d[n]){q++;if(q<=p-m){delete d[n]}}}}try{sessionStorage.setItem("tumblelog_popover",JSON.stringify(d))}catch(o){}},this))},show:function(){var k,l=true,i=e(this.current_target),j=(d)?d[this.current_tumblelog]:null;if(j&&j.data){k=b.isObject(j.data)?j.data:e.parseJSON(j.data);if(b.size(k)>1){this.current_data=b.isObject(j.data)?j.data:e.parseJSON(j.data)}}this.$popover=e(b.template(this.popover_template,this.current_data||{}));this.$popover.appendTo(this.$el).hide();this.popover=new a.Popover({button:i,popover:this.$popover,skip_glass:true});if(!b.isEmpty(this.current_data)){this.popover.show();l=false}this.popover_info=new g({el:this.$popover,tumblelog:this.current_tumblelog,post:this.current_post,current_data:this.current_data,on_close:b.bind(this.animate_out,this),hide_posts_on_unfollow:this.hide_posts_on_unfollow,is_user_mention:this.is_user_mention});if(l===false&&!b.isEmpty(this.current_data)){this.popover.show()}this.position();this.animate_in();this.is_open=true;this.bind_events();this.log_impression(j);a.Events.trigger("TumblelogPopover:show",this.current_target)},hide:function(){if(this.$popover){this.$popover.remove();this.$popover=null;a.Events.trigger("TumblelogPopover:hide",this.current_target)}if(this.popover){this.popover.hide();this.popover=null}if(this.popover_info){this.popover_info.close(false);this.popover_info=null}this.current_data={};this.current_tumblelog="";this.current_post="";this.is_open=false;this.is_user_mention=false;if(this.queued_event){this.on_mouseover(this.queued_event);this.queued_event=null}},animate_in:function(){if(this.hide_timeout){clearTimeout(this.hide_timeout);this.hide_timeout=null}if(this.$popover){this.$popover.removeClass("is_closed").addClass("is_open")}},animate_out:function(){if(this.hide_timeout){clearTimeout(this.hide_timeout);this.hide_timeout=null}if(this.$popover){this.$popover.removeClass("is_open").addClass("is_closed")}this.unbind_events();this.hide_timeout=setTimeout(b.bind(this.hide,this),300)},position:function(){if(!this.$popover||!this.current_target){return}this.$popover.show();var p=e(window),k=e(this.current_target),m=this.$popover.outerHeight();var j={top:p.scrollTop(),left:p.scrollLeft()};j.right=j.left+p.width();j.bottom=j.top+p.height();var o=k.offset().top,n=k.offset().left+(k.width()*0.5);k.css("white-space","nowrap");if(k.offset().top>o){n=this.current_mouse_x}k.css("white-space","");this.$popover.removeClass("down nipple_on_top left");this.$popover.addClass("up nipple_on_bottom");this.$popover.css({left:n,top:k.offset().top-m});var l=c(this.$popover),i=c(k);if(l.top<j.top+20){this.$popover.removeClass("up nipple_on_bottom");this.$popover.addClass("down nipple_on_top");this.$popover.css("top",i.bottom);l=c(this.$popover)}if(l.right>j.right-20){this.$popover.addClass("left");l=c(this.$popover)}this.hover_bounds.left=Math.min(l.left,i.left);this.hover_bounds.top=Math.min(l.top,i.top);this.hover_bounds.right=Math.max(l.right,i.right);this.hover_bounds.bottom=Math.max(l.bottom,i.bottom)},bind_events:function(){if(this.is_mobile){e(document).on("touchstart.tumblelog_popover",b.bind(this.on_touch_close,this))}else{e(document).on("mousemove.tumblelog_popover",b.throttle(b.bind(this.on_mousemove,this),50))}},unbind_events:function(){e(document).off(".tumblelog_popover")},on_mouseover:function(o){var i,p,m,l,k=e(o.currentTarget),j=k.attr("href"),n=!!(k.attr("data-tumblelog-popover")),q=(k.text().replace(/\s+/g," ").length>1);this.current_mouse_x=o.clientX;this.current_post=k.closest(".post").data("post-id")||k.closest(".radar").data("post-id")||"";if(!n&&!q){return}if(this.is_open){if(this.current_target.href!==o.currentTarget.href){this.queued_event=o;this.animate_out()}return}if(n){this.current_data=e.parseJSON(k.attr("data-tumblelog-popover"));this.current_tumblelog=this.current_data.name.toString()}else{if(k[0].hostname&&k[0].hostname===this.mention_hostname){i=(j.substr(-1)==="/")?j.substr(0,j.length-1):j;p=i.split("/");this.is_user_mention=true;this.current_tumblelog=p[p.length-1]}else{if(q){i=j.replace(/.*?:\/\//g,"");p=i.split("/");if(p.length>1&&p[1].length&&p[1]!=="post"){return}m=j.match(/([^\/\.]+\/\/)([^\/\.]+)(\..*)/i);l=m&&m[2];if(l){this.current_tumblelog=l.toLowerCase()}}}}if(this.current_tumblelog){this.current_target=o.currentTarget;this.show()}},on_mousemove:function(k){if((this.popover_info&&this.popover_info.is_disabled)||!this.hover_bounds||b.isEmpty(this.hover_bounds)){return}var l=!(this.hover_bounds.left<=k.pageX&&k.pageX<=this.hover_bounds.right),j=!(this.hover_bounds.top<=k.pageY&&k.pageY<=this.hover_bounds.bottom);var i=e(k.target).hasClass("icon_close");if(l||j||i){this.animate_out()}},on_touch_open:function(i){i.preventDefault();i.stopPropagation();(this.is_open)?this.animate_out():this.on_mouseover(i)},on_touch_close:function(i){this.on_mousemove(i.originalEvent)},log_impression:function(i){a.Events.trigger("Capture:push","tumblelog_popover","impressions",{post_type:(this.current_data.following)?"recent":"highlighted",cached:(i)?true:false})}});a.TumblelogPopover=f})(jQuery,_,Tumblr,Backbone);
/*! scripts/ghostlist.js */
(function(o,e,d){function m(p){return(p!==null&&p!==undefined)?(("length" in p)?p:[p]):[]}function i(p){if(p&&typeof p.then==="function"){return p}else{if(typeof p==="function"){return function(){return i(p.apply(this,arguments))}}else{return e.Deferred()[p===false?"reject":"resolve"](p).promise()}}}function f(p,q){return o.compact(o.map(m(q),function(r){return n(p,r)}))}function n(p,r){var q;return(q=r.parentNode)?((q!==p)?n(p,q):r):false}var a=(function(){var s="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";function r(u){return(u.nodeName==="IMG")?[u]:o.toArray(u.getElementsByTagName("img"))}function q(u){var v=u.src;if(v&&v!==s){u.src=s;return{img:u,src:v}}}function p(u){return(u.img.src=u.src,u.img)}return function t(u){var v=o.chain(m(u)).map(r).flatten().map(q).compact().value();return(v.length)?o.partial(o.map,v,p):o.noop}})();var h=(function(){function r(t){var s=o.toArray(t.querySelectorAll("[data-background-image]"));t.getAttribute("data-background-image")&&s.push(t);return s}function q(t){var s=t.getAttribute("data-background-image");if(s){t.style.backgroundImage="url("+s+")";t.removeAttribute("data-background-image");return t}}return function p(s){return o.chain(m(s)).map(r).flatten().map(q).compact().value()}})();function j(s,q){var r=q.options.onBeforeAttach;var p=q.options.onAfterAttach;return o.map(s,function(u){var v=e.data(u);if(v.exclude){return u}if(!v.reattach){return u}r.call(q,u,v).then(function t(){v.reattach();v.reattach=null;p.call(q,u,v)})})}function c(r,p){var q=p.options.onViewable;o.each(r,function(s){var t=e.data(s);if(t.exclude){return}if(t.promise&&t.promise.state&&t.promise.state()==="pending"){return s}q.call(p,s,t,h)})}function b(t,q){var s=q.options.styles;var p=q.options.onBeforeDetach;var r=q.options.onAfterDetach;return o.chain(t).map(function(v){var w=e.data(v);if(w.exclude){return v}if(w.promise&&w.promise.state&&w.promise.state()==="pending"){return v}(w.promise=p.call(q,v,w)).then(function x(y){w.reattach=l(v,s,(y==="hide"));w.promise=null;r.call(q,v,w)},function u(){w.promise=null});return v}).tap(function(){t=null}).value()}function l(u,w,t){var s=o.toArray(u.children);var p=(function(){var x=o.pick(u.style,o.keys(w));o.extend(u.style,w,{height:e(u).height()+"px",width:e(u).width()+"px"});return function(){o.extend(u.style,x,{height:"",width:""})}})();var r=o.map(s,t?function(y){var x=y.style.display;y.style.display="none";return function(){y.style.display=x;return y}}:function(x){u.removeChild(x);return function(){u.appendChild(x);return x}});var v=a(s);s=null;w=null;return function q(){v();p();o.each(r,function(x){x()})}}function k(A){var B=-(A.windowHeight*this.options.PAGES_ABOVE);var w=A.windowHeight+(A.windowHeight*this.options.PAGES_BELOW);var q=this.container.children;var r=[];var u=(A.windowScrollY/A.documentHeight);(u>=0)||(u=0);(u<=1)||(u=1);var x=Math.floor(q.length*u);var t;var p;var y;t=x;while((t>=0)&&(p=q[t--])&&(y=p.getBoundingClientRect())&&(B<y.bottom)){if(p.nodeType!==1){continue}if(y.top<w){r.push(p)}}t=x+1;while((p=q[t++])&&(y=p.getBoundingClientRect())&&(y.top<w)){if(p.nodeType!==1){continue}if(B<y.bottom){r.push(p)}}var z=o.difference(this.attached,r);if(z.length){b(z,this)}var v=o.intersection(r,this.detached);if(v.length){j(v,this)}var s=o.difference(r,this.attached);if(s.length){c(s,this)}this.detached=o.without.apply(null,[this.detached].concat(v)).concat(z);this.attached=r}function g(q){var p=e(q.container).get(0);if(!p){throw"GhostList: Bad container form."}if(q.eventor){q.eventor.on("DOMEventor:flatscroll",o.bind(k,this))}else{throw"GhostList depends on DOMEventor:flatscroll."}this.container=p;this.attached=[];this.detached=[];this.options={styles:q.styles||{},onBeforeDetach:i(q.onBeforeDetach||o.noop),onAfterDetach:q.onAfterDetach||o.noop,onBeforeAttach:i(q.onBeforeAttach||o.noop),onAfterAttach:q.onAfterAttach||o.noop,onViewable:q.onViewable||o.noop,PAGES_ABOVE:(q.pages&&q.pages[0]!==undefined)?q.pages[0]:1,PAGES_BELOW:(q.pages&&q.pages[1]!==undefined)?q.pages[1]:1};if(o.isFunction(q.initialize)){q.initialize.call(this)}}g.prototype={exclude:function(p){return o.map(f(this.container,p),function(q){return(e.data(q,"exclude",true),q)})},unexclude:function(p){return o.map(f(this.container,p),function(q){return(e.data(q,"exclude",false),q)})},clean:function(){},remove:function(){},relayout:function(){}};d.GhostList=g})(_,jQuery,Tumblr);
/*! scripts/fast_dashboard.js */
(function(b,c,a){Tumblr.Flags("fast_dashboard")(function(){c(function(){a.fastDashboard=new Tumblr.GhostList({container:"#posts",pages:[1,2],eventor:Tumblr.Events,styles:{backgroundColor:"#ffffff",borderRadius:"6px"},initialize:function(){this.exclude(this.container.querySelector("#new_post_buttons"))},onBeforeDetach:function(){return"hide"},onAfterDetach:function(){},onBeforeAttach:function(){},onAfterAttach:function(){}})})})})(_,jQuery,Tumblr);
/*! scripts/application/keycommands.js */
(function(b,a){var c=Backbone.View.extend({el:"body",post_types:["text","photo","quote","link","chat","audio","video"],suspended:false,suspended_exceptions:[],last_key_code:0,mouseout_id:null,events:{keydown:"keydown",keyup:"keyup","click .post_tab_switching .tab_post_type":"click_tab_switch","mouseover .post_tab_switching .tab_post_type":"mouseover_tab_switch","mouseout .post_tab_switching .tab_post_type":"mouseout_tab_switch","click .post_tab_switching":"dismiss_fast_compose"},dismiss_fast_compose:function(d){if(this.post_keying){this.post_keys({toggle:"cancel"})}if(this.tab_switching){this.blog_switcher({toggle:"cancel"})}},click_tab_switch:function(d){this.post_keys({toggle:"stop"})},mouseover_tab_switch:function(d){window.clearTimeout(this.mouseout_id);this.post_keys({toggle:"start",pos:d.currentTarget.attributes["data-index"].value})},mouseout_tab_switch:function(d){this.mouseout_id=window.setTimeout(_.bind(function(){this.post_keys({toggle:"clear"})},this),250)},initialize:function(){this.logged_in=(!b(document.body).hasClass("logged_out"));this.auto_paginate=Tumblr.auto_paginate||false;this.animate_scroll=(Tumblr.animate_scroll!==undefined)?Tumblr.animate_scroll:false;this.scroll_speed=100;this.scroll_offset=7;this.pressed_keys=[];this.current_post=null;if(!Tumblr.enable_dashboard_key_commands){this.suspend()}this.blog_switcher_detection();this.is_xbox=Tumblr.Flags("is_xbox")(true,false);if(this.is_xbox){this.animate_scroll=false}},suspend:function(d){this.suspended=true;this.suspended_exceptions=d||[]},resume:function(){this.suspended=false;this.suspended_exceptions=[]},left:function(){if(!this.auto_paginate&&!b("#tumblr_lightbox").length){var d=b("#previous_page_link").attr("href");if(d){location.href=d}}},right:function(){if(!this.auto_paginate&&!b("#tumblr_lightbox").length){var d=b("#next_page_link").attr("href");if(d){location.href=d}}},next:function(d){if(d>(this.current_position+2)&&(d<this.go_to_position||!this.go_to_position)){Tumblr.Popover.hide_all();this.go_to_position=d}},previous:function(d){if(d<(this.current_position-2)&&d>this.go_to_position){Tumblr.Popover.hide_all();this.go_to_position=d}},check_offset:function(d){return(Math.abs(d-this.current_position)<2)},update_post_positions:function(){var d={};b("#posts .post[data-post-id]").each(function(){var e=b(this);var f=this.id;var g=e.closest(".post_container");if(!g.length){return}d[f]=g.offset().top});this.post_positions=d},get_parse_params:function(d){var e=window.location.pathname.split("/");e.shift();if(e[0]==="tagged"){return"/new/"+d+"?post[tags]="+e[1]}else{return"/new/"+d}},create_new:function(f){if(typeof Tumblr.PostForms=="object"){var d=b("#new_post_label_"+f);var e=d.length?d.attr("href"):this.get_parse_params(f);var g=Tumblr.PostForms.endpoints_to_types[f];var h=Tumblr.PostForms.parse_url_params(e);h.detached=true;Tumblr.PostForms.create({type:g,attach_to:"body",detached:true,mode:"index"},h)}else{document.location.href="/new/"+f;this.suspend()}},like:function(e){var d=b("#"+e);var f=d.find(".post_control.like");var g=d.data("post-id");if(f.length&&g){Tumblr.Events.trigger("post:like",g,"keyboard")}},notes:function(f){var e=b("#"+f);var d=e.find(".post_notes_label");if(d.length<1||d.find(".note_link_current").text()===""){return}var g=d.offset().top-500,h;if(e.find(".post_notes .popover").length>0&&g>e.offset().top){b("html,body").animate({scrollTop:g},200,function(){if(!h){d.trigger("click")}h=true})}else{d.trigger("click")}},reblog:function(d){var e=b("#"+d).find(".post_control.reblog");if(e.length){e.trigger("click")}},elevate:function(){var d=window.pageYOffset||(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;if(d>=1500){b("html, body").stop(true).animate({scrollTop:0},"slow")}},play:function(g,i){var d=b("#"+g),h=d.data("type");if(h=="video"){var f=d.find("iframe.tumblr_video_iframe");var j=d.find(".retro_video_preview");if(f.length>0){f[0].contentWindow.postMessage("toggle",f.attr("data-origin"));f[0].contentWindow.focus()}else{if(j.length>0){b(".big_play_button",j).click();i.preventDefault()}}}},fast_reblog:function(f,g,e){var h=b("#tumblr_form_key").attr("content"),d=b("#"+f),i=d.find(".post_control.reblog:not(.reblogged)");if(i.length&&this.check_offset(g)){Tumblr.Events.trigger("post:fastreblog",b("#"+f).data("post-id"),e)}},show_plexi:function(){if(Tumblr.Plexi.findByToken("body-plexi")){this.body_plexi=Tumblr.Plexi.findByToken("body-plexi")}if(!this.body_plexi){this.body_plexi=new Tumblr.Plexi({token:"body-plexi"});this.body_plexi.create(document.body,{insertAt:"top",cssClass:"color"})}this.body_plexi.show({transition_class:"fast"})},hide_plexi:function(){if(Tumblr.Plexi.findByToken("body-plexi")){this.body_plexi=Tumblr.Plexi.findByToken("body-plexi")}if(this.body_plexi){this.body_plexi.hide()}},post_keys:function(g){g.toggle=g.toggle||null;g.shift=g.shift||null;g.pos=g.pos||null;if(this.tab_switching){return}var e=b("#post_tab_switching");if(!e.length){return}var f=e.find(".tab_post_type");if(g.toggle=="cancel"){if(!this.creating_new){this.hide_plexi()}this.creating_new=false;e.removeClass("active");clearTimeout(this.show_timeout);clearTimeout(this.fade_timeout);this.cancel_timeout=setTimeout(function(){e.addClass("inactive undimmed")},50);this.post_keying=false;this.post_tab_index=undefined;return}if(g.toggle=="clear"){this.post_tab_index=undefined;f.removeClass("selected loading")}if(g.toggle=="stop"){var d=null;if(this.post_tab_index!==undefined){d=this.post_types[this.post_tab_index]}this.post_tab_index=undefined;if(d){this.creating_new=true;this.create_new(d)}else{this.hide_plexi()}this.post_keys({toggle:"cancel"});return}if(g.toggle=="init"){this.show_plexi();clearTimeout(this.cancel_timeout);clearTimeout(this.fade_timeout);setTimeout(function(){f.removeClass("selected loading");e.removeClass("inactive");e.addClass("active");this.post_keys({toggle:"start"})}.bind(this),50);this.post_keying=true;return}if(g.toggle=="start"){clearTimeout(this.show_timeout);if(g.pos&&(g.pos-1==this.post_tab_index)){return}setTimeout(function(){e.removeClass("undimmed");f.removeClass("selected loading");if(this.post_tab_index===undefined){this.post_tab_index=g.pos?g.pos-1:0}else{this.post_tab_index=g.pos?g.pos-1:(this.post_tab_index+((g.shift)?-1:1));if(this.post_tab_index>=7){this.post_tab_index=0}if(this.post_tab_index<0){this.post_tab_index=6}}e.addClass("active");this.tab_current_post_type=f.eq(this.post_tab_index);this.tab_current_post_type.addClass("selected")}.bind(this),1);return}},blog_switcher:function(h){h.toggle=h.toggle||null;h.shift=h.shift||null;if(this.post_keying){return}this.tab_switching=(h.toggle.length)?true:false;var e=b("#tab_switching");if(!e.length){return}var g=e.find(".tab_blog");g.removeClass("selected loading");if(h.toggle=="cancel"){this.tab_switching=false;this.tab_index=undefined;this.hide_plexi();e.removeClass("active");setTimeout(function(){e.addClass("inactive")},500);return}if(h.toggle=="stop"){this.tab_index=undefined;var d=this.tab_current_blog.find("a.blog_name").attr("href");if(!document.location.href.match(d)){this.tab_current_blog.addClass("loading");var f=new Spinner(Tumblr.spinners.white).spin();this.tab_current_blog.append(f.el);document.location.href=d;this.suspend();b(window).on("keydown",function(){return false})}else{this.blog_switcher({toggle:"cancel"})}return}if(h.toggle=="start"){e.removeClass("inactive");this.show_plexi();setTimeout(_.bind(function(){if(this.tab_index===undefined){this.tab_index=1}else{this.tab_index=this.tab_index+((h.shift)?-1:1);if(this.tab_index>=g.length){this.tab_index=0}if(this.tab_index<0){this.tab_index=g.length-1}}e.addClass("active");this.tab_current_blog=g.eq(this.tab_index);this.tab_current_blog.addClass("selected")},this),50);return}},blog_switcher_detection:function(){if(window.devicePixelRatio){if(escape(navigator.javaEnabled.toString())=="function%20javaEnabled%28%29%20%7B%20%5Bnative%20code%5D%20%7D"){b("html").addClass("tab_switcher_chrome")}else{if(escape(navigator.javaEnabled.toString())!="function%20javaEnabled%28%29%20%7B%20%5Bnative%20code%5D%20%7D"){b("html").addClass("tab_switcher_safari")}}}},match_modifier_keys:function(h,d){if(typeof d=="string"){d=[d]}var f={shift:_.indexOf(d,"shift")>-1,ctrl:_.indexOf(d,"ctrl")>-1,alt:_.indexOf(d,"alt")>-1,meta:_.indexOf(d,"meta")>-1};var g={shift:h.shiftKey,ctrl:h.ctrlKey,alt:h.altKey,meta:h.metaKey};return _.isEqual(f,g)},keydown:function(k){var f=k.charCode?k.charCode:k.keyCode;if(this.suspended&&_.indexOf(this.suspended_exceptions,f)<0){return}if(this.animating){return}var l=k?k.target:window.event.srcElement;if(b(l).is("input:focus")){return}this.update_post_positions();this.current_position=(window.pageYOffset||(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop)+7;this.go_to_position=0;var n=(k.shiftKey||k.ctrlKey||k.altKey||k.metaKey),j;this.pressed_keys[f]=1;if((this.post_keying||this.tab_switching)&&!(k.ctrlKey||k.altKey||k.metaKey)){var h=[74,75,190,76,78,82,32,38,40,33,34,35,36];if(_.indexOf(h,f)>=0){return false}}if(f==37){this.left()}else{if(f==39){this.right()}else{if(!n){for(j in this.post_positions){var g=j,m=this.post_positions[j],d=b;if(f==74){this.next(m)}if(f==75){this.previous(m)}if(this.is_xbox&&f==40){this.next(m);k.preventDefault()}if(this.is_xbox&&f==38){this.previous(m);k.preventDefault()}if(f==190){this.elevate();k.preventDefault();return false}if(this.check_offset(m)){this.current_post=b("#"+g);if(f==76){this.like(g)}if(f==78){this.notes(g)}if(f==82){this.reblog(g)}if(f==32){this.play(g,k);if(this.current_post.length){if(this.current_post.attr("data-type")=="video"&&this.current_post.attr("data-direct-video")){return false}}return true}}}if(f==74&&!this.go_to_position){this.go_to_position=b(document).height()}if(this.animate_scroll){if(this.go_to_position&&!this.animating){this.animating=true;b("html,body").stop().animate({scrollTop:this.go_to_position-this.scroll_offset},this.scroll_speed,_.bind(function(){this.animating=false},this))}}else{if(this.go_to_position){window.scrollTo(0,this.go_to_position-this.scroll_offset)}}}}}if(navigator.platform=="MacIntel"){if(f==67&&this.post_keying){this.post_keys({toggle:"start",shift:k.shiftKey})}else{if(f==67&&this.match_modifier_keys(k,"alt")){this.post_keys({toggle:"init",shift:k.shiftKey})}}if(f==13&&this.post_keying){this.post_keys({toggle:"stop"});return false}if(f==27&&this.post_keying){this.post_keys({toggle:"cancel"});return false}if(f==37&&this.post_keying){this.post_keys({toggle:"start",shift:true});return false}if(f==39&&this.post_keying){this.post_keys({toggle:"start"});return false}if(f==9&&this.post_keying){this.post_keys({toggle:"start",shift:k.shiftKey});return false}if(k.altKey&&f==9){this.blog_switcher({toggle:"start",shift:k.shiftKey});return false}if(k.altKey&&f==192){this.blog_switcher({toggle:"start",shift:true});return false}if(k.altKey&&f==27&&this.tab_switching){this.blog_switcher({toggle:"cancel"});return false}if(k.altKey&&f==37&&this.tab_switching){this.blog_switcher({toggle:"start",shift:true});return false}if(k.altKey&&f==39&&this.tab_switching){this.blog_switcher({toggle:"start"});return false}if(k.altKey&&f==82&&this.logged_in){for(j in this.post_positions){this.fast_reblog(j,this.post_positions[j])}return false}if(k.altKey&&f==69&&this.logged_in){for(j in this.post_positions){this.fast_reblog(j,this.post_positions[j],true)}return false}}if(navigator.platform=="Win32"){if(this.pressed_keys[67]&&this.post_keying){this.post_keys({toggle:"start",shift:k.shiftKey})}else{if(this.pressed_keys[90]&&this.pressed_keys[67]){this.post_keys({toggle:"init",shift:k.shiftKey})}}if(this.pressed_keys[13]&&this.post_keying){this.post_keys({toggle:"stop"});return false}if(this.pressed_keys[27]&&this.post_keying){this.post_keys({toggle:"cancel"});return false}if(this.pressed_keys[37]&&this.post_keying){this.post_keys({toggle:"start",shift:true});return false}if(this.pressed_keys[39]&&this.post_keying){this.post_keys({toggle:"start"});return false}if(this.pressed_keys[9]&&this.post_keying){this.post_keys({toggle:"start",shift:k.shiftKey});return false}if(this.pressed_keys[90]&&this.pressed_keys[9]){this.blog_switcher({toggle:"start",shift:k.shiftKey});return false}if(this.pressed_keys[90]&&this.pressed_keys[27]&&this.tab_switching){this.blog_switcher({toggle:"cancel"});return false}if(this.pressed_keys[90]&&this.pressed_keys[192]){this.blog_switcher({toggle:"start",shift:true});return false}if(this.pressed_keys[90]&&this.pressed_keys[37]&&this.tab_switching){this.blog_switcher({toggle:"start",shift:true});return false}if(this.pressed_keys[90]&&this.pressed_keys[39]&&this.tab_switching){this.blog_switcher({toggle:"start"});return false}if(k.shiftKey&&f==82&&this.logged_in){for(j in this.post_positions){this.fast_reblog(j,this.post_positions[j])}return false}if(k.shiftKey&&f==69&&this.logged_in){for(j in this.post_positions){this.fast_reblog(j,this.post_positions[j],true)}return false}}},keyup:function(g){var f=g.charCode?g.charCode:g.keyCode,d=(g.shiftKey||g.ctrlKey||g.altKey||g.metaKey);this.pressed_keys[f]=0;if(navigator.platform=="MacIntel"){if(!g.altKey&&this.tab_switching){this.blog_switcher({toggle:"stop"});return false}}if(navigator.platform=="Win32"){if(!this.pressed_keys[90]&&this.tab_switching){this.blog_switcher({toggle:"stop"});return false}}}});a.KeyCommandsConstructor=c})(jQuery,Tumblr);
/*! scripts/posts.js */
(function(e,p,b,o){var f=Tumblr.Features;var h=f("is_logged_in");var n=b.View.extend({el:"#posts",initialize:function(){this.collection=Tumblr.Posts;this.postViews=[];this.form_key=e("#tumblr_form_key").attr("content");this.createPosts();Tumblr.AutoPaginator.on("after",this.createPosts,this);Tumblr.Events.on("posts:load",this.createPosts,this);Tumblr.Events.on("post:like",this.likePostById,this);Tumblr.Events.on("post:fastreblog",this.fastReblogById,this)},createPosts:function(){o.forEach(this.$el.find(".post:not(.new_post_buttons):not([data-view-exists])"),this.createPost,this)},createPostModelFromEl:function(t){return new r({id:t.attr("data-post-id"),type:t.attr("data-type"),root_id:t.attr("data-root-id"),tumblelog:t.attr("data-tumblelog-name"),tumblelog_key:t.attr("data-tumblelog-key"),reblog_key:t.attr("data-reblog-key"),is_mine:t.hasClass("is_mine"),accepts_answers:(t.attr("data-accepts-answers")==="1"),following_tumblelog:(t.attr("data-following-tumblelog")==="1"),reblogged:false,liked:t.find(".post_control.like").hasClass("liked"),form_key:this.form_key,sponsored:(t.attr("data-sponsored")==="1"),placement_id:t.attr("data-placement-id")||false,featured_tags:(t.attr("data-featured-tags")||"").split(","),reblog_source:t.find(".reblog_source [data-tumblelog-popover]").data("tumblelog-popover")})},createPost:function(w){var t=e(w);var v=this.createPostModelFromEl(t);var u=h(function(){var x=(v.get("type")==="fan_mail")?g:k;return new x({el:t,model:v})},function(){return new j({el:t,model:v})});this.collection.add(v);this.postViews.push(u);t.attr("data-view-exists",true);return u},likePostById:function(u,t){t=t||"mouse";this.collection.get(u).like(t)},fastReblogById:function(u,t){this.collection.get(u).fastReblog(t)}});var i=b.Collection.extend({model:r,initialize:function(){this.on("change:liked",this.updateLikeStatus,this);this.on("ignore:success",this.dismiss,this);this.on("unfollow:success",this.dismiss,this)},updateLikeStatus:function(t,u){var v=this.whereBy({liked:!u,root_id:t.get("root_id")});v.invoke("set",{liked:u});if(t.get("liked")){v.invoke("trigger","like:success")}else{v.invoke("trigger","unlike:success")}},dismiss:function(t){this.whereBy({tumblelog:t.get("tumblelog"),sponsored:false}).invoke("dismiss")},whereBy:function(t){return new i(this.where(t))}});var r=b.Model.extend({initialize:function(t){this.tumblelog=new Tumblr.Models.Tumblelog(o({name:t.tumblelog,ignoring:false,sponsor:t.sponsored,following:!!t.following_tumblelog,}).omit(o.isUndefined).omit(o.isNull).value());var u=t.reblog_source;if(u&&u.name){this.reblog_tumblelog=new Tumblr.Models.Tumblelog(o({name:u.name,ignoring:false,following:!!u.following,}).omit(o.isUndefined).omit(o.isNull).value())}},getLikeSource:function(t){t=t||"like";var u="LIKE_";switch(t){case"unlike":u="UNLIKE_";break;case"reply":u="REPLY_";break;case"ignore":u="IGNORE_"}var v=location.pathname;if(v.match(/^\/dashboard/)){return u+"SOURCE_DASHBOARD"}if(v.match(/^\/tagged/)){return u+"SOURCE_TAG_PAGE"}if(v.match(/^\/likes/)){return u+"SOURCE_LIKES_PAGE"}if(v.match(/^\/inbox/)){return u+"SOURCE_INBOX"}if(v.match(/^\/search/)){return u+"SOURCE_SEARCH_RESULTS_PAGE"}return u+"SOURCE_UNKNOWN"},likePayload:function(u,t){u=u||"mouse";t=t||"LIKE_SOURCE_UNKNOWN";return{id:this.get("id"),key:this.get("reblog_key"),method:u,source:t,placement_id:this.get("placement_id")||false}},like:function(t){if(this.get("is_mine")){return}this.trigger("like:success",this);if(!this.get("liked")){this.set("liked",true);Tumblr.like(this.likePayload(t,this.getLikeSource("like"))).error(o.bind(this.trigger,this,"like:failure"))}},xhr_request:function(t,w,u){w=o.extend(w,{form_key:this.get("form_key")});var v=e.ajax({data:JSON.stringify(w),type:"POST",url:t});v.done(o.bind(function(x){if(u[200]){u[200].call(this,x)}},this));v.fail(o.bind(function(x){if(u[x.status]){u[x.status].call(this,x.status)}},this))},unlike:function(){this.set("liked",false);this.trigger("unlike:success",this);Tumblr.unlike(this.likePayload("mouse",this.getLikeSource("unlike"))).error(o.bind(this.trigger,this,"unlike:failure"))},toggleLike:function(){if(this.get("liked")){this.unlike()}else{this.like()}},reblog:function(){if(this.get("reblogged")){return}this.set("reblogged",true);return e.ajax({url:"/fast_reblog",type:"post",data:{reblog_key:this.get("reblog_key"),reblog_post_id:this.get("id"),form_key:e("#tumblr_form_key").attr("content")},success:function(){this.set("reblogged",true)}.bind(this),error:function(){this.set("reblogged",false)}.bind(this)})},fastReblog:function(t){t=t||false;this.trigger("fastreblog:success",t);this.set("reblogged",true);return e.ajax({url:"/fast_reblog",type:"post",data:{reblog_key:this.get("reblog_key"),reblog_post_id:this.get("id"),form_key:e("#tumblr_form_key").attr("content"),queue:t},success:o.bind(function(){this.set("reblogged",true)},this),error:o.bind(function(){this.set("reblogged",false)},this)})},reply:function(u){var t=Tumblr.reply({reply_text:u,post_id:this.get("id"),tumblelog:this.get("tumblelog"),tumblelog_key:this.get("tumblelog_key"),source:this.getLikeSource("reply")});t.done(function(){this.trigger("replied")}.bind(this));return t},destroy:function(){var t={post_id:this.get("id"),channel_id:this.get("tumblelog")};this.xhr_request("/svc/post/delete",t,{200:o.bind(this.trigger,this,"destroy:success"),401:o.bind(this.trigger,this,"destroy:failure"),403:o.bind(this.trigger,this,"destroy:failure"),500:o.bind(this.trigger,this,"destroy:failure"),})},toggle_spam_tumblelog:function(){var t=e.ajax({url:"/spam/toggle",type:"post",data:{tumblelog:this.get("tumblelog"),form_key:this.get("form_key")}});t.fail(o.bind(this.trigger,this,"spam_toggle:failure"));t.done(o.bind(this.trigger,this,"spam_toggle:success"));return t},toggle_nsfw_tumblelog:function(){var t=e.ajax({url:"/nsfw/toggle",type:"post",data:{tumblelog:this.get("tumblelog"),form_key:this.get("form_key")}});t.fail(o.bind(this.trigger,this,"nsfw_toggle:failure"));t.done(o.bind(this.trigger,this,"nsfw_toggle:success"));return t},toggle_adult_tumblelog:function(){var t=e.ajax({url:"/adult/toggle",type:"post",data:{tumblelog:this.get("tumblelog"),form_key:this.get("form_key")}});t.fail(o.bind(this.trigger,this,"adult_toggle:failure"));t.done(o.bind(this.trigger,this,"adult_toggle:success"));return t},toggle_follow:function(v){var t;var u={tumblelog:this.get("tumblelog"),source:v};if(this.get("following_tumblelog")){this.set("following_tumblelog",false);t=Tumblr.unfollow(u);t.done(o.bind(this.trigger,this,"unfollow:success",this));t.fail(o.bind(this.trigger,this,"unfollow:failure",this))}else{this.set("following_tumblelog",true);t=Tumblr.follow(u);t.done(o.bind(this.trigger,this,"follow:success",this));t.fail(o.bind(this.trigger,this,"follow:failure",this))}return t},fan_mail:function(){if(o.isObject(Tumblr.FanMail)){var t={href:Tumblr.FanMail.make_url_from_tumblelog(this.get("tumblelog"))};Tumblr.FanMail.show(t)}},publish:function(){var t=e.ajax({url:"/publish",type:"post",data:{form_key:this.get("form_key"),id:this.get("id")}});t.fail(o.bind(this.trigger,this,"publish:failure"));t.done(o.bind(this.trigger,this,"publish:success"))},promote:function(t){var u=e.ajax({url:"/svc/promote",type:"post",data:{tag:t,post_id:this.get("id"),form_key:this.get("form_key"),reblog_key:this.get("reblog_key"),tumblelog_name:this.get("tumblelog")}});u.fail(o.bind(this.trigger,this,"promote:failure"));u.done(function(v){if(v&&v.status&&v.status==="failure"){this.trigger("promote:failure",v.error)}else{this.trigger("promote:success",t)}}.bind(this));return u},unpromote:function(t){var u=e.ajax({url:"/svc/unpromote",type:"post",data:{tag_id:t,post_id:this.get("id"),form_key:this.get("form_key"),reblog_key:this.get("reblog_key"),tumblelog_name:this.get("tumblelog")}});u.fail(o.bind(this.trigger,this,"unpromote:failure"));u.done(o.bind(this.trigger,this,"unpromote:success"));return u},follow:function(u,t){u=u||this.get("tumblelog");Tumblr.follow({tumblelog:u,source:t,placement_id:this.get("placement_id")||false},{success:e.proxy(function(){Tumblr.Events.trigger("follow_tumblelog",{tumblelog:u});this.trigger("follow:success",this)},this),error:e.proxy(function(){this.trigger("follow:failure",this)},this)})},ignore:function(w){w=w||this.get("tumblelog");var v=Tumblr.ignore({tumblelog:w,source:this.getLikeSource("ignore")});var u=w.match(/post\_id\:/);var t=!u;v.done(o.bind(function(){Tumblr.Events.trigger("block_tumblelog",{tumblelog:w,can_report:t});if(w===this.get("tumblelog")){this.trigger("ignore:success",this)}else{this.dismiss()}},this));v.fail(o.bind(this.trigger,this,"ignore:failure"))},queue:function(){var t=e.ajax({url:"/publish",type:"post",data:{form_key:this.get("form_key"),id:this.get("id"),queue:"queue"}});t.fail(o.bind(this.trigger,this,"queue:failure"));t.done(o.bind(this.trigger,this,"queue:success"))},removeSource:function(){var t=e.ajax({url:"/remove_app_attribution",type:"post",dataType:"text",data:{post_id:this.get("id"),tumblelog_id:this.get("tumblelog"),form_key:this.get("form_key")}});t.done(o.bind(this.trigger,this,"remove_source:success"));t.fail(o.bind(this.trigger,this,"remove_source:failure"));return t},dismiss:function(){this.trigger("dismiss",this)},approve:function(t){var v={form_key:this.get("form_key"),id:this.get("id")};if(t){v.queue=true}var u=e.ajax({url:"/approve_submission/"+this.get("id"),type:"post",dataType:"text",data:v});u.fail(o.bind(this.trigger,this,"approve:failure"));u.done(o.bind(this.trigger,this,"approve:success"));return u},deny:function(){var t=e.ajax({url:"/deny_submission",type:"post",dataType:"text",data:{pid:this.get("id"),form_key:this.get("form_key")}});t.fail(o.bind(this.trigger,this,"deny:failure"));t.done(o.bind(this.trigger,this,"deny:success"));return t},answer:function(u){var t=e.ajax({url:"/answer",type:"post",data:{form_key:this.get("form_key"),post_id:this.get("id"),tumblelog:this.get("tumblelog"),key:this.get("tumblelog_key"),answer_text:u}});t.fail(o.bind(this.trigger,this,"answer:failure"));t.done(o.bind(this.trigger,this,"answer:success"));return t}});var c=Tumblr.PopoverWithForm.extend({template:"#post_reply_form",events:{"input textarea":"check_form_state","keydown textarea":"on_keydown"},initialize:function(t){this.options=t||{};var u=o.template(e(this.template).html());this.$el.html(u());this.submit_button=this.$("button");this.textarea=this.$("form textarea");this.check_form_state();this.is_empty=true;o.extend(this.options,{on_hide:this.on_hide,on_show:this.on_show});Tumblr.PopoverWithForm.prototype.initialize.apply(this,arguments)},on_keydown:function(t){this.check_form_state();if(!this.is_empty&&(t.ctrlKey||t.metaKey)&&t.which===13){t.preventDefault();this.submit_form()}},check_form_state:function(){this.is_empty=(this.textarea[0].value.length===0);this.submit_button.attr("disabled",this.is_empty)},on_show:function(){this.position()},on_hide:function(){this.$el.removeClass("active")},submit_form:function(u){if(u){u.preventDefault()}this.submit_button.attr("disabled",true);this.submit_button.html(this.submit_button.data("label-loading"));var t=this.model.reply(this.textarea.val());t.done(o.bind(this.on_success,this))},on_success:function(){this.model.set("replied_to",true);this.trigger("success");this.$el.find("button").attr("disabled",false);this.$el.find("textarea").val("");this.hide();this.submit_button.html(this.submit_button.data("label"))}});var a=Tumblr.Popover.extend({events:{"click .post_control.delete":"delete","click .post_control.edit":"edit","click .post_control.queue":"queue"},initialize:function(t){this.options=t||{};o.extend(this.options,{on_show:this.on_show,disable_auto_show:true});Tumblr.Popover.prototype.initialize.apply(this,arguments)},"delete":function(){this.hide();this.$el.removeClass("active")},edit:function(t){this.hide();this.$el.removeClass("active");this.trigger("action:edit");if(Tumblr.PostForms){t.preventDefault()}},queue:function(){this.hide()},on_show:function(){this.position()}});var d=b.View.extend({events:{"click .promote_post a":"promote","change select.promotable_tags":"promote_select"},button_count:5,initialize:function(){this.listenTo(this.model,"promote:success",this.update_tag_count);this.render()},render:function(){this.$el.html(this.template())},promote:function(v){var t=e(v.currentTarget);var u=this.model.promote(t.data("tag"));t.addClass("loading");u.always(t.removeClass.bind(t,"loading"));if(Tumblr.Popover){Tumblr.Popover.hide_all()}},update_tag_count:function(t){for(var u=0;u<window.promotable_tags.length;u++){if(window.promotable_tags[u].tag===t){window.promotable_tags[u].promote_diff-=1}}this.render()},promote_select:function(){if(Tumblr.Popover){Tumblr.Popover.hide_all()}},show:function(){this.$el.show();this.$el.removeClass("hidden")},hide:function(){this.$el.hide();this.$el.addClass("hidden")},template:function(){var t=o.compact(this.$el.data("promotion-warnings").split(";;"));var u="";u+="<ul>";u+='<li class="popover_sub_header promote_post_header">Promote</li>';if(window.promotable_tags.length>this.button_count){u+='<div class="promote_select_wrapper">';u+='<select class="popover_menu_item promotable_tags">';u+='<option value="">'+l10n_str.promote_this_post_in+"</option>"}o.each(window.promotable_tags,function(v,x){var w=(v.promote_diff<0)?"":" ("+v.promote_diff+")";if(v.promote_diff===0){t.push(l10n_str.promote_warning_none.replace("%1$s",v.title))}if(window.promotable_tags.length>this.button_count){u+='<option value="'+v.tag+'">'+window.promotable_tags[x].title+w+"</option>"}else{u+='<li class="popover_menu_item promote_post">';u+='<a data-tag="'+v.tag+'" href="#">';u+=window.promotable_tags[x].title+w;u+="</a>";u+="</li>"}},this);if(window.promotable_tags.length>this.button_count){u+="</select>";u+="</div>"}if(t.length){u+='<div class="promote_pane_warnings>';o.each(t,function(v){u+='<div class="warning">'+v+"</div>"});u+="</div>"}u+="</ul>";return u}});var s=Tumblr.Popover.extend({events:{"click .post_control.unpromote":"unpromote","click .post_control.remove_source":"remove_source"},initialize:function(t){this.options=t||{};o.extend(this.options,{on_show:this.on_show,on_hide:this.on_hide,disable_auto_show:true});if(window.promotable_tags&&window.promotable_tags.length){this.promote_tag_view=new d({el:this.$(".promote_pane"),model:this.model,tags:window.promotable_tags});this.promote_tag_view.show()}this.listenTo(this.model,"remove_source:failure",this.error);Tumblr.Popover.prototype.initialize.apply(this,arguments)},on_show:function(){this.position()},remove_source:function(){this.hide();this.model.removeSource()},on_hide:function(){},error:function(){Tumblr.Dialog.alert("Error removing source from this post")},promote:function(t){t.preventDefault();if(!(this.promote_tag_view instanceof d)){this.promote_tag_view=new d({el:this.$(".promote_pane"),model:this.model,tags:window.promotable_tags})}this.promote_tag_view.show()},unpromote:function(v){var t=e(v.currentTarget);var u=this.model.unpromote(t.data("tag"));t.addClass("loading");u.always(t.removeClass.bind(t,"loading"))},});var m=Tumblr.Popover.extend({initialize:function(t){this.options=t||{};o.extend(this.options,{on_show:this.on_show,on_hide:this.on_hide,disable_auto_show:false});this.listenTo(this.model,"nsfw_toggle:success",this.toggle_nsfw_class);this.listenTo(this.model,"adult_toggle:success",this.toggle_adult_class);this.listenTo(this.model,"spam_toggle:success",this.toggle_spam_class);this.listenTo(this.model,"unfollow:success",this.toggle_follow_class);this.listenTo(this.model,"follow:success",this.toggle_follow_class);this.$el.on("click",".user_menu_toggle_spam",o.bind(this.toggle_spam,this));this.$el.on("click",".user_menu_toggle_nsfw",o.bind(this.toggle_nsfw,this));this.$el.on("click",".user_menu_toggle_adult",o.bind(this.toggle_adult,this));this.$el.on("click",".user_menu_toggle_follow",o.bind(this.toggle_follow,this));this.$el.on("click",".fan_mail",o.bind(this.fan_mail,this));Tumblr.Popover.prototype.initialize.apply(this,arguments)},on_show:function(){this.position();this.$el.addClass("active")},on_hide:function(){this.$el.removeClass("active")},fan_mail:function(t){if(o.isObject(Tumblr.FanMail)){t.preventDefault();this.hide();this.model.fan_mail()}},toggle_spam:function(t){t.preventDefault();this.hide();this.model.toggle_spam_tumblelog()},toggle_nsfw:function(t){t.preventDefault();this.hide();this.model.toggle_nsfw_tumblelog()},toggle_adult:function(t){t.preventDefault();this.hide();this.model.toggle_adult_tumblelog()},toggle_follow:function(t){t.preventDefault();this.hide();this.model.toggle_follow("FOLLOW_SOURCE_DASHBOARD")},toggle_spam_class:function(){this.$(".user_menu_toggle_spam").toggleClass("is_spam")},toggle_nsfw_class:function(){this.$(".user_menu_toggle_nsfw").toggleClass("is_nsfw")},toggle_adult_class:function(){this.$(".user_menu_toggle_adult").toggleClass("is_adult")},toggle_follow_class:function(){this.$(".user_menu_toggle_follow").toggleClass("follow").toggleClass("unfollow")}});var k=b.View.extend({events:{"click .post_control.like:not(.liked)":"like","click .post_control.liked":"unlike","click .post_control.reblog":"reblog","click .post_control.reply":"reply","click .post_control.block":"ignore","click .post_control.publish":"publish","click .post_control.queue":"queue","click .post_control.queue_submission":"queue_submission","click .post_control.delete":"delete","click .post_control.approve":"approve","click .post_control.post_control_menu.creator":"creator_popover","click .post_control.post_control_menu.admin":"admin_popover","click .tumblelog_menu_button":"user_popover","touchend .tumblelog_menu":"user_popover","click .post_control.deny":"deny","click .note .follow":"follow","click .photo_reply_image_container":"photo_reply_click",'click .reblog_follow_button:not(".onboard")':"follow_reblog"},initialize:function(){this.controls={};this.controls.like=this.$el.find(".post_control.like");this.controls.reblog=this.$el.find(".post_control.reblog");this.note_count=this.$el.find(".note_count");this.tagsDraggable();if(this.model.get("accepts_answers")){this.setupAnswerForm()}this.like_heart_timeout=null;this.is_click_trigger=false;this.is_reblogged=false;this.listenTo(this.model,"like:success",o.bind(this.updateLikeStatus,this,true));this.listenTo(this.model,"unlike:success",o.bind(this.updateLikeStatus,this,false));this.listenTo(this.model,"like:success",o.bind(this.updateNoteCount,this,true));this.listenTo(this.model,"unlike:success",o.bind(this.updateNoteCount,this,false));this.listenTo(this.model,"destroy:success",this.destroy);this.listenTo(this.model,"dismiss",this.destroy);this.listenTo(this.model,"publish:success",this.destroy);this.listenTo(this.model,"queue:success",this.destroy);this.listenTo(this.model,"unpromote:success",this.destroy);this.listenTo(this.model,"promote:failure",this.alert);this.listenTo(this.model,"deny:success",this.destroy);this.listenTo(this.model,"approve:success",this.destroy);this.listenTo(this.model,"answer:success",this.answer);this.listenTo(this.model,"fastreblog:success",this.updateReblog);this.listenTo(this.model,"remove_source:success",this.hidePost);var t=this.model.reblog_tumblelog||this.model.tumblelog;if(t){t.on("change:following",this.updateReblogFollow,this)}if(Tumblr.Capture&&this.model.get("sponsored")){this.capture_web_instream=new Tumblr.Capture.WebInStream({el:this.$el})}this.current_link=true;this.less_link=false;this.more_link=false},edit:function(){if(!Tumblr.PostForms){return}Tumblr.PostForms.edit({type:this.model.get("type"),edit:true,channel_id:this.model.get("tumblelog"),post_id:this.model.get("id"),endpoint:this.model.get("type"),attach_to:this.$el,previous_content_selector:this.$(".post_wrapper"),adjust_offset:true})},"delete":function(u){u.preventDefault();var t=e(u.currentTarget).data("confirm");Tumblr.Dialog.confirm(t,o.bind(this.model.destroy,this.model))},deny:function(u){u.preventDefault();var t=e(u.currentTarget).data("confirm");Tumblr.Dialog.confirm(t,o.bind(function(){this.destroy();this.model.deny()},this))},approve:function(u){u.preventDefault();var t=e(u.currentTarget).data("confirm");Tumblr.Dialog.confirm(t,o.bind(this.model.approve,this.model,false))},queue:function(u){u.preventDefault();var t=e(u.currentTarget).data("confirm");Tumblr.Dialog.confirm(t,o.bind(this.model.queue,this.model))},queue_submission:function(u){u.preventDefault();var t=e(u.currentTarget).data("confirm");Tumblr.Dialog.confirm(t,o.bind(this.model.approve,this.model,true))},creator_popover:function(t){if(t.target!==t.currentTarget){return}var u=e(t.currentTarget);if(!(this.creatorPopover instanceof a)){this.creatorPopover=new a({model:this.model,el:e(t.target),on_hide:o.bind(function(){u.removeClass("active")},this)});this.creatorPopover.on("action:edit",o.bind(this.edit,this))}u.addClass("active");this.creatorPopover.show()},admin_popover:function(t){if(t.target!==t.currentTarget){return}if(!(this.adminPopover instanceof s)){this.adminPopover=new s({model:this.model,el:e(t.target)})}this.adminPopover.show()},user_popover:function(u){var t=(u.type==="touchend");if(t){u.preventDefault();u.stopPropagation();this.$el.off("click",".tumblelog_menu_button")}if(!(this.userPopover instanceof m)){var v=this.$(u.currentTarget);this.userPopover=new m({model:this.model,el:t?v:v.closest(".tumblelog_menu"),popover:t?v.find(".popover"):v.siblings(".popover")})}this.userPopover.show()},like:function(t){t.preventDefault();this.is_click_trigger=true;this.model.like("mouse")},unlike:function(t){t.preventDefault();this.is_click_trigger=true;this.model.unlike()},reply:function(t){var u=e(t.currentTarget);if(!(this.replyPopover instanceof c)){this.replyPopover=new c({model:this.model,el:u});this.replyPopover.on("success",function(){u.addClass("replied")});this.replyPopover.on("close",function(){u.removeClass("active")})}u.addClass("active");this.replyPopover.show()},publish:function(u){u.preventDefault();var t=e(u.currentTarget).data("confirm");Tumblr.Dialog.confirm(t,o.bind(this.model.publish,this.model))},reblog:function(t){if(t.altKey&&!this.model.reblogged){t.preventDefault();this.is_click_trigger=true;return this.fastReblog(t)}if(this.is_reblogged||!Tumblr.PostForms){return}t.preventDefault();this.is_click_trigger=true;Tumblr.PostForms.edit({type:this.model.get("type"),channel_id:this.model.get("tumblelog"),reblog_id:this.model.get("id"),endpoint:this.model.get("type"),detached:true,reblog:true,animate_from:this.$el,reblog_key:this.model.get("reblog_key"),previous_content_selector:null})},fastReblog:function(t){t.stopPropagation();t.preventDefault();if(!this.is_reblogged){this.model.fastReblog()}},follow:function(v){v.preventDefault();var u=e(v.currentTarget);var t=u.closest(".note");var w=t.data("tumblelog");t.addClass("is_following");this.model.follow(w)},follow_reblog:function(){var u=this.model.reblog_tumblelog||this.model.tumblelog;if(!u){return false}var v=this.$('.reblog_follow_button:not(".onboard")');v.addClass("active animated poof");var t=this;u.save_following({following:true},{source:(function(x,w){if(x==="dashboard_posts_likes"){w="FOLLOW_SOURCE_REBLOG_TAGGED"}if(x==="tagged_display"){w="FOLLOW_SOURCE_REBLOG_LIKES"}if(e("body").hasClass("tablet")){w="FOLLOW_SOURCE_REBLOG_TABLET"}return w})(document.body.id,"FOLLOW_SOURCE_REBLOG"),placement_id:this.model.get("placement_id")}).done(function(){v.addClass("final_state");if(t.capture_web_instream){t.capture_web_instream.track_follow(true)}}).fail(function(){Tumblr.Dialog.alert(l10n_str.ajax_error)});return false},ignore:function(u){u.preventDefault();var t=e(u.target).data("block")||this.model.get("tumblelog");var v=Tumblr.TumblelogActions.confirm_ignore({tumblelog:t,avatar_url:this.$(".post_avatar_link").attr("data-avatar-url")});v.done(o.bind(this.model.ignore,this.model,t))},hidePost:function(){this.$el.fadeOut("fast")},updateReblogFollow:function(t,u){if(t._previousAttributes.following==null||t._previousAttributes.following===u){return}if(u===false){this.$('.reblog_follow_button:not(".onboard")').removeClass("active animated poof final_state")}},updateReblog:function(t){this.is_reblogged=true;var v=e('<div class="post_reblog_poof post_poof"></div>'),u=this.controls.reblog;if(t){v.addClass("queue")}if(this.is_click_trigger){u.append(v)}else{if(this.$el.height()>e(window).height()){v.css("top",e(window).height()*0.5)}this.$el.append(v)}this.is_click_trigger=false;setTimeout(function(){v.fadeOut(200,function(){v.remove();u.addClass("reblogged");if(t){u.addClass("queued")}})},300);if(this.capture_web_instream){this.capture_web_instream.track_fast_reblog()}},updateLikeStatus:function(u){this.controls.like.toggleClass("liked",u);var t=e('<div class="post_animated_heart post_poof"><span class="heart_left"></span><span class="heart_right"></span></div>').toggleClass("unliked",!u);if(this.is_click_trigger){this.controls.like.append(t)}else{if(this.$el.height()>e(window).height()){t.css("top",e(window).height()*0.5)}if(e(".post_animated_heart").length>0){var v=0.2+(Math.random()*0.6);t.css("left",this.$el.width()*v)}this.$el.append(t)}this.is_click_trigger=false;setTimeout(function(){t.fadeOut(200,function(){t.remove()})},300);if(this.capture_web_instream){this.capture_web_instream.track_like(u)}},updateNoteCount:function(u){var t=this.$(".note_link_current"),v;if(u){v=t.data("more");if(t.data("more")!==t.text()){t.data("less",t.text())}this.$el.removeClass("no_notes")}else{v=t.data("less");if(!v.length){this.$el.addClass("no_notes")}}t.text(v);t.attr("title",v)},destroy:function(){this.$el.fadeOut(500,function(){this.unbind();this.$el.parent().remove();Tumblr.Events.trigger("DOMEventor:updateRect");this.remove()}.bind(this))},alert:function(t){Tumblr.Dialog(t)},tagsDraggable:function(){var t=this.$(".post_tags");var u=t.find(".post_tags_inner");if(t.width()<u.width()){t.addClass("draggable no_pop");new q({el:t})}},setupAnswerForm:function(){var t=this.$(".post_answer");if(!(this.answer_form instanceof l)&&t.find(".post_answer_input").length){this.answer_form=new l({model:this.model,el:t,existing_note:this.$el.hasClass("existing_note")})}},answer:function(){this.$el.addClass("existing_note")},photo_reply_click:function(t){Tumblr.Lightbox.init([{high_res:e(t.currentTarget).find("img").attr("src"),low_res:e(t.currentTarget).find("img").attr("src"),width:500}])}});var j=k.extend({events:{"click .post_control.like":"send_to_signup","click .post_control.reblog":"send_to_signup"},send_to_signup:function(t){if(t){e(t.currentTarget).trigger("PostsView:send_to_signup",[t,this]);if(t.isPropagationStopped()){return false}t.preventDefault();t.stopPropagation()}window.open("/register");return false}});var g=k.extend({events:{'click [data-action="ignore"]':"ignore",'click [data-action="read_more"]':"read_more",'click [data-action="deny"]':"deny",'click [data-action="reply"]':"reply"},read_more:function(t){t.preventDefault();this.$(".read_more").hide();this.$(".message_body_truncated").hide();this.$(".message_body").show()},reply:function(t){t.preventDefault();Tumblr.FanMail.show(t.target)},deny:function(t){k.prototype.deny.call(this,t)}});Tumblr.NotesPopover=Tumblr.PopoverWithScroll.extend({show_by_el:function(t){this.$el=e(t);this.$container=this.$el.find(".notes_container");this.$scroll=this.$el.find(".popover_scroll");this.popover=this.$el.find(".popover");this.show()}});Tumblr.Notes=b.View.extend({el:"#posts",loading_notes:false,at_end:false,events:{"click .post_notes_label":"show_notes","click .more_notes_link":"on_more_click",keydown:"on_keydown"},initialize:function(){var t=this;this.popover=new Tumblr.NotesPopover({direction:"left",disable_auto_show:true,auto_center:false,on_show:function(){t.on_notes_show(this.$el)},on_load_more:function(){if(!t.loading_notes&&this.$el.find("a.more_notes_link").length>0){t.more_notes(this.$el.closest(".post"))}}})},show_notes:function(t){t.preventDefault();if(this.popover.is_showing){return}this.popover.show_by_el(t.currentTarget);Tumblr.KeyCommands.suspend([74,75])},create_note_views:function(t){t.find(".note:not([data-view-exists])").each(function(v,w){var u;if(e(w).hasClass("reblog")){u=new Tumblr.ReblogNoteView({el:w})}else{u=new Tumblr.NoteView({el:w})}e(w).attr("data-view-exists",true)});this.popover.update()},updateControls:function(u,v){var t=u.find(".more_notes_link");if(v){u.show();t.attr("data-next",v).show()}else{this.at_end=true;this.popover.is_scroll_disabled=true;t.attr("data-notes-complete",true);u.hide()}},animate_in:function(t){this.loading_notes=true;t.slideDown(300,o.bind(function(){this.loading_notes=false},this))},on_more_click:function(t){t.preventDefault();this.more_notes(e(t.currentTarget).closest(".post"))},on_keydown:function(u){var t=u.charCode?u.charCode:u.keyCode;if(t===78&&this.popover.is_showing){u.preventDefault();u.stopPropagation();this.popover.hide()}},on_notes_show:function(v){var u=e(v),t=u.closest(".post");this.at_end=(u.find(".more_notes_link").data("notes-complete"))?true:false;this.popover.is_scroll_disabled=this.at_end;if(!u.attr("data-notes-loaded")){this.load_notes(t,{},o.bind(function(w){if(!w){this.popover.hide()}u.attr("data-notes-loaded",true);this.popover.position_vertical()},this))}},more_notes:function(v){var t=e(v);var u=t.find(".more_notes_link").hide();var w=t.find(".notes_loading").show();this.loading_notes=true;this.load_notes(t,{from_id:u.attr("data-next")},o.bind(function(){w.hide();u.show();this.loading_notes=false},this))},load_notes:function(t,v,w){var u="/dashboard/notes/"+t.attr("data-post-id")+"/"+t.attr("data-tumblelog-key")+"/"+t.attr("data-tumblelog-name");if(v.from_id){u+="?from_c="+v.from_id}e.ajax(u).done(o.bind(function(C,D,A){var z=t.find(".more_notes_link_container"),x=t.find(".notes"),y=t.find(".more_notes_link"),B=t.find(".notes_loading");y.show();B.hide();C=e.trim(C);this.updateControls(z,A.getResponseHeader("X-next-note"));x.append(e(C).children());this.create_note_views(x);Tumblr.Events.trigger("DOMEventor:updateRect");w(C,D,A)},this))}});var q=b.View.extend({initialize:function(){this.dragging=false;this.drag_x=false;this.drag_inner=this.$(".post_tags_inner");this.doc=e(document);this.d=this.getDimensions();this.transform=this.isTransformSupported();this.bindEvents()},bindEvents:function(){this.$el.on("mousedown touchstart touchmove mouseleave mouseup touchend",".post_tags_inner",o.bind(this.dragEvents,this));this.$el.on("click",".post_tag",o.bind(this.handleLinks,this))},getDimensions:function(){var u=this.$el.width();var t=this.drag_inner.width();return{post_width:u,tag_width:t,max_left:0,max_right:((u-t)-10)}},isTransformSupported:function(){var u="transform WebkitTransform MozTransform OTransform msTransform".split(" ");for(var t=0;t<u.length;t++){if(document.createElement("div").style[u[t]]!==undefined){return true}}return false},dragEvents:function(t){switch(t.type){case"mousedown":case"touchstart":this.dragStart(t);break;case"mousemove":case"touchmove":if(this.pointer_down){this.dragMove(t)}break;case"touchend":case"mouseup":this.dragEnd(t);break}},bindDocEvents:function(){this.doc.on("mousemove.tagsDraggable",o.bind(this.dragEvents,this));this.doc.on("mouseup.tagsDraggable",o.bind(this.resetDrag,this))},unbindDocEvents:function(){this.doc.off("mousemove.tagsDraggable");this.doc.off("mouseup.tagsDraggable")},dragStart:function(t){t.preventDefault();if(!this.dragging&&!this.pointer_down){this.pointer_down=true;this.start_x=this.drag_inner.position().left;this.page_x=("pageX" in t?t.pageX:t.originalEvent.touches[0].pageX);this.bindDocEvents()}},dragMove:function(u){u.preventDefault();u.stopPropagation();this.drag_inner[0].classList.add("dragging");this.dragging=true;var t=("clientX" in u?u.clientX:u.originalEvent.touches[0].clientX)-this.page_x;this.drag_x=t+this.start_x;this.dragSet(this.drag_x)},dragSet:function(t){if(this.transform){this.drag_inner.css("transform","translate("+t+"px, 0)")}else{this.drag_inner.css("left",t)}},handleLinks:function(t){t.preventDefault();t.stopPropagation();if(!this.dragging){window.open(e(t.currentTarget).attr("href"),"_blank")}return false},resetDragPosition:function(){if(this.drag_x>this.d.max_left){this.dragSet(this.d.max_left)}else{if(this.drag_x<this.d.max_right){this.dragSet(this.d.max_right)}}},dragEnd:function(u){u.preventDefault();u.stopPropagation();var t=o.bind(this.resetDrag,this);o.delay(t,100)},resetDrag:function(){if(this.dragging||this.pointer_down){this.dragging=false;this.pointer_down=false;this.drag_inner[0].classList.remove("dragging");this.resetDragPosition();this.unbindDocEvents()}}});var l=b.View.extend({events:{"keyup .post_answer_input":"keyup","focus .post_answer_input":"focus","blur  .post_answer_input":"blur","click .post_answer_submit":"submit"},initialize:function(t){this.options=t||{};this.max_length=140;this.answer_input=this.$(".post_answer_input");this.answer_submit=this.$(".post_answer_submit");this.answer_length=this.$(".post_answer_length");this.answer_error_message=this.answer_input.data("error-message");this.existing_note=this.options.existing_note||false;this.answer_text=this.answer_input.val();this.listenTo(this.model,"answer:success",this.answer);this.listenTo(this.model,"answer:failure",this.error)},keyup:function(t){if(this.existing_note){return false}this.remaining_chars=this.max_length-this.getAnswerLength();if(this.remaining_chars<=0){this.remaining_chars=0}this.answer_length.text(this.remaining_chars);this.answer_text=(this.answer_text!==this.answer_input.val())?this.answer_input.val():this.answer_text;if(t.keyCode===13){t.preventDefault();this.answer_post()}},focus:function(){if(this.existing_note){return false}this.answer_text=this.answer_input.val();this.$el.addClass("show_submit")},blur:function(){if(this.getAnswerLength()===0){this.$el.removeClass("show_submit")}},submit:function(t){t.preventDefault();this.answer_post()},answer_post:function(){if(this.getAnswerLength()){this.model.answer(this.getAnswer())}},answer:function(){this.answer_input.blur();this.answer_input.attr("readonly","readonly")},error:function(){Tumblr.Dialog.confirm(this.answer_error_message)},getAnswerLength:function(){return this.getAnswer().length},getAnswer:function(){return e.trim(this.answer_input.val())}});(p.Models||(p.Models={})).Post=Tumblr.Post=r;p.PostView=k;p.Posts=new i();p.PostsView=n;e(function(){Tumblr.postsView=new Tumblr.PostsView()})})(jQuery,Tumblr,Backbone,_);
/*! scripts/follow_list.js */
(function(e,a){function c(){return window.location.pathname.split("/")[1]}var d=Backbone.View.extend({tagName:"ul",events:{"click .show_more":"show_more"},initialize:function(f){this.template||(this.template=f.template);this.subviews=[];this.data=this.$el.data("json")||{};this.tumblelogs=this.data.tumblelogs||[];this.context=this.data.context||"";this.enable_refresh=false;this.collection_url="";this.exclude_following=false;this.minimum_list_length=null;this.visible_list_length=3;this.viewed=[];this.log_impressions=false;this.is_popover_showing=false;this.set_context_props();var h=this;var g=Backbone.Collection.extend({url:this.collection_url,model:Tumblr.Models.Tumblelog,parse:function(i){if(h.exclude_following){i=_.filter(i,{following:false})}return i}});this.collection=new g();this.listenTo(this.collection,"add",this.add_tumblelog);this.listenTo(this.collection,"remove",this.remove_tumblelog);this.listenTo(this.collection,"change:following",this.on_follow);this.listenTo(Tumblr.Events,"TumblelogPopover:show",this.on_popover_show);this.listenTo(Tumblr.Events,"TumblelogPopover:hide",this.on_popover_hide);if(this.log_impressions){this.listenTo(this.collection,"add",this.log_impression);this.listenTo(this.collection,"remove",this.log_impression)}this.$el.attr("data-json",null)},render:function(){this.$el.html(_.template(this.template,{heading:this.data.heading||"",context:this.data.context||""}));this.collection.add(this.tumblelogs);this.add_footer();return this},set_context_props:function(){if(this.context=="recommended_tumblelogs"){this.enable_refresh=true;this.has_dismiss=true;this.auto_refresh=true;this.collection_url="/svc/get_recommended_tumblelog";this.exclude_following=true;this.minimum_list_length=6;this.log_impressions=true}else{if(this.context=="trending_tumblelogs"){this.enable_refresh=true;this.has_dismiss=true;this.auto_refresh=true;this.collection_url="/svc/get_trending_tumblelog";this.exclude_following=true;this.minimum_list_length=6;this.log_impressions=true}}},on_popover_show:function(f){this.is_popover_showing=true},on_popover_hide:function(f){this.is_popover_showing=false},add_footer:function(){var f=_.template(e("#follow_list_"+this.data.context+"_small_links_template").html(),{user_is_editor:this.data.user_is_editor||false});this.$el.append(f)},on_follow:function(i,h,g){var f=_.find(this.subviews,{model:i});if(!this.enable_refresh){f.render();return}if(h){if(this.collection.length>this.visible_list_length){if(this.is_popover_showing){this.listenToOnce(Tumblr.Events,"TumblelogPopover:hide",function(){this.collection.remove(i);this.animate(f,false)});f.$el.addClass("flash");f.render();f.$el.find(".dismiss").addClass("hide")}else{this.collection.remove(i);this.animate(f,true)}}else{f.render()}}else{this.stopListening(Tumblr.Events,"TumblelogPopover:hide");f.render()}f.disable_dismiss()},add_tumblelog:function(g){var f=new b({model:g,collection:this.collection,params:{follow_source:this.data.follow_source,has_dismiss:this.has_dismiss}});this.subviews.push(f);if(!this.auto_refresh&&this.visible_list_length&&this.subviews.length>this.visible_list_length){f.hide()}this.$el.append(f.el);f.render()},remove_tumblelog:function(g){this.subviews=_.filter(this.subviews,function(h){return h.model!=g});var f=this.minimum_list_length-this.collection.length;if(f>0){this.fetch_tumblelogs(f)}},fetch_tumblelogs:function(f){var g=this;this.collection.fetch({data:{limit:f,page:c()},with_form_key:true,remove:false})},animate:function(g,f){if(f){g.$el.addClass("flash").delay(200)}g.$el.animate({opacity:0},100).slideUp(300,function(){e(this).remove()})},show_more:function(f){this.$(".item.last").removeClass("last");this.$(".item").last().addClass("after_showing");this.$(".item.hidden").removeClass("hidden");e(f.currentTarget).hide();return false},log_impression:function(){_.forEach(this.collection.slice(0,this.visible_list_length),function(f){if(_.indexOf(this.viewed,f)!==-1){return}this.viewed.push(f);Tumblr.Events.trigger("Capture:push","recommended_blog_impressions","impressions",{tumblelog_name:f.get("name"),algorithm_id:f.get("algorithm_id")||"",page:c(),ts:Math.floor(e.now()/1000)})},this)}});var b=Backbone.View.extend({tagName:"li",className:"item",events:{"click .follow":"follow","click .icon_close":"dismiss"},initialize:function(f){this.params=f.params||{};this.$button=this.$(".follow")},render:function(){var f=_.extend(this.model.toJSON(),this.params);f.following=this.model.get("following")||this.model.get("is_you");var g=_.template(e("#follow_list_item_template").html(),f);this.$el.html(g);this.$button.toggle(!this.model.get("following"));return this},follow:function(){this.model.save_following({following:true},{source:this.params.follow_source}).fail(function(){alert(l10n_str.ajax_error)});return false},hide:function(){this.$el.addClass("hidden")},dismiss:function(f){this.collection.remove(this.model);this.$el.animate({left:-245},250).slideUp(300,function(){e(this).remove()});e.ajax({url:"/svc/log_dismissal",data:{tumblelog_name:this.model.get("name"),page:c()},with_form_key:true})},disable_dismiss:function(){this.$el.find(".dismiss").remove()}});a.FollowList=d;a.FollowListItem=b})(jQuery,Tumblr);jQuery(document).ready(function(b){var a=b.trim(b("#follow_list_template").html());b(".follow_list").each(function(d,c){new Tumblr.FollowList({el:c,template:a}).render()})});
/*! scripts/tumblr/dashboard/dashboard_controls.js */
(function(k,f,j,d){function c(){var m=arguments;return function(){for(var o=0,n=m.length;o<n;o++){if(m[o].apply(this,arguments)===false){break}}}}function b(){return this.isRenderable()}function g(m){return function(n){return !(n._previousAttributes[m]==null||n._previousAttributes[m]===n.attributes[m])}}var a=(function(){try{var m=0;m.toLocaleString("i");return function(o,p){return p.toLocaleString()}}catch(n){return function(o,p){return p.toLocaleString(o)}}})();function e(n){var m=/\d[\d\s\.,]*/;return function(o,s){var p=this[n];var r=parseInt(p.data("count"),10)+(s?1:-1);p.data("count",r);var t=p.text();var q=f.trim(t.match(m));if(q){p.text(t.replace(q,a(this.locale,r)))}}}var l=j.View.extend({initialize:function(m){this._renderable=false;this.locale=m.locale;this.allPosts=m.allPosts;this.allTumblelogs=m.allTumblelogs;this.listenTo(this.allTumblelogs,"change:following",this.changeFollowingLabel);this.listenTo(this.allPosts,"change:liked",this.changeLikesLabel)},changeFollowingLabel:c(b,g("following"),e("$followingLabel")),changeLikesLabel:c(b,g("liked"),e("$likesLabel")),isRenderable:function(){return !!this._renderable},render:function(){this.$likesLabel=this.$(".likes [data-count]");this.$followingLabel=this.$(".following [data-count]");this._renderable=(this.$likesLabel.length!==0)&&(this.$followingLabel!==0);return this}});var h=(typeof language_for_tinymce==="string")?language_for_tinymce:"en";var i=new l({el:"#right_column",allPosts:Tumblr.Posts,allTumblelogs:Tumblr.Models.Tumblelog.collection,locale:h}).render();d.DashboardControls=l;d.dashboardControls=i})(_,jQuery,Backbone,Tumblr);
/*! scripts/vendor/audio-js/audio.js */
(function(e,b,a){var d=(function(){var j=new RegExp("audio(\\.min)?\\.js.*"),f=document.getElementsByTagName("script");for(var g=0,h=f.length;g<h;g++){var k=f[g].getAttribute("src");if(j.test(k)){return k.replace(j,"")}}return""})();a[e]={instanceCount:0,instances:{},flashSource:'      <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="$1" width="1" height="1" name="$1" style="position: absolute; left: -1px;">         <param name="movie" value="$2?playerInstance='+e+'.instances[\'$1\']&datetime=$3">         <param name="allowscriptaccess" value="always">         <embed name="$1" src="$2?playerInstance='+e+'.instances[\'$1\']&datetime=$3" width="1" height="1" allowscriptaccess="always">       </object>',settings:{autoplay:false,loop:false,preload:true,imageLocation:d+"player-graphics.gif",swfLocation:d+"audiojs.swf",useFlash:(function(){var f=document.createElement("audio");return !(f.canPlayType&&f.canPlayType("audio/mpeg;").replace(/no/,""))})(),hasFlash:(function(){if(navigator.plugins&&navigator.plugins.length&&navigator.plugins["Shockwave Flash"]){return true}else{if(navigator.mimeTypes&&navigator.mimeTypes.length){var h=navigator.mimeTypes["application/x-shockwave-flash"];return h&&h.enabledPlugin}else{try{var f=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");return true}catch(g){}}}return false})(),createPlayer:{markup:'          <div class="play-pause">             <p class="play"></p>             <p class="pause"></p>             <p class="loading"></p>             <p class="error"></p>           </div>           <div class="scrubber">             <div class="progress"></div>             <div class="loaded"></div>           </div>           <div class="time">             <em class="played">00:00</em>/<strong class="duration">00:00</strong>           </div>           <div class="error-message"></div>',playPauseClass:"play-pause",scrubberClass:"scrubber",progressClass:"progress",loaderClass:"loaded",timeClass:"time",durationClass:"duration",playedClass:"played",errorMessageClass:"error-message",playingClass:"playing",loadingClass:"loading",errorClass:"error"},css:'        .audiojs audio { position: absolute; left: -1px; }         .audiojs { width: 460px; height: 36px; background: #404040; overflow: hidden; font-family: monospace; font-size: 12px;           background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #444), color-stop(0.5, #555), color-stop(0.51, #444), color-stop(1, #444));           background-image: -moz-linear-gradient(center top, #444 0%, #555 50%, #444 51%, #444 100%);           -webkit-box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3); -moz-box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3);           -o-box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3); box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3); }         .audiojs .play-pause { width: 25px; height: 40px; padding: 4px 6px; margin: 0px; float: left; overflow: hidden; border-right: 1px solid #000; }         .audiojs p { display: none; width: 25px; height: 40px; margin: 0px; cursor: pointer; }         .audiojs .play { display: block; }         .audiojs .scrubber { position: relative; float: left; width: 280px; background: #5a5a5a; height: 14px; margin: 10px; border-top: 1px solid #3f3f3f; border-left: 0px; border-bottom: 0px; overflow: hidden; }         .audiojs .progress { position: absolute; top: 0px; left: 0px; height: 14px; width: 0px; background: #ccc; z-index: 1;           background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #ccc), color-stop(0.5, #ddd), color-stop(0.51, #ccc), color-stop(1, #ccc));           background-image: -moz-linear-gradient(center top, #ccc 0%, #ddd 50%, #ccc 51%, #ccc 100%); }         .audiojs .loaded { position: absolute; top: 0px; left: 0px; height: 14px; width: 0px; background: #000;           background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #222), color-stop(0.5, #333), color-stop(0.51, #222), color-stop(1, #222));           background-image: -moz-linear-gradient(center top, #222 0%, #333 50%, #222 51%, #222 100%); }         .audiojs .time { float: left; height: 36px; line-height: 36px; margin: 0px 0px 0px 6px; padding: 0px 6px 0px 12px; border-left: 1px solid #000; color: #ddd; text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.5); }         .audiojs .time em { padding: 0px 2px 0px 0px; color: #f9f9f9; font-style: normal; }         .audiojs .time strong { padding: 0px 0px 0px 2px; font-weight: normal; }         .audiojs .error-message { float: left; display: none; margin: 0px 10px; height: 36px; width: 400px; overflow: hidden; line-height: 36px; white-space: nowrap; color: #fff;           text-overflow: ellipsis; -o-text-overflow: ellipsis; -icab-text-overflow: ellipsis; -khtml-text-overflow: ellipsis; -moz-text-overflow: ellipsis; -webkit-text-overflow: ellipsis; }         .audiojs .error-message a { color: #eee; text-decoration: none; padding-bottom: 1px; border-bottom: 1px solid #999; white-space: wrap; }                 .audiojs .play { background: url("$1") -2px -1px no-repeat; }         .audiojs .loading { background: url("$1") -2px -31px no-repeat; }         .audiojs .error { background: url("$1") -2px -61px no-repeat; }         .audiojs .pause { background: url("$1") -2px -91px no-repeat; }                 .playing .play, .playing .loading, .playing .error { display: none; }         .playing .pause { display: block; }                 .loading .play, .loading .pause, .loading .error { display: none; }         .loading .loading { display: block; }                 .error .time, .error .play, .error .pause, .error .scrubber, .error .loading { display: none; }         .error .error { display: block; }         .error .play-pause p { cursor: auto; }         .error .error-message { display: block; }',trackEnded:function(f){},flashError:function(){var h=this.settings.createPlayer,f=c(h.errorMessageClass,this.wrapper),g='Missing <a href="http://get.adobe.com/flashplayer/">flash player</a> plugin.';if(this.mp3){g+=' <a href="'+this.mp3+'">Download audio file</a>.'}a[e].helpers.removeClass(this.wrapper,h.loadingClass);a[e].helpers.addClass(this.wrapper,h.errorClass);f.innerHTML=g},loadError:function(h){var g=this.settings.createPlayer,f=c(g.errorMessageClass,this.wrapper);a[e].helpers.removeClass(this.wrapper,g.loadingClass);a[e].helpers.addClass(this.wrapper,g.errorClass);f.innerHTML='Error loading: "'+this.mp3+'"'},init:function(){var f=this.settings.createPlayer;a[e].helpers.addClass(this.wrapper,f.loadingClass)},loadStarted:function(){var g=this.settings.createPlayer,i=c(g.durationClass,this.wrapper),f=Math.floor(this.duration/60),h=Math.floor(this.duration%60);a[e].helpers.removeClass(this.wrapper,g.loadingClass);i.innerHTML=((f<10?"0":"")+f+":"+(h<10?"0":"")+h)},loadProgress:function(h){var g=this.settings.createPlayer,i=c(g.scrubberClass,this.wrapper),f=c(g.loaderClass,this.wrapper);f.style.width=(i.offsetWidth*h)+"px"},playPause:function(){if(this.playing){this.settings.play()}else{this.settings.pause()}},play:function(){var f=this.settings.createPlayer;a[e].helpers.addClass(this.wrapper,f.playingClass)},pause:function(){var f=this.settings.createPlayer;a[e].helpers.removeClass(this.wrapper,f.playingClass)},updatePlayhead:function(j){var h=this.settings.createPlayer,l=c(h.scrubberClass,this.wrapper),g=c(h.progressClass,this.wrapper);g.style.width=(l.offsetWidth*j)+"px";var k=c(h.playedClass,this.wrapper),n=this.duration*j,f=Math.floor(n/60),i=Math.floor(n%60);k.innerHTML=((f<10?"0":"")+f+":"+(i<10?"0":"")+i)}},create:function(g,f){var f=f||{};if(g.length){return this.createAll(f,g)}else{return this.newInstance(g,f)}},createAll:function(g,k){var f=k||document.getElementsByTagName("audio"),l=[];g=g||{};for(var h=0,j=f.length;h<j;h++){l.push(this.newInstance(f[h],g))}return l},newInstance:function(g,f){var g=g,h=this.helpers.clone(this.settings),l="audiojs"+this.instanceCount,k="audiojs_wrapper"+this.instanceCount,j=this.instanceCount++;if(g.getAttribute("autoplay")!=null){h.autoplay=true}if(g.getAttribute("loop")!=null){h.loop=true}if(g.getAttribute("preload")=="none"){h.preload=false}if(f){this.helpers.merge(h,f)}if(h.createPlayer.markup){g=this.createPlayer(g,h.createPlayer,k)}else{g.parentNode.setAttribute("id",k)}var i=new a[b](g,h);if(h.css){this.helpers.injectCss(i,h.css)}if(h.useFlash&&h.hasFlash){this.injectFlash(i,l);this.attachFlashEvents(i.wrapper,i)}else{if(h.useFlash&&!h.hasFlash){h.flashError.apply(i)}}if(!h.useFlash||(h.useFlash&&h.hasFlash)){this.attachEvents(i.wrapper,i)}this.instances[l]=i;return i},createPlayer:function(g,f,j){var i=document.createElement("div"),h=g.cloneNode(true);i.setAttribute("class","audiojs");i.setAttribute("className","audiojs");i.setAttribute("id",j);if(h.outerHTML&&!document.createElement("audio").canPlayType){h=this.helpers.cloneHtml5Node(g);i.innerHTML=f.markup;i.appendChild(h);g.outerHTML=i.outerHTML;i=document.getElementById(j)}else{i.appendChild(h);i.innerHTML=i.innerHTML+f.markup;g.parentNode.replaceChild(i,g)}return i.getElementsByTagName("audio")[0]},attachEvents:function(k,h){if(!h.settings.createPlayer){return}var g=h.settings.createPlayer,j=c(g.playPauseClass,k),i=c(g.scrubberClass,k),f=function(l){var m=0;if(l.offsetParent){do{m+=l.offsetLeft}while(l=l.offsetParent)}return m};a[e].events.addListener(j,"click",function(l){h.playPause.apply(h)});a[e].events.addListener(i,"click",function(m){var l=m.clientX-f(this);h.skipTo(l/i.offsetWidth)});if(h.settings.useFlash){return}a[e].events.trackLoadProgress(h);a[e].events.addListener(h.element,"timeupdate",function(l){h.updatePlayhead.apply(h)});a[e].events.addListener(h.element,"ended",function(l){h.trackEnded.apply(h)});a[e].events.addListener(h.source,"error",function(l){clearInterval(h.readyTimer);clearInterval(h.loadTimer);h.settings.loadError.apply(h)})},attachFlashEvents:function(f,g){g.swfReady=false;g.load=function(h){g.mp3=h;if(g.swfReady){g.element.load(h)}};g.loadProgress=function(h,i){g.loadedPercent=h;g.duration=i;g.settings.loadStarted.apply(g);g.settings.loadProgress.apply(g,[h])};g.skipTo=function(h){if(h>g.loadedPercent){return}g.updatePlayhead.call(g,[h]);g.element.skipTo(h)};g.updatePlayhead=function(h){g.settings.updatePlayhead.apply(g,[h])};g.play=function(){if(!g.settings.preload){g.settings.preload=true;g.element.init(g.mp3)}g.playing=true;g.element.pplay();g.settings.play.apply(g)};g.pause=function(){g.playing=false;g.element.ppause();g.settings.pause.apply(g)};g.setVolume=function(h){g.element.setVolume(h)};g.loadStarted=function(){g.swfReady=true;if(g.settings.flashReady){g.settings.flashReady.apply(g)}if(g.settings.preload&&g.mp3){g.element.init(g.mp3)}if(g.settings.autoplay){g.play.apply(g)}}},injectFlash:function(h,j){var f=this.flashSource.replace(/\$1/g,j);f=f.replace(/\$2/g,h.settings.swfLocation);f=f.replace(/\$3/g,(+new Date+Math.random()));var g=h.wrapper.innerHTML,i=document.createElement("div");i.innerHTML=f+g;h.wrapper.innerHTML=i.innerHTML;h.element=this.helpers.getSwf(j)},helpers:{merge:function(g,f){for(attr in f){if(g.hasOwnProperty(attr)||f.hasOwnProperty(attr)){g[attr]=f[attr]}}},clone:function(h){if(h==null||typeof(h)!=="object"){return h}var f=new h.constructor();for(var g in h){f[g]=arguments.callee(h[g])}return f},addClass:function(f,h){var g=new RegExp("(\\s|^)"+h+"(\\s|$)");if(g.test(f.className)){return}f.className+=" "+h},removeClass:function(f,h){var g=new RegExp("(\\s|^)"+h+"(\\s|$)");f.className=f.className.replace(g," ")},injectCss:function(g,k){var q="",p=document.getElementsByTagName("style"),j=k.replace(/\$1/g,g.settings.imageLocation);for(var h=0,o=p.length;h<o;h++){var m=p[h].getAttribute("title");if(m&&~m.indexOf("audiojs")){f=p[h];if(f.innerHTML===j){return}q=f.innerHTML;break}}var l=document.getElementsByTagName("head")[0],n=l.firstChild,f=document.createElement("style");if(!l){return}f.setAttribute("type","text/css");f.setAttribute("title","audiojs");if(f.styleSheet){f.styleSheet.cssText=q+j}else{f.appendChild(document.createTextNode(q+j))}if(n){l.insertBefore(f,n)}else{l.appendChild(styleElement)}},cloneHtml5Node:function(g){var f=document.createDocumentFragment(),h=f.createElement?f:document;h.createElement("audio");var i=h.createElement("div");f.appendChild(i);i.innerHTML=g.outerHTML;return i.firstChild},getSwf:function(f){var g=document[f]||window[f];return g.length>1?g[g.length-1]:g}},events:{memoryLeaking:false,listeners:[],addListener:function(g,f,h){if(g.addEventListener){g.addEventListener(f,h,false)}else{if(g.attachEvent){this.listeners.push(g);if(!this.memoryLeaking){window.attachEvent("onunload",function(){if(this.listeners){for(var j=0,k=this.listeners.length;j<k;j++){a[e].events.purge(this.listeners[j])}}});this.memoryLeaking=true}g.attachEvent("on"+f,function(){h.call(g,window.event)})}}},trackLoadProgress:function(h){if(!h.settings.preload){return}if(!h.element.src){return}var f,i,h=h,g=(/(ipod|iphone|ipad)/i).test(navigator.userAgent);f=setInterval(function(){if(h.element.readyState>-1){if(!g){h.init.apply(h)}}if(h.element.readyState>1){if(h.settings.autoplay){h.play.apply(h)}clearInterval(f);i=setInterval(function(){h.loadProgress.apply(h);if(h.loadedPercent>=1){clearInterval(i)}})}},10);h.readyTimer=f;h.loadTimer=i},purge:function(h){var f=h.attributes,g;if(f){for(g=0;g<f.length;g+=1){if(typeof h[f[g].name]==="function"){h[f[g].name]=null}}}f=h.childNodes;if(f){for(g=0;g<f.length;g+=1){purge(h.childNodes[g])}}},ready:(function(){return function(l){var h=window,g=false,k=true,n=h.document,m=n.documentElement,q=n.addEventListener?"addEventListener":"attachEvent",o=n.addEventListener?"removeEventListener":"detachEvent",f=n.addEventListener?"":"on",p=function(r){if(r.type=="readystatechange"&&n.readyState!="complete"){return}(r.type=="load"?h:n)[o](f+r.type,p,false);if(!g&&(g=true)){l.call(h,r.type||r)}},j=function(){try{m.doScroll("left")}catch(r){setTimeout(j,50);return}p("poll")};if(n.readyState=="complete"){l.call(h,"lazy")}else{if(n.createEventObject&&m.doScroll){try{k=!h.frameElement}catch(i){}if(k){j()}}n[q](f+"DOMContentLoaded",p,false);n[q](f+"readystatechange",p,false);h[q](f+"load",p,false)}}})()}};a[b]=function(f,g){this.element=f;this.wrapper=f.parentNode;this.source=f.getElementsByTagName("source")[0]||f;this.mp3=(function(h){var i=h.getElementsByTagName("source")[0];return h.getAttribute("src")||(i?i.getAttribute("src"):null)})(f);this.settings=g;this.loadStartedCalled=false;this.loadedPercent=0;this.duration=1;this.playing=false};a[b].prototype={updatePlayhead:function(){var f=this.element.currentTime/this.duration;this.settings.updatePlayhead.apply(this,[f])},skipTo:function(f){if(f>this.loadedPercent){return}this.element.currentTime=this.duration*f;this.updatePlayhead()},load:function(f){this.loadStartedCalled=false;this.source.setAttribute("src",f);this.element.load();this.mp3=f;a[e].events.trackLoadProgress(this)},loadError:function(){this.settings.loadError.apply(this)},init:function(){this.settings.init.apply(this)},loadStarted:function(){if(!this.element.duration){return false}this.duration=this.element.duration;this.updatePlayhead();this.settings.loadStarted.apply(this);return true},loadProgress:function(){if(this.element.buffered!=null&&this.element.buffered.length){if(!this.loadStartedCalled){this.loadStartedCalled=this.loadStarted()}var f=this.element.buffered.end(this.element.buffered.length-1);this.loadedPercent=f/this.duration;this.settings.loadProgress.apply(this,[this.loadedPercent])}},playPause:function(){if(this.playing){this.pause()}else{this.play()}},play:function(){var f=(/(ipod|iphone|ipad)/i).test(navigator.userAgent);if(f&&this.element.readyState==0){this.init.apply(this)}if(!this.settings.preload){this.settings.preload=true;this.element.setAttribute("preload","auto");a[e].events.trackLoadProgress(this)}this.playing=true;this.element.play();this.settings.play.apply(this)},pause:function(){this.playing=false;this.element.pause();this.settings.pause.apply(this)},setVolume:function(f){this.element.volume=f},trackEnded:function(f){this.skipTo.apply(this,[0]);if(!this.settings.loop){this.pause.apply(this)}this.settings.trackEnded.apply(this)}};var c=function(n,j){var m=[];j=j||document;if(j.getElementsByClassName){m=j.getElementsByClassName(n)}else{var h,f,g=j.getElementsByTagName("*"),k=new RegExp("(^|\\s)"+n+"(\\s|$)");for(h=0,f=g.length;h<f;h++){if(k.test(g[h].className)){m.push(g[h])}}}return m.length>1?m:m[0]}})("audiojs","audiojsInstance",this);
/*! scripts/html5_audio.js */
(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());(function(d,b){var c=c||function(f){return f};var a=function(f){if(!(this instanceof a)){return new a(f)}this.options=f;this.config=d.extend(true,{},a.defaults,this.options);this.config.audiojs_settings=d.extend({},audiojs.settings,a.defaults.audiojs_settings,this.config.audiojs_settings);this.localized=d.extend({no_id3:"Listen",flash_error:'<a href="http://get.adobe.com/flashplayer/">Flash 9 is required to listen to audio.</a>'},this.config.localized);this.__init();a.register(this);return this};a.prototype={playing:false,onscreen:true,animation_interval:false,animation_callback:false,animation_arguments:[],last_tick:0,__init:function(){this.__build_track_list();this.title=a.format_title(this.tracks[0]);if(typeof this.config.template==="string"){this.config.template=_.template(this.config.template)}this.$container=d(this.config.template({service:this.config.service,cover:this.config.cover,tracks:this.config.tracks,title:this.title}));if(this.config.replace){d(this.config.replace).replaceWith(this.$container)}else{if(this.config.append_to){d(this.config.append_to).append(this.$container)}else{if(this.config.prepend_to){d(this.config.prepend_to).prepend(this.$container)}}}this.__cache_selectors();this.__proxy_functions();this.$player.addClass(this.config.player_classes);this.starting_track_id=this.config.start_at||0;if(!this.track_info(this.starting_track_id,"artist")&&!this.track_info(this.starting_track_id,"track")&&!this.track_info(this.starting_track_id,"album")){this.$message_text.html(this.localized.no_id3);this.$player.addClass("message")}this.__init_visualizations();this.config.audiojs_settings.createPlayer.markup="";this.config.audiojs_settings.createPlayer.css="";this.__init_audiojs();if(!this.audiojs.settings.useFlash||!this.audiojs.settings.hasFlash){this.bind_events()}if(this.config.lightbox){this.$container.addClass("has_lightbox")}d(document.body).trigger("tumblr:audio:ready",{audioplayer:this,using_flash:(this.audiojs.settings.useFlash&&this.audiojs.settings.hasFlash)})},__init_audiojs:function(){this.element=this.config.el||this.__create_el(this.config.wrapper||this.$player.get(0));this.audiojs=audiojs.create(this.element,this.config.audiojs_settings);this.audiojs.audioplayer=this;this.check_flash_error()},__create_el:function(f){return d("<audio/>").attr({type:"audio/mp3"}).appendTo(f).get(0)},__cache_selectors:function(){this.$player=this.$container.find(".audio_player");if(this.track_info(0,"cover")){this.$container.addClass("has_art")}this.$controls=this.$container.find(".audio_controls");this.$visualizer=this.$container.find(".audio_visualizer");this.$message_container=this.$container.find(".audio_message_container");this.$message_text=this.$container.find(".audio_message_text");this.$overlay=this.$container.find(".audio_player_overlay");this.$progress_container=this.$container.find(".progress_container");this.$load_progress=this.$container.find(".load_progress");this.$play_progress=this.$container.find(".play_progress");this.$playhead=this.$container.find(".playhead");this.$seek_overlay=this.$container.find(".seek_overlay");this.$seek_position=this.$container.find(".seek_position");this.$seek_time=this.$container.find(".seek_time");this.$play_pause_container=this.$container.find(".play_pause_container");this.$play_button=this.$container.find(".play_button");this.$pause_button=this.$container.find(".pause_button");this.$text_wrapper=this.$container.find(".player_text_wrapper");this.$text=this.$container.find(".player_text");this.$track_name=this.$container.find(".track_name");this.$artist_name=this.$container.find(".artist_name");this.$album_name=this.$container.find(".album_name");this.truncate_text();this.$current_time=this.$container.find(".current_time");this.$total_time=this.$container.find(".total_time");this.$album_art_container=this.$container.find(".album_art_container");this.$main_album_art=this.$container.find(".album_art.main");this.$album_art=this.$container.find(".album_art").not(this.$main_album_art).hide()},__init_visualizations:function(){this.$visualizer.empty();if(this.config.eq){this.generate_equalizer();this.equalizer_levels(0);this.real_frequencies=a.has_equalizer_support();this.$container.addClass("has_visualizer");this.truncate_text()}},__proxy_functions:function(){this._on_focus_player=d.proxy(this.on_focus_player,this);this._album_art_lightbox=d.proxy(this.album_art_lightbox,this);this._on_overlay_mouseenter=d.proxy(this.on_overlay_mouseenter,this);this._on_overlay_mouseleave=d.proxy(this.on_overlay_mouseleave,this);this._on_overlay_mousedown=d.proxy(this.on_overlay_mousedown,this);this._on_seek_mouseenter=d.proxy(this.on_seek_mouseenter,this);this._on_seek_mousemove=d.proxy(this.on_seek_mousemove,this);this._on_seek_mouseleave=d.proxy(this.on_seek_mouseleave,this);this._on_seek_begin=d.proxy(this.on_seek_begin,this);this._on_seek_move=d.proxy(this.on_seek_move,this);this._on_seek_end=d.proxy(this.on_seek_end,this);this._on_audio_playing=d.proxy(this.on_audio_playing,this);this._on_audio_pause=d.proxy(this.on_audio_pause,this);this._play=d.proxy(this.play,this);this._pause=d.proxy(this.pause,this);this._load_progress=d.proxy(this.load_progress,this);this._play_progress=d.proxy(this.play_progress,this)},__build_track_list:function(f){this.tracks=f||this.config.tracks;if(!this.tracks.length){this.tracks=[d.extend({},a.defaults.tracks[0])];this.tracks[0].bpm=this.config.bpm;this.tracks[0].stream_url=this.config.stream_url;this.tracks[0].track=this.config.track;this.tracks[0].artist=this.config.artist;this.tracks[0].album=this.config.album;this.tracks[0].cover=this.config.cover}},bind_events:function(){this.$player.on({touchstart:this._on_focus_player,mousedown:this._on_focus_player});this.$album_art_container.on("click",this._album_art_lightbox);this.$overlay.on({touchstart:this._on_overlay_mousedown,mouseenter:this._on_overlay_mouseenter,mouseleave:this._on_overlay_mouseleave,mousedown:this._on_overlay_mousedown});this.$seek_overlay.on({mouseenter:this._on_seek_mouseenter,mouseleave:this._on_seek_mouseleave,mousemove:this._on_seek_mousemove,mousedown:this._on_seek_begin});d(document.body).on({"tumblr:audio:playing":this._on_audio_playing,"tumblr:audio:pause":this._on_audio_pause})},unbind_events:function(){this.$player.off({touchstart:this._on_focus_player,mousedown:this._on_focus_player});this.$album_art_container.off("click",this._album_art_lightbox);this.$overlay.off({touchstart:this._on_overlay_mousedown,mouseenter:this._on_overlay_mouseenter,mouseleave:this._on_overlay_mouseleave,mousedown:this._on_overlay_mousedown});this.$seek_overlay.off({mouseenter:this._on_seek_mouseenter,mouseleave:this._on_seek_mouseleave,mousemove:this._on_seek_mousemove,mousedown:this._on_seek_begin});d(document.body).off({mousemove:this._on_seek_move,mouseup:this._on_seek_end,"tumblr:audio:playing":this._on_audio_playing,"tumblr:audio:pause":this._on_audio_pause});this.unbind_key_events()},responsive_size_embed:function(g,f){this.$container.removeClass("hide_art hide_visualizer condense_visualizer");this.$container.addClass("embed");if(this.track_info(0,"cover")){this.$container.addClass("has_art")}if(this.config.eq){this.$container.addClass("has_visualizer")}if(this.$container.hasClass("has_art")&&f*2<=g&&f>=30){this.$album_art_container.css("width",f);this.$player.css("padding-right",f);this.$visualizer.css("margin-right",f)}else{this.$album_art_container.css("width","");this.$player.css("padding-right","");this.$visualizer.css("margin-right","");if(this.$container.hasClass("has_art")||g<250){this.$container.removeClass("has_visualizer embed")}this.$container.removeClass("has_art")}if(this.$container.hasClass("has_art")){if(f<169){this.$controls.css("height","");this.$container.removeClass("has_visualizer")}else{this.$controls.css("height",f-this.$visualizer.outerHeight())}}else{this.$controls.css("height","");if(f<85||f>85){this.$container.removeClass("has_visualizer")}}if(this.$equalizer){if(this.$equalizer.width()<300){this.$container.addClass("condense_visualizer")}}this.responsive_size(this.$controls.width(),this.$controls.height())},responsive_size:function(g,f){this.$container.removeClass("switch small button listen");if(f>50){if(g<110){this.$container.addClass("button")}else{if(g<205){this.$container.addClass("listen")}}}else{this.$container.addClass("small");if(g<70){this.$container.addClass("button")}else{this.$container.addClass("listen")}}},check_flash_error:function(){var f=this.audiojs.settings.useFlash&&!this.audiojs.settings.hasFlash;if(f&&!this.flash_error){this.audiojs.settings.flashError.apply(this.audiojs)}},on_focus_player:function(f){if(f&&!a.is_left_click(f)){return true}a.set_key_commands(true,true)},on_overlay_mouseenter:function(f){this.$player.addClass("hover")},on_overlay_mouseleave:function(f){this.$player.removeClass("hover")},on_overlay_mousedown:function(f){if(f&&!a.is_left_click(f)){return true}if(this.flash_error){return true}else{if(!this.audiojs.loadedPercent){if(this.load_track(this.config.start_at)){this.play()}}else{if(!this.error){this.play_pause()}}}f.preventDefault()},on_seek_mouseenter:function(f){this.$progress_container.addClass("seek")},on_seek_mousemove:function(g){var f=this.get_seek_progress(g.pageX-this.$progress_container.offset().left);this.$seek_position.css("left",(100*f)+"%");if(this.$progress_container.width()*Math.abs(this.play_progress-f)<5){this.$player.addClass("playhead_hover")}else{this.$player.removeClass("playhead_hover")}if(this.total_time){this.$seek_time.text(a.format_time(f*this.total_time))}},on_seek_mouseleave:function(f){this.$player.removeClass("playhead_hover");this.$progress_container.removeClass("seek")},on_audio_playing:function(g,f){a.handling_on_play=true;if(a.config.one_at_a_time&&f.audioplayer!==this){if(this.current_state("unplayed")){this.paused_animation_start(true)}else{if(this.playing){this.pause()}}}a.handling_on_play=false},on_audio_pause:function(g,f){if(a.handling_on_play){return}if(a.config.one_at_a_time&&f.audioplayer!==this){if(this.current_state("unplayed")){this.demo_animation_start()}}},on_seek_begin:function(f){if(f&&!a.is_left_click(f)){return true}this.$player.addClass("seeking");d(document.body).addClass("grabbing");this.was_playing=this.audiojs.playing;if(this.was_playing){this.$player.addClass("was_playing")}this.pause();d(document.body).on({mousemove:this._on_seek_move,mouseup:this._on_seek_end});this.seek_move_timeout=_.delay(this._on_seek_move,50,f,true);this.on_focus_player(f);return false},on_seek_move:function(h,f){clearTimeout(this.seek_move_timeout);if(!f){this.$player.addClass("show_seek_time")}this.on_seek_mousemove(h);var g=this.get_seek_progress();this.set_play_progress(g);this.set_time(g*this.total_time,this.total_time)},on_seek_end:function(f){this.$player.removeClass("seeking show_seek_time was_playing");d(document.body).removeClass("grabbing");this.skip_to(Math.min(this.total_time?(this.total_time-0.1)/this.total_time:1,this.get_seek_progress(f.pageX-this.$progress_container.offset().left)));if(this.was_playing){this.play()}d(document.body).off({mousemove:this._on_seek_move,mouseup:this._on_seek_end})},load_track:function(h){if(this.current_track_id===h){return false}if(h>=this.tracks.length||h<0){return false}if(this.audiojs.playing){this.pause()}var g=!this.current_track_id;this.current_track_id=h;this.current_track=this.tracks[h];this.$track_name.text(this.current_track.track);this.$artist_name.text(this.current_track.artist);this.$album_name.text(this.current_track.album);this.$current_album_art=d(this.$album_art.get(h));this.$current_album_art.show();this.$album_art.not(this.$current_album_art).hide();this.truncate_text();this.$player.removeClass("message");var f=this.config.post_key?"?play_key="+this.config.post_key:"";this.audiojs.load(this.current_track.stream_url+f);this.equalizer_levels(0);if(!this.audiojs.settings.useFlash){this.use_audio_context(Tumblr.AudioPlayer.context)}return true},play_pause:function(){return this.audiojs.playing?this.audiojs.pause():this.audiojs.play()},smart_play_pause:function(f){if(typeof f==="undefined"){f=!this.audiojs.playing}if(this.flash_error){return false}else{if(!this.audiojs.loadedPercent){if(f&&this.load_track(this.config.start_at)){this.play()}}else{if(!this.error){return f?this.play():this.pause()}}}},play:function(){return this.audiojs.play()},pause:function(){return this.audiojs.pause()},skip_to:function(f){return this.audiojs.skipTo(f)},previous_track:function(){if(this.load_track(this.current_track_id-1)){this.play();return true}return false},next_track:function(){if(this.load_track(this.current_track_id+1)){this.play();return true}return false},get_seek_progress:function(f){if(typeof f!=="number"){f=this.$seek_position.position().left}return Math.max(0,Math.min(f/this.$progress_container.width(),1))},set_play_progress:function(f){this.$play_progress.width((100*f)+"%");this.$playhead.css("left",(100*f)+"%")},set_time:function(g,f){if(typeof g!=="number"){g=0}this.$current_time.text(a.format_time(g));if(typeof f!=="number"){return}this.$total_time.text(a.format_time(f))},set_load_progress:function(f){this.$load_progress.width((100*f)+"%")},album_art_lightbox:function(f){if(f&&!a.is_left_click(f)){return true}if(!this.config.lightbox){return false}var g=this.current_track_info("cover");if(!g){return false}return this.config.lightbox.init([{high_res:g}])},truncate_text:function(g){var h=this.$text_wrapper.width();if(!h){if(typeof g!=="number"){g=10}if(g>0){_.delay(d.proxy(this.truncate_text,this),100,--g);return}}var f=this.max_lines(this.$track_name,3,"...");this.max_lines(this.$artist_name,4-f,"...")},max_lines:function(f,n,j){var m=d(f);var l=m.clone().css("opacity",0.5).text("A");m.after(l);var k=l.height(),h=k*n;if(!m.data("full_text")){m.data("full_text",m.text())}if(!h){l.remove();m.text("");return n}l.text(m.data("full_text"));if(l.height()<=h){l.remove();m.text(m.data("full_text"));return Math.ceil(m.height()/k)}if(typeof j!=="string"){j="..."}var i=m.data("full_text").split(" ");var g=0;do{l.text(i.slice(0,++g).join(" ")+j)}while(l.height()<=h&&g<=i.length);m.text(i.slice(0,g-1).join(" ")+j);l.remove();return Math.ceil(m.height()/k)},use_audio_context:function(g){if(!g){return false}this.context=g;this.source=this.context.createMediaElementSource(this.audiojs.source);this.analyser_node=this.context.createAnalyser();this.analyser_node.fftSize=128;this.analyser_node.smoothingTimeConstant=0.2;this.frequency_array=new Uint8Array(this.analyser_node.frequencyBinCount);this.nodes=[this.source,this.analyser_node,this.context.destination];for(var f=1;f<this.nodes.length;f++){this.nodes[f-1].connect(this.nodes[f])}},read_analyser_frequencies:function(l,h,r,p){if(this.analyser_node){this.analyser_node.getByteFrequencyData(this.frequency_array)}else{if(this.audiojs.settings.useFlash&&this.audiojs.settings.hasFlash){var s;try{s=this.audiojs.element.getByteFrequencyData()}catch(m){return false}if(!s||s==="NO_ACCESS"||s.match(/ERR/)){this.equalizer_levels(0);return false}var j=s.match(/.{1,2}/g);var q=Math.floor(0.5*j.length);var f;var o=true;this.frequency_array=[];for(var k=0;k<q;k++){f=0.5*(parseInt(j[k],16)+parseInt(j[k+q],16));if(f){o=false}this.frequency_array.push(f)}if(o){return false}}else{return false}}if(typeof r!=="number"){r=1}if(typeof p!=="number"){p=0}var g=a.scale_array_values(this.frequency_array,this.config.eq.bands+p,true,function(t,n){t*=r;if(l){t/=l}if(h){return Math.max(0,Math.min(t,1))}else{return t}});if(p){return g.slice(0,this.config.eq.bands)}else{return g}},generate_equalizer:function(){if(this.$equalizer){this.$equalizer.remove()}var h=this.config.eq;if(!h){return false}this.$equalizer=d("<div/>").addClass("audio_equalizer");if(!this.config.preview&&!this.$container.hasClass("has_art")){h.bands=7}var g,j;for(var f=0;f<h.bands;f++){g=d("<div/>").addClass("audio_equalizer_band").data({wait:0,peak:0,level:0}).appendTo(this.$equalizer);for(var i=0;i<h.levels;i++){j=d("<b>").appendTo(g);if(i===h.levels-1){j.addClass("peak")}}}this.$visualizer.append(this.$equalizer);return true},equalizer_levels:function(i,j,g,f){if(!this.$equalizer){return false}if(typeof i!=="number"&&!d.isArray(i)){var h=[];this.$equalizer.children(".audio_equalizer_band").each(function(k,l){h[k]=d(l).data("level")});return h}this.$equalizer.children(".audio_equalizer_band").each(d.proxy(function(n,q){var r=0;if(typeof i==="number"){r=i}else{if(i&&n<i.length&&i[n]){r=i[n]}}var o=d(q);var l=this.config.eq.levels;var m=Math.floor(r*(l-1));var p=parseFloat(o.data("peak"))||0;var k=j||(r>p);if(k){o.data({wait:10,peak:r})}o.data("level",r);o.children("b").each(function(s,u){var t=d(u);t.removeClass("on");if(!g&&l-m<s+1){t.addClass("on")}if(k){t.removeClass("peak");if(f){if(l-m-0.5*f<=s+1&&l-m+0.5*f>s+1){t.addClass("peak")}}else{if(l-m===s+1){t.addClass("peak")}}}})},this));return true},equalizer_image:function(f){if(!this.$equalizer){return false}this.$equalizer.children(".audio_equalizer_band").each(d.proxy(function(g,i){var h=d(i);h.children("b").each(function(l,k){var j=d(k);j.removeClass("on peak");if(g>=f.length){return}if(l>=f[g].length){return}if(f[g][l]<0){j.addClass("on")}else{if(f[g][l]>0){j.addClass("peak")}}})},this));return true},equalizer_dolphin:function(f,j,i,h){var g=a.offset_image(a.dolphin_frames[i?1:0],f,j,h);return this.equalizer_image(g)},equalizer_peaks:function(){if(!this.$equalizer){return false}var f=true;this.$equalizer.children(".audio_equalizer_band").each(d.proxy(function(j,n){var k=d(n);var l=parseFloat(k.data("peak"))||0;var o=parseFloat(k.data("level"))||0;var m=parseFloat(k.data("wait"))||0;if(l!==o){f=false}if(m>0){k.data("wait",m-1);return}l=Math.max(l-0.1,o);k.data("peak",l);var g=this.config.eq.levels;var h=Math.floor(l*(g-1));k.data("peak",l);k.children("b").each(function(p,r){var q=d(r);q.removeClass("peak");if(g-h===p+1){q.addClass("peak")}})},this));return f},set_animation_callback:function(h,f,g){if(!h){return this.reset_animation()}this.animation_callback=h;this.animation_interval=f||30;this.animation_arguments=g||[];this.last_tick=0},reset_animation:function(){this.animation=false;d(document.body).trigger("tumblr:audio:animation_complete",{audioplayer:this});this.animation_callback=false;this.animation_interval=false;this.animation_arguments=[];this.last_tick=0},animation_tick:function(f,g){if(!this.animation_callback){return false}if(!(g||this.onscreen)){return false}if(this.last_tick&&f-this.last_tick<this.animation_interval){return false}this.animation_callback.apply(this,this.animation_arguments);this.last_tick=f;return true},demo_animation_start:function(g){if(a.config.disable_inactive_loop){return false}if(!(g||this.$player.hasClass("inactive"))){return false}var f=60;var h=this.current_track_info("bpm")||150;this.demo_frequency=h/2/Math.PI/f;this.demo_loop_index=0;this.set_animation_callback(this.demo_animation_tick,f)},demo_animation_tick:function(){this.loop_index++;var f=Math.abs(Math.tan(Math.sin(this.demo_frequency*this.demo_loop_index))*2/Math.PI);f*=0.5*Math.max(0,Math.sin(0.5*this.demo_frequency*this.demo_loop_index))+0.5;f=0.4*Math.abs(f)+0.6;this.equalizer_levels(this.generate_demo_eq(0.75*f,0.3,0.2,1.6));this.equalizer_peaks()},playing_animation_start:function(){var f=30;if(typeof this.fallback_offset!=="number"){this.fallback_offset=0}if(this.real_frequencies){this.set_animation_callback(this.visualizer_animation_tick,f,[true,true,false])}else{this.set_animation_callback(this.fallback_animation_tick,f)}},paused_animation_start:function(g){var f=30;if(g){this.equalizer_levels(0)}this.set_animation_callback(this.visualizer_animation_tick,f,[false,true,true])},visualizer_animation_tick:function(h,i,f){if(h){this.equalizer_levels(this.read_analyser_frequencies(255,true,1.3,2))}var g=false;if(i){g=this.equalizer_peaks();this.animation=true}if(g&&f){this.reset_animation()}},fallback_animation_tick:function(){if(this.playing){this.fallback_offset++}this.equalizer_levels(this.generate_sine_eq(this.fallback_offset),true,true,2)},idle_animation_start:function(){if(!this.$equalizer){return}this.dolphin_width=6;this.dolphin_height=5;this.dolphin_x=-this.dolphin_width;this.dolphin_y=0;this.dolphin_left=false;this.dolphin_up=false;this.dolphin_frame=0;this.dolphin_min_x=-1;this.dolphin_max_x=this.config.eq.bands-this.dolphin_width+1;this.dolphin_min_y=-1;this.dolphin_max_y=this.config.eq.levels-this.dolphin_height+1;if(!a.dolphin_frames){a.generate_dolphins()}this.set_animation_callback(this.idle_animation_tick,300)},idle_animation_tick:function(){this.equalizer_dolphin(this.dolphin_x,this.dolphin_y,this.dolphin_frame,this.dolphin_left);this.dolphin_frame=(this.dolphin_frame+1)%a.dolphin_frames.length;if(this.dolphin_frame!==0){return}this.dolphin_x+=this.dolphin_left?-1:1;this.dolphin_y+=this.dolphin_up?-1:1;if(!this.dolphin_left&&this.dolphin_x>=this.dolphin_max_x){this.dolphin_x=this.dolphin_max_x;this.dolphin_left=true}else{if(this.dolphin_left&&this.dolphin_x<=this.dolphin_min_x){this.dolphin_x=this.dolphin_min_x;this.dolphin_left=false}}if(!this.dolphin_up&&this.dolphin_y>=this.dolphin_max_y){this.dolphin_y=this.dolphin_max_y;this.dolphin_up=true}else{if(this.dolphin_up&&this.dolphin_y<=this.dolphin_min_y){this.dolphin_y=this.dolphin_min_y;this.dolphin_up=false}}},visualizer_fallback_tick:function(){var h=this.fallback_offset++;var g=this.config.eq.bands;var f=_.range(g).map(function(j,k){return 0.3*Math.sin(k+0.3*h)+0.5});this.equalizer_levels(f,true,true,2)},generate_sine_eq:function(h,f){var g=this.config.eq?this.config.eq.bands:11;if(typeof h!=="number"){h=0}if(typeof f!=="number"){f=0.3}return _.range(g).map(function(j,k){return f*Math.sin(k+0.3*h)+0.5})},generate_demo_eq:function(i,h,f,g){if(typeof i!=="number"){i=1}if(typeof h!=="number"){pad=0}if(typeof f!=="number"){f=0}if(typeof g!=="number"){g=1}return _.range(this.config.eq.bands).map(d.proxy(function(j,k){var l=Math.max(0,Math.min(1-k/(this.config.eq.bands-1)+h,1));return Math.pow(i*l*(f*Math.random()+1-f),g)},this))},track_info:function(h,g){if(!this.tracks.length){return}if(typeof h==="undefined"){h=this.config.start_at}if(h<0||h>=this.tracks.length){return}var f=this.tracks[h];return g?f[g]:f},current_track_info:function(f){return this.track_info(this.current_track_id,f)},is_onscreen:function(g){if(!this.rect){return}if(typeof g!=="number"){g=50}var i=this.$container.offset().top;var f=this.$container.offset().top+this.$container.height();var h=this.rect.windowScrollTop;var j=h+this.rect.windowHeight;if(i>j+g){return(this.onscreen=false)}if(f<h-g){return(this.onscreen=false)}return(this.onscreen=true)},needs_animation:function(f){if(f){this.is_onscreen()}if(!this.onscreen){return false}if(this.playing||this.animation){return true}if(!a.config.disable_inactive_loop&&this.$player.hasClass("unplayed")){return true}if(!this.$player.hasClass("unplayed")&&this.$player.hasClass("inactive")){return true}return false},current_state:function(f){var g="";if(this.playing){g="playing"}else{if(this.$player.hasClass("unplayed")){g="unplayed"}else{if(this.$player.hasClass("inactive")){g="inactive"}else{if(this.$player.hasClass("error")){g="error"}else{g="paused"}}}}if(typeof f==="undefined"){return g}else{return(g===f)}}};a.instances=[];a.register=function(f){this.instances.push(f)};a.unregister=function(f){this.instances.splice(_.indexOf(this.instances,f),1)};a.config={disable_inactive_loop:true,draw_offscreen:false,one_at_a_time:true,auto_advance:false,key_commands:true};a.key_commands=false;a.idle_delay=1;a.__init_jukebox=function(f){this.config=d.extend(this.config,f);d(document.body).on("click.tumblraudio",".audio_player_container.placeholder",function(i){var h=Tumblr.AudioPlayer.replace_placeholder(d(i.currentTarget));h.smart_play_pause()});d(document.body).on({"tumblr:audio:animation_complete":d.proxy(function(i,h){this.update_onscreen()},this),"tumblr:audio:playing":d.proxy(function(i,h){this.current_player_id=d.inArray(h.audioplayer,this.instances);this.current_player=h.audioplayer;d("iframe.tumblr_video_iframe").each(function(j,k){k.contentWindow.postMessage("pause","*")});this.update_onscreen()},this),"tumblr:audio:pause":d.proxy(function(i,h){this.update_onscreen()},this),"tumblr:audio:ended":d.proxy(function(i,h){if(this.config.auto_advance){if(this.current_player_id+1<this.instances.length){this.instances[this.current_player_id+1].on_overlay_mousedown()}}},this),mousedown:d.proxy(function(h){this.set_key_commands(false)},this),keydown:d.proxy(function(i){if(!i){return false}if(!this.key_commands){return true}if(!this.current_player){return true}var h=i.charCode?i.charCode:i.keyCode;switch(h){case 32:this.current_player.play_pause();i.preventDefault();i.stopPropagation();return false;case 37:if(!(i.ctrlKey||i.metaKey)){return true}i.preventDefault();i.stopPropagation();if(this.current_player.current_time>2){this.current_player.skip_to(0);return false}return !this.current_player.previous_track();case 39:if(!(i.ctrlKey||i.metaKey)){return true}i.preventDefault();i.stopPropagation();return !this.current_player.next_track();case 27:this.set_key_commands(false);return false}},this)});if(b.DOMEventor){b.Events.on("DOMEventor:flatscroll",_.debounce(this.update_onscreen,100),this);this.prototype.rect=b.DOMEventor.rect()}else{d(window).on("scroll",_.debounce((function(h){var j=d(window);var i=h.prototype.rect={};return function(){i.windowScrollTop=j.scrollTop();i.windowHeight=j.height();h.update_onscreen()}})(this),100))}try{Tumblr.PostMessageListener.initialize(function(i,h){if(i[0]==="video_do_play"){Tumblr.AudioPlayer.pause_all()}})}catch(g){}};a.update_all=function(){var f=false;var g=false;var h=(!this.current_player||!this.current_player.playing);this.replace_placeholders();d.each(this.instances,d.proxy(function(k,j){if(j.is_onscreen()){f=true}if(!g&&j.needs_animation()){g=true}if(h&&j.current_state("unplayed")){j.demo_animation_start(false)}},this));if(this.instances.length){if(g){this.animation_start()}else{this.animation_stop()}}};a.update_onscreen=function(){var f=false;var g=false;d.each(this.instances,function(j,h){if(h.is_onscreen()){f=true}if(!g&&h.needs_animation()){g=true}});if(this.instances.length){if(g){this.animation_start()}else{this.animation_stop()}}};a.pause_all=function(f){d.each(this.instances,function(h,g){if(f&&f===g.config.post_id){return}g.pause()})};a.animation_start=function(){if(this.animating){return}this.animating=true;window.cancelAnimationFrame(this.animation_frame);this.animation_frame=window.requestAnimationFrame(this._animation_tick)};a.animation_tick=function(){var f=Date.now();d.each(this.instances,d.proxy(function(h,g){g.animation_tick(f,this.config.draw_offscreen)},this));if(this.animating){this.animation_frame=window.requestAnimationFrame(this._animation_tick)}};a._animation_tick=d.proxy(a.animation_tick,a);a.animation_stop=function(f){this.animating=false;window.cancelAnimationFrame(this.animation_frame)};a.inactive_player_demo=function(){d.each(this.instances,function(g,f){if(f.current_state("unplayed")){f.demo_animation_start(false)}})};a.when_dolphins_cry=function(){d.each(this.instances,function(g,f){f.idle_animation_start()})};a.create_context=function(){try{this.context=new webkitAudioContext();return this.context}catch(f){return false}};a.replace_placeholders=function(f,g){var h=f?d(f):d(document.body);h.find(".audio_player_container.placeholder").each(_.bind(function(j,k){this.replace_placeholder(k)},this));if(g){this.clean_up(true)}};a.replace_placeholder=function(h){var k=".audio_player_container";var f=d(h);var i=f.data();var j=d("<div/>");f.before(j);var g=new a({post_key:i.postKey,replace:j,player_classes:i.playerClasses,post_id:i.postId,service:i.service,cover:i.cover,tracks:[{bpm:i.bpm,stream_url:i.streamUrl,track:i.track,artist:i.artist,album:i.album,cover:i.cover}],localized:{no_id3:i.noId3,flash_error:i.flashError}});f.remove();return g};a.clean_up=function(h){if(!document.body){return}var g,f;for(g=0;g<this.instances.length;g++){f=this.instances[g];if(!f.$container.closest(document.body).length){this.unregister(f);g--}}if(h){this.sort()}};a.sort=function(){d.each(d(".audio_player_container"),function(g,f){d(f).data("tumblr_audioplayer_sort",g)});this.instances.sort(function(g,f){return g.$container.data("tumblr_audioplayer_sort")-f.$container.data("tumblr_audioplayer_sort")});this.current_player_id=d.inArray(this.current_player,this.instances)};a.scale_array_values=function(g,l,k,j){if(l<=0){return[]}if(g.length===l){if(typeof j==="function"){return g.slice().map(j)}else{return g.slice()}}if(l===1){var i=_.reduce(g,function(o,p){return o+p},0);if(typeof j==="function"){return[j(i)]}else{return[i]}}var f=_.range(l);var h=g.length/l;if(h>1){return f.map(function(n,q){var s=q*h;var p=q*h+h;var t=1-s%1;var r=p%1;s=Math.floor(s);p=Math.floor(p);if(!r&&s+1<p){p-=1;r=1}var m=t*g[s]+r*g[p];for(var o=s+1;o<p;o++){m+=g[o]}if(k){m/=h}if(typeof j==="function"){return j(m)}else{return m}})}else{return f.map(function(n,o){var p=Math.floor(o*h);var m=g[p]*h;if(k){m/=h}if(typeof j==="function"){return j(m)}else{return m}})}};a.format_title=function(f){var g="";if(f.artist){g+=f.artist}if(f.track){if(g){g+=" "}g+="&quot;"+f.track+"&quot;"}if(f.album){if(g){g+=" "}g+="(from '"+f.album+"')"}return g};a.format_time=function(i){if(!i||i<0){i=0}function h(l,k){if(typeof l!=="string"){l=l.toString()}return l.length<k?h("0"+l,k):l}var j=Math.floor(i%60);var g=Math.floor(i/60)%60;var f=Math.floor(i/3600);if(f){return f+":"+h(g,2)+":"+h(j,2)}else{return g+":"+h(j,2)}};a.has_equalizer_support=function(){if(this.context||this.create_context()){if(/chrome/.test(navigator.userAgent.toLowerCase())){return true}}else{if(Tumblr.flashVersion()>=9){return false}}return false};a.is_left_click=function(f){return !(f&&(f.which>1||f.which<=1&&f.ctrlKey))};a.generate_image=function(g,j){var f,l,k=[];for(var h=0;h<g.length;h++){f=h%j;l=Math.floor(h/j);if(!k[f]){k[f]=[]}switch(g[h]){case" ":k[f][l]=0;break;case"o":k[f][l]=-1;break;default:case"x":k[f][l]=1;break}}return k};a.offset_image=function(j,f,k,g){j=j.slice();if(g){j.reverse()}if(f>0){d.each(_.range(f),function(){j.unshift([])})}else{if(f<0){j.splice(0,-f)}}if(k){for(var h=0;h<j.length;h++){j[h]=j[h].slice();if(k>0){d.each(_.range(k),function(){j[h].unshift(0)})}else{if(k<0){j[h].splice(0,-k)}}}}return j};a.generate_dolphins=function(){this.dolphin_frames=[this.generate_image("   x  x  xx xxxxxxx oxoo   x  ",6),this.generate_image("   x     xx x xxxxxxoxoox  x  ",6)];return this.dolphin_frames};a.set_key_commands=function(f,g){if(this.ignore_next){this.ignore_next=false;return this.key_commands}if(g){this.ignore_next=true}this.key_commands=this.config.key_commands&&f;return this.key_commands};var e=(function(){var j=new RegExp("audio(\\.min|_src|_player)?\\.js.*"),k=new RegExp("(^[^/]+//[^/]+|)(/.*$)|(.*)"),f=document.getElementsByTagName("script");for(var g=0,h=f.length;g<h;g++){var l=f[g].getAttribute("src");if(j.test(l)){return l.replace(k,"$1")}}return""})();a.defaults={template:_.template('<div class="audio_player_container"><div class="album_art_container"><% if (cover) { %><img src="<%= cover %>" alt="<%- title %>" class="album_art main"/><% }%><% _.each(tracks, function(t, i) { %><% if (t.cover) { %><img src="<%= t.cover %>" alt="<%- Tumblr.AudioPlayer.format_title(t) %>" class="album_art album_art_<%= i %>"/><% }%><% }); %></div><div class="audio_player inactive unplayed"><div class="audio_controls"><div class="progress_container"><div class="load_progress"></div><div class="play_progress"></div><i class="playhead"></i><i class="seek_position"></i><i class="seek_time"></i></div><div class="player_text_wrapper"><div class="player_text"><% if (tracks.length) { %><ul class="id3_tags"><li class="track_name"><%- tracks[0].track %></li><li class="artist_name"><%- tracks[0].artist %></li><li class="album_name"><%- tracks[0].album %></li></ul><% } %></div></div><ul class="time_container"><li class="current_time">0:00</li><li class="separator"> / </li><li class="total_time">0:00</li></ul><div class="seek_overlay"></div><div class="play_pause_container"><i class="play_button audio_player_button">'+c("Play")+'</i><i class="pause_button audio_player_button">'+c("Pause")+'</i><i class="error_x audio_player_button">'+c("X")+'</i></div><div class="audio_message_container"><span class="audio_message_text">'+c("Listen")+'</span></div></div><div class="audio_visualizer"></div><div class="audio_player_overlay"></div></div></div>'),preview:false,eq:{width:330,height:84,padding_x:16,padding_y:7,bands:11,levels:14,tick_width:18,tick_height:3,tick_radius:2,tick_margin_x:10,tick_margin_y:2},cover:"",service:"",player_classes:"",autoplay:false,tracks:[{bpm:150,stream_url:"",track:"",artist:"",album:"",cover:""}],start_at:0,lightbox:Tumblr.Lightbox,audiojs_settings:{swfLocation:e+"/javascript/audio-js/audiojs.swf",createPlayer:{playPauseClass:"play_pause_container",scrubberClass:"progress_container",progressClass:"play_progress",loaderClass:"load_progress",timeClass:"time_container",durationClass:"total_time",playedClass:"current_time",errorMessageClass:"audio_message_text",playingClass:"playing",loadingClass:"loading",errorClass:"error"},css:"",trackEnded:function(g){var f=this.audioplayer;f.playing=false;audiojs.settings.trackEnded.apply(this,arguments);f.$player.addClass("inactive");f.paused_animation_start(true);f.idle_timeout=_.delay(d.proxy(f.idle_animation_start,f),a.idle_delay*1000);d(document.body).trigger("tumblr:audio:ended",{audioplayer:f})},flashError:function(){if(!this.audioplayer){return}audiojs.settings.flashError.apply(this,arguments);var f=this.audioplayer;f.playing=false;f.flash_error=true;f.error=true;f.$player.addClass("inactive error flash_error").removeClass("playing");f.$message_text.html(f.localized.flash_error)},loadError:function(){audiojs.settings.loadError.apply(this,arguments);var f=this.audioplayer;f.error=true;f.$player.addClass("inactive error").removeClass("playing");f.$message_text.html(c("Error"))},init:function(){return audiojs.settings.init.apply(this,arguments)},loadStarted:function(){audiojs.settings.loadStarted.apply(this,arguments);var f=this.audioplayer;f.error=false},loadProgress:function(f){return audiojs.settings.loadProgress.apply(this,arguments)},flashReady:function(){var f=this.audioplayer;f.__cache_selectors();f.__init_visualizations();f.bind_events();d(document.body).trigger("tumblr:audio:flashready",{audioplayer:f})},play:function(){audiojs.settings.play.apply(this,arguments);var f=this.audioplayer;f.$player.removeClass("inactive unplayed");f.playing=true;f.playing_animation_start();clearTimeout(f.idle_timeout);d(document.body).trigger("tumblr:audio:playing",{audioplayer:f})},pause:function(){audiojs.settings.pause.apply(this,arguments);var f=this.audioplayer;f.playing=false;if(!f.$player.hasClass("inactive")){f.paused_animation_start()}clearTimeout(f.idle_timeout);d(document.body).trigger("tumblr:audio:pause",{audioplayer:f})},updatePlayhead:function(g){audiojs.settings.updatePlayhead.apply(this,arguments);var f=this.audioplayer;f.$player.addClass("duration");f.total_time=this.element.duration||this.duration;f.current_time=f.total_time*g;f.play_progress=f.current_time/f.total_time;f.set_play_progress(f.play_progress);f.set_time(f.current_time,f.total_time);d(document.body).trigger("tumblr:audio:update",{current_time:a.format_time(f.current_time),total_time:a.format_time(f.total_time),audioplayer:f})}}};b.AudioPlayer=a;d(function(){if(Tumblr.AudioPlayerSettings&&!d.isEmptyObject(Tumblr.AudioPlayerSettings)){Tumblr.AudioPlayer.defaults=d.extend(Tumblr.AudioPlayer.defaults,Tumblr.AudioPlayerSettings)}a.__init_jukebox()});d(window).on("load",function(f){a.create_context()})})(jQuery,Tumblr);
/*! scripts/audio_player.js */

/*! scripts/dashboard_ask.js */
(function(d,a){var c=c||function(g){return g};var e={initialize:function(){d(document).on("click","a.ask",_.bind(function(g){g.preventDefault();this.open_ask(d(g.currentTarget))},this))},open_ask:function(g){Tumblr.Popover.hide_all();var h=g.attr("data-tumblelog-name");var i=(parseInt(g.data("anonymous-ask"),10)===1)?true:false;this.model=new f();if(this.view){this.view.destroy()}this.view=new b({model:this.model,recipient:h,allow_anonymous:i}).show_form()}};var f=Backbone.Model.extend({defaults:{form_key:d("#tumblr_form_key").attr("content")},urlRoot:"/svc/post/ask",validate:function(g){if(!d.trim(g.question)){return{error:c("You need to enter a question!")}}else{if(this.is_url(g.question)){return{error:c("Sorry, but please don't include links in questions.")}}}if(g.response&&g.response.errors){return g.response.errors}},is_url:function(g){return !!(g.match(/(http|https):\/\//i)||g.match(/www\./i)||g.match(/[a-zA-Z0-9]+(\.arpa|\.root|\.aero|\.biz|\.cat|\.com|\.coop|\.edu|\.gov|\.info|\.int|\.jobs|\.mil|\.mobi|\.museum|\.name|\.net|\.org|\.pro|\.travel|TLD|\.ac|\.ad|\.ae|\.af|\.ag|\.ai|\.al|\.am|\.an|\.ao|\.aq|\.ar|\.as|\.at|\.au|\.aw|\.ax|\.az|\.ba|\.bb|\.bd|\.be|\.bf|\.bg|\.bh|\.bi|\.bj|\.bm|\.bn|\.bo|\.br|\.bs|\.bt|\.bv|\.bw|\.by|\.bz|\.ca|\.cc|\.cd|\.cf|\.cg|\.ch|\.ci|\.ck|\.cl|\.cm|\.cn|\.co|\.cr|\.cu|\.cv|\.cx|\.cy|\.cz|\.de|\.dj|\.dk|\.dm|\.do|\.dz|\.ec|\.ee|\.eg|\.er|\.es|\.et|\.eu|\.fi|\.fj|\.fk|\.fm|\.fo|\.fr|\.ga|\.gb|\.gd|\.ge|\.gf|\.gg|\.gh|\.gi|\.gl|\.gm|\.gn|\.gp|\.gq|\.gr|\.gs|\.gt|\.gu|\.gw|\.gy|\.hk|\.hm|\.hn|\.hr|\.ht|\.hu|\.id|\.ie|\.il|\.im|\.in|\.io|\.iq|\.ir|\.is|\.it|\.je|\.jm|\.jo|\.jp|\.ke|\.kg|\.kh|\.ki|\.km|\.kn|\.kr|\.kw|\.ky|\.kz|\.la|\.lb|\.lc|\.li|\.lk|\.lr|\.ls|\.lt|\.lu|\.lv|\.ly|\.ma|\.mc|\.md|\.mg|\.mh|\.mk|\.ml|\.mm|\.mn|\.mo|\.mp|\.mq|\.mr|\.ms|\.mt|\.mu|\.mv|\.mw|\.mx|\.my|\.mz|\.na|\.nc|\.ne|\.nf|\.ng|\.ni|\.nl|\.no|\.np|\.nr|\.nu|\.nz|\.om|\.pa|\.pe|\.pf|\.pg|\.ph|\.pk|\.pl|\.pm|\.pn|\.pr|\.ps|\.pt|\.pw|\.py|\.qa|\.re|\.ro|\.ru|\.rw|\.sa|\.sb|\.sc|\.sd|\.se|\.sg|\.sh|\.si|\.sj|\.sk|\.sl|\.sm|\.sn|\.so|\.sr|\.st|\.su|\.sv|\.sy|\.sz|\.tc|\.td|\.tf|\.tg|\.th|\.tj|\.tk|\.tl|\.tm|\.tn|\.to|\.tp|\.tr|\.tt|\.tv|\.tw|\.tz|\.ua|\.ug|\.uk|\.um|\.us|\.uy|\.uz|\.va|\.vc|\.ve|\.vg|\.vi|\.vn|\.vu|\.wf|\.ws|\.ye|\.yt|\.yu|\.za|\.zm|\.zw)/i))}});var b=Backbone.View.extend({className:"ask_container",events:{"click button.close":"__close_button_click","keydown #question":"__textarea_keydown","input #question":"__textarea_input","change #question":"__textarea_input","submit #ask_form":"__form_submit","change #ask_anonymously":"__ask_anonymously_change"},__close_button_click:function(g){g.preventDefault();this.hide_form()},__textarea_keydown:function(g){if(g.keyCode===13){g.preventDefault()}},__textarea_input:function(g){this.update()},__form_submit:function(g){g.preventDefault();this.submit_form()},__ask_anonymously_change:function(h){var g=d(h.currentTarget);this.toggle_anonymous(g)},__keydown:function(g){if(g.keyCode===27){this.hide_form(g)}},initialize:function(g){this.options=g||{};this.template=d("#dashboard_ask_template").html();this.$body=d("body");this.ask_limit=Tumblr.ASK_CHARACTER_LIMIT||500;this.recipient=this.options.recipient;this.recipient_avatar=this.options.recipient_avatar;this.allow_anonymous=this.options.allow_anonymous;this.render();var h={lines:13,length:6,width:2,radius:6,color:"rgba(0,0,0,.5)",speed:0.9,trail:34,shadow:false,hwaccel:false,className:"spinner",zIndex:2000000000,top:"0",left:"0"};this.keyboard_events={keydown:_.bind(this.__keydown,this)};this.spinner=new Spinner(h)},render:function(){var g=_.template(this.template);this.$body.append(this.$el.append(g({recipient:this.recipient,allow_anonymous:this.allow_anonymous})));this.cache_selectors();this.is_ie9=d("html").hasClass("ie9");if(this.is_ie9){this.disable_submit()}Tumblr.PlaceHolders.init({els:this.$("#question"),clear_on_submit:true});return this},cache_selectors:function(){this.$form=this.$("form");this.$loader=this.$(".post_loader");this.$plexi=this.$(".plexi");this.$question=this.$("#question");this.$character_count=this.$("#character_count");this.$post_form_wrapper=this.$(".post_form_wrapper");this.$close_button=this.$("button.close");this.$post_avatar=this.$(".post_avatar");this.$post_avatar_link=this.$(".post_avatar_link");this.$tumblelog_name=this.$("#from .tumblelog_name");this.$anonymous=this.$("#from .anonymous");this.$anonymous_avatar=this.$(".post_avatar .anonymous");this.$ask_button=this.$("#ask_button")},toggle_anonymous:function(g){this.is_anonymous=g.prop("checked");if(this.is_anonymous){this.$post_avatar_link.removeClass("use_blog_avatar");this.$tumblelog_name.hide();this.$anonymous.show()}else{this.$post_avatar_link.addClass("use_blog_avatar");this.$tumblelog_name.show();this.$anonymous.hide()}},show_form:function(){Tumblr.KeyCommands.suspend();d(document).on("keydown",this.keyboard_events.keydown);this.$body.addClass("scrollverlay_active");this.$plexi.addClass("active");setTimeout(_.bind(function(){this.$plexi.addClass("show");this.$post_form_wrapper.addClass("active")},this),10);return this},hide_form:function(){Tumblr.KeyCommands.resume();this.$post_form_wrapper.removeClass("active");this.$plexi.removeClass("show");setTimeout(_.bind(function(){this.$plexi.removeClass("active");this.destroy()},this),250);this.$body.removeClass("scrollverlay_active");return this},show_loader:function(){this.$loader.show();this.$close_button.hide();setTimeout(_.bind(function(){this.$loader.addClass("active")},this),10);this.spinner.spin(this.$(".loader").get(0))},hide_loader:function(){this.$close_button.show();this.$loader.removeClass("active");this.spinner.stop();this.$loader.hide()},serialize:function(i,j){var h={};var g=i.serializeArray();d.each(g,function(){if(h[this.name]!==undefined){if(!h[this.name].push){h[this.name]=[h[this.name]]}h[this.name].push(this.value||"")}else{h[this.name]=this.value||""}});return(j)?JSON.stringify(h):h},destroy:function(){this.remove();d(document).off("keydown",this.keyboard_events.keydown)},update:function(){if(d.trim(this.$question.val()).length>0){this.enable_submit()}else{this.disable_submit()}if(this.$question.val().match(/\n/g)){this.$question.val(this.$question.val().replace(/\n/g,""))}if(this.$question.val().length>this.ask_limit){this.$question.val(this.$question.val().substring(0,this.ask_limit))}var g=this.ask_limit-this.$question.val().length;this.$character_count.text(g);if(g<=100){this.$character_count.addClass("active");if(g>40){this.$character_count.css({color:"#a8b1ba"})}else{if(g>20&&g<=40){this.$character_count.css({color:"#b2212e"})}else{this.$character_count.css({color:"#cd1828"})}}}else{this.$character_count.removeClass("active")}},enable_submit:function(){if(!this.is_ie9){this.$ask_button.prop("disabled",false)}else{this.$ask_button.prop("disabled",false).removeClass("ui_disabled")}},disable_submit:function(){if(!this.is_ie9){this.$ask_button.prop("disabled",true)}else{this.$ask_button.prop("disabled",false).addClass("ui_disabled")}},submit_form:function(){var g=this.serialize(this.$form);this.show_loader();this.delay_loader=setTimeout(_.bind(function(){this.show_loader()},this),150);this.model.save(g,{success:_.bind(function(h){setTimeout(_.bind(function(){clearTimeout(this.delay_loader);if(typeof Tumblr.Toaster==="object"&&typeof Tumblr.ToastKit==="object"){var j="Sent to %1$s";j=Tumblr.ToastKit.__(j).replace("%1$s",this.recipient);var i={type:"image_text",message:"<strong>"+j+" </strong>",is_link:false,href:"#",img1:{url:(this.is_anonymous)?this.$anonymous_avatar.data("anonymous-avatar-url"):this.$post_avatar_link.data("user-avatar-url"),is_link:false,href:"#"}};Tumblr.Toaster.add_toast(i)}this.hide_form()},this),350)},this),error:_.bind(function(h,i){clearTimeout(this.delay_loader);this.hide_loader();this.display_errors(i)},this)})},show_messages:function(h,i){var j=this.$("."+h);var g=j.get(0);if(!g){return}j.empty();if(typeof i==="string"){i=[i]}_.each(i,function(l){var k=d("<li/>",{text:l});j.append(k)});j.show().fadeTo(250,1)},hide_messages:function(g){var h=this.$("."+g);if(!h.length){return}h.empty().hide()},display_errors:function(g){this.show_messages("errors",g)},hide_errors:function(){this.hide_messages("errors")}});a.DashboardAsk=e;a.DashboardAskModel=f;a.DashboardAskView=b})(jQuery,Tumblr||{});jQuery(function(){Tumblr.DashboardAsk.initialize()});
/*! scripts/jquery.sparkline.min.js */
(function(b){typeof define=="function"&&define.amd?define(["jquery"],b):b(jQuery)})(function(ar){var aq={},ap,ao,an,am,al,ak,aj,ai,ah,ag,af,ae,ad,ac,aa,Y,W,U,S,Q,O,M,K,J,ab,Z,X,V,T,R,P,N,L=0;ap=function(){return{common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:!1,enableHighlight:!0,highlightLighten:1.4,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!1,disableInteraction:!1},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:undefined,normalRangeMax:undefined,normalRangeColor:"#ccc",drawNormalOnTop:!1,chartRangeMin:undefined,chartRangeMax:undefined,chartRangeMinX:undefined,chartRangeMaxX:undefined,tooltipFormat:new an('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],zeroColor:undefined,nullColor:undefined,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:undefined,chartRangeMin:undefined,chartRangeClip:!1,colorMap:undefined,tooltipFormat:new an('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new an('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),tooltipValueLookups:{map:{"-1":"Loss",0:"Draw",1:"Win"}}},discrete:{lineHeight:"auto",thresholdColor:undefined,thresholdValue:0,chartRangeMax:undefined,chartRangeMin:undefined,chartRangeClip:!1,tooltipFormat:new an("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:undefined,tooltipFormat:new an("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],borderWidth:0,borderColor:"#000",tooltipFormat:new an('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:undefined,targetColor:"#4a2",chartRangeMax:undefined,chartRangeMin:undefined,tooltipFormat:new an("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}}},Z='.jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}',ao=function(){var a,d;return a=function(){this.init.apply(this,arguments)},arguments.length>1?(arguments[0]?(a.prototype=ar.extend(new arguments[0],arguments[arguments.length-1]),a._super=arguments[0].prototype):a.prototype=arguments[arguments.length-1],arguments.length>2&&(d=Array.prototype.slice.call(arguments,1,-1),d.unshift(a.prototype),ar.extend.apply(ar,d))):a.prototype=arguments[0],a.prototype.cls=a,a},ar.SPFormatClass=an=ao({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(d,c){this.format=d,this.fclass=c},render:function(t,s,r){var q=this,p=t,o,n,m,l,k;return this.format.replace(this.fre,function(){var b;return n=arguments[1],m=arguments[3],o=q.precre.exec(n),o?(k=o[2],n=o[1]):k=!1,l=p[n],l===undefined?"":m&&s&&s[m]?(b=s[m],b.get?s[m].get(l)||l:s[m][l]||l):(ah(l)&&(r.get("numberFormatter")?l=r.get("numberFormatter")(l):l=ac(l,k,r.get("numberDigitGroupCount"),r.get("numberDigitGroupSep"),r.get("numberDecimalMark"))),l)})}}),ar.spformat=function(d,c){return new an(d,c)},am=function(e,d,f){return e<d?d:e>f?f:e},al=function(e,d){var f;return d===2?(f=Math.floor(e.length/2),e.length%2?e[f]:(e[f-1]+e[f])/2):e.length%2?(f=(e.length*d+d)/4,f%1?(e[Math.floor(f)]+e[Math.floor(f)-1])/2:e[f-1]):(f=(e.length*d+2)/4,f%1?(e[Math.floor(f)]+e[Math.floor(f)-1])/2:e[f-1])},ak=function(d){var c;switch(d){case"undefined":d=undefined;break;case"null":d=null;break;case"true":d=!0;break;case"false":d=!1;break;default:c=parseFloat(d),d==c&&(d=c)}return d},aj=function(e){var d,f=[];for(d=e.length;d--;){f[d]=ak(e[d])}return f},ai=function(g,f){var j,i,h=[];for(j=0,i=g.length;j<i;j++){g[j]!==f&&h.push(g[j])}return h},ah=function(b){return !isNaN(parseFloat(b))&&isFinite(b)},ac=function(a,n,m,l,k){var j,i;a=(n===!1?parseFloat(a).toString():a.toFixed(n)).split(""),j=(j=ar.inArray(".",a))<0?a.length:j,j<a.length&&(a[j]=k);for(i=j-m;i>0;i-=m){a.splice(i,0,l)}return a.join("")},ag=function(f,e,h){var g;for(g=e.length;g--;){if(h&&e[g]===null){continue}if(e[g]!==f){return !1}}return !0},af=function(e){var d=0,f;for(f=e.length;f--;){d+=typeof e[f]=="number"?e[f]:0}return d},ad=function(a){return ar.isArray(a)?a:[a]},ae=function(d){var c;document.createStyleSheet?document.createStyleSheet().cssText=d:(c=document.createElement("style"),c.type="text/css",document.getElementsByTagName("head")[0].appendChild(c),c[typeof document.body.style.WebkitAppearance=="string"?"innerText":"innerHTML"]=d)},ar.fn.simpledraw=function(a,l,k,j){var i,h;if(k&&(i=this.data("_jqs_vcanvas"))){return i}a===undefined&&(a=ar(this).innerWidth()),l===undefined&&(l=ar(this).innerHeight());if(ar.fn.sparkline.hasCanvas){i=new R(a,l,this,j)}else{if(!ar.fn.sparkline.hasVML){return !1}i=new P(a,l,this)}return h=ar(this).data("_jqs_mhandler"),h&&h.registerCanvas(i),i},ar.fn.cleardraw=function(){var b=this.data("_jqs_vcanvas");b&&b.reset()},ar.RangeMapClass=aa=ao({init:function(f){var e,h,g=[];for(e in f){f.hasOwnProperty(e)&&typeof e=="string"&&e.indexOf(":")>-1&&(h=e.split(":"),h[0]=h[0].length===0?-Infinity:parseFloat(h[0]),h[1]=h[1].length===0?Infinity:parseFloat(h[1]),h[2]=f[e],g.push(h))}this.map=f,this.rangelist=g||!1},get:function(g){var f=this.rangelist,j,i,h;if((h=this.map[g])!==undefined){return h}if(f){for(j=f.length;j--;){i=f[j];if(i[0]<=g&&i[1]>=g){return i[2]}}}return undefined}}),ar.range_map=function(b){return new aa(b)},Y=ao({init:function(a,f){var e=ar(a);this.$el=e,this.options=f,this.currentPageX=0,this.currentPageY=0,this.el=a,this.splist=[],this.tooltip=null,this.over=!1,this.displayTooltips=!f.get("disableTooltips"),this.highlightEnabled=!f.get("disableHighlight")},registerSparkline:function(b){this.splist.push(b),this.over&&this.updateDisplay()},registerCanvas:function(a){var d=ar(a.canvas);this.canvas=a,this.$canvas=d,d.mouseenter(ar.proxy(this.mouseenter,this)),d.mouseleave(ar.proxy(this.mouseleave,this)),d.click(ar.proxy(this.mouseclick,this))},reset:function(b){this.splist=[],this.tooltip&&b&&(this.tooltip.remove(),this.tooltip=undefined)},mouseclick:function(a){var d=ar.Event("sparklineClick");d.originalEvent=a,d.sparklines=this.splist,this.$el.trigger(d)},mouseenter:function(a){ar(document.body).unbind("mousemove.jqs"),ar(document.body).bind("mousemove.jqs",ar.proxy(this.mousemove,this)),this.over=!0,this.currentPageX=a.pageX,this.currentPageY=a.pageY,this.currentEl=a.target,!this.tooltip&&this.displayTooltips&&(this.tooltip=new W(this.options),this.tooltip.updatePosition(a.pageX,a.pageY)),this.updateDisplay()},mouseleave:function(){ar(document.body).unbind("mousemove.jqs");var a=this.splist,j=a.length,i=!1,h,g;this.over=!1,this.currentEl=null,this.tooltip&&(this.tooltip.remove(),this.tooltip=null);for(g=0;g<j;g++){h=a[g],h.clearRegionHighlight()&&(i=!0)}i&&this.canvas.render()},mousemove:function(b){this.currentPageX=b.pageX,this.currentPageY=b.pageY,this.currentEl=b.target,this.tooltip&&this.tooltip.updatePosition(b.pageX,b.pageY),this.updateDisplay()},updateDisplay:function(){var v=this.splist,u=v.length,t=!1,s=this.$canvas.offset(),r=this.currentPageX-s.left,q=this.currentPageY-s.top,p,o,n,m,a;if(!this.over){return}for(n=0;n<u;n++){o=v[n],m=o.setRegionHighlight(this.currentEl,r,q),m&&(t=!0)}if(t){a=ar.Event("sparklineRegionChange"),a.sparklines=this.splist,this.$el.trigger(a);if(this.tooltip){p="";for(n=0;n<u;n++){o=v[n],p+=o.getCurrentRegionTooltip()}this.tooltip.setContent(p)}this.disableHighlight||this.canvas.render()}m===null&&this.mouseleave()}}),W=ao({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(a){var h=a.get("tooltipClassname","jqstooltip"),g=this.sizeStyle,f;this.container=a.get("tooltipContainer")||document.body,this.tooltipOffsetX=a.get("tooltipOffsetX",10),this.tooltipOffsetY=a.get("tooltipOffsetY",12),ar("#jqssizetip").remove(),ar("#jqstooltip").remove(),this.sizetip=ar("<div/>",{id:"jqssizetip",style:g,"class":h}),this.tooltip=ar("<div/>",{id:"jqstooltip","class":h}).appendTo(this.container),f=this.tooltip.offset(),this.offsetLeft=f.left,this.offsetTop=f.top,this.hidden=!0,ar(window).unbind("resize.jqs scroll.jqs"),ar(window).bind("resize.jqs scroll.jqs",ar.proxy(this.updateWindowDims,this)),this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=ar(window).scrollTop(),this.scrollLeft=ar(window).scrollLeft(),this.scrollRight=this.scrollLeft+ar(window).width(),this.updatePosition()},getSize:function(b){this.sizetip.html(b).appendTo(this.container),this.width=this.sizetip.width()+1,this.height=this.sizetip.height(),this.sizetip.remove()},setContent:function(b){if(!b){this.tooltip.css("visibility","hidden"),this.hidden=!0;return}this.getSize(b),this.tooltip.html(b).css({width:this.width,height:this.height,visibility:"visible"}),this.hidden&&(this.hidden=!1,this.updatePosition())},updatePosition:function(d,c){if(d===undefined){if(this.mousex===undefined){return}d=this.mousex-this.offsetLeft,c=this.mousey-this.offsetTop}else{this.mousex=d-=this.offsetLeft,this.mousey=c-=this.offsetTop}if(!this.height||!this.width||this.hidden){return}c-=this.height+this.tooltipOffsetY,d+=this.tooltipOffsetX,c<this.scrollTop&&(c=this.scrollTop),d<this.scrollLeft?d=this.scrollLeft:d+this.width>this.scrollRight&&(d=this.scrollRight-this.width),this.tooltip.css({left:d,top:c})},remove:function(){this.tooltip.remove(),this.sizetip.remove(),this.sizetip=this.tooltip=undefined,ar(window).unbind("resize.jqs scroll.jqs")}}),X=function(){ae(Z)},ar(X),N=[],ar.fn.sparkline=function(a,d){return this.each(function(){var i=new ar.fn.sparkline.options(this,d),h=ar(this),c,b;c=function(){var q,p,o,n,m,l,e;if(a==="html"||a===undefined){e=this.getAttribute(i.get("tagValuesAttribute"));if(e===undefined||e===null){e=h.html()}q=e.replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(",")}else{q=a}p=i.get("width")==="auto"?q.length*i.get("defaultPixelsPerValue"):i.get("width");if(i.get("height")==="auto"){if(!i.get("composite")||!ar.data(this,"_jqs_vcanvas")){n=document.createElement("span"),n.innerHTML="a",h.html(n),o=ar(n).innerHeight()||ar(n).height(),ar(n).remove(),n=null}}else{o=i.get("height")}i.get("disableInteraction")?m=!1:(m=ar.data(this,"_jqs_mhandler"),m?i.get("composite")||m.reset():(m=new Y(this,i),ar.data(this,"_jqs_mhandler",m)));if(i.get("composite")&&!ar.data(this,"_jqs_vcanvas")){ar.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),ar.data(this,"_jqs_errnotify",!0));return}l=new (ar.fn.sparkline[i.get("type")])(this,q,i,p,o),l.render(),m&&m.registerSparkline(l)};if(ar(this).html()&&!i.get("disableHiddenCheck")&&ar(this).is(":hidden")||ar.fn.jquery<"1.3.0"&&ar(this).parents().is(":hidden")||!ar(this).parents("body").length){if(!i.get("composite")&&ar.data(this,"_jqs_pending")){for(b=N.length;b;b--){N[b-1][0]==this&&N.splice(b-1,1)}}N.push([this,c]),ar.data(this,"_jqs_pending",!0)}else{c.call(this)}})},ar.fn.sparkline.defaults=ap(),ar.sparkline_display_visible=function(){var a,h,g,f=[];for(h=0,g=N.length;h<g;h++){a=N[h][0],ar(a).is(":visible")&&!ar(a).parents().is(":hidden")?(N[h][1].call(a),ar.data(N[h][0],"_jqs_pending",!1),f.push(h)):!ar(a).closest("html").length&&!ar.data(a,"_jqs_pending")&&(ar.data(N[h][0],"_jqs_pending",!1),f.push(h))}for(h=f.length;h;h--){N.splice(f[h-1],1)}},ar.fn.sparkline.options=ao({init:function(l,k){var j,i,b,a;this.userOptions=k=k||{},this.tag=l,this.tagValCache={},i=ar.fn.sparkline.defaults,b=i.common,this.tagOptionsPrefix=k.enableTagOptions&&(k.tagOptionsPrefix||b.tagOptionsPrefix),a=this.getTagSetting("type"),a===aq?j=i[k.type||b.type]:j=i[a],this.mergedOptions=ar.extend({},b,j,k)},getTagSetting:function(b){var l=this.tagOptionsPrefix,k,j,i,h;if(l===!1||l===undefined){return aq}if(this.tagValCache.hasOwnProperty(b)){k=this.tagValCache.key}else{k=this.tag.getAttribute(l+b);if(k===undefined||k===null){k=aq}else{if(k.substr(0,1)==="["){k=k.substr(1,k.length-2).split(",");for(j=k.length;j--;){k[j]=ak(k[j].replace(/(^\s*)|(\s*$)/g,""))}}else{if(k.substr(0,1)==="{"){i=k.substr(1,k.length-2).split(","),k={};for(j=i.length;j--;){h=i[j].split(":",2),k[h[0].replace(/(^\s*)|(\s*$)/g,"")]=ak(h[1].replace(/(^\s*)|(\s*$)/g,""))}}else{k=ak(k)}}}this.tagValCache.key=k}return k},get:function(b,h){var g=this.getTagSetting(b),f;return g!==aq?g:(f=this.mergedOptions[b])===undefined?h:f}}),ar.fn.sparkline._base=ao({disabled:!1,init:function(a,j,i,h,g){this.el=a,this.$el=ar(a),this.values=j,this.options=i,this.width=h,this.height=g,this.currentRegion=undefined},initTarget:function(){var b=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),b))?(this.canvasWidth=this.target.pixelWidth,this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return this.disabled?(this.el.innerHTML="",!1):!0},getRegion:function(d,c){},setRegionHighlight:function(h,g,l){var k=this.currentRegion,j=!this.options.get("disableHighlight"),i;return g>this.canvasWidth||l>this.canvasHeight||g<0||l<0?null:(i=this.getRegion(h,g,l),k!==i?(k!==undefined&&j&&this.removeHighlight(),this.currentRegion=i,i!==undefined&&j&&this.renderHighlight(),!0):!1)},clearRegionHighlight:function(){return this.currentRegion!==undefined?(this.removeHighlight(),this.currentRegion=undefined,!0):!1},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(b){},getCurrentRegionTooltip:function(){var G=this.options,F="",E=[],D,C,B,A,z,y,x,w,v,u,t,e,a,H;if(this.currentRegion===undefined){return""}D=this.getCurrentRegionFields(),t=G.get("tooltipFormatter");if(t){return t(this,G,D)}G.get("tooltipChartTitle")&&(F+='<div class="jqs jqstitle">'+G.get("tooltipChartTitle")+"</div>\n"),C=this.options.get("tooltipFormat");if(!C){return""}ar.isArray(C)||(C=[C]),ar.isArray(D)||(D=[D]),x=this.options.get("tooltipFormatFieldlist"),w=this.options.get("tooltipFormatFieldlistKey");if(x&&w){v=[];for(y=D.length;y--;){u=D[y][w],(H=ar.inArray(u,x))!=-1&&(v[H]=D[y])}D=v}B=C.length,a=D.length;for(y=0;y<B;y++){e=C[y],typeof e=="string"&&(e=new an(e)),A=e.fclass||"jqsfield";for(H=0;H<a;H++){if(!D[H].isNull||!G.get("tooltipSkipNull")){ar.extend(D[H],{prefix:G.get("tooltipPrefix"),suffix:G.get("tooltipSuffix")}),z=e.render(D[H],G.get("tooltipValueLookups"),G),E.push('<div class="'+A+'">'+z+"</div>")}}}return E.length?F+E.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(j,f){var p=f.get("highlightColor"),o=f.get("highlightLighten"),n,m,l,k;if(p){return p}if(o){n=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(j)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(j);if(n){l=[],m=j.length===4?16:1;for(k=0;k<3;k++){l[k]=am(Math.round(parseInt(n[k+1],16)*m*o),0,255)}return"rgb("+l.join(",")+")"}}return j}}),U={changeHighlight:function(a){var j=this.currentRegion,i=this.target,h=this.regionShapes[j],g;h&&(g=this.renderRegion(j,a),ar.isArray(g)||ar.isArray(h)?(i.replaceWithShapes(h,g),this.regionShapes[j]=ar.map(g,function(b){return b.id})):(i.replaceWithShape(h,g),this.regionShapes[j]=g.id))},render:function(){var a=this.values,n=this.target,m=this.regionShapes,l,k,j,i;if(!this.cls._super.render.call(this)){return}for(j=a.length;j--;){l=this.renderRegion(j);if(l){if(ar.isArray(l)){k=[];for(i=l.length;i--;){l[i].append(),k.push(l[i].id)}m[j]=k}else{l.append(),m[j]=l.id}}else{m[j]=null}}n.render()}},ar.fn.sparkline.line=S=ao(ar.fn.sparkline._base,{type:"line",init:function(g,f,j,i,h){S._super.init.call(this,g,f,j,i,h),this.vertices=[],this.regionMap=[],this.xvalues=[],this.yvalues=[],this.yminmax=[],this.hightlightSpotId=null,this.lastShapeId=null,this.initTarget()},getRegion:function(g,f,j){var i,h=this.regionMap;for(i=h.length;i--;){if(h[i]!==null&&f>=h[i][0]&&f<=h[i][1]){return h[i][2]}}return undefined},getCurrentRegionFields:function(){var b=this.currentRegion;return{isNull:this.yvalues[b]===null,x:this.xvalues[b],y:this.yvalues[b],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:b}},renderHighlight:function(){var r=this.currentRegion,q=this.target,p=this.vertices[r],o=this.options,n=o.get("spotRadius"),m=o.get("highlightSpotColor"),l=o.get("highlightLineColor"),k,j;if(!p){return}n&&m&&(k=q.drawCircle(p[0],p[1],n,undefined,m),this.highlightSpotId=k.id,q.insertAfterShape(this.lastShapeId,k)),l&&(j=q.drawLine(p[0],this.canvasTop,p[0],this.canvasTop+this.canvasHeight,l),this.highlightLineId=j.id,q.insertAfterShape(this.lastShapeId,j))},removeHighlight:function(){var b=this.target;this.highlightSpotId&&(b.removeShapeId(this.highlightSpotId),this.highlightSpotId=null),this.highlightLineId&&(b.removeShapeId(this.highlightLineId),this.highlightLineId=null)},scanValues:function(){var t=this.values,s=t.length,r=this.xvalues,q=this.yvalues,p=this.yminmax,o,n,m,l,k;for(o=0;o<s;o++){n=t[o],m=typeof t[o]=="string",l=typeof t[o]=="object"&&t[o] instanceof Array,k=m&&t[o].split(":"),m&&k.length===2?(r.push(Number(k[0])),q.push(Number(k[1])),p.push(Number(k[1]))):l?(r.push(n[0]),q.push(n[1]),p.push(n[1])):(r.push(o),t[o]===null||t[o]==="null"?q.push(null):(q.push(Number(n)),p.push(Number(n))))}this.options.get("xvalues")&&(r=this.options.get("xvalues")),this.maxy=this.maxyorg=Math.max.apply(Math,p),this.miny=this.minyorg=Math.min.apply(Math,p),this.maxx=Math.max.apply(Math,r),this.minx=Math.min.apply(Math,r),this.xvalues=r,this.yvalues=q,this.yminmax=p},processRangeOptions:function(){var e=this.options,d=e.get("normalRangeMin"),f=e.get("normalRangeMax");d!==undefined&&(d<this.miny&&(this.miny=d),f>this.maxy&&(this.maxy=f)),e.get("chartRangeMin")!==undefined&&(e.get("chartRangeClip")||e.get("chartRangeMin")<this.miny)&&(this.miny=e.get("chartRangeMin")),e.get("chartRangeMax")!==undefined&&(e.get("chartRangeClip")||e.get("chartRangeMax")>this.maxy)&&(this.maxy=e.get("chartRangeMax")),e.get("chartRangeMinX")!==undefined&&(e.get("chartRangeClipX")||e.get("chartRangeMinX")<this.minx)&&(this.minx=e.get("chartRangeMinX")),e.get("chartRangeMaxX")!==undefined&&(e.get("chartRangeClipX")||e.get("chartRangeMaxX")>this.maxx)&&(this.maxx=e.get("chartRangeMaxX"))},drawNormalRange:function(r,q,p,o,n){var m=this.options.get("normalRangeMin"),l=this.options.get("normalRangeMax"),k=q+Math.round(p-p*((l-this.miny)/n)),j=Math.round(p*(l-m)/n);this.target.drawRect(r,k,o,j,undefined,this.options.get("normalRangeColor")).append()},render:function(){var aV=this.options,aU=this.target,aT=this.canvasWidth,aS=this.canvasHeight,aR=this.vertices,aQ=aV.get("spotRadius"),aP=this.regionMap,aO,aN,aM,aL,aK,aJ,aI,aH,aE,aC,aA,ax,av,at,q,a,aG,aF,aD,aB,az,ay,aw,au,u;if(!S._super.render.call(this)){return}this.scanValues(),this.processRangeOptions(),aw=this.xvalues,au=this.yvalues;if(!this.yminmax.length||this.yvalues.length<2){return}aL=aK=0,aO=this.maxx-this.minx===0?1:this.maxx-this.minx,aN=this.maxy-this.miny===0?1:this.maxy-this.miny,aM=this.yvalues.length-1,aQ&&(aT<aQ*4||aS<aQ*4)&&(aQ=0);if(aQ){az=aV.get("highlightSpotColor")&&!aV.get("disableInteraction");if(az||aV.get("minSpotColor")||aV.get("spotColor")&&au[aM]===this.miny){aS-=Math.ceil(aQ)}if(az||aV.get("maxSpotColor")||aV.get("spotColor")&&au[aM]===this.maxy){aS-=Math.ceil(aQ),aL+=Math.ceil(aQ)}if(az||(aV.get("minSpotColor")||aV.get("maxSpotColor"))&&(au[0]===this.miny||au[0]===this.maxy)){aK+=Math.ceil(aQ),aT-=Math.ceil(aQ)}if(az||aV.get("spotColor")||aV.get("minSpotColor")||aV.get("maxSpotColor")&&(au[aM]===this.miny||au[aM]===this.maxy)){aT-=Math.ceil(aQ)}}aS--,aV.get("normalRangeMin")!==undefined&&!aV.get("drawNormalOnTop")&&this.drawNormalRange(aK,aL,aS,aT,aN),aI=[],aH=[aI],at=q=null,a=au.length;for(u=0;u<a;u++){aE=aw[u],aA=aw[u+1],aC=au[u],ax=aK+Math.round((aE-this.minx)*(aT/aO)),av=u<a-1?aK+Math.round((aA-this.minx)*(aT/aO)):aT,q=ax+(av-ax)/2,aP[u]=[at||0,q,u],at=q,aC===null?u&&(au[u-1]!==null&&(aI=[],aH.push(aI)),aR.push(null)):(aC<this.miny&&(aC=this.miny),aC>this.maxy&&(aC=this.maxy),aI.length||aI.push([ax,aL+aS]),aJ=[ax,aL+Math.round(aS-aS*((aC-this.miny)/aN))],aI.push(aJ),aR.push(aJ))}aG=[],aF=[],aD=aH.length;for(u=0;u<aD;u++){aI=aH[u],aI.length&&(aV.get("fillColor")&&(aI.push([aI[aI.length-1][0],aL+aS]),aF.push(aI.slice(0)),aI.pop()),aI.length>2&&(aI[0]=[aI[0][0],aI[1][1]]),aG.push(aI))}aD=aF.length;for(u=0;u<aD;u++){aU.drawShape(aF[u],aV.get("fillColor"),aV.get("fillColor")).append()}aV.get("normalRangeMin")!==undefined&&aV.get("drawNormalOnTop")&&this.drawNormalRange(aK,aL,aS,aT,aN),aD=aG.length;for(u=0;u<aD;u++){aU.drawShape(aG[u],aV.get("lineColor"),undefined,aV.get("lineWidth")).append()}if(aQ&&aV.get("valueSpots")){aB=aV.get("valueSpots"),aB.get===undefined&&(aB=new aa(aB));for(u=0;u<a;u++){ay=aB.get(au[u]),ay&&aU.drawCircle(aK+Math.round((aw[u]-this.minx)*(aT/aO)),aL+Math.round(aS-aS*((au[u]-this.miny)/aN)),aQ,undefined,ay).append()}}aQ&&aV.get("spotColor")&&au[aM]!==null&&aU.drawCircle(aK+Math.round((aw[aw.length-1]-this.minx)*(aT/aO)),aL+Math.round(aS-aS*((au[aM]-this.miny)/aN)),aQ,undefined,aV.get("spotColor")).append(),this.maxy!==this.minyorg&&(aQ&&aV.get("minSpotColor")&&(aE=aw[ar.inArray(this.minyorg,au)],aU.drawCircle(aK+Math.round((aE-this.minx)*(aT/aO)),aL+Math.round(aS-aS*((this.minyorg-this.miny)/aN)),aQ,undefined,aV.get("minSpotColor")).append()),aQ&&aV.get("maxSpotColor")&&(aE=aw[ar.inArray(this.maxyorg,au)],aU.drawCircle(aK+Math.round((aE-this.minx)*(aT/aO)),aL+Math.round(aS-aS*((this.maxyorg-this.miny)/aN)),aQ,undefined,aV.get("maxSpotColor")).append())),this.lastShapeId=aU.getLastShapeId(),this.canvasTop=aL,aU.render()}}),ar.fn.sparkline.bar=Q=ao(ar.fn.sparkline._base,U,{type:"bar",init:function(aW,aV,aU,aT,aS){var aR=parseInt(aU.get("barWidth"),10),aQ=parseInt(aU.get("barSpacing"),10),aP=aU.get("chartRangeMin"),aO=aU.get("chartRangeMax"),aN=aU.get("chartRangeClip"),aM=Infinity,aL=-Infinity,aK,aJ,aI,aH,aG,aF,aE,aD,aC,aB,aA,az,ay,ax,aw,av,au,at,v,q,j,i,h;Q._super.init.call(this,aW,aV,aU,aT,aS);for(aF=0,aE=aV.length;aF<aE;aF++){q=aV[aF],aK=typeof q=="string"&&q.indexOf(":")>-1;if(aK||ar.isArray(q)){aw=!0,aK&&(q=aV[aF]=aj(q.split(":"))),q=ai(q,null),aJ=Math.min.apply(Math,q),aI=Math.max.apply(Math,q),aJ<aM&&(aM=aJ),aI>aL&&(aL=aI)}}this.stacked=aw,this.regionShapes={},this.barWidth=aR,this.barSpacing=aQ,this.totalBarWidth=aR+aQ,this.width=aT=aV.length*aR+(aV.length-1)*aQ,this.initTarget(),aN&&(ay=aP===undefined?-Infinity:aP,ax=aO===undefined?Infinity:aO),aG=[],aH=aw?[]:aG;var f=[],a=[];for(aF=0,aE=aV.length;aF<aE;aF++){if(aw){av=aV[aF],aV[aF]=v=[],f[aF]=0,aH[aF]=a[aF]=0;for(au=0,at=av.length;au<at;au++){q=v[au]=aN?am(av[au],ay,ax):av[au],q!==null&&(q>0&&(f[aF]+=q),aM<0&&aL>0?q<0?a[aF]+=Math.abs(q):aH[aF]+=q:aH[aF]+=Math.abs(q-(q<0?aL:aM)),aG.push(q))}}else{q=aN?am(aV[aF],ay,ax):aV[aF],q=aV[aF]=ak(q),q!==null&&aG.push(q)}}this.max=az=Math.max.apply(Math,aG),this.min=aA=Math.min.apply(Math,aG),this.stackMax=aL=aw?Math.max.apply(Math,f):az,this.stackMin=aM=aw?Math.min.apply(Math,aG):aA,aU.get("chartRangeMin")!==undefined&&(aU.get("chartRangeClip")||aU.get("chartRangeMin")<aA)&&(aA=aU.get("chartRangeMin")),aU.get("chartRangeMax")!==undefined&&(aU.get("chartRangeClip")||aU.get("chartRangeMax")>az)&&(az=aU.get("chartRangeMax")),this.zeroAxis=aC=aU.get("zeroAxis",!0),aA<=0&&az>=0&&aC?aB=0:aC==0?aB=aA:aA>0?aB=aA:aB=az,this.xaxisOffset=aB,aD=aw?Math.max.apply(Math,aH)+Math.max.apply(Math,a):az-aA,this.canvasHeightEf=aC&&aA<0?this.canvasHeight-2:this.canvasHeight-1,aA<aB?(i=aw&&az>=0?aL:az,j=(i-aB)/aD*this.canvasHeight,j!==Math.ceil(j)&&(this.canvasHeightEf-=2,j=Math.ceil(j))):j=this.canvasHeight,this.yoffset=j,ar.isArray(aU.get("colorMap"))?(this.colorMapByIndex=aU.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=aU.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===undefined&&(this.colorMapByValue=new aa(this.colorMapByValue))),this.range=aD},getRegion:function(f,e,h){var g=Math.floor(e/this.totalBarWidth);return g<0||g>=this.values.length?undefined:g},getCurrentRegionFields:function(){var g=this.currentRegion,f=ad(this.values[g]),j=[],i,h;for(h=f.length;h--;){i=f[h],j.push({isNull:i===null,value:i,color:this.calcColor(h,i,g),offset:g})}return j},calcColor:function(a,p,o){var n=this.colorMapByIndex,m=this.colorMapByValue,l=this.options,k,j;return this.stacked?k=l.get("stackedBarColor"):k=p<0?l.get("negBarColor"):l.get("barColor"),p===0&&l.get("zeroColor")!==undefined&&(k=l.get("zeroColor")),m&&(j=m.get(p))?k=j:n&&n.length>o&&(k=n[o]),ar.isArray(k)?k[a%k.length]:k},renderRegion:function(aB,aA){var az=this.values[aB],ay=this.options,ax=this.xaxisOffset,aw=[],av=this.range,au=this.stacked,at=this.target,I=aB*this.totalBarWidth,H=this.canvasHeightEf,G=this.yoffset,F,E,D,C,B,A,z,y,l,a;az=ar.isArray(az)?az:[az],z=az.length,y=az[0],C=ag(null,az),a=ag(ax,az,!0);if(C){return ay.get("nullColor")?(D=aA?ay.get("nullColor"):this.calcHighlightColor(ay.get("nullColor"),ay),F=G>0?G-1:G,at.drawRect(I,F,this.barWidth-1,0,D,D)):undefined}B=G;for(A=0;A<z;A++){y=az[A];if(au&&y===ax){if(!a||l){continue}l=!0}av>0?E=Math.floor(H*(Math.abs(y-ax)/av))+1:E=1,y<ax||y===ax&&G===0?(F=B,B+=E):(F=G-E,G-=E),D=this.calcColor(A,y,aB),aA&&(D=this.calcHighlightColor(D,ay)),aw.push(at.drawRect(I,F,this.barWidth-1,E-1,D,D))}return aw.length===1?aw[0]:aw}}),ar.fn.sparkline.tristate=O=ao(ar.fn.sparkline._base,U,{type:"tristate",init:function(a,n,m,l,k){var j=parseInt(m.get("barWidth"),10),i=parseInt(m.get("barSpacing"),10);O._super.init.call(this,a,n,m,l,k),this.regionShapes={},this.barWidth=j,this.barSpacing=i,this.totalBarWidth=j+i,this.values=ar.map(n,Number),this.width=l=n.length*j+(n.length-1)*i,ar.isArray(m.get("colorMap"))?(this.colorMapByIndex=m.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=m.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===undefined&&(this.colorMapByValue=new aa(this.colorMapByValue))),this.initTarget()},getRegion:function(e,d,f){return Math.floor(d/this.totalBarWidth)},getCurrentRegionFields:function(){var b=this.currentRegion;return{isNull:this.values[b]===undefined,value:this.values[b],color:this.calcColor(this.values[b],b),offset:b}},calcColor:function(j,i){var p=this.values,o=this.options,n=this.colorMapByIndex,m=this.colorMapByValue,l,k;return m&&(k=m.get(j))?l=k:n&&n.length>i?l=n[i]:p[i]<0?l=o.get("negBarColor"):p[i]>0?l=o.get("posBarColor"):l=o.get("zeroBarColor"),l},renderRegion:function(v,u){var t=this.values,s=this.options,r=this.target,q,p,o,n,m,l;q=r.pixelHeight,o=Math.round(q/2),n=v*this.totalBarWidth,t[v]<0?(m=o,p=o-1):t[v]>0?(m=0,p=o-1):(m=o-1,p=2),l=this.calcColor(t[v],v);if(l===null){return}return u&&(l=this.calcHighlightColor(l,s)),r.drawRect(n,m,this.barWidth-1,p-1,l,l)}}),ar.fn.sparkline.discrete=M=ao(ar.fn.sparkline._base,U,{type:"discrete",init:function(a,j,i,h,g){M._super.init.call(this,a,j,i,h,g),this.regionShapes={},this.values=j=ar.map(j,Number),this.min=Math.min.apply(Math,j),this.max=Math.max.apply(Math,j),this.range=this.max-this.min,this.width=h=i.get("width")==="auto"?j.length*2:this.width,this.interval=Math.floor(h/j.length),this.itemWidth=h/j.length,i.get("chartRangeMin")!==undefined&&(i.get("chartRangeClip")||i.get("chartRangeMin")<this.min)&&(this.min=i.get("chartRangeMin")),i.get("chartRangeMax")!==undefined&&(i.get("chartRangeClip")||i.get("chartRangeMax")>this.max)&&(this.max=i.get("chartRangeMax")),this.initTarget(),this.target&&(this.lineHeight=i.get("lineHeight")==="auto"?Math.round(this.canvasHeight*0.3):i.get("lineHeight"))},getRegion:function(e,d,f){return Math.floor(d/this.itemWidth)},getCurrentRegionFields:function(){var b=this.currentRegion;return{isNull:this.values[b]===undefined,value:this.values[b],offset:b}},renderRegion:function(F,E){var D=this.values,C=this.options,B=this.min,A=this.max,z=this.range,y=this.interval,x=this.target,w=this.canvasHeight,v=this.lineHeight,u=w-v,t,s,r,f;return s=am(D[F],B,A),f=F*y,t=Math.round(u-u*((s-B)/z)),r=C.get("thresholdColor")&&s<C.get("thresholdValue")?C.get("thresholdColor"):C.get("lineColor"),E&&(r=this.calcHighlightColor(r,C)),x.drawLine(f,t,f,t+v,r)}}),ar.fn.sparkline.bullet=K=ao(ar.fn.sparkline._base,{type:"bullet",init:function(j,i,p,o,n){var m,l,k;K._super.init.call(this,j,i,p,o,n),this.values=i=aj(i),k=i.slice(),k[0]=k[0]===null?k[2]:k[0],k[1]=i[1]===null?k[2]:k[1],m=Math.min.apply(Math,i),l=Math.max.apply(Math,i),p.get("base")===undefined?m=m<0?m:0:m=p.get("base"),this.min=m,this.max=l,this.range=l-m,this.shapes={},this.valueShapes={},this.regiondata={},this.width=o=p.get("width")==="auto"?"4.0em":o,this.target=this.$el.simpledraw(o,n,p.get("composite")),i.length||(this.disabled=!0),this.initTarget()},getRegion:function(f,e,h){var g=this.target.getShapeAt(f,e,h);return g!==undefined&&this.shapes[g]!==undefined?this.shapes[g]:undefined},getCurrentRegionFields:function(){var b=this.currentRegion;return{fieldkey:b.substr(0,1),value:this.values[b.substr(1)],region:b}},changeHighlight:function(f){var e=this.currentRegion,h=this.valueShapes[e],g;delete this.shapes[h];switch(e.substr(0,1)){case"r":g=this.renderRange(e.substr(1),f);break;case"p":g=this.renderPerformance(f);break;case"t":g=this.renderTarget(f)}this.valueShapes[e]=g.id,this.shapes[g.id]=e,this.target.replaceWithShape(h,g)},renderRange:function(g,f){var j=this.values[g],i=Math.round(this.canvasWidth*((j-this.min)/this.range)),h=this.options.get("rangeColors")[g-2];return f&&(h=this.calcHighlightColor(h,this.options)),this.target.drawRect(0,0,i-1,this.canvasHeight-1,h,h)},renderPerformance:function(f){var e=this.values[1],h=Math.round(this.canvasWidth*((e-this.min)/this.range)),g=this.options.get("performanceColor");return f&&(g=this.calcHighlightColor(g,this.options)),this.target.drawRect(0,Math.round(this.canvasHeight*0.3),h-1,Math.round(this.canvasHeight*0.4)-1,g,g)},renderTarget:function(h){var g=this.values[0],l=Math.round(this.canvasWidth*((g-this.min)/this.range)-this.options.get("targetWidth")/2),k=Math.round(this.canvasHeight*0.1),j=this.canvasHeight-k*2,i=this.options.get("targetColor");return h&&(i=this.calcHighlightColor(i,this.options)),this.target.drawRect(l,k,this.options.get("targetWidth")-1,j-1,i,i)},render:function(){var f=this.values.length,e=this.target,h,g;if(!K._super.render.call(this)){return}for(h=2;h<f;h++){g=this.renderRange(h).append(),this.shapes[g.id]="r"+h,this.valueShapes["r"+h]=g.id}this.values[1]!==null&&(g=this.renderPerformance().append(),this.shapes[g.id]="p1",this.valueShapes.p1=g.id),this.values[0]!==null&&(g=this.renderTarget().append(),this.shapes[g.id]="t0",this.valueShapes.t0=g.id),e.render()}}),ar.fn.sparkline.pie=J=ao(ar.fn.sparkline._base,{type:"pie",init:function(a,n,m,l,k){var j=0,i;J._super.init.call(this,a,n,m,l,k),this.shapes={},this.valueShapes={},this.values=n=ar.map(n,Number),m.get("width")==="auto"&&(this.width=this.height);if(n.length>0){for(i=n.length;i--;){j+=n[i]}}this.total=j,this.initTarget(),this.radius=Math.floor(Math.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(f,e,h){var g=this.target.getShapeAt(f,e,h);return g!==undefined&&this.shapes[g]!==undefined?this.shapes[g]:undefined},getCurrentRegionFields:function(){var b=this.currentRegion;return{isNull:this.values[b]===undefined,value:this.values[b],percent:this.values[b]/this.total*100,color:this.options.get("sliceColors")[b%this.options.get("sliceColors").length],offset:b}},changeHighlight:function(f){var e=this.currentRegion,h=this.renderSlice(e,f),g=this.valueShapes[e];delete this.shapes[g],this.target.replaceWithShape(g,h),this.valueShapes[e]=h.id,this.shapes[h.id]=e},renderSlice:function(F,E){var D=this.target,C=this.options,B=this.radius,A=C.get("borderWidth"),z=C.get("offset"),y=2*Math.PI,x=this.values,w=this.total,v=z?2*Math.PI*(z/360):0,u,t,s,r,q;r=x.length;for(s=0;s<r;s++){u=v,t=v,w>0&&(t=v+y*(x[s]/w));if(F===s){return q=C.get("sliceColors")[s%C.get("sliceColors").length],E&&(q=this.calcHighlightColor(q,C)),D.drawPieSlice(B,B,B-A,u,t,undefined,q)}v=t}},render:function(){var i=this.target,h=this.values,n=this.options,m=this.radius,l=n.get("borderWidth"),k,j;if(!J._super.render.call(this)){return}l&&i.drawCircle(m,m,Math.floor(m-l/2),n.get("borderColor"),undefined,l).append();for(j=h.length;j--;){h[j]&&(k=this.renderSlice(j).append(),this.valueShapes[j]=k.id,this.shapes[k.id]=j)}i.render()}}),ar.fn.sparkline.box=ab=ao(ar.fn.sparkline._base,{type:"box",init:function(a,j,i,h,g){ab._super.init.call(this,a,j,i,h,g),this.values=ar.map(j,Number),this.width=i.get("width")==="auto"?"4.0em":h,this.initTarget(),this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var b=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];return this.loutlier!==undefined&&b.push({field:"lo",value:this.loutlier}),this.routlier!==undefined&&b.push({field:"ro",value:this.routlier}),this.lwhisker!==undefined&&b.push({field:"lw",value:this.lwhisker}),this.rwhisker!==undefined&&b.push({field:"rw",value:this.rwhisker}),b},render:function(){var ax=this.target,aw=this.values,av=aw.length,au=this.options,at=this.canvasWidth,I=this.canvasHeight,H=au.get("chartRangeMin")===undefined?Math.min.apply(Math,aw):au.get("chartRangeMin"),G=au.get("chartRangeMax")===undefined?Math.max.apply(Math,aw):au.get("chartRangeMax"),F=0,E,D,C,B,A,z,y,x,w,v,g;if(!ab._super.render.call(this)){return}if(au.get("raw")){au.get("showOutliers")&&aw.length>5?(D=aw[0],E=aw[1],B=aw[2],A=aw[3],z=aw[4],y=aw[5],x=aw[6]):(E=aw[0],B=aw[1],A=aw[2],z=aw[3],y=aw[4])}else{aw.sort(function(d,c){return d-c}),B=al(aw,1),A=al(aw,2),z=al(aw,3),C=z-B;if(au.get("showOutliers")){E=y=undefined;for(w=0;w<av;w++){E===undefined&&aw[w]>B-C*au.get("outlierIQR")&&(E=aw[w]),aw[w]<z+C*au.get("outlierIQR")&&(y=aw[w])}D=aw[0],x=aw[av-1]}else{E=aw[0],y=aw[av-1]}}this.quartiles=[B,A,z],this.lwhisker=E,this.rwhisker=y,this.loutlier=D,this.routlier=x,g=at/(G-H+1),au.get("showOutliers")&&(F=Math.ceil(au.get("spotRadius")),at-=2*Math.ceil(au.get("spotRadius")),g=at/(G-H+1),D<E&&ax.drawCircle((D-H)*g+F,I/2,au.get("spotRadius"),au.get("outlierLineColor"),au.get("outlierFillColor")).append(),x>y&&ax.drawCircle((x-H)*g+F,I/2,au.get("spotRadius"),au.get("outlierLineColor"),au.get("outlierFillColor")).append()),ax.drawRect(Math.round((B-H)*g+F),Math.round(I*0.1),Math.round((z-B)*g),Math.round(I*0.8),au.get("boxLineColor"),au.get("boxFillColor")).append(),ax.drawLine(Math.round((E-H)*g+F),Math.round(I/2),Math.round((B-H)*g+F),Math.round(I/2),au.get("lineColor")).append(),ax.drawLine(Math.round((E-H)*g+F),Math.round(I/4),Math.round((E-H)*g+F),Math.round(I-I/4),au.get("whiskerColor")).append(),ax.drawLine(Math.round((y-H)*g+F),Math.round(I/2),Math.round((z-H)*g+F),Math.round(I/2),au.get("lineColor")).append(),ax.drawLine(Math.round((y-H)*g+F),Math.round(I/4),Math.round((y-H)*g+F),Math.round(I-I/4),au.get("whiskerColor")).append(),ax.drawLine(Math.round((A-H)*g+F),Math.round(I*0.1),Math.round((A-H)*g+F),Math.round(I*0.9),au.get("medianColor")).append(),au.get("target")&&(v=Math.ceil(au.get("spotRadius")),ax.drawLine(Math.round((au.get("target")-H)*g+F),Math.round(I/2-v),Math.round((au.get("target")-H)*g+F),Math.round(I/2+v),au.get("targetColor")).append(),ax.drawLine(Math.round((au.get("target")-H)*g+F-v),Math.round(I/2),Math.round((au.get("target")-H)*g+F+v),Math.round(I/2),au.get("targetColor")).append()),ax.render()}}),function(){document.namespaces&&!document.namespaces.v?(ar.fn.sparkline.hasVML=!0,document.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML")):ar.fn.sparkline.hasVML=!1;var a=document.createElement("canvas");ar.fn.sparkline.hasCanvas=!!a.getContext&&!!a.getContext("2d")}(),V=ao({init:function(f,e,h,g){this.target=f,this.id=e,this.type=h,this.args=g},append:function(){return this.target.appendShape(this),this}}),T=ao({_pxregex:/(\d+)(px)?\s*$/i,init:function(a,f,e){if(!a){return}this.width=a,this.height=f,this.target=e,this.lastShapeId=null,e[0]&&(e=e[0]),ar.data(e,"_jqs_vcanvas",this)},drawLine:function(h,g,l,k,j,i){return this.drawShape([[h,g],[l,k]],j,i)},drawShape:function(f,e,h,g){return this._genShape("Shape",[f,e,h,g])},drawCircle:function(h,g,l,k,j,i){return this._genShape("Circle",[h,g,l,k,j,i])},drawPieSlice:function(i,h,n,m,l,k,j){return this._genShape("PieSlice",[i,h,n,m,l,k,j])},drawRect:function(h,g,l,k,j,i){return this._genShape("Rect",[h,g,l,k,j,i])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(a,d){ar(d).html(a)},_calculatePixelDims:function(a,h,g){var f;f=this._pxregex.exec(h),f?this.pixelHeight=f[1]:this.pixelHeight=ar(g).height(),f=this._pxregex.exec(a),f?this.pixelWidth=f[1]:this.pixelWidth=ar(g).width()},_genShape:function(e,d){var f=L++;return d.unshift(f),new V(this,f,e,d)},appendShape:function(b){alert("appendShape not implemented")},replaceWithShape:function(d,c){alert("replaceWithShape not implemented")},insertAfterShape:function(d,c){alert("insertAfterShape not implemented")},removeShapeId:function(b){alert("removeShapeId not implemented")},getShapeAt:function(e,d,f){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}}),R=ao(T,{init:function(a,h,g,f){R._super.init.call(this,a,h,g),this.canvas=document.createElement("canvas"),g[0]&&(g=g[0]),ar.data(g,"_jqs_vcanvas",this),ar(this.canvas).css({display:"inline-block",width:a,height:h,verticalAlign:"top"}),this._insert(this.canvas,g),this._calculatePixelDims(a,h,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,this.interact=f,this.shapes={},this.shapeseq=[],this.currentTargetShapeId=undefined,ar(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(f,e,h){var g=this.canvas.getContext("2d");return f!==undefined&&(g.strokeStyle=f),g.lineWidth=h===undefined?1:h,e!==undefined&&(g.fillStyle=e),g},reset:function(){var b=this._getContext();b.clearRect(0,0,this.pixelWidth,this.pixelHeight),this.shapes={},this.shapeseq=[],this.currentTargetShapeId=undefined},_drawShape:function(j,i,p,o,n){var m=this._getContext(p,o,n),l,k;m.beginPath(),m.moveTo(i[0][0]+0.5,i[0][1]+0.5);for(l=1,k=i.length;l<k;l++){m.lineTo(i[l][0]+0.5,i[l][1]+0.5)}p!==undefined&&m.stroke(),o!==undefined&&m.fill(),this.targetX!==undefined&&this.targetY!==undefined&&m.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=j)},_drawCircle:function(j,i,p,o,n,m,l){var k=this._getContext(n,m,l);k.beginPath(),k.arc(i,p,o,0,2*Math.PI,!1),this.targetX!==undefined&&this.targetY!==undefined&&k.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=j),n!==undefined&&k.stroke(),m!==undefined&&k.fill()},_drawPieSlice:function(r,q,p,o,n,m,l,k){var j=this._getContext(l,k);j.beginPath(),j.moveTo(q,p),j.arc(q,p,o,n,m,!1),j.lineTo(q,p),j.closePath(),l!==undefined&&j.stroke(),k&&j.fill(),this.targetX!==undefined&&this.targetY!==undefined&&j.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=r)},_drawRect:function(i,h,n,m,l,k,j){return this._drawShape(i,[[h,n],[h+m,n],[h+m,n+l],[h,n+l],[h,n]],k,j)},appendShape:function(b){return this.shapes[b.id]=b,this.shapeseq.push(b.id),this.lastShapeId=b.id,b.id},replaceWithShape:function(f,e){var h=this.shapeseq,g;this.shapes[e.id]=e;for(g=h.length;g--;){h[g]==f&&(h[g]=e.id)}delete this.shapes[f]},replaceWithShapes:function(i,h){var n=this.shapeseq,m={},l,k,j;for(k=i.length;k--;){m[i[k]]=!0}for(k=n.length;k--;){l=n[k],m[l]&&(n.splice(k,1),delete this.shapes[l],j=k)}for(k=h.length;k--;){n.splice(j,0,h[k].id),this.shapes[h[k].id]=h[k]}},insertAfterShape:function(f,e){var h=this.shapeseq,g;for(g=h.length;g--;){if(h[g]===f){h.splice(g+1,0,e.id),this.shapes[e.id]=e;return}}},removeShapeId:function(e){var d=this.shapeseq,f;for(f=d.length;f--;){if(d[f]===e){d.splice(f,1);break}}delete this.shapes[e]},getShapeAt:function(e,d,f){return this.targetX=d,this.targetY=f,this.render(),this.currentTargetShapeId},render:function(){var i=this.shapeseq,h=this.shapes,n=i.length,m=this._getContext(),l,k,j;m.clearRect(0,0,this.pixelWidth,this.pixelHeight);for(j=0;j<n;j++){l=i[j],k=h[l],this["_draw"+k.type].apply(this,k.args)}this.interact||(this.shapes={},this.shapeseq=[])}}),P=ao(T,{init:function(a,h,g){var f;P._super.init.call(this,a,h,g),g[0]&&(g=g[0]),ar.data(g,"_jqs_vcanvas",this),this.canvas=document.createElement("span"),ar(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:a,height:h,margin:"0px",padding:"0px",verticalAlign:"top"}),this._insert(this.canvas,g),this._calculatePixelDims(a,h,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,f='<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" style="position:absolute;top:0;left:0;width:'+this.pixelWidth+"px;height="+this.pixelHeight+'px;"></v:group>',this.canvas.insertAdjacentHTML("beforeEnd",f),this.group=ar(this.canvas).children()[0],this.rendered=!1,this.prerender=""},_drawShape:function(z,y,x,w,v){var u=[],t,s,r,q,p,o,n;for(n=0,o=y.length;n<o;n++){u[n]=""+y[n][0]+","+y[n][1]}return t=u.splice(0,1),v=v===undefined?1:v,s=x===undefined?' stroked="false" ':' strokeWeight="'+v+'px" strokeColor="'+x+'" ',r=w===undefined?' filled="false"':' fillColor="'+w+'" filled="true" ',q=u[0]===u[u.length-1]?"x ":"",p='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+z+'" '+s+r+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+t+" l "+u.join(", ")+" "+q+'e"> </v:shape>',p},_drawCircle:function(t,s,r,q,p,o,n){var m,l,k;return s-=q,r-=q,m=p===undefined?' stroked="false" ':' strokeWeight="'+n+'px" strokeColor="'+p+'" ',l=o===undefined?' filled="false"':' fillColor="'+o+'" filled="true" ',k='<v:oval  id="jqsshape'+t+'" '+m+l+' style="position:absolute;top:'+r+"px; left:"+s+"px; width:"+q*2+"px; height:"+q*2+'px"></v:oval>',k},_drawPieSlice:function(F,E,D,C,B,A,z,y){var x,w,v,u,t,s,r,q;if(B===A){return""}A-B===2*Math.PI&&(B=0,A=2*Math.PI),w=E+Math.round(Math.cos(B)*C),v=D+Math.round(Math.sin(B)*C),u=E+Math.round(Math.cos(A)*C),t=D+Math.round(Math.sin(A)*C);if(w===u&&v===t){if(A-B<Math.PI){return""}w=u=E+C,v=t=D}return w===u&&v===t&&A-B<Math.PI?"":(x=[E-C,D-C,E+C,D+C,w,v,u,t],s=z===undefined?' stroked="false" ':' strokeWeight="1px" strokeColor="'+z+'" ',r=y===undefined?' filled="false"':' fillColor="'+y+'" filled="true" ',q='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+F+'" '+s+r+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+E+","+D+" wa "+x.join(", ")+' x e"> </v:shape>',q)},_drawRect:function(i,h,n,m,l,k,j){return this._drawShape(i,[[h,n],[h,n+l],[h+m,n+l],[h+m,n],[h,n]],k,j)},reset:function(){this.group.innerHTML=""},appendShape:function(d){var c=this["_draw"+d.type].apply(this,d.args);return this.rendered?this.group.insertAdjacentHTML("beforeEnd",c):this.prerender+=c,this.lastShapeId=d.id,d.id},replaceWithShape:function(a,h){var g=ar("#jqsshape"+a),f=this["_draw"+h.type].apply(this,h.args);g[0].outerHTML=f},replaceWithShapes:function(a,l){var k=ar("#jqsshape"+a[0]),j="",i=l.length,h;for(h=0;h<i;h++){j+=this["_draw"+l[h].type].apply(this,l[h].args)}k[0].outerHTML=j;for(h=1;h<a.length;h++){ar("#jqsshape"+a[h]).remove()}},insertAfterShape:function(a,h){var g=ar("#jqsshape"+a),f=this["_draw"+h.type].apply(this,h.args);g[0].insertAdjacentHTML("afterEnd",f)},removeShapeId:function(a){var d=ar("#jqsshape"+a);this.group.removeChild(d[0])},getShapeAt:function(f,e,h){var g=f.id.substr(8);return g},render:function(){this.rendered||(this.group.innerHTML=this.prerender,this.rendered=!0)}})});
/*! scripts/fullsize_photo_slideshow.js */
(function(b,a){var c=Backbone.View.extend({initialize:function(d){this.options=d||{};this.slides=this.options.slideshow_items||[];this.root=b(this.options.slideshow_container)||b("#rad_slideshow"),this.interval=this.options.interval||3000,this.display_badge=this.options.display_badge||false,this.display_like_and_reblog=this.options.display_like_and_reblog||false,this.current_slide=false;this.next_slide=false;this.count=false;if(!this.slides.length){return}this.start_slideshow()},create_slide:function(){var d,e,h,g,f;d=b('<div class="slide" />');h=b('<a class="source" />');if(this.display_badge){e=b('<div class="radar_badge" />');d.append(e)}if(this.display_like_and_reblog){g=b('<a class="reblog reblog_button" />');f=b('<a class="like" />');d.append(g);d.append(f)}d.append(h);return d},update_slide:function(f,d){if(!d){return false}var i=f.find(".source"),g=f.find(".like"),h=f.find(".reblog"),e=f.find(".radar_badge");if(typeof(d.photo_url)!=="undefined"){f.css({"background-image":"url("+d.photo_url+")"})}if(d.source_url!==undefined){i.attr("href",d.source_url);i.attr("target","_new");if(d.source_label!==undefined){i.html(d.source_label||"Source")}}if(this.display_badge){e.addClass(d.radar_badge_class||"radar_badge")}if(this.display_like_and_reblog){if(d.like_url!==undefined){g.attr("href",d.like_url)}if(d.like_url==="#like"){g.off("click.NerdSlideshow").on("click.NerdSlideshow",function(j){j.preventDefault();var k=(!d.like_state)?"like":"unlike";Tumblr[k]({id:d.post_id,key:d.reblog_key},{complete:function(){b("#rad_slideshow_like_"+d.post_id).toggleClass("red");d.like_state=!d.like_state}})})}g.attr({id:"rad_slideshow_like_"+d.post_id,"class":(d.like_state===true)?"like red like_button":"like like_button"}).html(d.like_label||"Like");if(d.reblog_url!==undefined){h.html(d.reblog_label||"Reblog");h.attr("href",d.reblog_url)}}},transition:function(){b(this.current_slide).fadeOut(function(f){if(this.next_slide){this.next_slide.css({zIndex:1})}if(this.current_slide){this.current_slide.css({zIndex:0}).show()}var d=this.next_slide;this.next_slide=this.current_slide;this.current_slide=d;var e=this.slides[count%this.slides.length];this.update_slide(this.next_slide,e);count++;setTimeout(_.bind(this.transition,this),this.interval)}.bind(this))},start_slideshow:function(){this.current_slide=this.create_slide();this.root.append(this.current_slide);this.update_slide(this.current_slide,this.slides[0]);if(this.slides.length>1){this.next_slide=this.create_slide();this.root.append(this.next_slide);this.update_slide(this.next_slide,this.slides[1]);count=2;this.transition()}}});a.NerdSlideshow=c})(jQuery,Tumblr);
/*! scripts/radar.js */
(function(d,b,e,c){var a=e.View.extend({el:"#tumblr_radar",events:{"click a":"run_click","click .notes_outer_container.popover .follow":"notes_popover_follow","click .radar_footer .follow":"toggleFollow","click .radar_controls_buttons .reblog":"reblog","click .radar_controls_buttons .like:not(.liked)":"like","click .radar_controls_buttons .liked":"unlike"},initialize:function(){this.post_id=this.$el.attr("data-post-id");this.form_key=d("#tumblr_form_key").attr("content");this.placement_id=this.$el.attr("data-placement-id");this.$followButton=this.$(".follow");this.version=this.$el.hasClass("radar_v2")?"v2":"v1";this.is_new_radar_design=this.$el.hasClass("new_radar_design");this.postModel=Tumblr.postsView.createPostModelFromEl(this.$el);Tumblr.postsView.collection.add(this.postModel);this.tumblelogModel=this.postModel.tumblelog;this.listenTo(this.tumblelogModel,"change:following",this.renderFollow);if(this.version==="v2"&&this.$el.hasClass("radar_type_video")){var f=this.$el.find(".thumbnail_anchor");var k=d(f).data("thumbnail-urls");var j=[];for(var h=0;h<k.length;h++){j.push({photo_url:k[h]})}this.slideshow=new Tumblr.NerdSlideshow({slideshow_container:f,slideshow_items:j,display_badge:false,display_like_and_reblog:false})}else{if(this.version==="v2"&&this.$el.find(".photoset").length>0){var g=this.$el.find(".photoset");var m=d(g).data("thumbnail-urls");this.slideshow=new Tumblr.RadarPhotosetSlideshow({container:g,image_urls:m})}}var l=new Tumblr.Notes({el:this.el})},renderFollow:function(f,g){if(f._previousAttributes.following==null||f._previousAttributes.following===g){return}if(this.version==="v2"){this.$followButton[g?"hide":"show"]()}else{if(this.version==="v1"){this.$followButton.toggleClass("followed",g)}}this.$(".radar_footer").toggleClass("has_follow_button",!g)},toggleFollow:function(){this.tumblelogModel.save_following({following:!this.tumblelogModel.get("following")},{placement_id:this.placement_id,source:!this.tumblelogModel.get("following")?"FOLLOW_SOURCE_RADAR":"UNFOLLOW_SOURCE_RADAR"}).fail(function(){Tumblr.Dialog.alert(c.ajax_error)});return false},like:function(g){g.stopPropagation();g.preventDefault();var f=d(g.currentTarget);f.addClass("liked");this.show_heart_poof(f.parent(),true);this.update_note_count(true);Tumblr.like({id:this.post_id,key:f.attr("data-reblog-key"),placement_id:this.placement_id,source:"LIKE_SOURCE_RADAR"},{error:function(){f.removeClass("liked");Tumblr.Dialog.alert(c.ajax_error)}})},unlike:function(g){g.stopPropagation();g.preventDefault();var f=d(g.currentTarget);f.removeClass("liked");this.show_heart_poof(f.parent(),false);this.update_note_count(false);Tumblr.unlike({id:this.post_id,key:f.attr("data-reblog-key"),placement_id:this.placement_id,source:"UNLIKE_SOURCE_RADAR"},{error:function(){f.addClass("liked");Tumblr.Dialog.alert(c.ajax_error)}})},show_heart_poof:function(g,h){var f=d('<div class="post_animated_heart post_poof"><span class="heart_left"></span><span class="heart_right"></span></div>').toggleClass("unliked",!h);g.append(f);setTimeout(function(){f.fadeOut(200,function(){f.remove()})},300)},reblog:function(h){if(h.altKey){h.stopPropagation();h.preventDefault();var g=d(h.currentTarget);if(g.hasClass("reblogged")){return}g.addClass("reblogged");var f=this;d.ajax({url:"/fast_reblog",type:"post",data:{reblog_key:g.attr("data-reblog-key"),reblog_post_id:g.attr("data-reblog-id"),form_key:this.form_key},success:function(){if(Tumblr.CapturePremiumRadar&&f.placement_id){Tumblr.CapturePremiumRadar.track_reblog(g,h)}else{if(Tumblr.CaptureRadar){Tumblr.CaptureRadar.track_reblog(g,h)}}},error:function(){g.removeClass("reblogged");Tumblr.Dialog.alert(c.ajax_error)}})}},notes_popover_follow:function(h){var g=d(h.currentTarget);var f=g.closest(".note");var i=f.data("tumblelog");f.addClass("is_following");Tumblr.follow({tumblelog:i})},update_note_count:function(g){var f=this.$el.find(".note_link_current"),h;if(g){h=f.data("more");if(f.data("more")!==f.text()){f.data("less",f.text())}this.$el.removeClass("no_notes")}else{h=f.data("less");if(!h.length){this.$el.addClass("no_notes")}}f.text(h);f.attr("title",h)},run_click:function(h){var f=h.currentTarget.href;var g=d(h.currentTarget);if(g.is(".no_pop, .photoset_photo, .photo_exif_flipper, .fan_mail_read_more, .follow, .like, .reblog")){return}if(window.self!==window.top&&g.is(".post_control.reblog, .post_control.edit")){f=f.replace(/\?.*/,"")}else{if(g.closest(".no_pop, .post_controls, #new_post, .controls, .user_menu_list, form, .flash_notification, .more_notes_link").length>0){return}if(!f||f==="#"){return}}h.preventDefault();h.stopPropagation();window.open(f)}});b.Radar=a})(jQuery,Tumblr,Backbone,l10n_str);jQuery(document).ready(function(a){var b=a("#tumblr_radar");if(b.length){Tumblr.radar=new Tumblr.Radar({el:b})}});
/*! scripts/mb_impression_tracking.js */
(function(b,a){var c={initialize:function(){this.tracking=[];this.beacons=[];this.min_in_view=50;this.setup();Tumblr.Events.on("DOMEventor:updateRect",this.setup,this)},setup:function(){this.register("#tumblr_radar.premium[data-mb-impression-url]");this.register(".post.sponsored_post[data-mb-impression-url]");if(this.tracking.length){Tumblr.Events.on("DOMEventor:flatscroll",this.track,this);b(window).on("beforeunload.mb_track",_.bind(this.cleanup,this))}},register:function(d){_.each(b(d+":not(.mb_tracked)"),function(f){var e=b(f);e.addClass("mb_tracked");this.tracking.push({sel:d,el:f,$el:e,height:e.height(),min_in_view:(e.height()*this.min_in_view)/100,in_view:false})},this)},track:function(d){_.each(this.tracking,function(f){var e=f.el.getBoundingClientRect();if(!f.in_view&&e.top+f.min_in_view<=d.windowHeight&&e.top>0-f.min_in_view&&e.bottom-f.min_in_view<=d.windowHeight&&e.bottom>0){f.in_view=_.now();f.timeout=setTimeout(this.log_impression,1000,this,f)}else{if(f.in_view&&((e.top>d.windowHeight||e.top<0)&&(e.bottom>d.windowHeight||e.bottom<0))){clearTimeout(f.timeout);f.in_view=false}}},this)},cleanup:function(){_(this.tracking).filter("in_view").each(function(d){this.log_impression(this,d)},this)},log_impression:function(d,f){if(_.now()-f.in_view<1000){return}clearTimeout(f.timeout);var g=f.$el.data("mb-impression-url");if(_.contains(d.beacons,g)){return}var e=document.createElement("img");e.src=g;d.beacons.push(g)}};a.MoneyBallImpressionTracking=c})(jQuery,Tumblr||{});jQuery(window).load(function(){Tumblr.MoneyBallImpressionTracking.initialize()});
/*! scripts/dashboard.js */
